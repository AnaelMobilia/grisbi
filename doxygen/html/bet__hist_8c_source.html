<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Grisbi:  Fichier source de bet_hist.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Généré par Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Page&nbsp;principale</span></a></li>
      <li><a href="pages.html"><span>Pages&nbsp;associées</span></a></li>
      <li><a href="annotated.html"><span>Structures&nbsp;de&nbsp;données</span></a></li>
      <li class="current"><a href="files.html"><span>Fichiers</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>Liste&nbsp;des&nbsp;fichiers</span></a></li>
      <li><a href="globals.html"><span>Portée&nbsp;globale</span></a></li>
    </ul>
  </div>
<h1>bet_hist.c</h1><a href="bet__hist_8c.html">Aller à la documentation de ce fichier.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* ************************************************************************** */</span>
<a name="l00002"></a>00002 <span class="comment">/*                                                                            */</span>
<a name="l00003"></a>00003 <span class="comment">/*     Copyright (C) 2007 Dominique Parisot                                   */</span>
<a name="l00004"></a>00004 <span class="comment">/*          zionly@free.org                                                   */</span>
<a name="l00005"></a>00005 <span class="comment">/*          2008-2010 Pierre Biava (grisbi@pierre.biava.name)                 */</span>
<a name="l00006"></a>00006 <span class="comment">/*          http://www.grisbi.org                                             */</span>
<a name="l00007"></a>00007 <span class="comment">/*                                                                            */</span>
<a name="l00008"></a>00008 <span class="comment">/*  This program is free software; you can redistribute it and/or modify      */</span>
<a name="l00009"></a>00009 <span class="comment">/*  it under the terms of the GNU General Public License as published by      */</span>
<a name="l00010"></a>00010 <span class="comment">/*  the Free Software Foundation; either version 2 of the License, or         */</span>
<a name="l00011"></a>00011 <span class="comment">/*  (at your option) any later version.                                       */</span>
<a name="l00012"></a>00012 <span class="comment">/*                                                                            */</span>
<a name="l00013"></a>00013 <span class="comment">/*  This program is distributed in the hope that it will be useful,           */</span>
<a name="l00014"></a>00014 <span class="comment">/*  but WITHOUT ANY WARRANTY; without even the implied warranty of            */</span>
<a name="l00015"></a>00015 <span class="comment">/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the             */</span>
<a name="l00016"></a>00016 <span class="comment">/*  GNU General Public License for more details.                              */</span>
<a name="l00017"></a>00017 <span class="comment">/*                                                                            */</span>
<a name="l00018"></a>00018 <span class="comment">/*  You should have received a copy of the GNU General Public License         */</span>
<a name="l00019"></a>00019 <span class="comment">/*  along with this program; if not, write to the Free Software               */</span>
<a name="l00020"></a>00020 <span class="comment">/*  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA */</span>
<a name="l00021"></a>00021 <span class="comment">/*                                                                            */</span>
<a name="l00022"></a>00022 <span class="comment">/* ************************************************************************** */</span>
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="comment">/* ./configure --with-balance-estimate */</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="include_8h.html">include.h</a>&quot;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;config.h&gt;</span>
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 <span class="comment">/*START_INCLUDE*/</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="bet__hist_8h.html">bet_hist.h</a>&quot;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;<a class="code" href="bet__tab_8h.html">bet_tab.h</a>&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="bet__config_8h.html">bet_config.h</a>&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="bet__data_8h.html">bet_data.h</a>&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="fenetre__principale_8h.html">fenetre_principale.h</a>&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="utils__dates_8h.html">utils_dates.h</a>&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="gsb__data__account_8h.html">gsb_data_account.h</a>&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="gsb__data__fyear_8h.html">gsb_data_fyear.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="gsb__data__transaction_8h.html">gsb_data_transaction.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="gsb__fyear_8h.html">gsb_fyear.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="gsb__real_8h.html">gsb_real.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="navigation_8h.html">navigation.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="traitement__variables_8h.html">traitement_variables.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="utils__str_8h.html">utils_str.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="gsb__fyear_8h.html">gsb_fyear.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="mouse_8h.html">mouse.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="structures_8h.html">structures.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="include_8h.html">include.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="erreur_8h.html">erreur.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="comment">/*END_INCLUDE*/</span>
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 <span class="comment">/*START_STATIC*/</span>
<a name="l00052"></a>00052 <span class="keyword">static</span> <span class="keywordtype">void</span> bet_historical_add_average_amount ( GtkWidget *menu_item,
<a name="l00053"></a>00053                         GtkTreeSelection *tree_selection );
<a name="l00054"></a>00054 <span class="keyword">static</span> <span class="keywordtype">void</span> bet_historical_add_last_amount ( GtkWidget *menu_item,
<a name="l00055"></a>00055                         GtkTreeSelection *tree_selection );
<a name="l00056"></a>00056 <span class="keyword">static</span> gboolean bet_historical_affiche_div ( GHashTable  *list_div, GtkWidget *tree_view );
<a name="l00057"></a>00057 <span class="keyword">static</span> gboolean bet_historical_amount_differ_average ( GtkTreeModel *model,
<a name="l00058"></a>00058                         GtkTreeIter *iter );
<a name="l00059"></a>00059 <span class="keyword">static</span> gboolean bet_historical_button_press ( GtkWidget *tree_view,
<a name="l00060"></a>00060                         GdkEventButton *ev );
<a name="l00061"></a>00061 <span class="keyword">static</span> <span class="keywordtype">void</span> bet_historical_context_menu ( GtkWidget *tree_view );
<a name="l00062"></a>00062 <span class="keyword">static</span> <span class="keywordtype">void</span> bet_historical_div_cell_edited (GtkCellRendererText *cell,
<a name="l00063"></a>00063                         <span class="keyword">const</span> gchar *path_string,
<a name="l00064"></a>00064                         <span class="keyword">const</span> gchar *new_text,
<a name="l00065"></a>00065                         GtkWidget *tree_view );
<a name="l00066"></a>00066 <span class="keyword">static</span> <span class="keywordtype">void</span> bet_historical_div_cell_editing_started (GtkCellRenderer *cell,
<a name="l00067"></a>00067                         GtkCellEditable *editable,
<a name="l00068"></a>00068                         <span class="keyword">const</span> gchar *path_string,
<a name="l00069"></a>00069                         GtkWidget *tree_view );
<a name="l00070"></a>00070 <span class="keyword">static</span> gboolean bet_historical_div_toggle_clicked ( GtkCellRendererToggle *renderer,
<a name="l00071"></a>00071                         gchar *path_string,
<a name="l00072"></a>00072                         GtkTreeModel *model );
<a name="l00073"></a>00073 <span class="keyword">static</span> gboolean bet_historical_fyear_create_combobox_store ( <span class="keywordtype">void</span> );
<a name="l00074"></a>00074 <span class="keyword">static</span> <a class="code" href="structgsb__real.html">gsb_real</a> bet_historical_get_children_amount ( GtkTreeModel *model, GtkTreeIter *parent );
<a name="l00075"></a>00075 <span class="keyword">static</span> GtkWidget *bet_historical_get_data_tree_view ( GtkWidget *container );
<a name="l00076"></a>00076 <span class="keyword">static</span> gboolean bet_historical_get_full_div ( GtkTreeModel *model, GtkTreeIter *parent );
<a name="l00077"></a>00077 <span class="keyword">static</span> gboolean bet_historical_initializes_account_settings ( gint account_number );
<a name="l00078"></a>00078 <span class="keyword">static</span> <span class="keywordtype">void</span> bet_historical_populate_div_model ( gpointer key,
<a name="l00079"></a>00079                         gpointer value,
<a name="l00080"></a>00080                         gpointer user_data );
<a name="l00081"></a>00081 <span class="keyword">static</span> <span class="keywordtype">void</span> bet_historical_row_collapse_all ( GtkTreeView *tree_view,
<a name="l00082"></a>00082                         GtkTreeIter *iter,
<a name="l00083"></a>00083                         GtkTreeModel *model );
<a name="l00084"></a>00084 <span class="keyword">static</span> <span class="keywordtype">void</span> bet_historical_row_expanded_event ( GtkTreeView *tree_view,
<a name="l00085"></a>00085                         GtkTreeIter *iter,
<a name="l00086"></a>00086                         GtkTreePath *path,
<a name="l00087"></a>00087                         GtkTreeModel *model );
<a name="l00088"></a>00088 <span class="keyword">static</span> gboolean bet_historical_set_background_color ( GtkWidget *tree_view );
<a name="l00089"></a>00089 <span class="keyword">static</span> gboolean bet_historical_set_empty_sub_div ( GtkTreeModel *model, GtkTreeIter *parent );
<a name="l00090"></a>00090 <span class="keyword">static</span> gboolean bet_historical_set_full_sub_div ( GtkTreeModel *model, GtkTreeIter *parent );
<a name="l00091"></a>00091 <span class="comment">/*END_STATIC*/</span>
<a name="l00092"></a>00092 
<a name="l00093"></a>00093 <span class="comment">/*START_EXTERN*/</span>
<a name="l00094"></a>00094 <span class="keyword">extern</span> GtkWidget *<a class="code" href="bet__config_8c.html#ad5443d986a9ab5d64dd84c5346c4b87c">account_page</a>;
<a name="l00095"></a>00095 <span class="keyword">extern</span> GdkColor <a class="code" href="affichage_8c.html#a58089bf9225ae2e274165369f8bc7a00">couleur_fond</a>[2];
<a name="l00096"></a>00096 <span class="keyword">extern</span> GtkWidget *<a class="code" href="bet__config_8c.html#a8924516aa4170f932308e93cf93a785b">notebook_general</a>;
<a name="l00097"></a>00097 <span class="keyword">extern</span> <a class="code" href="structgsb__real.html">gsb_real</a> <a class="code" href="accueil_8c.html#a26f304bec3fdc0651b9aa8765d4de3c6">null_real</a>;
<a name="l00098"></a>00098 <span class="comment">/*END_EXTERN*/</span>
<a name="l00099"></a>00099 
<a name="l00100"></a>00100 <span class="comment">/* blocage des signaux pour le tree_view pour les comptes de type GSB_TYPE_CASH */</span>
<a name="l00101"></a>00101 <span class="keyword">static</span> gboolean hist_block_signal = FALSE;
<a name="l00102"></a>00102 
<a name="l00107"></a><a class="code" href="bet__hist_8c.html#a3b7bcf1e9b05e7a812d6f4d4bc0627d6">00107</a> GtkTreeModel *<a class="code" href="bet__config_8c.html#a3b7bcf1e9b05e7a812d6f4d4bc0627d6">bet_fyear_model</a> = NULL;
<a name="l00108"></a>00108 
<a name="l00113"></a><a class="code" href="bet__hist_8c.html#aecc63d6768ce86bba48badbe50334f1b">00113</a> GtkTreeModel *<a class="code" href="bet__config_8c.html#aecc63d6768ce86bba48badbe50334f1b">bet_fyear_model_filter</a> = NULL;
<a name="l00114"></a>00114 
<a name="l00115"></a>00115  
<a name="l00122"></a><a class="code" href="bet__hist_8h.html#a339ca48839f4c4ed5480bd2d36822c9c">00122</a> GtkWidget *<a class="code" href="bet__hist_8c.html#a339ca48839f4c4ed5480bd2d36822c9c">bet_historical_create_page</a> ( <span class="keywordtype">void</span> )
<a name="l00123"></a>00123 {
<a name="l00124"></a>00124     GtkWidget *widget;
<a name="l00125"></a>00125     GtkWidget *page;
<a name="l00126"></a>00126     GtkWidget *hbox;
<a name="l00127"></a>00127     GtkWidget *align;
<a name="l00128"></a>00128     GtkWidget *label;
<a name="l00129"></a>00129     GtkWidget *button_1, *button_2;
<a name="l00130"></a>00130     GtkWidget *tree_view;
<a name="l00131"></a>00131     gchar *str_year;
<a name="l00132"></a>00132     gint year;
<a name="l00133"></a>00133     gpointer pointer;
<a name="l00134"></a>00134 
<a name="l00135"></a>00135     <a class="code" href="erreur_8h.html#a17bfffc4306bc76edd79e060a8947dc4">devel_debug</a> (NULL);
<a name="l00136"></a>00136     page = gtk_vbox_new ( FALSE, 5 );
<a name="l00137"></a>00137     gtk_widget_set_name ( page, <span class="stringliteral">&quot;historical_page&quot;</span> );
<a name="l00138"></a>00138 
<a name="l00139"></a>00139     <span class="comment">/* titre de la page */</span>
<a name="l00140"></a>00140     align = gtk_alignment_new (0.5, 0.0, 0.0, 0.0);
<a name="l00141"></a>00141     gtk_box_pack_start ( GTK_BOX ( page ), align, FALSE, FALSE, 5) ;
<a name="l00142"></a>00142  
<a name="l00143"></a>00143     label = gtk_label_new ( <span class="stringliteral">&quot;bet_hist_title&quot;</span> );
<a name="l00144"></a>00144     gtk_container_add ( GTK_CONTAINER ( align ), label );
<a name="l00145"></a>00145     g_object_set_data ( G_OBJECT ( <a class="code" href="bet__config_8c.html#ad5443d986a9ab5d64dd84c5346c4b87c">account_page</a> ), <span class="stringliteral">&quot;bet_hist_title&quot;</span>, label);
<a name="l00146"></a>00146 
<a name="l00147"></a>00147     <span class="comment">/* Choix des données sources */</span>
<a name="l00148"></a>00148     align = gtk_alignment_new (0.5, 0.0, 0.0, 0.0);
<a name="l00149"></a>00149     gtk_box_pack_start ( GTK_BOX ( page ), align, FALSE, FALSE, 5) ;
<a name="l00150"></a>00150 
<a name="l00151"></a>00151     hbox = gtk_hbox_new ( FALSE, 5 );
<a name="l00152"></a>00152     gtk_container_add ( GTK_CONTAINER ( align ), hbox );
<a name="l00153"></a>00153     g_object_set_data ( G_OBJECT ( <a class="code" href="bet__config_8c.html#ad5443d986a9ab5d64dd84c5346c4b87c">account_page</a> ), <span class="stringliteral">&quot;bet_historical_data&quot;</span>, hbox );
<a name="l00154"></a>00154 
<a name="l00155"></a>00155     button_1 = gtk_radio_button_new_with_label ( NULL,
<a name="l00156"></a>00156                         _(<span class="stringliteral">&quot;Categories&quot;</span>) );
<a name="l00157"></a>00157     gtk_widget_set_name ( button_1, <span class="stringliteral">&quot;bet_hist_button_1&quot;</span> );
<a name="l00158"></a>00158     g_signal_connect ( G_OBJECT ( button_1 ),
<a name="l00159"></a>00159                         <span class="stringliteral">&quot;released&quot;</span>,
<a name="l00160"></a>00160                         G_CALLBACK ( <a class="code" href="bet__config_8c.html#af35307117be15ea41c6a5eebcefdf975">bet_config_origin_data_clicked</a> ),
<a name="l00161"></a>00161                         GINT_TO_POINTER ( 1 ) );
<a name="l00162"></a>00162 
<a name="l00163"></a>00163     button_2 = gtk_radio_button_new_with_label_from_widget (
<a name="l00164"></a>00164                         GTK_RADIO_BUTTON ( button_1 ),
<a name="l00165"></a>00165                         _(<span class="stringliteral">&quot;Budgetary lines&quot;</span>) );
<a name="l00166"></a>00166     g_signal_connect ( G_OBJECT ( button_2 ),
<a name="l00167"></a>00167                         <span class="stringliteral">&quot;released&quot;</span>,
<a name="l00168"></a>00168                         G_CALLBACK ( <a class="code" href="bet__config_8c.html#af35307117be15ea41c6a5eebcefdf975">bet_config_origin_data_clicked</a> ),
<a name="l00169"></a>00169                         GINT_TO_POINTER ( 1 ) );
<a name="l00170"></a>00170 
<a name="l00171"></a>00171     g_object_set_data ( G_OBJECT ( <a class="code" href="bet__config_8c.html#ad5443d986a9ab5d64dd84c5346c4b87c">account_page</a> ), <span class="stringliteral">&quot;bet_hist_button_1&quot;</span>, button_1 );
<a name="l00172"></a>00172     g_object_set_data ( G_OBJECT ( <a class="code" href="bet__config_8c.html#ad5443d986a9ab5d64dd84c5346c4b87c">account_page</a> ), <span class="stringliteral">&quot;bet_hist_button_2&quot;</span>, button_2 );
<a name="l00173"></a>00173     gtk_box_pack_start ( GTK_BOX ( hbox ), button_1, FALSE, FALSE, 5) ;
<a name="l00174"></a>00174     gtk_box_pack_start ( GTK_BOX ( hbox ), button_2, FALSE, FALSE, 5) ;
<a name="l00175"></a>00175 
<a name="l00176"></a>00176     gtk_toggle_button_set_active ( GTK_TOGGLE_BUTTON ( button_1 ), TRUE );
<a name="l00177"></a>00177     <a class="code" href="bet__data_8c.html#aa8173c7d047bf72aef314ecf99689f73">bet_data_set_div_ptr</a> ( 0 );
<a name="l00178"></a>00178 
<a name="l00179"></a>00179     <span class="comment">/* création du sélecteur de périod */</span>
<a name="l00180"></a>00180     <span class="keywordflow">if</span> ( bet_historical_fyear_create_combobox_store ( ) )
<a name="l00181"></a>00181     {
<a name="l00182"></a>00182         widget = <a class="code" href="gsb__fyear_8c.html#af7e2bd1df0eccd82fa4fa78f269ae5d0">gsb_fyear_make_combobox_new</a> ( <a class="code" href="bet__config_8c.html#aecc63d6768ce86bba48badbe50334f1b">bet_fyear_model_filter</a>, TRUE );
<a name="l00183"></a>00183         gtk_widget_set_name ( GTK_WIDGET ( widget ), <span class="stringliteral">&quot;bet_hist_fyear_combo&quot;</span> );
<a name="l00184"></a>00184         gtk_widget_set_tooltip_text ( GTK_WIDGET ( widget ),
<a name="l00185"></a>00185                         <a class="code" href="structures_8h.html#a865883e81d37f6f4329636d5170f5209">SPACIFY</a>(_(<span class="stringliteral">&quot;Choose the financial year or 12 months rolling&quot;</span>) ) );
<a name="l00186"></a>00186 
<a name="l00187"></a>00187         g_object_set_data ( G_OBJECT ( <a class="code" href="bet__config_8c.html#ad5443d986a9ab5d64dd84c5346c4b87c">account_page</a> ), <span class="stringliteral">&quot;bet_hist_fyear_combo&quot;</span>, widget );
<a name="l00188"></a>00188 
<a name="l00189"></a>00189         gtk_box_pack_start ( GTK_BOX ( hbox ), widget, FALSE, FALSE, 5);
<a name="l00190"></a>00190 
<a name="l00191"></a>00191         <span class="comment">/* hide the present financial year */</span>
<a name="l00192"></a>00192         year = g_date_get_year ( <a class="code" href="utils__dates_8c.html#a6b816aab8b5dd412b89406bcc587738b">gdate_today</a> ( ) );
<a name="l00193"></a>00193         str_year = <a class="code" href="utils__str_8c.html#a1e50f3be459180b9dea9f14eb7e1204e" title="convert an integer into a gchar based string">utils_str_itoa</a> ( year );
<a name="l00194"></a>00194         <a class="code" href="gsb__fyear_8c.html#a860e2fbddb31ed8ddb8d70a4d90e7c37">gsb_fyear_hide_iter_by_name</a> ( <a class="code" href="bet__config_8c.html#a3b7bcf1e9b05e7a812d6f4d4bc0627d6">bet_fyear_model</a>, str_year );
<a name="l00195"></a>00195         g_free ( str_year );
<a name="l00196"></a>00196 
<a name="l00197"></a>00197         <span class="comment">/* set the signal */</span>
<a name="l00198"></a>00198         pointer = GINT_TO_POINTER ( 1 );
<a name="l00199"></a>00199         g_object_set_data ( G_OBJECT ( widget ), <span class="stringliteral">&quot;pointer&quot;</span>, pointer );
<a name="l00200"></a>00200         g_signal_connect ( G_OBJECT ( widget ),
<a name="l00201"></a>00201                         <span class="stringliteral">&quot;changed&quot;</span>,
<a name="l00202"></a>00202                         G_CALLBACK (<a class="code" href="bet__config_8c.html#a2a8189cead3056cb65d7d26433012d14">bet_config_fyear_clicked</a>),
<a name="l00203"></a>00203                         pointer );
<a name="l00204"></a>00204     }
<a name="l00205"></a>00205 
<a name="l00206"></a>00206     <span class="comment">/* création de la liste des données */</span>
<a name="l00207"></a>00207     tree_view = bet_historical_get_data_tree_view ( page );
<a name="l00208"></a>00208     g_object_set_data ( G_OBJECT ( <a class="code" href="bet__config_8c.html#ad5443d986a9ab5d64dd84c5346c4b87c">account_page</a> ), <span class="stringliteral">&quot;bet_historical_treeview&quot;</span>, tree_view );
<a name="l00209"></a>00209 
<a name="l00210"></a>00210     gtk_widget_show_all ( page );
<a name="l00211"></a>00211 
<a name="l00212"></a>00212     <span class="keywordflow">return</span> page;
<a name="l00213"></a>00213 }
<a name="l00214"></a>00214 
<a name="l00215"></a>00215 
<a name="l00222"></a>00222 gboolean bet_historical_div_toggle_clicked ( GtkCellRendererToggle *renderer,
<a name="l00223"></a>00223                         gchar *path_string,
<a name="l00224"></a>00224                         GtkTreeModel *model )
<a name="l00225"></a>00225 {
<a name="l00226"></a>00226     GtkTreeIter iter;
<a name="l00227"></a>00227 
<a name="l00228"></a>00228     <span class="comment">/* devel_debug (path_string); */</span>
<a name="l00229"></a>00229     <span class="keywordflow">if</span> ( gtk_tree_model_get_iter_from_string ( GTK_TREE_MODEL ( model ), &amp;iter, path_string ) )
<a name="l00230"></a>00230     {
<a name="l00231"></a>00231         gchar *str_amount;
<a name="l00232"></a>00232         gchar *str_average;
<a name="l00233"></a>00233         gint div_number;
<a name="l00234"></a>00234         gint sub_div_nb;
<a name="l00235"></a>00235         gint nbre_fils;
<a name="l00236"></a>00236         gint account_number;
<a name="l00237"></a>00237         gboolean valeur;
<a name="l00238"></a>00238         gboolean col_edited;
<a name="l00239"></a>00239 
<a name="l00240"></a>00240         gtk_tree_model_get ( GTK_TREE_MODEL ( model ), &amp;iter,
<a name="l00241"></a>00241                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a5d0bcfb3283a599dc1f20ca75cb6faf2">SPP_HISTORICAL_SELECT_COLUMN</a>, &amp;valeur,
<a name="l00242"></a>00242                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a1631c4f97d7e33268a015d35f8908b2d">SPP_HISTORICAL_AVERAGE_COLUMN</a>, &amp;str_average,
<a name="l00243"></a>00243                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a9383c850b527e1beb1a23ce870c7bbde">SPP_HISTORICAL_AVERAGE_AMOUNT</a>, &amp;str_amount,
<a name="l00244"></a>00244                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897ab8bc5e130fa8cfb9100d47fda24a5bff">SPP_HISTORICAL_ACCOUNT_NUMBER</a>, &amp;account_number,
<a name="l00245"></a>00245                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897ac666b9db44d7d9a667f13a3906efef93">SPP_HISTORICAL_DIV_NUMBER</a>, &amp;div_number,
<a name="l00246"></a>00246                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a80af7fc45177c92a3469977cc1e481f8">SPP_HISTORICAL_SUB_DIV_NUMBER</a>, &amp;sub_div_nb,
<a name="l00247"></a>00247                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a5a2e837c9fd864ef47eeb0b61b23bfe7">SPP_HISTORICAL_EDITED_COLUMN</a>, &amp;col_edited,
<a name="l00248"></a>00248                         -1 );
<a name="l00249"></a>00249 
<a name="l00250"></a>00250         <span class="keywordflow">if</span> ( col_edited == FALSE &amp;&amp; valeur == FALSE )
<a name="l00251"></a>00251             <span class="keywordflow">return</span> FALSE;
<a name="l00252"></a>00252 
<a name="l00253"></a>00253         <span class="keywordflow">if</span> ( renderer )
<a name="l00254"></a>00254             valeur = 1 - valeur;
<a name="l00255"></a>00255 
<a name="l00256"></a>00256         <span class="keywordflow">if</span> ( valeur == 1 )
<a name="l00257"></a>00257         {
<a name="l00258"></a>00258             <span class="comment">/* printf (&quot;avant - account_number = %d, div = %d, sub_div = %d\n&quot;,</span>
<a name="l00259"></a>00259 <span class="comment">                        account_number, div, sub_div); */</span>
<a name="l00260"></a>00260             <a class="code" href="bet__data_8c.html#a8e4e124545cf8a530c9c3ad879bcf5ea">bet_data_hist_add_div</a> ( account_number, div_number, sub_div_nb );
<a name="l00261"></a>00261             <a class="code" href="bet__data_8c.html#a3eeebe94c6f939ab1428c4a3860d7884">bet_data_set_div_amount</a> ( account_number, div_number, sub_div_nb,
<a name="l00262"></a>00262                         <a class="code" href="gsb__real_8c.html#a894affc3addf4e97be6c64194042209b">gsb_real_import_from_string</a> ( str_amount ) );
<a name="l00263"></a>00263             gtk_tree_store_set ( GTK_TREE_STORE ( model ), &amp;iter,
<a name="l00264"></a>00264                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a5d0bcfb3283a599dc1f20ca75cb6faf2">SPP_HISTORICAL_SELECT_COLUMN</a>, 1,
<a name="l00265"></a>00265                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a94988d43a9fb250409c6de6324165e5e">SPP_HISTORICAL_RETAINED_COLUMN</a>, str_average,
<a name="l00266"></a>00266                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a97b1a54b3d43dc7cf517776044d275c9">SPP_HISTORICAL_RETAINED_AMOUNT</a>, str_amount,
<a name="l00267"></a>00267                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897ab8bc5e130fa8cfb9100d47fda24a5bff">SPP_HISTORICAL_ACCOUNT_NUMBER</a>, account_number,
<a name="l00268"></a>00268                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897ac666b9db44d7d9a667f13a3906efef93">SPP_HISTORICAL_DIV_NUMBER</a>, div_number,
<a name="l00269"></a>00269                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a80af7fc45177c92a3469977cc1e481f8">SPP_HISTORICAL_SUB_DIV_NUMBER</a>, sub_div_nb,
<a name="l00270"></a>00270                         -1 );
<a name="l00271"></a>00271         }
<a name="l00272"></a>00272         <span class="keywordflow">else</span>
<a name="l00273"></a>00273         {
<a name="l00274"></a>00274             <a class="code" href="bet__data_8c.html#a2ad8c256ef5056925b921a71d8645578">bet_data_remove_div_hist</a> ( account_number, div_number, sub_div_nb );
<a name="l00275"></a>00275             gtk_tree_store_set ( GTK_TREE_STORE ( model ), &amp;iter,
<a name="l00276"></a>00276                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a5d0bcfb3283a599dc1f20ca75cb6faf2">SPP_HISTORICAL_SELECT_COLUMN</a>, FALSE,
<a name="l00277"></a>00277                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a94988d43a9fb250409c6de6324165e5e">SPP_HISTORICAL_RETAINED_COLUMN</a>, <span class="stringliteral">&quot;&quot;</span>,
<a name="l00278"></a>00278                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a97b1a54b3d43dc7cf517776044d275c9">SPP_HISTORICAL_RETAINED_AMOUNT</a>, str_amount,
<a name="l00279"></a>00279                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897ab8bc5e130fa8cfb9100d47fda24a5bff">SPP_HISTORICAL_ACCOUNT_NUMBER</a>, account_number,
<a name="l00280"></a>00280                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897ac666b9db44d7d9a667f13a3906efef93">SPP_HISTORICAL_DIV_NUMBER</a>, div_number,
<a name="l00281"></a>00281                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a80af7fc45177c92a3469977cc1e481f8">SPP_HISTORICAL_SUB_DIV_NUMBER</a>, sub_div_nb,
<a name="l00282"></a>00282                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a5a2e837c9fd864ef47eeb0b61b23bfe7">SPP_HISTORICAL_EDITED_COLUMN</a>, TRUE,
<a name="l00283"></a>00283                         -1 );
<a name="l00284"></a>00284         }
<a name="l00285"></a>00285 
<a name="l00286"></a>00286         nbre_fils = gtk_tree_model_iter_n_children ( GTK_TREE_MODEL ( model ), &amp;iter );
<a name="l00287"></a>00287         <span class="keywordflow">if</span> ( nbre_fils &gt; 0 )
<a name="l00288"></a>00288         {
<a name="l00289"></a>00289             <span class="keywordflow">if</span> ( valeur == 1 )
<a name="l00290"></a>00290                 bet_historical_set_full_sub_div ( model, &amp;iter );
<a name="l00291"></a>00291             <span class="keywordflow">else</span>
<a name="l00292"></a>00292                 bet_historical_set_empty_sub_div ( model, &amp;iter );
<a name="l00293"></a>00293         }
<a name="l00294"></a>00294         <span class="keywordflow">else</span>
<a name="l00295"></a>00295         {
<a name="l00296"></a>00296             GtkTreeIter parent;
<a name="l00297"></a>00297             <a class="code" href="structgsb__real.html">gsb_real</a> amount;
<a name="l00298"></a>00298 
<a name="l00299"></a>00299             <span class="keywordflow">if</span> ( gtk_tree_model_iter_parent ( GTK_TREE_MODEL ( model ), &amp;parent, &amp;iter ) )
<a name="l00300"></a>00300             {
<a name="l00301"></a>00301                 <span class="keywordflow">if</span> ( bet_historical_get_full_div ( model, &amp;parent ) )
<a name="l00302"></a>00302                 {
<a name="l00303"></a>00303                     amount = bet_historical_get_children_amount ( model, &amp;parent );
<a name="l00304"></a>00304                     <span class="keywordflow">if</span> ( str_amount )
<a name="l00305"></a>00305                         g_free ( str_amount );
<a name="l00306"></a>00306                     str_amount = <a class="code" href="gsb__real_8c.html#a50c880e082aa7241dfa50a9bc0a87207">gsb_real_save_real_to_string</a> ( amount, 2 );
<a name="l00307"></a>00307                     <span class="keywordflow">if</span> ( str_average )
<a name="l00308"></a>00308                         g_free ( str_average );
<a name="l00309"></a>00309                     str_average = <a class="code" href="gsb__real_8c.html#a03f4474a9a4269e384951af9be4acedd">gsb_real_get_string_with_currency</a> ( amount,
<a name="l00310"></a>00310                                 <a class="code" href="gsb__data__account_8c.html#a9f8d132b988ca73a7061fca955f6bc2c">gsb_data_account_get_currency</a> ( account_number ), TRUE );
<a name="l00311"></a>00311                     gtk_tree_store_set ( GTK_TREE_STORE ( model ),
<a name="l00312"></a>00312                                 &amp;parent,
<a name="l00313"></a>00313                                 <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a5d0bcfb3283a599dc1f20ca75cb6faf2">SPP_HISTORICAL_SELECT_COLUMN</a>, TRUE,
<a name="l00314"></a>00314                                 <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a94988d43a9fb250409c6de6324165e5e">SPP_HISTORICAL_RETAINED_COLUMN</a>, str_average,
<a name="l00315"></a>00315                                 <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a97b1a54b3d43dc7cf517776044d275c9">SPP_HISTORICAL_RETAINED_AMOUNT</a>, str_amount,
<a name="l00316"></a>00316                                 -1);
<a name="l00317"></a>00317                     <span class="keywordflow">if</span> ( bet_historical_amount_differ_average ( model, &amp;parent) )
<a name="l00318"></a>00318                         <a class="code" href="bet__data_8c.html#a3eeebe94c6f939ab1428c4a3860d7884">bet_data_set_div_amount</a> ( account_number, div_number, 0, amount );
<a name="l00319"></a>00319                         
<a name="l00320"></a>00320                     bet_historical_row_collapse_all ( NULL, &amp;parent, model );
<a name="l00321"></a>00321                 }
<a name="l00322"></a>00322                 <span class="keywordflow">else</span>
<a name="l00323"></a>00323                 {
<a name="l00324"></a>00324                     <a class="code" href="bet__data_8c.html#a3eeebe94c6f939ab1428c4a3860d7884">bet_data_set_div_amount</a> ( account_number, div_number, 0, null_real );
<a name="l00325"></a>00325                     gtk_tree_store_set ( GTK_TREE_STORE ( model ), &amp;parent,
<a name="l00326"></a>00326                                 <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a5d0bcfb3283a599dc1f20ca75cb6faf2">SPP_HISTORICAL_SELECT_COLUMN</a>, FALSE,
<a name="l00327"></a>00327                                 <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a94988d43a9fb250409c6de6324165e5e">SPP_HISTORICAL_RETAINED_COLUMN</a>, <span class="stringliteral">&quot;&quot;</span>,
<a name="l00328"></a>00328                                 <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a5a2e837c9fd864ef47eeb0b61b23bfe7">SPP_HISTORICAL_EDITED_COLUMN</a>, TRUE,
<a name="l00329"></a>00329                                 -1 );
<a name="l00330"></a>00330                 }
<a name="l00331"></a>00331             }
<a name="l00332"></a>00332         }
<a name="l00333"></a>00333 
<a name="l00334"></a>00334         <a class="code" href="gsb__data__account_8c.html#aad11cfab16ac44e8de3dd6d792fce4cd">gsb_data_account_set_bet_maj</a> ( account_number, <a class="code" href="structures_8h.html#ab021d1439ce505d767a56f4fc41af400a8c9b47440bdc426dc6e11af2b2856792">BET_MAJ_ESTIMATE</a> );
<a name="l00335"></a>00335         <a class="code" href="bet__data_8c.html#af0bc501a6a7a255f8adc9500328c950f">bet_data_update_bet_module</a> ( account_number, <a class="code" href="fenetre__principale_8h.html#a42855d1b033e0c804c7e4e8ae8616520a90dc66bf685d88710b5f31dec284ca60">GSB_HISTORICAL_PAGE</a> );
<a name="l00336"></a>00336     }
<a name="l00337"></a>00337 
<a name="l00338"></a>00338     <span class="keywordflow">if</span> ( <a class="code" href="parametres_8c.html#ab2a744f5d2124688473d13979420e911">etat</a>.<a class="code" href="structgsb__etat__t.html#a9d0fa9057da603e64a601d69d7bf2b51">modification_fichier</a> == 0 )
<a name="l00339"></a>00339         <a class="code" href="traitement__variables_8c.html#aa4084b9e508b1d1fea1d09c6b6208021">modification_fichier</a> ( TRUE );
<a name="l00340"></a>00340 
<a name="l00341"></a>00341     <span class="keywordflow">return</span> FALSE;
<a name="l00342"></a>00342 }
<a name="l00343"></a>00343 
<a name="l00344"></a>00344 
<a name="l00351"></a>00351 <span class="keywordtype">void</span> bet_historical_div_cell_editing_started (GtkCellRenderer *cell,
<a name="l00352"></a>00352                         GtkCellEditable *editable,
<a name="l00353"></a>00353                         <span class="keyword">const</span> gchar *path_string,
<a name="l00354"></a>00354                         GtkWidget *tree_view )
<a name="l00355"></a>00355 {
<a name="l00356"></a>00356     <span class="keywordflow">if</span> ( GTK_IS_ENTRY ( editable ) ) 
<a name="l00357"></a>00357         gtk_editable_delete_text ( GTK_EDITABLE ( editable ), 0, -1 );
<a name="l00358"></a>00358 }
<a name="l00359"></a>00359 
<a name="l00360"></a>00360 
<a name="l00367"></a>00367 <span class="keywordtype">void</span> bet_historical_div_cell_edited (GtkCellRendererText *cell,
<a name="l00368"></a>00368                         <span class="keyword">const</span> gchar *path_string,
<a name="l00369"></a>00369                         <span class="keyword">const</span> gchar *new_text,
<a name="l00370"></a>00370                         GtkWidget *tree_view )
<a name="l00371"></a>00371 {
<a name="l00372"></a>00372     GtkTreeModel *model;
<a name="l00373"></a>00373     GtkTreeIter iter;
<a name="l00374"></a>00374 
<a name="l00375"></a>00375     <span class="comment">/* devel_debug (new_text); */</span>
<a name="l00376"></a>00376     model = gtk_tree_view_get_model ( GTK_TREE_VIEW ( tree_view ) );
<a name="l00377"></a>00377     <span class="keywordflow">if</span> ( gtk_tree_model_get_iter_from_string ( GTK_TREE_MODEL ( model ), &amp;iter, path_string ) )
<a name="l00378"></a>00378     {
<a name="l00379"></a>00379         GtkTreeIter parent;
<a name="l00380"></a>00380         gboolean valeur;
<a name="l00381"></a>00381         gboolean edited;
<a name="l00382"></a>00382         gint account_number;
<a name="l00383"></a>00383         gint currency_number;
<a name="l00384"></a>00384         gint div_number;
<a name="l00385"></a>00385         gint sub_div_nb;
<a name="l00386"></a>00386         gchar *tmp_str;
<a name="l00387"></a>00387         gchar *str_amount;
<a name="l00388"></a>00388         gboolean is_parent = FALSE;
<a name="l00389"></a>00389         <a class="code" href="structgsb__real.html">gsb_real</a> number;
<a name="l00390"></a>00390 
<a name="l00391"></a>00391         gtk_tree_model_get ( GTK_TREE_MODEL ( model ), &amp;iter,
<a name="l00392"></a>00392                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a5d0bcfb3283a599dc1f20ca75cb6faf2">SPP_HISTORICAL_SELECT_COLUMN</a>, &amp;valeur,
<a name="l00393"></a>00393                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897ab8bc5e130fa8cfb9100d47fda24a5bff">SPP_HISTORICAL_ACCOUNT_NUMBER</a>, &amp;account_number,
<a name="l00394"></a>00394                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897ac666b9db44d7d9a667f13a3906efef93">SPP_HISTORICAL_DIV_NUMBER</a>, &amp;div_number,
<a name="l00395"></a>00395                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a80af7fc45177c92a3469977cc1e481f8">SPP_HISTORICAL_SUB_DIV_NUMBER</a>, &amp;sub_div_nb,
<a name="l00396"></a>00396                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a5a2e837c9fd864ef47eeb0b61b23bfe7">SPP_HISTORICAL_EDITED_COLUMN</a>, &amp;edited,
<a name="l00397"></a>00397                         -1 );
<a name="l00398"></a>00398 
<a name="l00399"></a>00399         <span class="keywordflow">if</span> ( edited == FALSE )
<a name="l00400"></a>00400             <span class="keywordflow">return</span>;
<a name="l00401"></a>00401 
<a name="l00402"></a>00402         is_parent = gtk_tree_model_iter_parent ( GTK_TREE_MODEL ( model ), &amp;parent, &amp;iter );
<a name="l00403"></a>00403         <span class="keywordflow">if</span> ( is_parent == FALSE )
<a name="l00404"></a>00404         {
<a name="l00405"></a>00405             bet_historical_set_empty_sub_div ( model, &amp;iter );
<a name="l00406"></a>00406             bet_historical_row_collapse_all ( GTK_TREE_VIEW ( tree_view ), &amp;iter, model );
<a name="l00407"></a>00407         }
<a name="l00408"></a>00408 
<a name="l00409"></a>00409         number = <a class="code" href="gsb__real_8c.html#ada8e5c9cbdb5ccab2c0bbc6e52b04efe">gsb_real_get_from_string</a> ( new_text );
<a name="l00410"></a>00410         currency_number = <a class="code" href="gsb__data__account_8c.html#a9f8d132b988ca73a7061fca955f6bc2c">gsb_data_account_get_currency</a> ( account_number );
<a name="l00411"></a>00411         tmp_str = <a class="code" href="gsb__real_8c.html#a03f4474a9a4269e384951af9be4acedd">gsb_real_get_string_with_currency</a> ( number, currency_number, TRUE );
<a name="l00412"></a>00412 
<a name="l00413"></a>00413         <span class="keywordflow">if</span> ( <a class="code" href="bet__data_8c.html#aa5a0bad0ab672a04b4dfa18d9816aa20">bet_data_search_div_hist</a> ( account_number, div_number, sub_div_nb ) == FALSE )
<a name="l00414"></a>00414             <a class="code" href="bet__data_8c.html#a8e4e124545cf8a530c9c3ad879bcf5ea">bet_data_hist_add_div</a> ( account_number, div_number, sub_div_nb );
<a name="l00415"></a>00415 
<a name="l00416"></a>00416         <a class="code" href="bet__data_8c.html#ac97294377ef5262c8c3940ecdb8e2443">bet_data_set_div_edited</a>  ( account_number, div_number, sub_div_nb, TRUE );
<a name="l00417"></a>00417         <a class="code" href="bet__data_8c.html#a3eeebe94c6f939ab1428c4a3860d7884">bet_data_set_div_amount</a> ( account_number, div_number, sub_div_nb, number );
<a name="l00418"></a>00418         gtk_tree_store_set ( GTK_TREE_STORE ( model ), &amp;iter,
<a name="l00419"></a>00419                             <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a5d0bcfb3283a599dc1f20ca75cb6faf2">SPP_HISTORICAL_SELECT_COLUMN</a>, TRUE,
<a name="l00420"></a>00420                             <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a94988d43a9fb250409c6de6324165e5e">SPP_HISTORICAL_RETAINED_COLUMN</a>, tmp_str,
<a name="l00421"></a>00421                             <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a97b1a54b3d43dc7cf517776044d275c9">SPP_HISTORICAL_RETAINED_AMOUNT</a>, new_text,
<a name="l00422"></a>00422                             -1 );
<a name="l00423"></a>00423         g_free ( tmp_str );
<a name="l00424"></a>00424 
<a name="l00425"></a>00425         <span class="keywordflow">if</span> ( is_parent )
<a name="l00426"></a>00426         gtk_tree_store_set ( GTK_TREE_STORE ( model ),
<a name="l00427"></a>00427                         &amp;parent,
<a name="l00428"></a>00428                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a5a2e837c9fd864ef47eeb0b61b23bfe7">SPP_HISTORICAL_EDITED_COLUMN</a>, FALSE,
<a name="l00429"></a>00429                         -1);
<a name="l00430"></a>00430 
<a name="l00431"></a>00431         <span class="keywordflow">if</span> ( is_parent &amp;&amp; bet_historical_get_full_div ( model, &amp;parent ) )
<a name="l00432"></a>00432         {
<a name="l00433"></a>00433             number = bet_historical_get_children_amount ( model, &amp;parent );
<a name="l00434"></a>00434             <a class="code" href="bet__data_8c.html#a3eeebe94c6f939ab1428c4a3860d7884">bet_data_set_div_amount</a> ( account_number, div_number, 0, number );
<a name="l00435"></a>00435             str_amount = <a class="code" href="gsb__real_8c.html#a50c880e082aa7241dfa50a9bc0a87207">gsb_real_save_real_to_string</a> ( number, 2 );
<a name="l00436"></a>00436             tmp_str = <a class="code" href="gsb__real_8c.html#a03f4474a9a4269e384951af9be4acedd">gsb_real_get_string_with_currency</a> ( number,
<a name="l00437"></a>00437                         <a class="code" href="gsb__data__account_8c.html#a9f8d132b988ca73a7061fca955f6bc2c">gsb_data_account_get_currency</a> ( account_number ), TRUE );
<a name="l00438"></a>00438             gtk_tree_store_set ( GTK_TREE_STORE ( model ),
<a name="l00439"></a>00439                         &amp;parent,
<a name="l00440"></a>00440                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a5d0bcfb3283a599dc1f20ca75cb6faf2">SPP_HISTORICAL_SELECT_COLUMN</a>, TRUE,
<a name="l00441"></a>00441                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a94988d43a9fb250409c6de6324165e5e">SPP_HISTORICAL_RETAINED_COLUMN</a>, tmp_str,
<a name="l00442"></a>00442                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a97b1a54b3d43dc7cf517776044d275c9">SPP_HISTORICAL_RETAINED_AMOUNT</a>, str_amount,
<a name="l00443"></a>00443                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a5a2e837c9fd864ef47eeb0b61b23bfe7">SPP_HISTORICAL_EDITED_COLUMN</a>, FALSE,
<a name="l00444"></a>00444                         -1);
<a name="l00445"></a>00445             g_free ( str_amount );
<a name="l00446"></a>00446             g_free ( tmp_str );
<a name="l00447"></a>00447         }
<a name="l00448"></a>00448 
<a name="l00449"></a>00449         <a class="code" href="gsb__data__account_8c.html#aad11cfab16ac44e8de3dd6d792fce4cd">gsb_data_account_set_bet_maj</a> ( account_number, <a class="code" href="structures_8h.html#ab021d1439ce505d767a56f4fc41af400a8c9b47440bdc426dc6e11af2b2856792">BET_MAJ_ESTIMATE</a> );
<a name="l00450"></a>00450 
<a name="l00451"></a>00451         <span class="keywordflow">if</span> ( <a class="code" href="parametres_8c.html#ab2a744f5d2124688473d13979420e911">etat</a>.<a class="code" href="structgsb__etat__t.html#a9d0fa9057da603e64a601d69d7bf2b51">modification_fichier</a> == 0 )
<a name="l00452"></a>00452             <a class="code" href="traitement__variables_8c.html#aa4084b9e508b1d1fea1d09c6b6208021">modification_fichier</a> ( TRUE );
<a name="l00453"></a>00453     }
<a name="l00454"></a>00454 }
<a name="l00455"></a>00455 
<a name="l00456"></a>00456 
<a name="l00463"></a>00463 GtkWidget *bet_historical_get_data_tree_view ( GtkWidget *container )
<a name="l00464"></a>00464 {
<a name="l00465"></a>00465     GtkWidget *scrolled_window;
<a name="l00466"></a>00466     GtkWidget *tree_view;
<a name="l00467"></a>00467     GtkTreeStore *tree_model;
<a name="l00468"></a>00468     GtkTreeSelection *tree_selection;
<a name="l00469"></a>00469     GtkCellRenderer *cell;
<a name="l00470"></a>00470     GtkTreeViewColumn *column;
<a name="l00471"></a>00471     gchar *title;
<a name="l00472"></a>00472 
<a name="l00473"></a>00473     <span class="comment">/* devel_debug (NULL); */</span>
<a name="l00474"></a>00474     tree_view = gtk_tree_view_new ( );
<a name="l00475"></a>00475     gtk_tree_view_set_rules_hint ( GTK_TREE_VIEW (tree_view), TRUE);
<a name="l00476"></a>00476     g_object_set_data ( G_OBJECT ( <a class="code" href="bet__config_8c.html#ad5443d986a9ab5d64dd84c5346c4b87c">account_page</a> ), <span class="stringliteral">&quot;hist_tree_view&quot;</span>, tree_view );
<a name="l00477"></a>00477 
<a name="l00478"></a>00478     tree_model = gtk_tree_store_new ( <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a72f24a1895933b5600b451876c773e47">SPP_HISTORICAL_NUM_COLUMNS</a>,
<a name="l00479"></a>00479                         G_TYPE_BOOLEAN,     <span class="comment">/* SPP_HISTORICAL_SELECT_COLUMN     */</span>
<a name="l00480"></a>00480                         G_TYPE_STRING,      <span class="comment">/* SPP_HISTORICAL_DESC_COLUMN       */</span>
<a name="l00481"></a>00481                         G_TYPE_STRING,      <span class="comment">/* SPP_HISTORICAL_PERIOD_COLUMN     */</span>
<a name="l00482"></a>00482                         G_TYPE_STRING,      <span class="comment">/* SPP_HISTORICAL_BALANCE_COLUMN    */</span>
<a name="l00483"></a>00483                         G_TYPE_STRING,      <span class="comment">/* SPP_HISTORICAL_AVERAGE_COLUMN    */</span>
<a name="l00484"></a>00484                         G_TYPE_STRING,      <span class="comment">/* SPP_HISTORICAL_AVERAGE_AMOUNT    */</span>
<a name="l00485"></a>00485                         G_TYPE_STRING,      <span class="comment">/* SPP_HISTORICAL_RETAINED_COLUMN   */</span>
<a name="l00486"></a>00486                         G_TYPE_STRING,      <span class="comment">/* SPP_HISTORICAL_RETAINED_AMOUNT   */</span>
<a name="l00487"></a>00487                         G_TYPE_STRING,      <span class="comment">/* SPP_HISTORICAL_BALANCE_COLOR     */</span>
<a name="l00488"></a>00488                         G_TYPE_INT,         <span class="comment">/* SPP_HISTORICAL_ACCOUNT_NUMBER    */</span>
<a name="l00489"></a>00489                         G_TYPE_INT,         <span class="comment">/* SPP_HISTORICAL_DIV_NUMBER        */</span>
<a name="l00490"></a>00490                         G_TYPE_INT,         <span class="comment">/* SPP_HISTORICAL_SUB_DIV_NUMBER    */</span>
<a name="l00491"></a>00491                         G_TYPE_BOOLEAN,     <span class="comment">/* SPP_HISTORICAL_EDITED_COLUMN     */</span>
<a name="l00492"></a>00492                         GDK_TYPE_COLOR );   <span class="comment">/* SPP_HISTORICAL_BACKGROUND_COLOR  */</span>
<a name="l00493"></a>00493     gtk_tree_view_set_model ( GTK_TREE_VIEW (tree_view), GTK_TREE_MODEL ( tree_model ) );
<a name="l00494"></a>00494     g_object_unref ( G_OBJECT ( tree_model ) );
<a name="l00495"></a>00495 
<a name="l00496"></a>00496     gtk_tree_sortable_set_sort_column_id ( GTK_TREE_SORTABLE ( tree_model ),
<a name="l00497"></a>00497                                             <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897aeff2bf9d7b77605f4e1deb048cd0c84b">SPP_HISTORICAL_DESC_COLUMN</a>, GTK_SORT_ASCENDING );
<a name="l00498"></a>00498 
<a name="l00499"></a>00499     tree_selection = gtk_tree_view_get_selection ( GTK_TREE_VIEW ( tree_view ) );
<a name="l00500"></a>00500     gtk_tree_selection_set_mode ( tree_selection, GTK_SELECTION_SINGLE );
<a name="l00501"></a>00501 
<a name="l00502"></a>00502     scrolled_window = gtk_scrolled_window_new ( NULL, NULL );
<a name="l00503"></a>00503     gtk_scrolled_window_set_policy ( GTK_SCROLLED_WINDOW ( scrolled_window ),
<a name="l00504"></a>00504                         GTK_POLICY_NEVER, GTK_POLICY_AUTOMATIC );
<a name="l00505"></a>00505     gtk_widget_set_size_request ( scrolled_window, -1, 250 );
<a name="l00506"></a>00506     gtk_container_add ( GTK_CONTAINER ( scrolled_window ), tree_view );
<a name="l00507"></a>00507     gtk_box_pack_start ( GTK_BOX ( container ), scrolled_window, TRUE, TRUE, 15 );
<a name="l00508"></a>00508 
<a name="l00509"></a>00509     <span class="comment">/* create columns */</span>
<a name="l00510"></a>00510     cell = gtk_cell_renderer_toggle_new ( );
<a name="l00511"></a>00511     g_object_set_data ( G_OBJECT ( <a class="code" href="bet__config_8c.html#ad5443d986a9ab5d64dd84c5346c4b87c">account_page</a> ), <span class="stringliteral">&quot;toggle_cell&quot;</span>, cell );
<a name="l00512"></a>00512     gtk_cell_renderer_toggle_set_radio ( GTK_CELL_RENDERER_TOGGLE ( cell ),
<a name="l00513"></a>00513                         FALSE );
<a name="l00514"></a>00514     g_object_set (cell, <span class="stringliteral">&quot;xalign&quot;</span>, 0.5, NULL);
<a name="l00515"></a>00515         g_signal_connect ( cell,
<a name="l00516"></a>00516                         <span class="stringliteral">&quot;toggled&quot;</span>,
<a name="l00517"></a>00517                         G_CALLBACK (bet_historical_div_toggle_clicked),
<a name="l00518"></a>00518                         tree_model );
<a name="l00519"></a>00519 
<a name="l00520"></a>00520     column = gtk_tree_view_column_new_with_attributes ( _(<span class="stringliteral">&quot;Select&quot;</span>),
<a name="l00521"></a>00521                         cell,
<a name="l00522"></a>00522                         <span class="stringliteral">&quot;active&quot;</span>, <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a5d0bcfb3283a599dc1f20ca75cb6faf2">SPP_HISTORICAL_SELECT_COLUMN</a>,
<a name="l00523"></a>00523                         <span class="stringliteral">&quot;cell-background-gdk&quot;</span>, <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a428a7138affdd5d06c282366109bacb5">SPP_HISTORICAL_BACKGROUND_COLOR</a>,
<a name="l00524"></a>00524                         NULL);
<a name="l00525"></a>00525     gtk_tree_view_column_set_alignment ( column, 0.5 );
<a name="l00526"></a>00526     gtk_tree_view_append_column ( GTK_TREE_VIEW ( tree_view ), column );
<a name="l00527"></a>00527     gtk_tree_view_column_set_resizable ( column, TRUE );
<a name="l00528"></a>00528 
<a name="l00529"></a>00529     <span class="comment">/* name of the div sous-div column*/</span>
<a name="l00530"></a>00530     title = g_strdup ( _(<span class="stringliteral">&quot;Category&quot;</span>) );
<a name="l00531"></a>00531     cell = gtk_cell_renderer_text_new ( );
<a name="l00532"></a>00532     column = gtk_tree_view_column_new_with_attributes ( title,
<a name="l00533"></a>00533                         cell,
<a name="l00534"></a>00534                         <span class="stringliteral">&quot;text&quot;</span>, <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897aeff2bf9d7b77605f4e1deb048cd0c84b">SPP_HISTORICAL_DESC_COLUMN</a>,
<a name="l00535"></a>00535                         <span class="stringliteral">&quot;cell-background-gdk&quot;</span>, <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a428a7138affdd5d06c282366109bacb5">SPP_HISTORICAL_BACKGROUND_COLOR</a>,
<a name="l00536"></a>00536                         NULL);
<a name="l00537"></a>00537     g_object_set_data ( G_OBJECT ( <a class="code" href="bet__config_8c.html#ad5443d986a9ab5d64dd84c5346c4b87c">account_page</a> ), <span class="stringliteral">&quot;historical_column_source&quot;</span>,
<a name="l00538"></a>00538                         column );
<a name="l00539"></a>00539     gtk_tree_view_append_column ( GTK_TREE_VIEW ( tree_view ),
<a name="l00540"></a>00540                         GTK_TREE_VIEW_COLUMN ( column ) );
<a name="l00541"></a>00541     gtk_tree_view_column_set_expand ( GTK_TREE_VIEW_COLUMN ( column ), TRUE );
<a name="l00542"></a>00542     gtk_tree_view_column_set_resizable ( column, TRUE );
<a name="l00543"></a>00543 
<a name="l00544"></a>00544     <span class="comment">/* period analysis column */</span>
<a name="l00545"></a>00545     cell = gtk_cell_renderer_text_new ( );
<a name="l00546"></a>00546     column = gtk_tree_view_column_new_with_attributes (
<a name="l00547"></a>00547                         _(<span class="stringliteral">&quot;Period&quot;</span>), cell,
<a name="l00548"></a>00548                         <span class="stringliteral">&quot;text&quot;</span>, <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a45ca3b7c980e082587741f06f4c48d46">SPP_HISTORICAL_PERIOD_COLUMN</a>,
<a name="l00549"></a>00549                         <span class="stringliteral">&quot;cell-background-gdk&quot;</span>, <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a428a7138affdd5d06c282366109bacb5">SPP_HISTORICAL_BACKGROUND_COLOR</a>,
<a name="l00550"></a>00550                         NULL);
<a name="l00551"></a>00551     g_object_set (cell, <span class="stringliteral">&quot;xalign&quot;</span>, 0.5, NULL);
<a name="l00552"></a>00552 
<a name="l00553"></a>00553     gtk_tree_view_column_set_alignment ( column, 0.5 );
<a name="l00554"></a>00554     gtk_tree_view_append_column ( GTK_TREE_VIEW ( tree_view ),
<a name="l00555"></a>00555                         GTK_TREE_VIEW_COLUMN ( column ) );
<a name="l00556"></a>00556     gtk_tree_view_column_set_expand ( GTK_TREE_VIEW_COLUMN ( column ), TRUE );
<a name="l00557"></a>00557     gtk_tree_view_column_set_resizable ( column, TRUE );
<a name="l00558"></a>00558 
<a name="l00559"></a>00559     <span class="comment">/* amount column */</span>
<a name="l00560"></a>00560     cell = gtk_cell_renderer_text_new ( );
<a name="l00561"></a>00561     column = gtk_tree_view_column_new_with_attributes (
<a name="l00562"></a>00562                         _(<span class="stringliteral">&quot;Amount&quot;</span>), cell,
<a name="l00563"></a>00563                         <span class="stringliteral">&quot;text&quot;</span>, <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a6a40f807c6a610907487b055f4fa741e">SPP_HISTORICAL_BALANCE_COLUMN</a>,
<a name="l00564"></a>00564                         <span class="stringliteral">&quot;foreground&quot;</span>, <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a7e8d04e4b520d5cc8c24c5e26af9ec75">SPP_HISTORICAL_BALANCE_COLOR</a>,
<a name="l00565"></a>00565                         <span class="stringliteral">&quot;cell-background-gdk&quot;</span>, <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a428a7138affdd5d06c282366109bacb5">SPP_HISTORICAL_BACKGROUND_COLOR</a>,
<a name="l00566"></a>00566                         NULL);
<a name="l00567"></a>00567     gtk_tree_view_append_column ( GTK_TREE_VIEW ( tree_view ),
<a name="l00568"></a>00568                         GTK_TREE_VIEW_COLUMN ( column ) );
<a name="l00569"></a>00569     g_object_set ( G_OBJECT ( GTK_CELL_RENDERER ( cell ) ), <span class="stringliteral">&quot;xalign&quot;</span>, 1.0, NULL );
<a name="l00570"></a>00570     gtk_tree_view_column_set_alignment ( column, 1 );
<a name="l00571"></a>00571     gtk_tree_view_column_set_clickable ( GTK_TREE_VIEW_COLUMN ( column ), TRUE );
<a name="l00572"></a>00572     gtk_tree_view_column_set_expand ( GTK_TREE_VIEW_COLUMN ( column ), TRUE );
<a name="l00573"></a>00573     gtk_tree_view_column_set_resizable ( column, TRUE );
<a name="l00574"></a>00574 
<a name="l00575"></a>00575     <span class="comment">/* average column */</span>
<a name="l00576"></a>00576     cell = gtk_cell_renderer_text_new ( );
<a name="l00577"></a>00577     column = gtk_tree_view_column_new_with_attributes (
<a name="l00578"></a>00578                         _(<span class="stringliteral">&quot;Average&quot;</span>), cell,
<a name="l00579"></a>00579                         <span class="stringliteral">&quot;text&quot;</span>, <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a1631c4f97d7e33268a015d35f8908b2d">SPP_HISTORICAL_AVERAGE_COLUMN</a>,
<a name="l00580"></a>00580                         <span class="stringliteral">&quot;foreground&quot;</span>, <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a7e8d04e4b520d5cc8c24c5e26af9ec75">SPP_HISTORICAL_BALANCE_COLOR</a>,
<a name="l00581"></a>00581                         <span class="stringliteral">&quot;cell-background-gdk&quot;</span>, <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a428a7138affdd5d06c282366109bacb5">SPP_HISTORICAL_BACKGROUND_COLOR</a>,
<a name="l00582"></a>00582                         NULL);
<a name="l00583"></a>00583     gtk_tree_view_append_column ( GTK_TREE_VIEW ( tree_view ),
<a name="l00584"></a>00584                         GTK_TREE_VIEW_COLUMN ( column ) );
<a name="l00585"></a>00585     g_object_set ( G_OBJECT ( GTK_CELL_RENDERER ( cell ) ), <span class="stringliteral">&quot;xalign&quot;</span>, 1.0, NULL );
<a name="l00586"></a>00586     gtk_tree_view_column_set_alignment ( column, 1 );
<a name="l00587"></a>00587     gtk_tree_view_column_set_clickable ( GTK_TREE_VIEW_COLUMN ( column ), TRUE );
<a name="l00588"></a>00588     gtk_tree_view_column_set_expand ( GTK_TREE_VIEW_COLUMN ( column ), TRUE );
<a name="l00589"></a>00589     gtk_tree_view_column_set_resizable ( column, TRUE );
<a name="l00590"></a>00590 
<a name="l00591"></a>00591     <span class="comment">/* amount retained column */</span>
<a name="l00592"></a>00592     cell = gtk_cell_renderer_text_new ( );
<a name="l00593"></a>00593     g_object_set_data ( G_OBJECT ( <a class="code" href="bet__config_8c.html#ad5443d986a9ab5d64dd84c5346c4b87c">account_page</a> ), <span class="stringliteral">&quot;edited_cell&quot;</span>, cell );
<a name="l00594"></a>00594     column = gtk_tree_view_column_new_with_attributes (
<a name="l00595"></a>00595                         _(<span class="stringliteral">&quot;Amount retained&quot;</span>), cell,
<a name="l00596"></a>00596                         <span class="stringliteral">&quot;text&quot;</span>, <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a94988d43a9fb250409c6de6324165e5e">SPP_HISTORICAL_RETAINED_COLUMN</a>,
<a name="l00597"></a>00597                         <span class="stringliteral">&quot;foreground&quot;</span>, <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a7e8d04e4b520d5cc8c24c5e26af9ec75">SPP_HISTORICAL_BALANCE_COLOR</a>,
<a name="l00598"></a>00598                         <span class="stringliteral">&quot;editable&quot;</span>, <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a5a2e837c9fd864ef47eeb0b61b23bfe7">SPP_HISTORICAL_EDITED_COLUMN</a>,
<a name="l00599"></a>00599                         <span class="stringliteral">&quot;cell-background-gdk&quot;</span>, <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a428a7138affdd5d06c282366109bacb5">SPP_HISTORICAL_BACKGROUND_COLOR</a>,
<a name="l00600"></a>00600                         NULL);
<a name="l00601"></a>00601     gtk_tree_view_append_column ( GTK_TREE_VIEW ( tree_view ),
<a name="l00602"></a>00602                         GTK_TREE_VIEW_COLUMN ( column ) );
<a name="l00603"></a>00603     g_object_set ( G_OBJECT ( GTK_CELL_RENDERER ( cell ) ), <span class="stringliteral">&quot;xalign&quot;</span>, 1.0, NULL );
<a name="l00604"></a>00604     gtk_tree_view_column_set_alignment ( column, 1 );
<a name="l00605"></a>00605     gtk_tree_view_column_set_clickable ( GTK_TREE_VIEW_COLUMN ( column ), TRUE );
<a name="l00606"></a>00606     gtk_tree_view_column_set_expand ( GTK_TREE_VIEW_COLUMN ( column ), TRUE );
<a name="l00607"></a>00607     gtk_tree_view_column_set_resizable ( column, TRUE );
<a name="l00608"></a>00608 
<a name="l00609"></a>00609     g_signal_connect ( cell,
<a name="l00610"></a>00610                         <span class="stringliteral">&quot;editing-started&quot;</span>,
<a name="l00611"></a>00611                         G_CALLBACK (bet_historical_div_cell_editing_started),
<a name="l00612"></a>00612                         tree_view );
<a name="l00613"></a>00613     g_signal_connect ( cell,
<a name="l00614"></a>00614                         <span class="stringliteral">&quot;edited&quot;</span>,
<a name="l00615"></a>00615                         G_CALLBACK (bet_historical_div_cell_edited),
<a name="l00616"></a>00616                         tree_view );
<a name="l00617"></a>00617 
<a name="l00618"></a>00618     g_signal_connect ( G_OBJECT ( tree_view ),
<a name="l00619"></a>00619                         <span class="stringliteral">&quot;row-expanded&quot;</span>,
<a name="l00620"></a>00620                         G_CALLBACK ( bet_historical_row_expanded_event ),
<a name="l00621"></a>00621                         tree_model );
<a name="l00622"></a>00622 
<a name="l00623"></a>00623     g_signal_connect ( G_OBJECT ( tree_view ),
<a name="l00624"></a>00624                                 <span class="stringliteral">&quot;button-press-event&quot;</span>,
<a name="l00625"></a>00625                                 G_CALLBACK ( bet_historical_button_press ),
<a name="l00626"></a>00626                                 NULL );
<a name="l00627"></a>00627 
<a name="l00628"></a>00628     gtk_widget_show_all ( scrolled_window );
<a name="l00629"></a>00629 
<a name="l00630"></a>00630     <span class="keywordflow">return</span> tree_view;
<a name="l00631"></a>00631 }
<a name="l00632"></a>00632 
<a name="l00633"></a>00633 
<a name="l00640"></a><a class="code" href="bet__hist_8h.html#adc9c988a689a8786009b652946cafd79">00640</a> <span class="keywordtype">void</span> <a class="code" href="bet__hist_8c.html#adc9c988a689a8786009b652946cafd79">bet_historical_populate_data</a> ( gint account_number )
<a name="l00641"></a>00641 {
<a name="l00642"></a>00642     GtkWidget *tree_view;
<a name="l00643"></a>00643     GtkTreeModel *model;
<a name="l00644"></a>00644     gint fyear_number;
<a name="l00645"></a>00645     GDate *date_min;
<a name="l00646"></a>00646     GDate *date_max;
<a name="l00647"></a>00647     GSList* tmp_list;
<a name="l00648"></a>00648     GHashTable  *list_div;
<a name="l00649"></a>00649 
<a name="l00650"></a>00650     <a class="code" href="erreur_8h.html#a10f4eeae4cc251a8d632fd62ec1057fb">devel_debug_int</a> ( account_number );
<a name="l00651"></a>00651     tree_view = g_object_get_data (G_OBJECT ( <a class="code" href="bet__config_8c.html#ad5443d986a9ab5d64dd84c5346c4b87c">account_page</a> ), <span class="stringliteral">&quot;bet_historical_treeview&quot;</span> );
<a name="l00652"></a>00652     <span class="keywordflow">if</span> ( GTK_IS_TREE_VIEW ( tree_view ) == FALSE )
<a name="l00653"></a>00653         <span class="keywordflow">return</span>;
<a name="l00654"></a>00654 
<a name="l00655"></a>00655     <span class="comment">/* Initializes account settings */</span>
<a name="l00656"></a>00656     bet_historical_initializes_account_settings ( account_number );
<a name="l00657"></a>00657 
<a name="l00658"></a>00658     model = gtk_tree_view_get_model ( GTK_TREE_VIEW ( tree_view ) );
<a name="l00659"></a>00659     gtk_tree_store_clear ( GTK_TREE_STORE ( model ) );
<a name="l00660"></a>00660 
<a name="l00661"></a>00661     <span class="comment">/* calculate date_min and date_max */</span>
<a name="l00662"></a>00662     fyear_number = <a class="code" href="gsb__data__account_8c.html#a3d3888aea106f90fd7715d1ee505a805">gsb_data_account_get_bet_hist_fyear</a> ( account_number );
<a name="l00663"></a>00663     <span class="keywordflow">if</span> ( fyear_number == 0 )
<a name="l00664"></a>00664     {
<a name="l00665"></a>00665         date_min = <a class="code" href="utils__dates_8c.html#a6b816aab8b5dd412b89406bcc587738b">gdate_today</a> ( );
<a name="l00666"></a>00666         g_date_subtract_years ( date_min, 1 );
<a name="l00667"></a>00667         date_max = <a class="code" href="utils__dates_8c.html#a6b816aab8b5dd412b89406bcc587738b">gdate_today</a> ( );
<a name="l00668"></a>00668         g_date_subtract_days ( date_max, 1 );
<a name="l00669"></a>00669         g_object_set_data ( G_OBJECT ( <a class="code" href="bet__config_8c.html#ad5443d986a9ab5d64dd84c5346c4b87c">account_page</a> ), <span class="stringliteral">&quot;bet_historical_period&quot;</span>,
<a name="l00670"></a>00670                 g_strdup ( _(<span class="stringliteral">&quot;12 months rolling&quot;</span>) ) );
<a name="l00671"></a>00671     }
<a name="l00672"></a>00672     <span class="keywordflow">else</span>
<a name="l00673"></a>00673     {
<a name="l00674"></a>00674         date_min = <a class="code" href="gsb__data__fyear_8c.html#afdcd8883d9a62f1b165c1099c4476355">gsb_data_fyear_get_beginning_date</a> ( fyear_number );
<a name="l00675"></a>00675         date_max = <a class="code" href="gsb__data__fyear_8c.html#a567296ee6aea9f010688da1bd2bfbf12">gsb_data_fyear_get_end_date</a> ( fyear_number );
<a name="l00676"></a>00676         g_object_set_data ( G_OBJECT ( <a class="code" href="bet__config_8c.html#ad5443d986a9ab5d64dd84c5346c4b87c">account_page</a> ), <span class="stringliteral">&quot;bet_historical_period&quot;</span>,
<a name="l00677"></a>00677                 g_strdup ( <a class="code" href="gsb__data__fyear_8c.html#ad6c1d7c774990722a69d741ab0d4785e">gsb_data_fyear_get_name</a> ( fyear_number ) ) );
<a name="l00678"></a>00678     }
<a name="l00679"></a>00679     list_div = g_hash_table_new_full ( g_str_hash,
<a name="l00680"></a>00680                         g_str_equal,
<a name="l00681"></a>00681                         (GDestroyNotify) g_free,
<a name="l00682"></a>00682                         (GDestroyNotify) <a class="code" href="bet__data_8c.html#a89a8671d4171468fbbd9cb1f36689f71">struct_free_bet_historical</a> );
<a name="l00683"></a>00683 
<a name="l00684"></a>00684     <span class="comment">/* search transactions of the account  */</span>
<a name="l00685"></a>00685     tmp_list = <a class="code" href="gsb__data__transaction_8c.html#aa54aeb205f29c2272154b2998fea490b">gsb_data_transaction_get_complete_transactions_list</a> ( );
<a name="l00686"></a>00686     <span class="keywordflow">while</span> ( tmp_list )
<a name="l00687"></a>00687     {
<a name="l00688"></a>00688         gint transaction_number;
<a name="l00689"></a>00689         gint tmp_account_number;
<a name="l00690"></a>00690         <span class="keyword">const</span> GDate *date;
<a name="l00691"></a>00691 
<a name="l00692"></a>00692         transaction_number = <a class="code" href="gsb__data__transaction_8c.html#a99bf548513083f4a71fe019faeccbe0a">gsb_data_transaction_get_transaction_number</a> (
<a name="l00693"></a>00693                         tmp_list-&gt;data );
<a name="l00694"></a>00694         tmp_list = tmp_list -&gt; next;
<a name="l00695"></a>00695 
<a name="l00696"></a>00696         tmp_account_number =  <a class="code" href="gsb__data__transaction_8c.html#a5b486efbc486f946e9c998a114054bce">gsb_data_transaction_get_account_number</a> (
<a name="l00697"></a>00697                         transaction_number );
<a name="l00698"></a>00698         <span class="keywordflow">if</span> ( tmp_account_number != account_number )
<a name="l00699"></a>00699             <span class="keywordflow">continue</span>;
<a name="l00700"></a>00700 
<a name="l00701"></a>00701         date = <a class="code" href="gsb__data__transaction_8c.html#ab0b62014885bcf3e2fbfff1ae9b32080">gsb_data_transaction_get_date</a> ( transaction_number );
<a name="l00702"></a>00702         <span class="comment">/* ignore transaction which are before date_min (today) */</span>
<a name="l00703"></a>00703         <span class="keywordflow">if</span> ( g_date_compare ( date, date_min ) &lt;= 0 )
<a name="l00704"></a>00704             <span class="keywordflow">continue</span>;
<a name="l00705"></a>00705         <span class="comment">/* ignore transaction which are after date_max */</span>
<a name="l00706"></a>00706         <span class="keywordflow">if</span> ( g_date_compare (date, date_max ) &gt; 0 )
<a name="l00707"></a>00707             <span class="keywordflow">continue</span>;
<a name="l00708"></a>00708 
<a name="l00709"></a>00709         <span class="comment">/* ignore splitted transactions */</span>
<a name="l00710"></a>00710         <span class="keywordflow">if</span> ( <a class="code" href="gsb__data__transaction_8c.html#a6018560ece7ab02e8d46bc9bdaffd607">gsb_data_transaction_get_mother_transaction_number</a> (
<a name="l00711"></a>00711          transaction_number ) != 0 )
<a name="l00712"></a>00712             <span class="keywordflow">continue</span>;
<a name="l00713"></a>00713 
<a name="l00714"></a>00714         <a class="code" href="bet__data_8c.html#a0de6607543e7a4e0f2051394707631b5">bet_data_populate_div</a> ( transaction_number, TRUE, list_div );
<a name="l00715"></a>00715     }
<a name="l00716"></a>00716 
<a name="l00717"></a>00717     bet_historical_affiche_div ( list_div, tree_view );
<a name="l00718"></a>00718     <span class="comment">/* bet_data_synchronise_hist_div_list ( list_div ); */</span>
<a name="l00719"></a>00719 
<a name="l00720"></a>00720     g_hash_table_remove_all ( list_div );
<a name="l00721"></a>00721 
<a name="l00722"></a>00722     bet_historical_set_background_color ( tree_view );
<a name="l00723"></a>00723 }
<a name="l00724"></a>00724 
<a name="l00725"></a>00725 
<a name="l00732"></a>00732 gboolean bet_historical_affiche_div ( GHashTable  *list_div, GtkWidget *tree_view )
<a name="l00733"></a>00733 {
<a name="l00734"></a>00734     GtkTreeModel *model;
<a name="l00735"></a>00735 
<a name="l00736"></a>00736     <span class="comment">/* devel_debug (NULL); */</span>
<a name="l00737"></a>00737     model = gtk_tree_view_get_model ( GTK_TREE_VIEW ( tree_view ) );
<a name="l00738"></a>00738 
<a name="l00739"></a>00739     g_hash_table_foreach ( list_div, bet_historical_populate_div_model, tree_view );
<a name="l00740"></a>00740 
<a name="l00741"></a>00741     <span class="keywordflow">return</span> FALSE;
<a name="l00742"></a>00742 }
<a name="l00743"></a>00743 
<a name="l00744"></a>00744 
<a name="l00751"></a>00751 <span class="keywordtype">void</span> bet_historical_populate_div_model ( gpointer key,
<a name="l00752"></a>00752                         gpointer value,
<a name="l00753"></a>00753                         gpointer user_data )
<a name="l00754"></a>00754 {
<a name="l00755"></a>00755     <a class="code" href="struct__historical.html">SH</a> *sh = ( <a class="code" href="struct__historical.html">SH</a>* ) value;
<a name="l00756"></a>00756     <a class="code" href="struct__bet__range.html">SBR</a> *sbr = sh -&gt; sbr;
<a name="l00757"></a>00757     GtkTreeView *tree_view = ( GtkTreeView * ) user_data;
<a name="l00758"></a>00758     GtkTreeModel *model;
<a name="l00759"></a>00759     GtkTreeIter parent;
<a name="l00760"></a>00760     GHashTableIter iter;
<a name="l00761"></a>00761     gpointer sub_key, sub_value;
<a name="l00762"></a>00762     gchar *div_name = NULL;
<a name="l00763"></a>00763     gchar *str_balance;
<a name="l00764"></a>00764     gchar *str_average;
<a name="l00765"></a>00765     gchar *str_amount;
<a name="l00766"></a>00766     gchar *str_retained = NULL;
<a name="l00767"></a>00767     gchar *titre;
<a name="l00768"></a>00768     gint div_number;
<a name="l00769"></a>00769     gint account_nb;
<a name="l00770"></a>00770     gboolean sub_div_visible = FALSE;
<a name="l00771"></a>00771     gboolean edited = TRUE;
<a name="l00772"></a>00772     <a class="code" href="structgsb__real.html">gsb_real</a> period = { 12, 0 };
<a name="l00773"></a>00773     <a class="code" href="structgsb__real.html">gsb_real</a> average;
<a name="l00774"></a>00774     <a class="code" href="structgsb__real.html">gsb_real</a> retained;
<a name="l00775"></a>00775     <a class="code" href="structgsb__real.html">gsb_real</a> amount;
<a name="l00776"></a>00776     <a class="code" href="gsb__data__account_8h.html#abe336abc6aaa13733b0ea311c9478862">kind_account</a> kind;
<a name="l00777"></a>00777 
<a name="l00778"></a>00778     div_number = sh -&gt; div;
<a name="l00779"></a>00779     div_name = <a class="code" href="bet__data_8c.html#aea9c573187265658d763308e06b90b05">bet_data_get_div_name</a> ( div_number, 0, NULL );
<a name="l00780"></a>00780     account_nb = sh -&gt; account_nb;
<a name="l00781"></a>00781     kind = <a class="code" href="gsb__data__account_8c.html#aa2e978644e71d62a1aaf1c58cb6b0fcd">gsb_data_account_get_kind</a> ( account_nb );
<a name="l00782"></a>00782     <span class="keywordflow">if</span> ( kind == <a class="code" href="gsb__data__account_8h.html#ab5b2ad5b1ac065827dcf65b09542f53da1e355ad8c560d892d0b5912be1d875a2">GSB_TYPE_CASH</a> )
<a name="l00783"></a>00783         edited = FALSE;
<a name="l00784"></a>00784 
<a name="l00785"></a>00785     titre = g_object_get_data ( G_OBJECT ( <a class="code" href="bet__config_8c.html#ad5443d986a9ab5d64dd84c5346c4b87c">account_page</a> ), <span class="stringliteral">&quot;bet_historical_period&quot;</span> );
<a name="l00786"></a>00786 
<a name="l00787"></a>00787     model = gtk_tree_view_get_model ( tree_view );
<a name="l00788"></a>00788 
<a name="l00789"></a>00789     str_balance = <a class="code" href="gsb__real_8c.html#a03f4474a9a4269e384951af9be4acedd">gsb_real_get_string_with_currency</a> ( sbr -&gt; current_balance, 
<a name="l00790"></a>00790                         <a class="code" href="gsb__data__account_8c.html#a9f8d132b988ca73a7061fca955f6bc2c">gsb_data_account_get_currency</a> ( account_nb ), TRUE );
<a name="l00791"></a>00791     average = <a class="code" href="gsb__real_8c.html#a93c09778fbfddebc650260cc49da78a5">gsb_real_div</a> ( sbr -&gt; current_balance, period );
<a name="l00792"></a>00792     str_amount = <a class="code" href="gsb__real_8c.html#a50c880e082aa7241dfa50a9bc0a87207">gsb_real_save_real_to_string</a> ( average, 2 );
<a name="l00793"></a>00793     str_average = <a class="code" href="gsb__real_8c.html#a03f4474a9a4269e384951af9be4acedd">gsb_real_get_string_with_currency</a> ( average,
<a name="l00794"></a>00794                         <a class="code" href="gsb__data__account_8c.html#a9f8d132b988ca73a7061fca955f6bc2c">gsb_data_account_get_currency</a> ( account_nb ), TRUE );
<a name="l00795"></a>00795 
<a name="l00796"></a>00796     gtk_tree_store_append ( GTK_TREE_STORE ( model ), &amp;parent, NULL);
<a name="l00797"></a>00797     gtk_tree_store_set ( GTK_TREE_STORE ( model ),
<a name="l00798"></a>00798                         &amp;parent,
<a name="l00799"></a>00799                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897aeff2bf9d7b77605f4e1deb048cd0c84b">SPP_HISTORICAL_DESC_COLUMN</a>, div_name,
<a name="l00800"></a>00800                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a45ca3b7c980e082587741f06f4c48d46">SPP_HISTORICAL_PERIOD_COLUMN</a>, titre,
<a name="l00801"></a>00801                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a6a40f807c6a610907487b055f4fa741e">SPP_HISTORICAL_BALANCE_COLUMN</a>, str_balance,
<a name="l00802"></a>00802                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a1631c4f97d7e33268a015d35f8908b2d">SPP_HISTORICAL_AVERAGE_COLUMN</a>, str_average,
<a name="l00803"></a>00803                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a9383c850b527e1beb1a23ce870c7bbde">SPP_HISTORICAL_AVERAGE_AMOUNT</a>, str_amount,
<a name="l00804"></a>00804                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a97b1a54b3d43dc7cf517776044d275c9">SPP_HISTORICAL_RETAINED_AMOUNT</a>, str_amount,
<a name="l00805"></a>00805                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897ab8bc5e130fa8cfb9100d47fda24a5bff">SPP_HISTORICAL_ACCOUNT_NUMBER</a>, account_nb,
<a name="l00806"></a>00806                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897ac666b9db44d7d9a667f13a3906efef93">SPP_HISTORICAL_DIV_NUMBER</a>, div_number,
<a name="l00807"></a>00807                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a80af7fc45177c92a3469977cc1e481f8">SPP_HISTORICAL_SUB_DIV_NUMBER</a>, 0,
<a name="l00808"></a>00808                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a5a2e837c9fd864ef47eeb0b61b23bfe7">SPP_HISTORICAL_EDITED_COLUMN</a>, edited,
<a name="l00809"></a>00809                         -1);
<a name="l00810"></a>00810 
<a name="l00811"></a>00811     <span class="keywordflow">if</span> ( <a class="code" href="bet__data_8c.html#aa5a0bad0ab672a04b4dfa18d9816aa20">bet_data_search_div_hist</a> ( account_nb, div_number, 0 ) 
<a name="l00812"></a>00812      &amp;&amp;
<a name="l00813"></a>00813      ( <a class="code" href="bet__data_8c.html#a404cd035dc7d1d50729066aa299fe43b">bet_data_get_div_edited</a> ( account_nb, div_number, 0 )
<a name="l00814"></a>00814       ||
<a name="l00815"></a>00815       g_hash_table_size ( sh -&gt; list_sub_div ) &lt;= 1 ) )
<a name="l00816"></a>00816     {
<a name="l00817"></a>00817         retained = <a class="code" href="bet__data_8c.html#aa0afee08549af46994f0cd802d462338">bet_data_hist_get_div_amount</a> ( account_nb, div_number, 0 );
<a name="l00818"></a>00818         <span class="keywordflow">if</span> ( str_amount )
<a name="l00819"></a>00819             g_free ( str_amount );
<a name="l00820"></a>00820         str_amount = <a class="code" href="gsb__real_8c.html#a50c880e082aa7241dfa50a9bc0a87207">gsb_real_save_real_to_string</a> ( retained, 2 );
<a name="l00821"></a>00821         str_retained = <a class="code" href="gsb__real_8c.html#a03f4474a9a4269e384951af9be4acedd">gsb_real_get_string_with_currency</a> ( retained,
<a name="l00822"></a>00822                         <a class="code" href="gsb__data__account_8c.html#a9f8d132b988ca73a7061fca955f6bc2c">gsb_data_account_get_currency</a> ( sh -&gt; account_nb ), TRUE );
<a name="l00823"></a>00823         gtk_tree_store_set ( GTK_TREE_STORE ( model ),
<a name="l00824"></a>00824                         &amp;parent,
<a name="l00825"></a>00825                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a5d0bcfb3283a599dc1f20ca75cb6faf2">SPP_HISTORICAL_SELECT_COLUMN</a>, TRUE,
<a name="l00826"></a>00826                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a94988d43a9fb250409c6de6324165e5e">SPP_HISTORICAL_RETAINED_COLUMN</a>, str_retained,
<a name="l00827"></a>00827                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a97b1a54b3d43dc7cf517776044d275c9">SPP_HISTORICAL_RETAINED_AMOUNT</a>, str_amount,
<a name="l00828"></a>00828                         -1);
<a name="l00829"></a>00829         g_free ( str_retained );
<a name="l00830"></a>00830     }
<a name="l00831"></a>00831 
<a name="l00832"></a>00832     g_free ( div_name );
<a name="l00833"></a>00833     g_free ( str_average );
<a name="l00834"></a>00834     g_free ( str_amount );
<a name="l00835"></a>00835 
<a name="l00836"></a>00836     <span class="keywordflow">if</span> ( g_hash_table_size ( sh -&gt; list_sub_div ) &lt;= 1 )
<a name="l00837"></a>00837         <span class="keywordflow">return</span>;
<a name="l00838"></a>00838 
<a name="l00839"></a>00839     g_hash_table_iter_init ( &amp;iter, sh -&gt; list_sub_div );
<a name="l00840"></a>00840     <span class="keywordflow">while</span> ( g_hash_table_iter_next ( &amp;iter, &amp;sub_key, &amp;sub_value ) ) 
<a name="l00841"></a>00841     {
<a name="l00842"></a>00842         <a class="code" href="struct__historical.html">SH</a> *sub_sh = ( <a class="code" href="struct__historical.html">SH</a>* ) sub_value;
<a name="l00843"></a>00843         <a class="code" href="struct__bet__range.html">SBR</a> *sub_sbr = sub_sh -&gt; sbr;
<a name="l00844"></a>00844         GtkTreeIter fils;
<a name="l00845"></a>00845         gchar **tab_str = NULL;
<a name="l00846"></a>00846 
<a name="l00847"></a>00847         div_name = <a class="code" href="bet__data_8c.html#aea9c573187265658d763308e06b90b05">bet_data_get_div_name</a> ( div_number, sub_sh -&gt; div, NULL );
<a name="l00848"></a>00848         <span class="comment">/* printf (&quot;division = %d sub_div = %d div_name = %s\n&quot;,</span>
<a name="l00849"></a>00849 <span class="comment">                        div_number, sub_sh -&gt; div, div_name); */</span>
<a name="l00850"></a>00850         <span class="keywordflow">if</span> ( div_name &amp;&amp; g_utf8_strrchr ( div_name, -1, <span class="charliteral">&#39;:&#39;</span> ) )
<a name="l00851"></a>00851         {
<a name="l00852"></a>00852                 tab_str = g_strsplit ( div_name, <span class="stringliteral">&quot;:&quot;</span>, 2 );
<a name="l00853"></a>00853             <span class="keywordflow">if</span> ( g_strv_length ( tab_str ) &gt; 1 )
<a name="l00854"></a>00854             {
<a name="l00855"></a>00855                 <span class="keywordflow">if</span> ( div_name )
<a name="l00856"></a>00856                     g_free ( div_name );
<a name="l00857"></a>00857                 div_name = g_strdup ( g_strstrip ( tab_str[1] ) );
<a name="l00858"></a>00858             }
<a name="l00859"></a>00859             <span class="keywordflow">if</span> ( tab_str )
<a name="l00860"></a>00860                 g_strfreev ( tab_str );
<a name="l00861"></a>00861         }
<a name="l00862"></a>00862 
<a name="l00863"></a>00863         str_balance = <a class="code" href="gsb__real_8c.html#a03f4474a9a4269e384951af9be4acedd">gsb_real_get_string_with_currency</a> ( sub_sbr -&gt; current_balance, 
<a name="l00864"></a>00864                         <a class="code" href="gsb__data__account_8c.html#a9f8d132b988ca73a7061fca955f6bc2c">gsb_data_account_get_currency</a> ( sh -&gt; account_nb ), TRUE );
<a name="l00865"></a>00865         average = <a class="code" href="gsb__real_8c.html#a93c09778fbfddebc650260cc49da78a5">gsb_real_div</a> ( sub_sbr -&gt; current_balance, period );
<a name="l00866"></a>00866         str_amount = <a class="code" href="gsb__real_8c.html#a50c880e082aa7241dfa50a9bc0a87207">gsb_real_save_real_to_string</a> ( average, 2 );
<a name="l00867"></a>00867         str_average = <a class="code" href="gsb__real_8c.html#a03f4474a9a4269e384951af9be4acedd">gsb_real_get_string_with_currency</a> ( average,
<a name="l00868"></a>00868                         <a class="code" href="gsb__data__account_8c.html#a9f8d132b988ca73a7061fca955f6bc2c">gsb_data_account_get_currency</a> ( sh -&gt; account_nb ), TRUE );
<a name="l00869"></a>00869 
<a name="l00870"></a>00870         gtk_tree_store_append ( GTK_TREE_STORE ( model ), &amp;fils, &amp;parent );
<a name="l00871"></a>00871         gtk_tree_store_set ( GTK_TREE_STORE ( model ),
<a name="l00872"></a>00872                         &amp;fils,
<a name="l00873"></a>00873                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897aeff2bf9d7b77605f4e1deb048cd0c84b">SPP_HISTORICAL_DESC_COLUMN</a>, div_name,
<a name="l00874"></a>00874                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a6a40f807c6a610907487b055f4fa741e">SPP_HISTORICAL_BALANCE_COLUMN</a>, str_balance,
<a name="l00875"></a>00875                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a1631c4f97d7e33268a015d35f8908b2d">SPP_HISTORICAL_AVERAGE_COLUMN</a>, str_average,
<a name="l00876"></a>00876                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a9383c850b527e1beb1a23ce870c7bbde">SPP_HISTORICAL_AVERAGE_AMOUNT</a>, str_amount,
<a name="l00877"></a>00877                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a97b1a54b3d43dc7cf517776044d275c9">SPP_HISTORICAL_RETAINED_AMOUNT</a>, str_amount,
<a name="l00878"></a>00878                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897ab8bc5e130fa8cfb9100d47fda24a5bff">SPP_HISTORICAL_ACCOUNT_NUMBER</a>, account_nb,
<a name="l00879"></a>00879                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897ac666b9db44d7d9a667f13a3906efef93">SPP_HISTORICAL_DIV_NUMBER</a>, div_number,
<a name="l00880"></a>00880                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a80af7fc45177c92a3469977cc1e481f8">SPP_HISTORICAL_SUB_DIV_NUMBER</a>, sub_sh -&gt; div,
<a name="l00881"></a>00881                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a5a2e837c9fd864ef47eeb0b61b23bfe7">SPP_HISTORICAL_EDITED_COLUMN</a>, edited,
<a name="l00882"></a>00882                         -1);
<a name="l00883"></a>00883 
<a name="l00884"></a>00884         <span class="keywordflow">if</span> ( <a class="code" href="bet__data_8c.html#aa5a0bad0ab672a04b4dfa18d9816aa20">bet_data_search_div_hist</a> ( account_nb, div_number, sub_sh -&gt; div ) )
<a name="l00885"></a>00885         {
<a name="l00886"></a>00886             <span class="keywordflow">if</span> ( <a class="code" href="bet__data_8c.html#a404cd035dc7d1d50729066aa299fe43b">bet_data_get_div_edited</a> ( account_nb, div_number, sub_sh -&gt; div ) )
<a name="l00887"></a>00887             {
<a name="l00888"></a>00888                 <span class="comment">/* printf (&quot;account_nb = %d div_number = %d sub_sh -&gt; div = %d\n&quot;, account_nb, div_number, sub_sh -&gt; div ); */</span>
<a name="l00889"></a>00889                 retained = <a class="code" href="bet__data_8c.html#aa0afee08549af46994f0cd802d462338">bet_data_hist_get_div_amount</a> ( account_nb, div_number, sub_sh -&gt; div );
<a name="l00890"></a>00890                 <span class="keywordflow">if</span> ( str_amount )
<a name="l00891"></a>00891                     g_free ( str_amount );
<a name="l00892"></a>00892                 str_amount = <a class="code" href="gsb__real_8c.html#a50c880e082aa7241dfa50a9bc0a87207">gsb_real_save_real_to_string</a> ( retained, 2 );
<a name="l00893"></a>00893                 str_retained = <a class="code" href="gsb__real_8c.html#a03f4474a9a4269e384951af9be4acedd">gsb_real_get_string_with_currency</a> ( retained,
<a name="l00894"></a>00894                                 <a class="code" href="gsb__data__account_8c.html#a9f8d132b988ca73a7061fca955f6bc2c">gsb_data_account_get_currency</a> ( sh -&gt; account_nb ), TRUE );
<a name="l00895"></a>00895 
<a name="l00896"></a>00896                 edited = FALSE;
<a name="l00897"></a>00897                 gtk_tree_store_set ( GTK_TREE_STORE ( model ),
<a name="l00898"></a>00898                         &amp;parent,
<a name="l00899"></a>00899                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a5a2e837c9fd864ef47eeb0b61b23bfe7">SPP_HISTORICAL_EDITED_COLUMN</a>, edited,
<a name="l00900"></a>00900                         -1);
<a name="l00901"></a>00901             }
<a name="l00902"></a>00902             <span class="keywordflow">else</span>
<a name="l00903"></a>00903             {
<a name="l00904"></a>00904                 <a class="code" href="bet__data_8c.html#a3eeebe94c6f939ab1428c4a3860d7884">bet_data_set_div_amount</a> ( account_nb, div_number, sub_sh -&gt; div, average );
<a name="l00905"></a>00905                 str_retained = g_strdup ( str_average );
<a name="l00906"></a>00906                 edited = TRUE;
<a name="l00907"></a>00907             }
<a name="l00908"></a>00908             gtk_tree_store_set ( GTK_TREE_STORE ( model ),
<a name="l00909"></a>00909                         &amp;fils,
<a name="l00910"></a>00910                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a5d0bcfb3283a599dc1f20ca75cb6faf2">SPP_HISTORICAL_SELECT_COLUMN</a>, TRUE,
<a name="l00911"></a>00911                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a94988d43a9fb250409c6de6324165e5e">SPP_HISTORICAL_RETAINED_COLUMN</a>, str_retained,
<a name="l00912"></a>00912                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a97b1a54b3d43dc7cf517776044d275c9">SPP_HISTORICAL_RETAINED_AMOUNT</a>, str_amount,
<a name="l00913"></a>00913                         -1);
<a name="l00914"></a>00914             sub_div_visible = TRUE;
<a name="l00915"></a>00915             gtk_tree_view_expand_to_path ( tree_view, gtk_tree_model_get_path ( model, &amp;fils ) );
<a name="l00916"></a>00916 
<a name="l00917"></a>00917             g_free ( str_retained );
<a name="l00918"></a>00918         }
<a name="l00919"></a>00919         g_free ( div_name );
<a name="l00920"></a>00920         g_free ( str_balance );
<a name="l00921"></a>00921         g_free ( str_average );
<a name="l00922"></a>00922         g_free ( str_amount );
<a name="l00923"></a>00923     }
<a name="l00924"></a>00924 
<a name="l00925"></a>00925     <span class="keywordflow">if</span> ( sub_div_visible &amp;&amp; bet_historical_get_full_div ( model, &amp;parent ) )
<a name="l00926"></a>00926     {
<a name="l00927"></a>00927         amount = bet_historical_get_children_amount ( model, &amp;parent );
<a name="l00928"></a>00928         <span class="keywordflow">if</span> ( str_amount )
<a name="l00929"></a>00929             g_free ( str_amount );
<a name="l00930"></a>00930         str_amount = <a class="code" href="gsb__real_8c.html#a50c880e082aa7241dfa50a9bc0a87207">gsb_real_save_real_to_string</a> ( amount, 2 );
<a name="l00931"></a>00931         str_retained = <a class="code" href="gsb__real_8c.html#a03f4474a9a4269e384951af9be4acedd">gsb_real_get_string_with_currency</a> ( amount,
<a name="l00932"></a>00932                     <a class="code" href="gsb__data__account_8c.html#a9f8d132b988ca73a7061fca955f6bc2c">gsb_data_account_get_currency</a> ( account_nb ), TRUE );
<a name="l00933"></a>00933 
<a name="l00934"></a>00934         gtk_tree_store_set ( GTK_TREE_STORE ( model ),
<a name="l00935"></a>00935                     &amp;parent,
<a name="l00936"></a>00936                     <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a5d0bcfb3283a599dc1f20ca75cb6faf2">SPP_HISTORICAL_SELECT_COLUMN</a>, TRUE,
<a name="l00937"></a>00937                     <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a94988d43a9fb250409c6de6324165e5e">SPP_HISTORICAL_RETAINED_COLUMN</a>, str_retained,
<a name="l00938"></a>00938                     <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a97b1a54b3d43dc7cf517776044d275c9">SPP_HISTORICAL_RETAINED_AMOUNT</a>, str_amount,
<a name="l00939"></a>00939                     <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a5a2e837c9fd864ef47eeb0b61b23bfe7">SPP_HISTORICAL_EDITED_COLUMN</a>, edited,
<a name="l00940"></a>00940                     -1);
<a name="l00941"></a>00941         g_free ( str_amount );
<a name="l00942"></a>00942         g_free ( str_retained );
<a name="l00943"></a>00943 
<a name="l00944"></a>00944         <span class="keywordflow">if</span> ( edited )
<a name="l00945"></a>00945         {
<a name="l00946"></a>00946             gtk_tree_view_collapse_row ( tree_view, gtk_tree_model_get_path ( model, &amp;parent ) );
<a name="l00947"></a>00947             gtk_tree_selection_select_iter ( gtk_tree_view_get_selection ( tree_view ), &amp;parent );
<a name="l00948"></a>00948 
<a name="l00949"></a>00949         }
<a name="l00950"></a>00950     }
<a name="l00951"></a>00951 }
<a name="l00952"></a>00952 
<a name="l00953"></a>00953 
<a name="l00962"></a>00962 gboolean bet_historical_fyear_create_combobox_store ( <span class="keywordtype">void</span> )
<a name="l00963"></a>00963 {
<a name="l00964"></a>00964     gchar *titre;
<a name="l00965"></a>00965 
<a name="l00966"></a>00966     <span class="comment">/* devel_debug (NULL); */</span>
<a name="l00967"></a>00967     <span class="comment">/* the fyear list store, contains 3 columns :</span>
<a name="l00968"></a>00968 <span class="comment">     * FYEAR_COL_NAME : the name of the fyear</span>
<a name="l00969"></a>00969 <span class="comment">     * FYEAR_COL_NUMBER : the number of the fyear</span>
<a name="l00970"></a>00970 <span class="comment">     * FYEAR_COL_VIEW : it the fyear should be showed */</span>
<a name="l00971"></a>00971 
<a name="l00972"></a>00972     titre = g_strdup ( _(<span class="stringliteral">&quot;12 months rolling&quot;</span>) );
<a name="l00973"></a>00973     <a class="code" href="bet__config_8c.html#a3b7bcf1e9b05e7a812d6f4d4bc0627d6">bet_fyear_model</a> = GTK_TREE_MODEL ( gtk_list_store_new ( 3,
<a name="l00974"></a>00974                         G_TYPE_STRING,
<a name="l00975"></a>00975                         G_TYPE_INT,
<a name="l00976"></a>00976                         G_TYPE_BOOLEAN ));
<a name="l00977"></a>00977     <a class="code" href="bet__config_8c.html#aecc63d6768ce86bba48badbe50334f1b">bet_fyear_model_filter</a> = gtk_tree_model_filter_new ( <a class="code" href="bet__config_8c.html#a3b7bcf1e9b05e7a812d6f4d4bc0627d6">bet_fyear_model</a>, NULL );
<a name="l00978"></a>00978     gtk_tree_model_filter_set_visible_column ( GTK_TREE_MODEL_FILTER (
<a name="l00979"></a>00979                         <a class="code" href="bet__config_8c.html#aecc63d6768ce86bba48badbe50334f1b">bet_fyear_model_filter</a> ),
<a name="l00980"></a>00980                         <a class="code" href="gsb__fyear_8h.html#a246a4e0e04222fdb2a11a5ba02450160adb9b40dd91d1b7e9be9ad797bfd78600">FYEAR_COL_VIEW</a> );
<a name="l00981"></a>00981     <a class="code" href="gsb__fyear_8c.html#a34d75e7b50bee69ad545dcea4df88f9a">gsb_fyear_update_fyear_list_new</a> ( <a class="code" href="bet__config_8c.html#a3b7bcf1e9b05e7a812d6f4d4bc0627d6">bet_fyear_model</a>,
<a name="l00982"></a>00982                         <a class="code" href="bet__config_8c.html#aecc63d6768ce86bba48badbe50334f1b">bet_fyear_model_filter</a>,
<a name="l00983"></a>00983                         titre );
<a name="l00984"></a>00984     g_free ( titre );
<a name="l00985"></a>00985 
<a name="l00986"></a>00986     <span class="keywordflow">return</span> TRUE;
<a name="l00987"></a>00987 }
<a name="l00988"></a>00988 
<a name="l00989"></a>00989 
<a name="l00996"></a><a class="code" href="bet__hist_8h.html#abcb09aee0aaff63d36a2da702ad4520b">00996</a> gint <a class="code" href="bet__hist_8c.html#abcb09aee0aaff63d36a2da702ad4520b">bet_historical_get_fyear_from_combobox</a> ( GtkWidget *combo_box )
<a name="l00997"></a>00997 {
<a name="l00998"></a>00998     gint fyear_number = 0;
<a name="l00999"></a>00999     GtkTreeIter iter;
<a name="l01000"></a>01000 
<a name="l01001"></a>01001     <span class="comment">/* devel_debug (NULL); */</span>
<a name="l01002"></a>01002     <span class="keywordflow">if</span> ( !gtk_combo_box_get_active_iter ( GTK_COMBO_BOX ( combo_box ), &amp;iter ) )
<a name="l01003"></a>01003         <span class="keywordflow">return</span> 0;
<a name="l01004"></a>01004 
<a name="l01005"></a>01005     <span class="keywordflow">if</span> ( <a class="code" href="bet__config_8c.html#aecc63d6768ce86bba48badbe50334f1b">bet_fyear_model_filter</a> )
<a name="l01006"></a>01006     {
<a name="l01007"></a>01007         gtk_tree_model_get ( GTK_TREE_MODEL ( <a class="code" href="bet__config_8c.html#aecc63d6768ce86bba48badbe50334f1b">bet_fyear_model_filter</a> ),
<a name="l01008"></a>01008                         &amp;iter,
<a name="l01009"></a>01009                         <a class="code" href="gsb__fyear_8h.html#a246a4e0e04222fdb2a11a5ba02450160a4eeeba3497eaa5fc6e5d9512ff45ae58">FYEAR_COL_NUMBER</a>, &amp;fyear_number,
<a name="l01010"></a>01010                         -1 );
<a name="l01011"></a>01011     }
<a name="l01012"></a>01012 
<a name="l01013"></a>01013     <span class="keywordflow">return</span> fyear_number;
<a name="l01014"></a>01014 }
<a name="l01015"></a>01015 
<a name="l01022"></a><a class="code" href="bet__hist_8h.html#ae25049d7e4dc6d068bafe7eef985e0db">01022</a> <span class="keywordtype">void</span> <a class="code" href="bet__hist_8c.html#ae25049d7e4dc6d068bafe7eef985e0db">bet_historical_set_fyear_from_combobox</a> ( GtkWidget *combo_box, gint fyear )
<a name="l01023"></a>01023 {
<a name="l01024"></a>01024     <a class="code" href="gsb__fyear_8c.html#a0e0eb0128f2cec486a664a028b70a273">gsb_fyear_select_iter_by_number</a> ( combo_box,
<a name="l01025"></a>01025                     <a class="code" href="bet__config_8c.html#a3b7bcf1e9b05e7a812d6f4d4bc0627d6">bet_fyear_model</a>,
<a name="l01026"></a>01026                     <a class="code" href="bet__config_8c.html#aecc63d6768ce86bba48badbe50334f1b">bet_fyear_model_filter</a>,
<a name="l01027"></a>01027                     fyear );
<a name="l01028"></a>01028 }
<a name="l01029"></a>01029 
<a name="l01030"></a>01030 
<a name="l01037"></a><a class="code" href="bet__hist_8h.html#a91d084d5b8b5d19d52294b1148c758b9">01037</a> <span class="keywordtype">void</span> <a class="code" href="bet__hist_8c.html#a91d084d5b8b5d19d52294b1148c758b9">bet_historical_refresh_data</a> ( GtkTreeModel *tab_model,
<a name="l01038"></a>01038                         GDate *date_min,
<a name="l01039"></a>01039                         GDate *date_max )
<a name="l01040"></a>01040 {
<a name="l01041"></a>01041     GtkWidget *tree_view;
<a name="l01042"></a>01042     GtkTreeModel *model;
<a name="l01043"></a>01043     GtkTreeIter iter;
<a name="l01044"></a>01044     GtkTreeIter fils_iter;
<a name="l01045"></a>01045 
<a name="l01046"></a>01046     <a class="code" href="erreur_8h.html#a17bfffc4306bc76edd79e060a8947dc4">devel_debug</a> (NULL);
<a name="l01047"></a>01047     tree_view = g_object_get_data ( G_OBJECT ( <a class="code" href="bet__config_8c.html#ad5443d986a9ab5d64dd84c5346c4b87c">account_page</a> ), <span class="stringliteral">&quot;bet_historical_treeview&quot;</span> );
<a name="l01048"></a>01048     model = gtk_tree_view_get_model ( GTK_TREE_VIEW ( tree_view ) );
<a name="l01049"></a>01049 
<a name="l01050"></a>01050     <span class="keywordflow">if</span> ( gtk_tree_model_get_iter_first ( GTK_TREE_MODEL ( model ), &amp;iter ) )
<a name="l01051"></a>01051     {
<a name="l01052"></a>01052         gboolean valeur;
<a name="l01053"></a>01053         gint account_number;
<a name="l01054"></a>01054 
<a name="l01055"></a>01055         <span class="comment">/* test du numero de compte */</span>
<a name="l01056"></a>01056         gtk_tree_model_get ( GTK_TREE_MODEL ( model ), &amp;iter,
<a name="l01057"></a>01057                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897ab8bc5e130fa8cfb9100d47fda24a5bff">SPP_HISTORICAL_ACCOUNT_NUMBER</a>, &amp;account_number,
<a name="l01058"></a>01058                         -1 );
<a name="l01059"></a>01059         <span class="keywordflow">if</span> ( account_number != <a class="code" href="navigation_8c.html#a3b668bf52ce71dcff3ea10c9db7be859">gsb_gui_navigation_get_current_account</a> ( ) )
<a name="l01060"></a>01060             <span class="keywordflow">return</span>;
<a name="l01061"></a>01061 
<a name="l01062"></a>01062         <span class="keywordflow">do</span>
<a name="l01063"></a>01063         {
<a name="l01064"></a>01064             gtk_tree_model_get ( GTK_TREE_MODEL ( model ), &amp;iter,
<a name="l01065"></a>01065                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a5d0bcfb3283a599dc1f20ca75cb6faf2">SPP_HISTORICAL_SELECT_COLUMN</a>, &amp;valeur,
<a name="l01066"></a>01066                         -1 );
<a name="l01067"></a>01067             <span class="keywordflow">if</span> ( valeur == 1 )
<a name="l01068"></a>01068             {
<a name="l01069"></a>01069                 <a class="code" href="bet__tab_8c.html#a06cdcd05c5db9dec496f47a99b7eaca5">bet_array_list_add_new_hist_line</a> ( tab_model,
<a name="l01070"></a>01070                         GTK_TREE_MODEL ( model ), &amp;iter,
<a name="l01071"></a>01071                         date_min, date_max );
<a name="l01072"></a>01072             }
<a name="l01073"></a>01073             <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( gtk_tree_model_iter_children (
<a name="l01074"></a>01074                         GTK_TREE_MODEL ( model ),
<a name="l01075"></a>01075                         &amp;fils_iter, &amp;iter ) )
<a name="l01076"></a>01076             {
<a name="l01077"></a>01077                 <span class="keywordflow">do</span>
<a name="l01078"></a>01078                 {
<a name="l01079"></a>01079                     gtk_tree_model_get ( GTK_TREE_MODEL ( model ),
<a name="l01080"></a>01080                                 &amp;fils_iter,
<a name="l01081"></a>01081                                 <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a5d0bcfb3283a599dc1f20ca75cb6faf2">SPP_HISTORICAL_SELECT_COLUMN</a>, &amp;valeur,
<a name="l01082"></a>01082                                 -1 );
<a name="l01083"></a>01083 
<a name="l01084"></a>01084                     <span class="keywordflow">if</span> ( valeur == 1 )
<a name="l01085"></a>01085                     {
<a name="l01086"></a>01086                         <a class="code" href="bet__tab_8c.html#a06cdcd05c5db9dec496f47a99b7eaca5">bet_array_list_add_new_hist_line</a> ( tab_model,
<a name="l01087"></a>01087                                 GTK_TREE_MODEL ( model ), &amp;fils_iter,
<a name="l01088"></a>01088                                 date_min, date_max );
<a name="l01089"></a>01089                     }
<a name="l01090"></a>01090                 }
<a name="l01091"></a>01091                     <span class="keywordflow">while</span> ( gtk_tree_model_iter_next (
<a name="l01092"></a>01092                         GTK_TREE_MODEL ( model ), &amp;fils_iter ) );
<a name="l01093"></a>01093             }
<a name="l01094"></a>01094 
<a name="l01095"></a>01095         } <span class="keywordflow">while</span> ( gtk_tree_model_iter_next ( GTK_TREE_MODEL ( model ), &amp;iter ) );
<a name="l01096"></a>01096     }
<a name="l01097"></a>01097 }
<a name="l01098"></a>01098 
<a name="l01099"></a>01099 
<a name="l01106"></a>01106 gboolean bet_historical_get_full_div ( GtkTreeModel *model, GtkTreeIter *parent )
<a name="l01107"></a>01107 {
<a name="l01108"></a>01108     GtkTreeIter fils_iter;
<a name="l01109"></a>01109     gint valeur;
<a name="l01110"></a>01110 
<a name="l01111"></a>01111     <span class="keywordflow">if</span> ( gtk_tree_model_iter_children ( GTK_TREE_MODEL ( model ), &amp;fils_iter, parent ) )
<a name="l01112"></a>01112     {
<a name="l01113"></a>01113         <span class="keywordflow">do</span>
<a name="l01114"></a>01114         {
<a name="l01115"></a>01115             gtk_tree_model_get ( GTK_TREE_MODEL ( model ), &amp;fils_iter,
<a name="l01116"></a>01116                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a5d0bcfb3283a599dc1f20ca75cb6faf2">SPP_HISTORICAL_SELECT_COLUMN</a>, &amp;valeur,
<a name="l01117"></a>01117                         -1 );
<a name="l01118"></a>01118 
<a name="l01119"></a>01119             <span class="keywordflow">if</span> ( valeur == FALSE )
<a name="l01120"></a>01120             {
<a name="l01121"></a>01121                 <span class="keywordflow">return</span> FALSE;
<a name="l01122"></a>01122             }
<a name="l01123"></a>01123         }
<a name="l01124"></a>01124         <span class="keywordflow">while</span> ( gtk_tree_model_iter_next ( GTK_TREE_MODEL ( model ), &amp;fils_iter ) );
<a name="l01125"></a>01125     }
<a name="l01126"></a>01126     <span class="keywordflow">return</span> TRUE;
<a name="l01127"></a>01127 }
<a name="l01128"></a>01128 
<a name="l01129"></a>01129 
<a name="l01136"></a>01136 gboolean bet_historical_set_full_sub_div ( GtkTreeModel *model, GtkTreeIter *parent )
<a name="l01137"></a>01137 {
<a name="l01138"></a>01138     GtkTreeView *tree_view;
<a name="l01139"></a>01139     GtkTreeIter fils_iter;
<a name="l01140"></a>01140     gint edited;
<a name="l01141"></a>01141 
<a name="l01142"></a>01142     <span class="keywordflow">if</span> ( gtk_tree_model_iter_children ( GTK_TREE_MODEL ( model ), &amp;fils_iter, parent ) )
<a name="l01143"></a>01143     {
<a name="l01144"></a>01144         gchar *str_amount;
<a name="l01145"></a>01145         gchar *str_retained;
<a name="l01146"></a>01146         gint account_nb;
<a name="l01147"></a>01147         gint div_number;
<a name="l01148"></a>01148         gint sub_div_nb;
<a name="l01149"></a>01149         <a class="code" href="structgsb__real.html">gsb_real</a> retained;
<a name="l01150"></a>01150 
<a name="l01151"></a>01151         <span class="keywordflow">do</span>
<a name="l01152"></a>01152         {
<a name="l01153"></a>01153             gtk_tree_model_get ( GTK_TREE_MODEL ( model ), &amp;fils_iter,
<a name="l01154"></a>01154                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a9383c850b527e1beb1a23ce870c7bbde">SPP_HISTORICAL_AVERAGE_AMOUNT</a>, &amp;str_amount,
<a name="l01155"></a>01155                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897ab8bc5e130fa8cfb9100d47fda24a5bff">SPP_HISTORICAL_ACCOUNT_NUMBER</a>, &amp;account_nb,
<a name="l01156"></a>01156                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897ac666b9db44d7d9a667f13a3906efef93">SPP_HISTORICAL_DIV_NUMBER</a>, &amp;div_number,
<a name="l01157"></a>01157                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a80af7fc45177c92a3469977cc1e481f8">SPP_HISTORICAL_SUB_DIV_NUMBER</a>, &amp;sub_div_nb,
<a name="l01158"></a>01158                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a5a2e837c9fd864ef47eeb0b61b23bfe7">SPP_HISTORICAL_EDITED_COLUMN</a>, &amp;edited,
<a name="l01159"></a>01159                         -1 );
<a name="l01160"></a>01160 
<a name="l01161"></a>01161             retained = <a class="code" href="gsb__real_8c.html#a894affc3addf4e97be6c64194042209b">gsb_real_import_from_string</a> ( str_amount );
<a name="l01162"></a>01162             <a class="code" href="bet__data_8c.html#a8e4e124545cf8a530c9c3ad879bcf5ea">bet_data_hist_add_div</a> ( account_nb, div_number, sub_div_nb );
<a name="l01163"></a>01163             <a class="code" href="bet__data_8c.html#a3eeebe94c6f939ab1428c4a3860d7884">bet_data_set_div_amount</a> ( account_nb, div_number, sub_div_nb,
<a name="l01164"></a>01164                         <a class="code" href="gsb__real_8c.html#a894affc3addf4e97be6c64194042209b">gsb_real_import_from_string</a> ( str_amount ) );
<a name="l01165"></a>01165             str_retained = <a class="code" href="gsb__real_8c.html#a03f4474a9a4269e384951af9be4acedd">gsb_real_get_string_with_currency</a> ( retained,
<a name="l01166"></a>01166                         <a class="code" href="gsb__data__account_8c.html#a9f8d132b988ca73a7061fca955f6bc2c">gsb_data_account_get_currency</a> ( account_nb ), TRUE );
<a name="l01167"></a>01167             gtk_tree_store_set ( GTK_TREE_STORE ( model ), &amp;fils_iter,
<a name="l01168"></a>01168                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a5d0bcfb3283a599dc1f20ca75cb6faf2">SPP_HISTORICAL_SELECT_COLUMN</a>, TRUE,
<a name="l01169"></a>01169                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a94988d43a9fb250409c6de6324165e5e">SPP_HISTORICAL_RETAINED_COLUMN</a>, str_retained,
<a name="l01170"></a>01170                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a97b1a54b3d43dc7cf517776044d275c9">SPP_HISTORICAL_RETAINED_AMOUNT</a>, str_amount,
<a name="l01171"></a>01171                         -1 );
<a name="l01172"></a>01172             g_free ( str_amount );
<a name="l01173"></a>01173             g_free ( str_retained );
<a name="l01174"></a>01174         }
<a name="l01175"></a>01175         <span class="keywordflow">while</span> ( gtk_tree_model_iter_next ( GTK_TREE_MODEL ( model ), &amp;fils_iter ) );
<a name="l01176"></a>01176     }
<a name="l01177"></a>01177 
<a name="l01178"></a>01178     <span class="keywordflow">if</span> ( edited )
<a name="l01179"></a>01179     {
<a name="l01180"></a>01180         tree_view = g_object_get_data ( G_OBJECT ( <a class="code" href="bet__config_8c.html#ad5443d986a9ab5d64dd84c5346c4b87c">account_page</a> ),
<a name="l01181"></a>01181                         <span class="stringliteral">&quot;bet_historical_treeview&quot;</span> );
<a name="l01182"></a>01182         gtk_tree_view_collapse_row ( tree_view,
<a name="l01183"></a>01183                         gtk_tree_model_get_path ( model, parent ) );
<a name="l01184"></a>01184         gtk_tree_selection_select_iter ( gtk_tree_view_get_selection (
<a name="l01185"></a>01185                         tree_view ), parent );
<a name="l01186"></a>01186     }
<a name="l01187"></a>01187 
<a name="l01188"></a>01188     <span class="keywordflow">return</span> FALSE;
<a name="l01189"></a>01189 }
<a name="l01190"></a>01190 
<a name="l01191"></a>01191 
<a name="l01198"></a>01198 gboolean bet_historical_set_empty_sub_div ( GtkTreeModel *model, GtkTreeIter *parent )
<a name="l01199"></a>01199 {
<a name="l01200"></a>01200     GtkTreeIter fils_iter;
<a name="l01201"></a>01201 
<a name="l01202"></a>01202     <span class="keywordflow">if</span> ( gtk_tree_model_iter_children ( GTK_TREE_MODEL ( model ), &amp;fils_iter, parent ) )
<a name="l01203"></a>01203     {
<a name="l01204"></a>01204         gchar *str_amount;
<a name="l01205"></a>01205         gint account_nb;
<a name="l01206"></a>01206         gint div_number;
<a name="l01207"></a>01207         gint sub_div_nb;
<a name="l01208"></a>01208 
<a name="l01209"></a>01209         <span class="keywordflow">do</span>
<a name="l01210"></a>01210         {
<a name="l01211"></a>01211             gtk_tree_model_get ( GTK_TREE_MODEL ( model ), &amp;fils_iter,
<a name="l01212"></a>01212                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a9383c850b527e1beb1a23ce870c7bbde">SPP_HISTORICAL_AVERAGE_AMOUNT</a>, &amp;str_amount,
<a name="l01213"></a>01213                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897ab8bc5e130fa8cfb9100d47fda24a5bff">SPP_HISTORICAL_ACCOUNT_NUMBER</a>, &amp;account_nb,
<a name="l01214"></a>01214                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897ac666b9db44d7d9a667f13a3906efef93">SPP_HISTORICAL_DIV_NUMBER</a>, &amp;div_number,
<a name="l01215"></a>01215                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a80af7fc45177c92a3469977cc1e481f8">SPP_HISTORICAL_SUB_DIV_NUMBER</a>, &amp;sub_div_nb,
<a name="l01216"></a>01216                         -1 );
<a name="l01217"></a>01217             <a class="code" href="bet__data_8c.html#a2ad8c256ef5056925b921a71d8645578">bet_data_remove_div_hist</a> ( account_nb, div_number, sub_div_nb );
<a name="l01218"></a>01218             gtk_tree_store_set ( GTK_TREE_STORE ( model ), &amp;fils_iter,
<a name="l01219"></a>01219                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a5d0bcfb3283a599dc1f20ca75cb6faf2">SPP_HISTORICAL_SELECT_COLUMN</a>, FALSE,
<a name="l01220"></a>01220                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a94988d43a9fb250409c6de6324165e5e">SPP_HISTORICAL_RETAINED_COLUMN</a>, <span class="stringliteral">&quot;&quot;</span>,
<a name="l01221"></a>01221                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a97b1a54b3d43dc7cf517776044d275c9">SPP_HISTORICAL_RETAINED_AMOUNT</a>, str_amount,
<a name="l01222"></a>01222                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a5a2e837c9fd864ef47eeb0b61b23bfe7">SPP_HISTORICAL_EDITED_COLUMN</a>, TRUE,
<a name="l01223"></a>01223                         -1 );
<a name="l01224"></a>01224             g_free ( str_amount );
<a name="l01225"></a>01225         }
<a name="l01226"></a>01226         <span class="keywordflow">while</span> ( gtk_tree_model_iter_next ( GTK_TREE_MODEL ( model ), &amp;fils_iter ) );
<a name="l01227"></a>01227     }
<a name="l01228"></a>01228 
<a name="l01229"></a>01229     <span class="keywordflow">return</span> FALSE;
<a name="l01230"></a>01230 }
<a name="l01231"></a>01231 
<a name="l01232"></a>01232 
<a name="l01239"></a>01239 <a class="code" href="structgsb__real.html">gsb_real</a> bet_historical_get_children_amount ( GtkTreeModel *model, GtkTreeIter *parent )
<a name="l01240"></a>01240 {
<a name="l01241"></a>01241     GtkTreeIter fils_iter;
<a name="l01242"></a>01242     gchar *str_amount;
<a name="l01243"></a>01243     <a class="code" href="structgsb__real.html">gsb_real</a> amount = null_real;
<a name="l01244"></a>01244 
<a name="l01245"></a>01245     <span class="keywordflow">if</span> ( gtk_tree_model_iter_children ( GTK_TREE_MODEL ( model ), &amp;fils_iter, parent ) )
<a name="l01246"></a>01246     {
<a name="l01247"></a>01247         <span class="keywordflow">do</span>
<a name="l01248"></a>01248         {
<a name="l01249"></a>01249             gtk_tree_model_get ( GTK_TREE_MODEL ( model ), &amp;fils_iter,
<a name="l01250"></a>01250                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a97b1a54b3d43dc7cf517776044d275c9">SPP_HISTORICAL_RETAINED_AMOUNT</a>, &amp;str_amount,
<a name="l01251"></a>01251                         -1 );
<a name="l01252"></a>01252             amount = <a class="code" href="gsb__real_8c.html#a5a3e9b2189f43f10c28333b09179e335">gsb_real_add</a> ( amount,
<a name="l01253"></a>01253                                 <a class="code" href="gsb__real_8c.html#ada8e5c9cbdb5ccab2c0bbc6e52b04efe">gsb_real_get_from_string</a> ( str_amount ) );
<a name="l01254"></a>01254         }
<a name="l01255"></a>01255         <span class="keywordflow">while</span> ( gtk_tree_model_iter_next ( GTK_TREE_MODEL ( model ), &amp;fils_iter ) );
<a name="l01256"></a>01256     }
<a name="l01257"></a>01257 
<a name="l01258"></a>01258     <span class="keywordflow">return</span> amount;
<a name="l01259"></a>01259 }
<a name="l01260"></a>01260 
<a name="l01261"></a>01261 
<a name="l01268"></a>01268 <span class="keywordtype">void</span> bet_historical_row_expanded_event ( GtkTreeView *tree_view,
<a name="l01269"></a>01269                         GtkTreeIter *iter,
<a name="l01270"></a>01270                         GtkTreePath *path,
<a name="l01271"></a>01271                         GtkTreeModel *model )
<a name="l01272"></a>01272 {
<a name="l01273"></a>01273     gint account_nb;
<a name="l01274"></a>01274     gint div_number;
<a name="l01275"></a>01275 
<a name="l01276"></a>01276     gtk_tree_model_get ( GTK_TREE_MODEL ( model ), iter,
<a name="l01277"></a>01277                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897ab8bc5e130fa8cfb9100d47fda24a5bff">SPP_HISTORICAL_ACCOUNT_NUMBER</a>, &amp;account_nb,
<a name="l01278"></a>01278                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897ac666b9db44d7d9a667f13a3906efef93">SPP_HISTORICAL_DIV_NUMBER</a>, &amp;div_number,
<a name="l01279"></a>01279                         -1 );
<a name="l01280"></a>01280 
<a name="l01281"></a>01281     <span class="keywordflow">if</span> ( <a class="code" href="bet__data_8c.html#a404cd035dc7d1d50729066aa299fe43b">bet_data_get_div_edited</a> ( account_nb, div_number, 0 ) == TRUE )
<a name="l01282"></a>01282     {
<a name="l01283"></a>01283         gtk_tree_view_collapse_row ( tree_view, path );
<a name="l01284"></a>01284         gtk_tree_selection_select_iter ( gtk_tree_view_get_selection ( tree_view ), iter );
<a name="l01285"></a>01285     }
<a name="l01286"></a>01286     bet_historical_set_background_color ( GTK_WIDGET ( tree_view ) );
<a name="l01287"></a>01287 }
<a name="l01288"></a>01288 
<a name="l01289"></a>01289 
<a name="l01296"></a>01296 gboolean bet_historical_amount_differ_average ( GtkTreeModel *model,
<a name="l01297"></a>01297                         GtkTreeIter *iter )
<a name="l01298"></a>01298 {
<a name="l01299"></a>01299     gchar *str_average;
<a name="l01300"></a>01300     gchar *str_amount;
<a name="l01301"></a>01301     
<a name="l01302"></a>01302     gtk_tree_model_get ( GTK_TREE_MODEL ( model ), iter,
<a name="l01303"></a>01303                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a9383c850b527e1beb1a23ce870c7bbde">SPP_HISTORICAL_AVERAGE_AMOUNT</a>, &amp;str_average,
<a name="l01304"></a>01304                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a97b1a54b3d43dc7cf517776044d275c9">SPP_HISTORICAL_RETAINED_AMOUNT</a>, &amp;str_amount,
<a name="l01305"></a>01305                         -1 );
<a name="l01306"></a>01306 
<a name="l01307"></a>01307     <span class="keywordflow">return</span> <a class="code" href="gsb__real_8c.html#a9ffa1aad0087896f5a3f1e2320c97db4">gsb_real_cmp</a> ( <a class="code" href="gsb__real_8c.html#ada8e5c9cbdb5ccab2c0bbc6e52b04efe">gsb_real_get_from_string</a> ( str_average ),
<a name="l01308"></a>01308                         <a class="code" href="gsb__real_8c.html#ada8e5c9cbdb5ccab2c0bbc6e52b04efe">gsb_real_get_from_string</a> ( str_amount ) );
<a name="l01309"></a>01309 }
<a name="l01310"></a>01310 
<a name="l01311"></a>01311 
<a name="l01318"></a>01318 <span class="keywordtype">void</span> bet_historical_row_collapse_all ( GtkTreeView *tree_view,
<a name="l01319"></a>01319                         GtkTreeIter *iter,
<a name="l01320"></a>01320                         GtkTreeModel *model )
<a name="l01321"></a>01321 {
<a name="l01322"></a>01322     <span class="keywordflow">if</span> ( tree_view == NULL )
<a name="l01323"></a>01323         tree_view = g_object_get_data ( G_OBJECT ( <a class="code" href="bet__config_8c.html#ad5443d986a9ab5d64dd84c5346c4b87c">account_page</a> ), <span class="stringliteral">&quot;bet_historical_treeview&quot;</span> );
<a name="l01324"></a>01324     gtk_tree_view_collapse_row ( tree_view,
<a name="l01325"></a>01325                 gtk_tree_model_get_path ( model, iter ) );
<a name="l01326"></a>01326     gtk_tree_selection_select_iter ( gtk_tree_view_get_selection (
<a name="l01327"></a>01327                 tree_view ), iter );
<a name="l01328"></a>01328 }
<a name="l01329"></a>01329 
<a name="l01330"></a>01330 
<a name="l01339"></a>01339 gboolean bet_historical_button_press ( GtkWidget *tree_view,
<a name="l01340"></a>01340                         GdkEventButton *ev )
<a name="l01341"></a>01341 {
<a name="l01342"></a>01342         <span class="comment">/* show the popup */</span>
<a name="l01343"></a>01343         <span class="keywordflow">if</span> ( ev -&gt; button == <a class="code" href="mouse_8h.html#aeb17351958162535ab6af2cd6b030955">RIGHT_BUTTON</a> )
<a name="l01344"></a>01344         bet_historical_context_menu ( tree_view );
<a name="l01345"></a>01345 
<a name="l01346"></a>01346     <span class="keywordflow">return</span> FALSE;
<a name="l01347"></a>01347 }
<a name="l01348"></a>01348 
<a name="l01349"></a>01349 
<a name="l01356"></a>01356 <span class="keywordtype">void</span> bet_historical_context_menu ( GtkWidget *tree_view )
<a name="l01357"></a>01357 {
<a name="l01358"></a>01358     GtkWidget *menu, *menu_item;
<a name="l01359"></a>01359     GtkTreeModel *model;
<a name="l01360"></a>01360     GtkTreeSelection *tree_selection;
<a name="l01361"></a>01361     GtkTreeIter iter;
<a name="l01362"></a>01362 
<a name="l01363"></a>01363     tree_selection = gtk_tree_view_get_selection ( GTK_TREE_VIEW ( tree_view ) );
<a name="l01364"></a>01364 
<a name="l01365"></a>01365     <span class="keywordflow">if</span> ( !gtk_tree_selection_get_selected ( GTK_TREE_SELECTION ( tree_selection ),
<a name="l01366"></a>01366      &amp;model, &amp;iter ) )
<a name="l01367"></a>01367         <span class="keywordflow">return</span>;
<a name="l01368"></a>01368 
<a name="l01369"></a>01369     menu = gtk_menu_new ();
<a name="l01370"></a>01370 
<a name="l01371"></a>01371     <span class="comment">/* Add last amount menu */</span>
<a name="l01372"></a>01372     menu_item = gtk_image_menu_item_new_with_label ( _(<span class="stringliteral">&quot;Assign the amount of the last operation&quot;</span>) );
<a name="l01373"></a>01373     gtk_image_menu_item_set_image ( GTK_IMAGE_MENU_ITEM ( menu_item ),
<a name="l01374"></a>01374                         gtk_image_new_from_stock ( GTK_STOCK_ADD,
<a name="l01375"></a>01375                         GTK_ICON_SIZE_MENU ) );
<a name="l01376"></a>01376 
<a name="l01377"></a>01377     g_signal_connect ( G_OBJECT ( menu_item ),
<a name="l01378"></a>01378                         <span class="stringliteral">&quot;activate&quot;</span>,
<a name="l01379"></a>01379                         G_CALLBACK ( bet_historical_add_last_amount ),
<a name="l01380"></a>01380                         tree_selection );
<a name="l01381"></a>01381 
<a name="l01382"></a>01382     <span class="keywordflow">if</span> ( gtk_tree_model_iter_n_children ( model, &amp;iter ) &gt; 0 )
<a name="l01383"></a>01383         gtk_widget_set_sensitive ( menu_item, FALSE );
<a name="l01384"></a>01384     <span class="keywordflow">else</span>
<a name="l01385"></a>01385         gtk_widget_set_sensitive ( menu_item, TRUE );
<a name="l01386"></a>01386 
<a name="l01387"></a>01387     gtk_menu_shell_append ( GTK_MENU_SHELL ( menu ), menu_item );
<a name="l01388"></a>01388 
<a name="l01389"></a>01389     <span class="comment">/* Separator */</span>
<a name="l01390"></a>01390     gtk_menu_shell_append ( GTK_MENU_SHELL ( menu ), gtk_separator_menu_item_new ( ) );
<a name="l01391"></a>01391     gtk_widget_show ( menu_item );
<a name="l01392"></a>01392 
<a name="l01393"></a>01393 
<a name="l01394"></a>01394     <span class="comment">/* Add average amount menu */</span>
<a name="l01395"></a>01395     menu_item = gtk_image_menu_item_new_with_label ( _(<span class="stringliteral">&quot;Copy the average amount&quot;</span>) );
<a name="l01396"></a>01396     gtk_image_menu_item_set_image ( GTK_IMAGE_MENU_ITEM ( menu_item ),
<a name="l01397"></a>01397                         gtk_image_new_from_stock ( GTK_STOCK_COPY,
<a name="l01398"></a>01398                         GTK_ICON_SIZE_MENU ) );
<a name="l01399"></a>01399 
<a name="l01400"></a>01400     g_signal_connect ( G_OBJECT ( menu_item ),
<a name="l01401"></a>01401                         <span class="stringliteral">&quot;activate&quot;</span>,
<a name="l01402"></a>01402                         G_CALLBACK ( bet_historical_add_average_amount ),
<a name="l01403"></a>01403                         tree_selection );
<a name="l01404"></a>01404 
<a name="l01405"></a>01405     gtk_menu_shell_append ( GTK_MENU_SHELL ( menu ), menu_item );
<a name="l01406"></a>01406 
<a name="l01407"></a>01407     <span class="comment">/* Finish all. */</span>
<a name="l01408"></a>01408     gtk_widget_show_all ( menu );
<a name="l01409"></a>01409     gtk_menu_popup ( GTK_MENU( menu ), NULL, NULL, NULL, NULL,
<a name="l01410"></a>01410                         3, gtk_get_current_event_time ( ) );
<a name="l01411"></a>01411 }
<a name="l01412"></a>01412 
<a name="l01413"></a>01413 
<a name="l01421"></a>01421 <span class="keywordtype">void</span> bet_historical_add_last_amount ( GtkWidget *menu_item,
<a name="l01422"></a>01422                         GtkTreeSelection *tree_selection )
<a name="l01423"></a>01423 {
<a name="l01424"></a>01424     GtkTreeModel *model;
<a name="l01425"></a>01425     GtkTreeIter parent;
<a name="l01426"></a>01426     GtkTreeIter iter;
<a name="l01427"></a>01427     gint account_number;
<a name="l01428"></a>01428     gint div_number;
<a name="l01429"></a>01429     gint sub_div_nb;
<a name="l01430"></a>01430     gint currency_number;
<a name="l01431"></a>01431     gchar *tmp_str;
<a name="l01432"></a>01432     gchar *str_amount;
<a name="l01433"></a>01433     <a class="code" href="structgsb__real.html">gsb_real</a> amount;
<a name="l01434"></a>01434 
<a name="l01435"></a>01435     <span class="keywordflow">if</span> ( !gtk_tree_selection_get_selected ( GTK_TREE_SELECTION ( tree_selection ),
<a name="l01436"></a>01436      &amp;model, &amp;iter ) )
<a name="l01437"></a>01437         <span class="keywordflow">return</span>;
<a name="l01438"></a>01438 
<a name="l01439"></a>01439     gtk_tree_model_get ( GTK_TREE_MODEL ( model ), &amp;iter,
<a name="l01440"></a>01440                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897ab8bc5e130fa8cfb9100d47fda24a5bff">SPP_HISTORICAL_ACCOUNT_NUMBER</a>, &amp;account_number,
<a name="l01441"></a>01441                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897ac666b9db44d7d9a667f13a3906efef93">SPP_HISTORICAL_DIV_NUMBER</a>, &amp;div_number,
<a name="l01442"></a>01442                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a80af7fc45177c92a3469977cc1e481f8">SPP_HISTORICAL_SUB_DIV_NUMBER</a>, &amp;sub_div_nb,
<a name="l01443"></a>01443                         -1 );
<a name="l01444"></a>01444 
<a name="l01445"></a>01445     amount = <a class="code" href="gsb__data__transaction_8c.html#a8fe058c05884ab1196d1b8b0286a1db9">gsb_data_transaction_get_last_transaction_with_div_sub_div</a> (
<a name="l01446"></a>01446                         account_number,
<a name="l01447"></a>01447                         div_number,
<a name="l01448"></a>01448                         sub_div_nb,
<a name="l01449"></a>01449                         <a class="code" href="gsb__data__account_8c.html#a2e685b1a8323c9e336d79e0e7f41cf2d">gsb_data_account_get_bet_hist_data</a> ( account_number ) );
<a name="l01450"></a>01450     str_amount = <a class="code" href="gsb__real_8c.html#a50c880e082aa7241dfa50a9bc0a87207">gsb_real_save_real_to_string</a> ( amount, 2 );
<a name="l01451"></a>01451 
<a name="l01452"></a>01452     currency_number = <a class="code" href="gsb__data__account_8c.html#a9f8d132b988ca73a7061fca955f6bc2c">gsb_data_account_get_currency</a> ( account_number );
<a name="l01453"></a>01453     tmp_str = <a class="code" href="gsb__real_8c.html#a03f4474a9a4269e384951af9be4acedd">gsb_real_get_string_with_currency</a> ( amount, currency_number, TRUE );
<a name="l01454"></a>01454     <span class="comment">/* printf (&quot;div = %d sub_div_nb = %d tmp_str = %s\n&quot;, div_number, sub_div_nb, tmp_str); */</span>
<a name="l01455"></a>01455     <span class="keywordflow">if</span> ( <a class="code" href="bet__data_8c.html#aa5a0bad0ab672a04b4dfa18d9816aa20">bet_data_search_div_hist</a> ( account_number, div_number, sub_div_nb ) == FALSE )
<a name="l01456"></a>01456         <a class="code" href="bet__data_8c.html#a8e4e124545cf8a530c9c3ad879bcf5ea">bet_data_hist_add_div</a> ( account_number, div_number, sub_div_nb );
<a name="l01457"></a>01457 
<a name="l01458"></a>01458     <a class="code" href="bet__data_8c.html#ac97294377ef5262c8c3940ecdb8e2443">bet_data_set_div_edited</a>  ( account_number, div_number, sub_div_nb, TRUE );
<a name="l01459"></a>01459     <a class="code" href="bet__data_8c.html#a3eeebe94c6f939ab1428c4a3860d7884">bet_data_set_div_amount</a> ( account_number, div_number, sub_div_nb, amount );
<a name="l01460"></a>01460     gtk_tree_store_set ( GTK_TREE_STORE ( model ), &amp;iter,
<a name="l01461"></a>01461                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a5d0bcfb3283a599dc1f20ca75cb6faf2">SPP_HISTORICAL_SELECT_COLUMN</a>, TRUE,
<a name="l01462"></a>01462                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a94988d43a9fb250409c6de6324165e5e">SPP_HISTORICAL_RETAINED_COLUMN</a>, tmp_str,
<a name="l01463"></a>01463                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a97b1a54b3d43dc7cf517776044d275c9">SPP_HISTORICAL_RETAINED_AMOUNT</a>, str_amount,
<a name="l01464"></a>01464                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897ab8bc5e130fa8cfb9100d47fda24a5bff">SPP_HISTORICAL_ACCOUNT_NUMBER</a>, account_number,
<a name="l01465"></a>01465                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897ac666b9db44d7d9a667f13a3906efef93">SPP_HISTORICAL_DIV_NUMBER</a>, div_number,
<a name="l01466"></a>01466                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a80af7fc45177c92a3469977cc1e481f8">SPP_HISTORICAL_SUB_DIV_NUMBER</a>, sub_div_nb,
<a name="l01467"></a>01467                         -1 );
<a name="l01468"></a>01468 
<a name="l01469"></a>01469     <span class="keywordflow">if</span> ( gtk_tree_model_iter_parent ( GTK_TREE_MODEL ( model ), &amp;parent, &amp;iter ) )
<a name="l01470"></a>01470         gtk_tree_store_set ( GTK_TREE_STORE ( model ),
<a name="l01471"></a>01471                         &amp;parent,
<a name="l01472"></a>01472                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a5a2e837c9fd864ef47eeb0b61b23bfe7">SPP_HISTORICAL_EDITED_COLUMN</a>, FALSE,
<a name="l01473"></a>01473                         -1);
<a name="l01474"></a>01474 
<a name="l01475"></a>01475     <a class="code" href="gsb__data__account_8c.html#aad11cfab16ac44e8de3dd6d792fce4cd">gsb_data_account_set_bet_maj</a> ( account_number, <a class="code" href="structures_8h.html#ab021d1439ce505d767a56f4fc41af400a8c9b47440bdc426dc6e11af2b2856792">BET_MAJ_ESTIMATE</a> );
<a name="l01476"></a>01476 
<a name="l01477"></a>01477     <span class="keywordflow">if</span> ( <a class="code" href="parametres_8c.html#ab2a744f5d2124688473d13979420e911">etat</a>.<a class="code" href="structgsb__etat__t.html#a9d0fa9057da603e64a601d69d7bf2b51">modification_fichier</a> == 0 )
<a name="l01478"></a>01478         <a class="code" href="traitement__variables_8c.html#aa4084b9e508b1d1fea1d09c6b6208021">modification_fichier</a> ( TRUE );
<a name="l01479"></a>01479 }
<a name="l01480"></a>01480 
<a name="l01481"></a>01481 
<a name="l01489"></a>01489 <span class="keywordtype">void</span> bet_historical_add_average_amount ( GtkWidget *menu_item,
<a name="l01490"></a>01490                         GtkTreeSelection *tree_selection )
<a name="l01491"></a>01491 {
<a name="l01492"></a>01492     GtkTreeModel *model;
<a name="l01493"></a>01493     GtkTreeIter iter;
<a name="l01494"></a>01494     gchar *path_string;
<a name="l01495"></a>01495 
<a name="l01496"></a>01496     <span class="keywordflow">if</span> ( !gtk_tree_selection_get_selected ( GTK_TREE_SELECTION ( tree_selection ),
<a name="l01497"></a>01497      &amp;model, &amp;iter ) )
<a name="l01498"></a>01498         <span class="keywordflow">return</span>;
<a name="l01499"></a>01499 
<a name="l01500"></a>01500     path_string = gtk_tree_path_to_string ( gtk_tree_model_get_path ( model, &amp;iter ) );
<a name="l01501"></a>01501     <span class="keywordflow">if</span> ( path_string )
<a name="l01502"></a>01502         bet_historical_div_toggle_clicked ( NULL, path_string, model );
<a name="l01503"></a>01503 }
<a name="l01504"></a>01504 
<a name="l01505"></a>01505 
<a name="l01512"></a>01512 gboolean bet_historical_initializes_account_settings ( gint account_number )
<a name="l01513"></a>01513 {
<a name="l01514"></a>01514     GtkWidget *combo = NULL;
<a name="l01515"></a>01515     gint fyear_number;
<a name="l01516"></a>01516     gpointer pointer;
<a name="l01517"></a>01517 
<a name="l01518"></a>01518     combo = g_object_get_data ( G_OBJECT ( <a class="code" href="bet__config_8c.html#ad5443d986a9ab5d64dd84c5346c4b87c">account_page</a> ), <span class="stringliteral">&quot;bet_hist_fyear_combo&quot;</span> );
<a name="l01519"></a>01519 
<a name="l01520"></a>01520     fyear_number = <a class="code" href="gsb__data__account_8c.html#a3d3888aea106f90fd7715d1ee505a805">gsb_data_account_get_bet_hist_fyear</a> ( account_number );
<a name="l01521"></a>01521 
<a name="l01522"></a>01522     pointer = g_object_get_data ( G_OBJECT ( combo ), <span class="stringliteral">&quot;pointer&quot;</span> );
<a name="l01523"></a>01523     g_signal_handlers_block_by_func ( G_OBJECT ( combo ),
<a name="l01524"></a>01524                         G_CALLBACK ( <a class="code" href="bet__config_8c.html#a2a8189cead3056cb65d7d26433012d14">bet_config_fyear_clicked</a> ),
<a name="l01525"></a>01525                         pointer );
<a name="l01526"></a>01526 
<a name="l01527"></a>01527     <a class="code" href="gsb__fyear_8c.html#a0e0eb0128f2cec486a664a028b70a273">gsb_fyear_select_iter_by_number</a> ( combo,
<a name="l01528"></a>01528                         <a class="code" href="bet__config_8c.html#a3b7bcf1e9b05e7a812d6f4d4bc0627d6">bet_fyear_model</a>,
<a name="l01529"></a>01529                         <a class="code" href="bet__config_8c.html#aecc63d6768ce86bba48badbe50334f1b">bet_fyear_model_filter</a>,
<a name="l01530"></a>01530                         fyear_number );
<a name="l01531"></a>01531 
<a name="l01532"></a>01532     g_signal_handlers_unblock_by_func ( G_OBJECT ( combo ),
<a name="l01533"></a>01533                         G_CALLBACK ( <a class="code" href="bet__config_8c.html#a2a8189cead3056cb65d7d26433012d14">bet_config_fyear_clicked</a> ),
<a name="l01534"></a>01534                         pointer );
<a name="l01535"></a>01535 
<a name="l01536"></a>01536     <span class="keywordflow">return</span> FALSE;
<a name="l01537"></a>01537 }
<a name="l01538"></a>01538 
<a name="l01539"></a>01539 
<a name="l01547"></a>01547 gboolean bet_historical_set_background_color ( GtkWidget *tree_view )
<a name="l01548"></a>01548 {
<a name="l01549"></a>01549     GtkTreeModel *model;
<a name="l01550"></a>01550     GtkTreeIter iter;
<a name="l01551"></a>01551     GtkTreeIter fils_iter;
<a name="l01552"></a>01552 
<a name="l01553"></a>01553     <span class="keywordflow">if</span> ( !tree_view )
<a name="l01554"></a>01554             <span class="keywordflow">return</span> FALSE;
<a name="l01555"></a>01555 
<a name="l01556"></a>01556     model = gtk_tree_view_get_model ( GTK_TREE_VIEW ( tree_view ) );
<a name="l01557"></a>01557 
<a name="l01558"></a>01558     <span class="keywordflow">if</span> ( gtk_tree_model_get_iter_first ( GTK_TREE_MODEL ( model ), &amp;iter ) )
<a name="l01559"></a>01559     {
<a name="l01560"></a>01560         gint current_color = 0;
<a name="l01561"></a>01561 
<a name="l01562"></a>01562         <span class="keywordflow">do</span>
<a name="l01563"></a>01563         {
<a name="l01564"></a>01564             gtk_tree_store_set ( GTK_TREE_STORE ( model ),
<a name="l01565"></a>01565                         &amp;iter,
<a name="l01566"></a>01566                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a428a7138affdd5d06c282366109bacb5">SPP_HISTORICAL_BACKGROUND_COLOR</a>, &amp;<a class="code" href="affichage_8c.html#a58089bf9225ae2e274165369f8bc7a00">couleur_fond</a>[current_color],
<a name="l01567"></a>01567                         -1 );
<a name="l01568"></a>01568             current_color = !current_color;
<a name="l01569"></a>01569 
<a name="l01570"></a>01570             <span class="keywordflow">if</span> ( gtk_tree_model_iter_children ( GTK_TREE_MODEL ( model ), &amp;fils_iter, &amp;iter )
<a name="l01571"></a>01571              &amp;&amp;
<a name="l01572"></a>01572               gtk_tree_view_row_expanded ( GTK_TREE_VIEW ( tree_view ),
<a name="l01573"></a>01573               gtk_tree_model_get_path ( GTK_TREE_MODEL ( model ), &amp;iter ) ) )
<a name="l01574"></a>01574             {
<a name="l01575"></a>01575                 <span class="keywordflow">do</span>
<a name="l01576"></a>01576                 {
<a name="l01577"></a>01577                     gtk_tree_store_set ( GTK_TREE_STORE ( model ),
<a name="l01578"></a>01578                         &amp;fils_iter,
<a name="l01579"></a>01579                         <a class="code" href="bet__hist_8h.html#a92c216be7a6952ea73c1b52b44ad4897a428a7138affdd5d06c282366109bacb5">SPP_HISTORICAL_BACKGROUND_COLOR</a>, &amp;<a class="code" href="affichage_8c.html#a58089bf9225ae2e274165369f8bc7a00">couleur_fond</a>[current_color],
<a name="l01580"></a>01580                         -1 );
<a name="l01581"></a>01581                     current_color = !current_color;
<a name="l01582"></a>01582                 }
<a name="l01583"></a>01583                 <span class="keywordflow">while</span> ( gtk_tree_model_iter_next ( GTK_TREE_MODEL ( model ), &amp;fils_iter ) );
<a name="l01584"></a>01584             }
<a name="l01585"></a>01585         }
<a name="l01586"></a>01586         <span class="keywordflow">while</span> ( gtk_tree_model_iter_next ( GTK_TREE_MODEL ( model ), &amp;iter ) );
<a name="l01587"></a>01587     }
<a name="l01588"></a>01588 
<a name="l01589"></a>01589     <span class="keywordflow">return</span> FALSE;
<a name="l01590"></a>01590 }
<a name="l01591"></a>01591 
<a name="l01592"></a>01592 
<a name="l01599"></a><a class="code" href="bet__hist_8h.html#adf6e0f9c8fad1ccf20cf59f847952694">01599</a> <span class="keywordtype">void</span> <a class="code" href="bet__hist_8c.html#adf6e0f9c8fad1ccf20cf59f847952694">bet_historical_g_signal_block_tree_view</a> ( <span class="keywordtype">void</span> )
<a name="l01600"></a>01600 {
<a name="l01601"></a>01601     GtkTreeView *tree_view;
<a name="l01602"></a>01602     gpointer cell;
<a name="l01603"></a>01603     GtkTreeModel *tree_model;
<a name="l01604"></a>01604 
<a name="l01605"></a>01605     hist_block_signal = TRUE;
<a name="l01606"></a>01606     tree_view = g_object_get_data ( G_OBJECT ( <a class="code" href="bet__config_8c.html#ad5443d986a9ab5d64dd84c5346c4b87c">account_page</a> ), <span class="stringliteral">&quot;hist_tree_view&quot;</span> );
<a name="l01607"></a>01607     tree_model = gtk_tree_view_get_model ( GTK_TREE_VIEW ( tree_view ) );
<a name="l01608"></a>01608 
<a name="l01609"></a>01609     cell = g_object_get_data ( G_OBJECT ( <a class="code" href="bet__config_8c.html#ad5443d986a9ab5d64dd84c5346c4b87c">account_page</a> ), <span class="stringliteral">&quot;toggle_cell&quot;</span> );
<a name="l01610"></a>01610     g_signal_handlers_block_by_func ( cell, bet_historical_div_toggle_clicked, tree_model );
<a name="l01611"></a>01611 
<a name="l01612"></a>01612     cell = g_object_get_data ( G_OBJECT ( <a class="code" href="bet__config_8c.html#ad5443d986a9ab5d64dd84c5346c4b87c">account_page</a> ), <span class="stringliteral">&quot;edited_cell&quot;</span> );
<a name="l01613"></a>01613     g_signal_handlers_block_by_func ( tree_view, bet_historical_button_press, NULL );
<a name="l01614"></a>01614 }
<a name="l01615"></a>01615 
<a name="l01616"></a>01616 
<a name="l01623"></a><a class="code" href="bet__hist_8h.html#abdc34191d350f48a5dfa2aab50e813d5">01623</a> <span class="keywordtype">void</span> <a class="code" href="bet__hist_8c.html#abdc34191d350f48a5dfa2aab50e813d5">bet_historical_g_signal_unblock_tree_view</a> ( <span class="keywordtype">void</span> )
<a name="l01624"></a>01624 {
<a name="l01625"></a>01625     GtkTreeView *tree_view;
<a name="l01626"></a>01626     gpointer cell;
<a name="l01627"></a>01627     GtkTreeModel *tree_model;
<a name="l01628"></a>01628 
<a name="l01629"></a>01629     <span class="keywordflow">if</span> ( hist_block_signal == FALSE )
<a name="l01630"></a>01630         <span class="keywordflow">return</span>;
<a name="l01631"></a>01631 
<a name="l01632"></a>01632     hist_block_signal = FALSE;
<a name="l01633"></a>01633     tree_view = g_object_get_data ( G_OBJECT ( <a class="code" href="bet__config_8c.html#ad5443d986a9ab5d64dd84c5346c4b87c">account_page</a> ), <span class="stringliteral">&quot;hist_tree_view&quot;</span> );
<a name="l01634"></a>01634     tree_model = gtk_tree_view_get_model ( GTK_TREE_VIEW ( tree_view ) );
<a name="l01635"></a>01635     cell = g_object_get_data ( G_OBJECT ( <a class="code" href="bet__config_8c.html#ad5443d986a9ab5d64dd84c5346c4b87c">account_page</a> ), <span class="stringliteral">&quot;toggle_cell&quot;</span> );
<a name="l01636"></a>01636 
<a name="l01637"></a>01637     g_signal_handlers_unblock_by_func ( cell, bet_historical_div_toggle_clicked, tree_model );
<a name="l01638"></a>01638 
<a name="l01639"></a>01639     cell = g_object_get_data ( G_OBJECT ( <a class="code" href="bet__config_8c.html#ad5443d986a9ab5d64dd84c5346c4b87c">account_page</a> ), <span class="stringliteral">&quot;edited_cell&quot;</span> );
<a name="l01640"></a>01640     g_signal_handlers_unblock_by_func ( tree_view, bet_historical_button_press, NULL );
<a name="l01641"></a>01641 }
<a name="l01642"></a>01642 
<a name="l01643"></a>01643 
<a name="l01650"></a><a class="code" href="bet__hist_8h.html#aa39deaae836fcf9b62acc430d95e1479">01650</a> <span class="keywordtype">void</span> <a class="code" href="bet__hist_8c.html#aa39deaae836fcf9b62acc430d95e1479">bet_historical_set_page_title</a> ( gint account_number )
<a name="l01651"></a>01651 {
<a name="l01652"></a>01652     GtkWidget * widget;
<a name="l01653"></a>01653     gchar *title;
<a name="l01654"></a>01654 
<a name="l01655"></a>01655     title = g_strdup_printf (
<a name="l01656"></a>01656                     _(<span class="stringliteral">&quot;Please select the data source for the account: \&quot;%s\&quot;&quot;</span>),
<a name="l01657"></a>01657                     <a class="code" href="gsb__data__account_8c.html#a6b0df19868e38619bff512f2c18ef51e">gsb_data_account_get_name</a> ( account_number ) );
<a name="l01658"></a>01658     widget = GTK_WIDGET ( g_object_get_data ( G_OBJECT ( <a class="code" href="bet__config_8c.html#ad5443d986a9ab5d64dd84c5346c4b87c">account_page</a> ), <span class="stringliteral">&quot;bet_hist_title&quot;</span>) );
<a name="l01659"></a>01659     gtk_label_set_label ( GTK_LABEL ( widget ), title );
<a name="l01660"></a>01660     g_free ( title );
<a name="l01661"></a>01661 }
<a name="l01662"></a>01662 
<a name="l01663"></a>01663 
<a name="l01671"></a>01671 <span class="comment">/* Local Variables: */</span>
<a name="l01672"></a>01672 <span class="comment">/* c-basic-offset: 4 */</span>
<a name="l01673"></a>01673 <span class="comment">/* End: */</span>
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Généré le Sat Aug 7 22:12:00 2010 pour Grisbi par&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
