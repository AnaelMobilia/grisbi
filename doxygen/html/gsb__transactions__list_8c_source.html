<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Grisbi:  Fichier source de gsb_transactions_list.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Généré par Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Page&nbsp;principale</span></a></li>
      <li><a href="pages.html"><span>Pages&nbsp;associées</span></a></li>
      <li><a href="annotated.html"><span>Structures&nbsp;de&nbsp;données</span></a></li>
      <li class="current"><a href="files.html"><span>Fichiers</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>Liste&nbsp;des&nbsp;fichiers</span></a></li>
      <li><a href="globals.html"><span>Portée&nbsp;globale</span></a></li>
    </ul>
  </div>
<h1>gsb_transactions_list.c</h1><a href="gsb__transactions__list_8c.html">Aller à la documentation de ce fichier.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* ************************************************************************** */</span>
<a name="l00002"></a>00002 <span class="comment">/*                                                                            */</span>
<a name="l00003"></a>00003 <span class="comment">/*     copyright (c)    2000-2008 Cédric Auger (cedric@grisbi.org)            */</span>
<a name="l00004"></a>00004 <span class="comment">/*          2004-2009 Benjamin Drieu (bdrieu@april.org)                       */</span>
<a name="l00005"></a>00005 <span class="comment">/*                      2008-2009 Pierre Biava (grisbi@pierre.biava.name)     */</span>
<a name="l00006"></a>00006 <span class="comment">/*          http://www.grisbi.org                                             */</span>
<a name="l00007"></a>00007 <span class="comment">/*                                                                            */</span>
<a name="l00008"></a>00008 <span class="comment">/*  This program is free software; you can redistribute it and/or modify      */</span>
<a name="l00009"></a>00009 <span class="comment">/*  it under the terms of the GNU General Public License as published by      */</span>
<a name="l00010"></a>00010 <span class="comment">/*  the Free Software Foundation; either version 2 of the License, or         */</span>
<a name="l00011"></a>00011 <span class="comment">/*  (at your option) any later version.                                       */</span>
<a name="l00012"></a>00012 <span class="comment">/*                                                                            */</span>
<a name="l00013"></a>00013 <span class="comment">/*  This program is distributed in the hope that it will be useful,           */</span>
<a name="l00014"></a>00014 <span class="comment">/*  but WITHOUT ANY WARRANTY; without even the implied warranty of            */</span>
<a name="l00015"></a>00015 <span class="comment">/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the             */</span>
<a name="l00016"></a>00016 <span class="comment">/*  GNU General Public License for more details.                              */</span>
<a name="l00017"></a>00017 <span class="comment">/*                                                                            */</span>
<a name="l00018"></a>00018 <span class="comment">/*  You should have received a copy of the GNU General Public License         */</span>
<a name="l00019"></a>00019 <span class="comment">/*  along with this program; if not, write to the Free Software               */</span>
<a name="l00020"></a>00020 <span class="comment">/*  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA */</span>
<a name="l00021"></a>00021 <span class="comment">/*                                                                            */</span>
<a name="l00022"></a>00022 <span class="comment">/* ************************************************************************** */</span>
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;<a class="code" href="include_8h.html">include.h</a>&quot;</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="comment">/*START_INCLUDE*/</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &quot;<a class="code" href="gsb__transactions__list_8h.html">gsb_transactions_list.h</a>&quot;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;<a class="code" href="accueil_8h.html">accueil.h</a>&quot;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;<a class="code" href="bet__data_8h.html">bet_data.h</a>&quot;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="utils__operations_8h.html">utils_operations.h</a>&quot;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;<a class="code" href="dialog_8h.html">dialog.h</a>&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="affichage__liste_8h.html">affichage_liste.h</a>&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="gsb__account_8h.html">gsb_account.h</a>&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="gsb__data__account_8h.html">gsb_data_account.h</a>&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="gsb__data__archive_8h.html">gsb_data_archive.h</a>&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="gsb__data__archive__store_8h.html">gsb_data_archive_store.h</a>&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="gsb__data__budget_8h.html">gsb_data_budget.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="gsb__data__category_8h.html">gsb_data_category.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="gsb__data__currency_8h.html">gsb_data_currency.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="gsb__data__fyear_8h.html">gsb_data_fyear.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="gsb__data__payee_8h.html">gsb_data_payee.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="gsb__data__payment_8h.html">gsb_data_payment.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="gsb__data__reconcile_8h.html">gsb_data_reconcile.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="gsb__data__scheduled_8h.html">gsb_data_scheduled.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="gsb__data__transaction_8h.html">gsb_data_transaction.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="gsb__form_8h.html">gsb_form.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="gsb__form__transaction_8h.html">gsb_form_transaction.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="utils__dates_8h.html">utils_dates.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="navigation_8h.html">navigation.h</a>&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="barre__outils_8h.html">barre_outils.h</a>&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="menu_8h.html">menu.h</a>&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="gsb__real_8h.html">gsb_real.h</a>&quot;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="gsb__reconcile_8h.html">gsb_reconcile.h</a>&quot;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="gsb__scheduler__list_8h.html">gsb_scheduler_list.h</a>&quot;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="main_8h.html">main.h</a>&quot;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="traitement__variables_8h.html">traitement_variables.h</a>&quot;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;<a class="code" href="utils__str_8h.html">utils_str.h</a>&quot;</span>
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;<a class="code" href="transaction__list_8h.html">transaction_list.h</a>&quot;</span>
<a name="l00059"></a>00059 <span class="preprocessor">#include &quot;<a class="code" href="transaction__list__select_8h.html">transaction_list_select.h</a>&quot;</span>
<a name="l00060"></a>00060 <span class="preprocessor">#include &quot;<a class="code" href="transaction__list__sort_8h.html">transaction_list_sort.h</a>&quot;</span>
<a name="l00061"></a>00061 <span class="preprocessor">#include &quot;<a class="code" href="transaction__model_8h.html">transaction_model.h</a>&quot;</span>
<a name="l00062"></a>00062 <span class="preprocessor">#include &quot;<a class="code" href="structures_8h.html">structures.h</a>&quot;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#include &quot;<a class="code" href="custom__list_8h.html">custom_list.h</a>&quot;</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &quot;<a class="code" href="fenetre__principale_8h.html">fenetre_principale.h</a>&quot;</span>
<a name="l00065"></a>00065 <span class="preprocessor">#include &quot;<a class="code" href="include_8h.html">include.h</a>&quot;</span>
<a name="l00066"></a>00066 <span class="preprocessor">#include &quot;<a class="code" href="gsb__data__transaction_8h.html">gsb_data_transaction.h</a>&quot;</span>
<a name="l00067"></a>00067 <span class="preprocessor">#include &quot;<a class="code" href="mouse_8h.html">mouse.h</a>&quot;</span>
<a name="l00068"></a>00068 <span class="preprocessor">#include &quot;<a class="code" href="dialog_8h.html">dialog.h</a>&quot;</span>
<a name="l00069"></a>00069 <span class="preprocessor">#include &quot;<a class="code" href="erreur_8h.html">erreur.h</a>&quot;</span>
<a name="l00070"></a>00070 <span class="comment">/*END_INCLUDE*/</span>
<a name="l00071"></a>00071 
<a name="l00072"></a>00072 <span class="comment">/*START_STATIC*/</span>
<a name="l00073"></a>00073 <span class="keyword">static</span> gboolean assert_selected_transaction ();
<a name="l00074"></a>00074 <span class="keyword">static</span> gboolean gsb_gui_change_cell_content ( GtkWidget * item, gint *element_ptr );
<a name="l00075"></a>00075 <span class="keyword">static</span> GtkWidget *gsb_gui_create_cell_contents_menu ( <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y );
<a name="l00076"></a>00076 <span class="keyword">static</span> gboolean gsb_transactions_list_button_press ( GtkWidget *tree_view,
<a name="l00077"></a>00077                         GdkEventButton *ev,
<a name="l00078"></a>00078                         gpointer null );
<a name="l00079"></a>00079 <span class="keyword">static</span> gboolean gsb_transactions_list_change_sort_column ( GtkTreeViewColumn *tree_view_column,
<a name="l00080"></a>00080                         gint *column_ptr );
<a name="l00081"></a>00081 <span class="keyword">static</span> gboolean gsb_transactions_list_change_sort_type ( GtkWidget *menu_item,
<a name="l00082"></a>00082                         gint *no_column );
<a name="l00083"></a>00083 <span class="keyword">static</span> gboolean gsb_transactions_list_check_mark ( gint transaction_number );
<a name="l00084"></a>00084 <span class="keyword">static</span> gint gsb_transactions_list_choose_reconcile ( gint account_number,
<a name="l00085"></a>00085                         gint selected_reconcile_number );
<a name="l00086"></a>00086 <span class="keyword">static</span> gboolean gsb_transactions_list_clone_template ( GtkWidget *menu_item,
<a name="l00087"></a>00087                         gpointer null );
<a name="l00088"></a>00088 <span class="keyword">static</span> gint gsb_transactions_list_clone_transaction ( gint transaction_number,
<a name="l00089"></a>00089                         gint mother_transaction_number );
<a name="l00090"></a>00090 <span class="keyword">static</span> GtkWidget *gsb_transactions_list_create_tree_view ( GtkTreeModel *model );
<a name="l00091"></a>00091 <span class="keyword">static</span> <span class="keywordtype">void</span> gsb_transactions_list_create_tree_view_columns ( <span class="keywordtype">void</span> );
<a name="l00092"></a>00092 <span class="keyword">static</span> gboolean gsb_transactions_list_fill_model ( <span class="keywordtype">void</span> );
<a name="l00093"></a>00093 <span class="keyword">static</span> gboolean gsb_transactions_list_key_press ( GtkWidget *widget,
<a name="l00094"></a>00094                         GdkEventKey *ev );
<a name="l00095"></a>00095 <span class="keyword">static</span> gboolean gsb_transactions_list_move_transaction_to_account ( gint transaction_number,
<a name="l00096"></a>00096                         gint target_account );
<a name="l00097"></a>00097 <span class="keyword">static</span> <span class="keywordtype">void</span> gsb_transactions_list_set_tree_view (GtkWidget *tree_view);
<a name="l00098"></a>00098 <span class="keyword">static</span> gboolean gsb_transactions_list_size_allocate ( GtkWidget *tree_view,
<a name="l00099"></a>00099                         GtkAllocation *allocation,
<a name="l00100"></a>00100                         gpointer null );
<a name="l00101"></a>00101 <span class="keyword">static</span> gboolean gsb_transactions_list_switch_R_mark ( gint transaction_number );
<a name="l00102"></a>00102 <span class="keyword">static</span> gboolean gsb_transactions_list_switch_mark ( gint transaction_number );
<a name="l00103"></a>00103 <span class="keyword">static</span> gboolean gsb_transactions_list_title_column_button_press ( GtkWidget *button,
<a name="l00104"></a>00104                         GdkEventButton *ev,
<a name="l00105"></a>00105                         gint *no_column );
<a name="l00106"></a>00106 <span class="keyword">static</span> gboolean move_selected_operation_to_account ( GtkMenuItem * menu_item,
<a name="l00107"></a>00107                         gpointer null );
<a name="l00108"></a>00108 <span class="keyword">static</span> <span class="keywordtype">void</span> popup_transaction_context_menu ( gboolean full, <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y );
<a name="l00109"></a>00109 <span class="keyword">static</span> gint schedule_transaction ( gint transaction_number );
<a name="l00110"></a>00110 <span class="keyword">static</span> <span class="keywordtype">void</span> update_titres_tree_view ( <span class="keywordtype">void</span> );
<a name="l00111"></a>00111 <span class="comment">/*END_STATIC*/</span>
<a name="l00112"></a>00112 
<a name="l00113"></a>00113 
<a name="l00114"></a>00114 <span class="comment">/*  adr du notebook qui contient les opés de chaque compte */</span>
<a name="l00115"></a><a class="code" href="gsb__transactions__list_8c.html#a852ebb7e2039cea38cf82e9d7b876d7c">00115</a> GtkWidget *<a class="code" href="gsb__file_8c.html#a852ebb7e2039cea38cf82e9d7b876d7c">tree_view_vbox</a> = NULL;
<a name="l00116"></a>00116 
<a name="l00117"></a>00117 <span class="comment">/* the columns of the tree_view */</span>
<a name="l00118"></a><a class="code" href="transaction__list__sort_8c.html#a4f11139c6cd90bf0cd17d761652b069b">00118</a> GtkTreeViewColumn *<a class="code" href="gsb__transactions__list_8c.html#a4f11139c6cd90bf0cd17d761652b069b">transactions_tree_view_columns</a>[<a class="code" href="custom__list_8h.html#a5120df6c303afc3c01e77218f39b80b5">CUSTOM_MODEL_N_VISIBLES_COLUMN</a>];
<a name="l00119"></a>00119 
<a name="l00120"></a>00120 <span class="comment">/* the initial width of each column */</span>
<a name="l00121"></a><a class="code" href="traitement__variables_8c.html#a6e5e85a5f63608656ce9709950bb08e6">00121</a> gint <a class="code" href="gsb__file__load_8c.html#a6e5e85a5f63608656ce9709950bb08e6">transaction_col_width</a>[<a class="code" href="custom__list_8h.html#a5120df6c303afc3c01e77218f39b80b5">CUSTOM_MODEL_N_VISIBLES_COLUMN</a>];
<a name="l00122"></a>00122 
<a name="l00123"></a>00123 <span class="comment">/* adr de la barre d&#39;outils */</span>
<a name="l00124"></a><a class="code" href="gsb__transactions__list_8c.html#a268b1e31b413c512d03776ae10b8f785">00124</a> GtkWidget *<a class="code" href="barre__outils_8c.html#a268b1e31b413c512d03776ae10b8f785">barre_outils</a>;
<a name="l00125"></a>00125 
<a name="l00126"></a>00126 <span class="comment">/* contient les tips et titres des colonnes des listes d&#39;opé */</span>
<a name="l00127"></a><a class="code" href="gsb__transactions__list_8c.html#a7d49023563c9144cf16b6b4c2b65ce05">00127</a> gchar *<a class="code" href="affichage__liste_8c.html#a7d49023563c9144cf16b6b4c2b65ce05">tips_col_liste_operations</a>[<a class="code" href="custom__list_8h.html#a5120df6c303afc3c01e77218f39b80b5">CUSTOM_MODEL_N_VISIBLES_COLUMN</a>];
<a name="l00128"></a><a class="code" href="gsb__transactions__list_8c.html#abe5a25ede887e60c7f679c9ff03607f0">00128</a> gchar *<a class="code" href="affichage__liste_8c.html#abe5a25ede887e60c7f679c9ff03607f0">titres_colonnes_liste_operations</a>[<a class="code" href="custom__list_8h.html#a5120df6c303afc3c01e77218f39b80b5">CUSTOM_MODEL_N_VISIBLES_COLUMN</a>];
<a name="l00129"></a>00129 
<a name="l00130"></a>00130 <span class="comment">/*  pointeur vers le label qui contient le solde sous la liste des opé */</span>
<a name="l00131"></a><a class="code" href="traitement__variables_8c.html#a13463693429f5d9aeefc559d1a72ab84">00131</a> GtkWidget *<a class="code" href="gsb__transactions__list_8c.html#a13463693429f5d9aeefc559d1a72ab84">solde_label</a> = NULL;
<a name="l00132"></a>00132 
<a name="l00133"></a><a class="code" href="traitement__variables_8c.html#a1a07890c391001f8dbed340113145fab">00133</a> GtkWidget *<a class="code" href="gsb__transactions__list_8c.html#a1a07890c391001f8dbed340113145fab">solde_label_pointe</a> = NULL;
<a name="l00134"></a>00134 
<a name="l00135"></a>00135 <span class="keyword">static</span> GtkWidget *transactions_tree_view = NULL;
<a name="l00136"></a>00136 
<a name="l00137"></a><a class="code" href="traitement__variables_8c.html#a265408c8482c4045a6e5e022d89696ba">00137</a> gint <a class="code" href="gsb__transactions__list_8c.html#a265408c8482c4045a6e5e022d89696ba">current_tree_view_width</a> = 0;
<a name="l00138"></a>00138 
<a name="l00141"></a><a class="code" href="transaction__list_8c.html#ac2f7ca891d6c3a7cfb5c8df02918cf7c">00141</a> GSList *<a class="code" href="gsb__transactions__list_8c.html#ac2f7ca891d6c3a7cfb5c8df02918cf7c">orphan_child_transactions</a> = NULL;
<a name="l00142"></a>00142 
<a name="l00143"></a>00143 <span class="comment">/* names of the cells */</span>
<a name="l00144"></a><a class="code" href="gsb__transactions__list_8c.html#aa9959039948028badde16d39e1a74c43">00144</a> gchar *<a class="code" href="gsb__transactions__list_8c.html#aa9959039948028badde16d39e1a74c43">cell_views</a>[] = {
<a name="l00145"></a>00145     N_(<span class="stringliteral">&quot;Date&quot;</span>),
<a name="l00146"></a>00146     N_(<span class="stringliteral">&quot;Value date&quot;</span>),
<a name="l00147"></a>00147     N_(<span class="stringliteral">&quot;Payee&quot;</span>),
<a name="l00148"></a>00148     N_(<span class="stringliteral">&quot;Budgetary line&quot;</span>),
<a name="l00149"></a>00149     N_(<span class="stringliteral">&quot;Debit&quot;</span>),
<a name="l00150"></a>00150     N_(<span class="stringliteral">&quot;Credit&quot;</span>),
<a name="l00151"></a>00151     N_(<span class="stringliteral">&quot;Balance&quot;</span>),
<a name="l00152"></a>00152     N_(<span class="stringliteral">&quot;Amount&quot;</span>),
<a name="l00153"></a>00153     N_(<span class="stringliteral">&quot;Method of payment&quot;</span>),
<a name="l00154"></a>00154     N_(<span class="stringliteral">&quot;Reconciliation reference&quot;</span>),
<a name="l00155"></a>00155     N_(<span class="stringliteral">&quot;Financial year&quot;</span>),
<a name="l00156"></a>00156     N_(<span class="stringliteral">&quot;Category&quot;</span>),
<a name="l00157"></a>00157     N_(<span class="stringliteral">&quot;C/R&quot;</span>),
<a name="l00158"></a>00158     N_(<span class="stringliteral">&quot;Voucher&quot;</span>),
<a name="l00159"></a>00159     N_(<span class="stringliteral">&quot;Notes&quot;</span>),
<a name="l00160"></a>00160     N_(<span class="stringliteral">&quot;Bank references&quot;</span>),
<a name="l00161"></a>00161     N_(<span class="stringliteral">&quot;Transaction number&quot;</span>),
<a name="l00162"></a>00162     N_(<span class="stringliteral">&quot;Cheque number&quot;</span>),
<a name="l00163"></a>00163     NULL };
<a name="l00164"></a>00164 
<a name="l00165"></a>00165 
<a name="l00166"></a>00166 <span class="comment">/*START_EXTERN*/</span>
<a name="l00167"></a>00167 <span class="keyword">extern</span> GSList *<a class="code" href="affichage__liste_8c.html#a53693b9d5a4ba330fa5650e09ef0519f">liste_labels_titres_colonnes_liste_ope</a>;
<a name="l00168"></a>00168 <span class="keyword">extern</span> <span class="keyword">struct </span><a class="code" href="structconditional__message.html">conditional_message</a> <a class="code" href="dialog_8c.html#a430b9f94c0af809780196ca7d7040fde">messages</a>[];
<a name="l00169"></a>00169 <span class="keyword">extern</span> gint <a class="code" href="accueil_8c.html#a9ebd251de44611d97ec364d1867a75ff">mise_a_jour_fin_comptes_passifs</a>;
<a name="l00170"></a>00170 <span class="keyword">extern</span> gint <a class="code" href="accueil_8c.html#a018917e8dacfd8fbe4e94d0f99a59c08">mise_a_jour_liste_comptes_accueil</a>;
<a name="l00171"></a>00171 <span class="keyword">extern</span> gint <a class="code" href="accueil_8c.html#a097d2eb216e05a68a5a153e7b68b6469">mise_a_jour_liste_echeances_auto_accueil</a>;
<a name="l00172"></a>00172 <span class="keyword">extern</span> gint <a class="code" href="accueil_8c.html#afaffaedc4fd0ae8638f7158c6777b35b">mise_a_jour_soldes_minimaux</a>;
<a name="l00173"></a>00173 <span class="keyword">extern</span> GtkWidget * <a class="code" href="etats__config_8c.html#a1cd17e8b2fd91a191f8d5d6a7e5f6979">navigation_tree_view</a>;
<a name="l00174"></a>00174 <span class="keyword">extern</span> GtkWidget *<a class="code" href="bet__config_8c.html#a8924516aa4170f932308e93cf93a785b">notebook_general</a>;
<a name="l00175"></a>00175 <span class="keyword">extern</span> GtkWidget *<a class="code" href="gsb__reconcile_8c.html#a3cc34f74c4d6dae91c269439b2ea894c">reconcile_sort_list_button</a>;
<a name="l00176"></a>00176 <span class="keyword">extern</span> gint <a class="code" href="affichage__liste_8c.html#a0c444565adac369ff42631d4b7b7e6bb">tab_affichage_ope</a>[<a class="code" href="custom__list_8h.html#a738de041650943c6854c2fa523b2e2e5">TRANSACTION_LIST_ROWS_NB</a>][<a class="code" href="custom__list_8h.html#a94bc00a237b4803e1096242436b77bcf">CUSTOM_MODEL_VISIBLE_COLUMNS</a>];
<a name="l00177"></a>00177 <span class="keyword">extern</span> GtkWidget *<a class="code" href="accueil_8c.html#a3d346c08cf2d67c388caabffb412b293">window</a>;
<a name="l00178"></a>00178 <span class="comment">/*END_EXTERN*/</span>
<a name="l00179"></a>00179 
<a name="l00180"></a>00180 
<a name="l00182"></a><a class="code" href="parametres_8c.html#a8be9044200783277533661fc770e77f5">00182</a> <span class="keyword">struct </span><a class="code" href="structconditional__message.html">conditional_message</a> <a class="code" href="gsb__file__config_8c.html#a8be9044200783277533661fc770e77f5">delete_msg</a>[] =
<a name="l00183"></a>00183 {
<a name="l00184"></a>00184     { <span class="stringliteral">&quot;delete-child-transaction&quot;</span>, N_(<span class="stringliteral">&quot;Delete a child transaction.&quot;</span>),
<a name="l00185"></a>00185       NULL, 
<a name="l00186"></a>00186       FALSE, FALSE, },
<a name="l00187"></a>00187 
<a name="l00188"></a>00188     { <span class="stringliteral">&quot;delete-transaction&quot;</span>,  N_(<span class="stringliteral">&quot;Delete a transaction.&quot;</span>),
<a name="l00189"></a>00189       NULL,
<a name="l00190"></a>00190       FALSE, FALSE, },
<a name="l00191"></a>00191 
<a name="l00192"></a>00192     { <span class="stringliteral">&quot;delete-child-scheduled&quot;</span>, N_(<span class="stringliteral">&quot;Delete a child of scheduled transaction.&quot;</span>),
<a name="l00193"></a>00193       NULL,
<a name="l00194"></a>00194       FALSE, FALSE, },
<a name="l00195"></a>00195 
<a name="l00196"></a>00196     { <span class="stringliteral">&quot;delete-scheduled&quot;</span>, N_(<span class="stringliteral">&quot;Delete a scheduled transaction.&quot;</span>),
<a name="l00197"></a>00197       NULL,
<a name="l00198"></a>00198       FALSE, FALSE, },
<a name="l00199"></a>00199 
<a name="l00200"></a>00200     { <span class="stringliteral">&quot;delete-scheduled-occurences&quot;</span>, N_(<span class="stringliteral">&quot;Delete one or all occurences of scheduled &quot;</span>
<a name="l00201"></a>00201       <span class="stringliteral">&quot;transaction.&quot;</span>),
<a name="l00202"></a>00202       NULL,
<a name="l00203"></a>00203       FALSE, FALSE, },
<a name="l00204"></a>00204 
<a name="l00205"></a>00205 <span class="comment">/*</span>
<a name="l00206"></a>00206 <span class="comment">    { &quot;&quot;, N_(),</span>
<a name="l00207"></a>00207 <span class="comment">      N_(), </span>
<a name="l00208"></a>00208 <span class="comment">      FALSE, FALSE, },</span>
<a name="l00209"></a>00209 <span class="comment">*/</span>
<a name="l00210"></a>00210     { NULL },
<a name="l00211"></a>00211 };
<a name="l00212"></a>00212 
<a name="l00213"></a>00213 
<a name="l00221"></a>00221 <span class="keywordtype">void</span> gsb_transactions_list_set_tree_view (GtkWidget *tree_view)
<a name="l00222"></a>00222 {
<a name="l00223"></a>00223     transactions_tree_view = tree_view;
<a name="l00224"></a>00224 }
<a name="l00225"></a>00225 
<a name="l00233"></a><a class="code" href="gsb__transactions__list_8h.html#a9c93505713234d8fa4727b067a140641">00233</a> GtkWidget *<a class="code" href="gsb__transactions__list_8c.html#a9c93505713234d8fa4727b067a140641">gsb_transactions_list_get_tree_view</a> (<span class="keywordtype">void</span>)
<a name="l00234"></a>00234 {
<a name="l00235"></a>00235     <span class="keywordflow">return</span> (transactions_tree_view);
<a name="l00236"></a>00236 }
<a name="l00237"></a>00237 
<a name="l00238"></a>00238 
<a name="l00254"></a><a class="code" href="gsb__transactions__list_8h.html#ab7d08f59bcf7149edda9db47e67333a4">00254</a> <span class="keywordtype">void</span> <a class="code" href="gsb__transactions__list_8c.html#ab7d08f59bcf7149edda9db47e67333a4">gsb_transactions_list_update_tree_view</a> ( gint account_number,
<a name="l00255"></a>00255                         gboolean keep_selected_transaction )
<a name="l00256"></a>00256 {
<a name="l00257"></a>00257     gint selected_transaction = 0;
<a name="l00258"></a>00258 
<a name="l00259"></a>00259     <span class="comment">/* called sometimes with gsb_gui_navigation_get_current_account, so check we are </span>
<a name="l00260"></a>00260 <span class="comment">     * on an account */</span>
<a name="l00261"></a>00261     <span class="keywordflow">if</span> ( account_number == -1 )
<a name="l00262"></a>00262         <span class="keywordflow">return</span>;
<a name="l00263"></a>00263 
<a name="l00264"></a>00264     <span class="keywordflow">if</span> ( keep_selected_transaction )
<a name="l00265"></a>00265         selected_transaction = <a class="code" href="transaction__list__select_8c.html#a0a2effd6ee01ec6f9b848593b797398a">transaction_list_select_get</a> ( );
<a name="l00266"></a>00266     <a class="code" href="transaction__list_8c.html#aaa7ed8c4599c862c1ec1332b2ec80c2f">transaction_list_filter</a> ( account_number );
<a name="l00267"></a>00267     <a class="code" href="transaction__list__sort_8c.html#a4437cb573f9bba01a794b2e2695e58d4">transaction_list_sort</a> ();
<a name="l00268"></a>00268     <a class="code" href="transaction__list_8c.html#a31251e7e47a79c21b63cffdea74a2ee9">transaction_list_colorize</a> ();
<a name="l00269"></a>00269     <span class="keywordflow">if</span> ( <a class="code" href="gsb__file__config_8c.html#ac390e947e97cef2bec2f5d59d6ec1071">conf</a>.<a class="code" href="structgsb__conf__t.html#afe3b36b196c6045e42ce4afdd915d506">show_transaction_gives_balance</a> )
<a name="l00270"></a>00270         <a class="code" href="transaction__list_8c.html#a8e2f2c3981823494ae5f16f0e8db383b">transaction_list_set_color_jour</a> ( account_number );
<a name="l00271"></a>00271     <a class="code" href="transaction__list_8c.html#a59ee075b27fa18fb9691201b52ec6692">transaction_list_set_balances</a> ( );
<a name="l00272"></a>00272     <span class="keywordflow">if</span> ( keep_selected_transaction )
<a name="l00273"></a>00273         <a class="code" href="transaction__list__select_8c.html#a85f38a439156b883335de73220dca237">transaction_list_select</a> ( selected_transaction );
<a name="l00274"></a>00274 }
<a name="l00275"></a>00275 
<a name="l00276"></a>00276 
<a name="l00282"></a><a class="code" href="gsb__transactions__list_8h.html#a750143785ed9e62525a92754c8262f55">00282</a> GtkWidget *<a class="code" href="gsb__transactions__list_8c.html#a750143785ed9e62525a92754c8262f55">creation_fenetre_operations</a> ( <span class="keywordtype">void</span> )
<a name="l00283"></a>00283 {
<a name="l00284"></a>00284     GtkWidget *win_operations;
<a name="l00285"></a>00285 
<a name="l00286"></a>00286     <span class="comment">/*   la fenetre des opé est une vbox : la liste en haut, le solde et  */</span>
<a name="l00287"></a>00287     <span class="comment">/*     des boutons de conf au milieu, le transaction_form en bas */</span>
<a name="l00288"></a>00288     win_operations = gtk_vbox_new ( FALSE, 6 );
<a name="l00289"></a>00289 
<a name="l00290"></a>00290     <span class="comment">/* création de la barre d&#39;outils */</span>
<a name="l00291"></a>00291     <a class="code" href="barre__outils_8c.html#a268b1e31b413c512d03776ae10b8f785">barre_outils</a> = gtk_handle_box_new ();
<a name="l00292"></a>00292     <a class="code" href="barre__outils_8c.html#ac0082a1048984a35739d37d106617dd6">gsb_gui_update_transaction_toolbar</a> ();
<a name="l00293"></a>00293     gtk_box_pack_start ( GTK_BOX ( win_operations ), <a class="code" href="barre__outils_8c.html#a268b1e31b413c512d03776ae10b8f785">barre_outils</a>, FALSE, FALSE, 0);
<a name="l00294"></a>00294 
<a name="l00295"></a>00295     <span class="comment">/* tree_view_vbox will contain the tree_view, we will see later to set it directly */</span>
<a name="l00296"></a>00296     <a class="code" href="gsb__file_8c.html#a852ebb7e2039cea38cf82e9d7b876d7c">tree_view_vbox</a> = gtk_vbox_new ( FALSE, 0 );
<a name="l00297"></a>00297 
<a name="l00298"></a>00298 
<a name="l00299"></a>00299     gtk_box_pack_start ( GTK_BOX ( win_operations ),
<a name="l00300"></a>00300                          <a class="code" href="gsb__file_8c.html#a852ebb7e2039cea38cf82e9d7b876d7c">tree_view_vbox</a>,
<a name="l00301"></a>00301                          TRUE, TRUE, 0);
<a name="l00302"></a>00302 
<a name="l00303"></a>00303     gtk_widget_show_all (win_operations);
<a name="l00304"></a>00304     <span class="keywordflow">return</span> ( win_operations );
<a name="l00305"></a>00305 }
<a name="l00306"></a>00306 
<a name="l00307"></a>00307 
<a name="l00308"></a>00308 
<a name="l00316"></a><a class="code" href="gsb__transactions__list_8h.html#a5a3574009546c888666713aa8269327b">00316</a> GtkWidget *<a class="code" href="gsb__transactions__list_8c.html#a5a3574009546c888666713aa8269327b">gsb_transactions_list_make_gui_list</a> ( <span class="keywordtype">void</span> )
<a name="l00317"></a>00317 {
<a name="l00318"></a>00318     GtkWidget *tree_view;
<a name="l00319"></a>00319     GtkWidget *scrolled_window;
<a name="l00320"></a>00320 
<a name="l00321"></a>00321     <span class="comment">/* we have first to create and fill the model */</span>
<a name="l00322"></a>00322     gsb_transactions_list_fill_model ();
<a name="l00323"></a>00323 
<a name="l00324"></a>00324     <span class="comment">/* we add the tree view in a scrolled window which will be returned */</span>
<a name="l00325"></a>00325     scrolled_window = gtk_scrolled_window_new ( NULL, NULL );
<a name="l00326"></a>00326     gtk_scrolled_window_set_policy ( GTK_SCROLLED_WINDOW ( scrolled_window ),
<a name="l00327"></a>00327                         GTK_POLICY_AUTOMATIC, GTK_POLICY_AUTOMATIC );
<a name="l00328"></a>00328     gtk_scrolled_window_set_shadow_type ( GTK_SCROLLED_WINDOW ( scrolled_window ),
<a name="l00329"></a>00329                         GTK_SHADOW_IN );
<a name="l00330"></a>00330 
<a name="l00331"></a>00331     <span class="comment">/* and now we can create the tree_view */</span>
<a name="l00332"></a>00332     tree_view = gsb_transactions_list_create_tree_view ( GTK_TREE_MODEL (
<a name="l00333"></a>00333                         <a class="code" href="transaction__model_8c.html#a416a1ee9231b6f7d74d3b0811902163a">transaction_model_get_model</a> ()) );
<a name="l00334"></a>00334     gtk_container_add ( GTK_CONTAINER ( scrolled_window ), tree_view );
<a name="l00335"></a>00335 
<a name="l00336"></a>00336     <span class="comment">/* we save the values */</span>
<a name="l00337"></a>00337     gsb_transactions_list_set_tree_view (tree_view);
<a name="l00338"></a>00338 
<a name="l00339"></a>00339     gtk_widget_show_all (scrolled_window);
<a name="l00340"></a>00340     <span class="keywordflow">return</span> scrolled_window;
<a name="l00341"></a>00341 }
<a name="l00342"></a>00342 
<a name="l00343"></a>00343 
<a name="l00344"></a>00344 
<a name="l00345"></a>00345 
<a name="l00349"></a>00349 <span class="keywordtype">void</span> gsb_transactions_list_create_tree_view_columns ( <span class="keywordtype">void</span> )
<a name="l00350"></a>00350 {
<a name="l00351"></a>00351     gint i;
<a name="l00352"></a>00352     gfloat alignment[] = {
<a name="l00353"></a>00353         <a class="code" href="gsb__transactions__list_8h.html#a1acc57689f7f1675288fb8a4b29fb4e7">COLUMN_CENTER</a>, <a class="code" href="gsb__transactions__list_8h.html#a1acc57689f7f1675288fb8a4b29fb4e7">COLUMN_CENTER</a>, <a class="code" href="gsb__transactions__list_8h.html#a6af7ccb9deda7edaeea9ca8bfc7c6b37">COLUMN_LEFT</a>,
<a name="l00354"></a>00354         COLUMN_CENTER, <a class="code" href="gsb__transactions__list_8h.html#a854253903a51c832eec04ab2ac08901b">COLUMN_RIGHT</a>, COLUMN_RIGHT, COLUMN_RIGHT
<a name="l00355"></a>00355     };
<a name="l00356"></a>00356     gint column_balance;
<a name="l00357"></a>00357 
<a name="l00358"></a>00358     <span class="comment">/* get the position of the amount column to set it in red */</span>
<a name="l00359"></a>00359     column_balance = <a class="code" href="gsb__transactions__list_8c.html#a8be7f66c4c8f7c67eb187290c18fb6f7">find_element_col</a> (<a class="code" href="gsb__transactions__list_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57a0f73340eb5af6e8a5454c1aa833339e8">ELEMENT_BALANCE</a>);
<a name="l00360"></a>00360 
<a name="l00361"></a>00361     <span class="comment">/* create the columns */</span>
<a name="l00362"></a>00362     <span class="keywordflow">for</span> ( i = 0 ; i &lt; <a class="code" href="custom__list_8h.html#a5120df6c303afc3c01e77218f39b80b5">CUSTOM_MODEL_N_VISIBLES_COLUMN</a> ; i++ )
<a name="l00363"></a>00363     {
<a name="l00364"></a>00364         GtkCellRenderer *cell_renderer;
<a name="l00365"></a>00365 
<a name="l00366"></a>00366         cell_renderer = gtk_cell_renderer_text_new ();
<a name="l00367"></a>00367         g_object_set ( G_OBJECT ( cell_renderer ),
<a name="l00368"></a>00368                                 <span class="stringliteral">&quot;xalign&quot;</span>, alignment[i],
<a name="l00369"></a>00369                                 NULL );
<a name="l00370"></a>00370         <a class="code" href="gsb__transactions__list_8c.html#a4f11139c6cd90bf0cd17d761652b069b">transactions_tree_view_columns</a>[i] = gtk_tree_view_column_new_with_attributes (
<a name="l00371"></a>00371                         _(<a class="code" href="affichage__liste_8c.html#abe5a25ede887e60c7f679c9ff03607f0">titres_colonnes_liste_operations</a>[i]),
<a name="l00372"></a>00372                                             cell_renderer,
<a name="l00373"></a>00373                                             <span class="stringliteral">&quot;text&quot;</span>, i,
<a name="l00374"></a>00374                                             <span class="stringliteral">&quot;cell-background-gdk&quot;</span>, <a class="code" href="custom__list_8h.html#a06fc87d81c62e9abb8790b6e5713c55baaeb0154012fa2239dd4a640838a0b926">CUSTOM_MODEL_BACKGROUND</a>,
<a name="l00375"></a>00375                                             <span class="stringliteral">&quot;font&quot;</span>, <a class="code" href="custom__list_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba8d29d48666a4bca641ba8b0b65502703">CUSTOM_MODEL_FONT</a>,
<a name="l00376"></a>00376                                             NULL );
<a name="l00377"></a>00377 
<a name="l00378"></a>00378         <span class="keywordflow">if</span> ( i == column_balance )
<a name="l00379"></a>00379             gtk_tree_view_column_add_attribute ( <a class="code" href="gsb__transactions__list_8c.html#a4f11139c6cd90bf0cd17d761652b069b">transactions_tree_view_columns</a>[i],
<a name="l00380"></a>00380                                                 cell_renderer,
<a name="l00381"></a>00381                                                 <span class="stringliteral">&quot;foreground&quot;</span>, <a class="code" href="custom__list_8h.html#a06fc87d81c62e9abb8790b6e5713c55bacdd498414fddfaf9ccf2fc84cf3f06f8">CUSTOM_MODEL_AMOUNT_COLOR</a>);
<a name="l00382"></a>00382         <span class="keywordflow">else</span>
<a name="l00383"></a>00383             gtk_tree_view_column_add_attribute ( <a class="code" href="gsb__transactions__list_8c.html#a4f11139c6cd90bf0cd17d761652b069b">transactions_tree_view_columns</a>[i],
<a name="l00384"></a>00384                                                 cell_renderer,
<a name="l00385"></a>00385                                                 <span class="stringliteral">&quot;foreground-gdk&quot;</span>, <a class="code" href="custom__list_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba6e2495ec36c3196595fd39b300480eb6">CUSTOM_MODEL_TEXT_COLOR</a> );
<a name="l00386"></a>00386 
<a name="l00387"></a>00387 
<a name="l00388"></a>00388         <span class="keywordflow">if</span> ( i == <a class="code" href="gsb__transactions__list_8c.html#a8be7f66c4c8f7c67eb187290c18fb6f7">find_element_col</a> (<a class="code" href="gsb__transactions__list_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57a1c9bb425c66169e4464498e2d76c6f00">ELEMENT_MARK</a>))
<a name="l00389"></a>00389         {
<a name="l00390"></a>00390             GtkCellRenderer * radio_renderer = gtk_cell_renderer_toggle_new ( );
<a name="l00391"></a>00391             gtk_tree_view_column_pack_start ( <a class="code" href="gsb__transactions__list_8c.html#a4f11139c6cd90bf0cd17d761652b069b">transactions_tree_view_columns</a>[i],
<a name="l00392"></a>00392                                             radio_renderer,
<a name="l00393"></a>00393                                              FALSE );
<a name="l00394"></a>00394             gtk_tree_view_column_set_attributes (<a class="code" href="gsb__transactions__list_8c.html#a4f11139c6cd90bf0cd17d761652b069b">transactions_tree_view_columns</a>[i], radio_renderer,
<a name="l00395"></a>00395                                                 <span class="stringliteral">&quot;active&quot;</span>, <a class="code" href="custom__list_8h.html#a06fc87d81c62e9abb8790b6e5713c55bac7a27e484ff94d8f9b4a2d42d24b2360">CUSTOM_MODEL_CHECKBOX_ACTIVE</a>,
<a name="l00396"></a>00396                                                 <span class="stringliteral">&quot;activatable&quot;</span>, <a class="code" href="custom__list_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba854287c59bb8bd04d517380095eae44b">CUSTOM_MODEL_CHECKBOX_VISIBLE</a>,
<a name="l00397"></a>00397                                                 <span class="stringliteral">&quot;visible&quot;</span>, <a class="code" href="custom__list_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba854287c59bb8bd04d517380095eae44b">CUSTOM_MODEL_CHECKBOX_VISIBLE</a>,
<a name="l00398"></a>00398                                                 <span class="stringliteral">&quot;cell-background-gdk&quot;</span>, <a class="code" href="custom__list_8h.html#a06fc87d81c62e9abb8790b6e5713c55baaeb0154012fa2239dd4a640838a0b926">CUSTOM_MODEL_BACKGROUND</a>,
<a name="l00399"></a>00399                                                 NULL );
<a name="l00400"></a>00400             g_object_set_data ( G_OBJECT ( <a class="code" href="gsb__transactions__list_8c.html#a4f11139c6cd90bf0cd17d761652b069b">transactions_tree_view_columns</a>[i] ),
<a name="l00401"></a>00401                         <span class="stringliteral">&quot;radio_renderer&quot;</span>, radio_renderer );
<a name="l00402"></a>00402         }
<a name="l00403"></a>00403 
<a name="l00404"></a>00404         gtk_tree_view_column_set_alignment ( <a class="code" href="gsb__transactions__list_8c.html#a4f11139c6cd90bf0cd17d761652b069b">transactions_tree_view_columns</a>[i],
<a name="l00405"></a>00405                                              alignment[i] );
<a name="l00406"></a>00406 
<a name="l00407"></a>00407         <span class="comment">/* automatic and resizeable sizing */</span>
<a name="l00408"></a>00408     <span class="keywordflow">if</span> ( i == column_balance )
<a name="l00409"></a>00409         gtk_tree_view_column_set_sizing ( <a class="code" href="gsb__transactions__list_8c.html#a4f11139c6cd90bf0cd17d761652b069b">transactions_tree_view_columns</a>[i],
<a name="l00410"></a>00410                                             GTK_TREE_VIEW_COLUMN_AUTOSIZE );
<a name="l00411"></a>00411     <span class="keywordflow">else</span>
<a name="l00412"></a>00412             gtk_tree_view_column_set_sizing ( <a class="code" href="gsb__transactions__list_8c.html#a4f11139c6cd90bf0cd17d761652b069b">transactions_tree_view_columns</a>[i],
<a name="l00413"></a>00413                                             GTK_TREE_VIEW_COLUMN_FIXED );
<a name="l00414"></a>00414 
<a name="l00415"></a>00415         gtk_tree_view_column_set_resizable ( <a class="code" href="gsb__transactions__list_8c.html#a4f11139c6cd90bf0cd17d761652b069b">transactions_tree_view_columns</a>[i],
<a name="l00416"></a>00416                                             TRUE );
<a name="l00417"></a>00417     }
<a name="l00418"></a>00418 
<a name="l00419"></a>00419 }
<a name="l00420"></a>00420 
<a name="l00421"></a>00421 
<a name="l00429"></a>00429 <span class="keywordtype">void</span> update_titres_tree_view ( <span class="keywordtype">void</span> )
<a name="l00430"></a>00430 {
<a name="l00431"></a>00431     gint i;
<a name="l00432"></a>00432 
<a name="l00433"></a>00433     <span class="keywordflow">for</span> ( i = 0 ; i &lt; CUSTOM_MODEL_N_VISIBLES_COLUMN ; i++ )
<a name="l00434"></a>00434     {
<a name="l00435"></a>00435         gtk_tree_view_column_set_title ( GTK_TREE_VIEW_COLUMN (
<a name="l00436"></a>00436                         <a class="code" href="gsb__transactions__list_8c.html#a4f11139c6cd90bf0cd17d761652b069b">transactions_tree_view_columns</a>[i] ),
<a name="l00437"></a>00437                         _(<a class="code" href="affichage__liste_8c.html#abe5a25ede887e60c7f679c9ff03607f0">titres_colonnes_liste_operations</a>[i] ) );
<a name="l00438"></a>00438 
<a name="l00439"></a>00439         <span class="keywordflow">if</span> ( GTK_TREE_VIEW_COLUMN ( <a class="code" href="gsb__transactions__list_8c.html#a4f11139c6cd90bf0cd17d761652b069b">transactions_tree_view_columns</a>[i] )-&gt;button )
<a name="l00440"></a>00440         {
<a name="l00441"></a>00441             gtk_widget_set_tooltip_text ( GTK_WIDGET ( GTK_TREE_VIEW_COLUMN (
<a name="l00442"></a>00442                         <a class="code" href="gsb__transactions__list_8c.html#a4f11139c6cd90bf0cd17d761652b069b">transactions_tree_view_columns</a>[i] )-&gt;button ),
<a name="l00443"></a>00443                         <a class="code" href="affichage__liste_8c.html#a7d49023563c9144cf16b6b4c2b65ce05">tips_col_liste_operations</a>[i] );
<a name="l00444"></a>00444         }
<a name="l00445"></a>00445     }
<a name="l00446"></a>00446 }
<a name="l00447"></a>00447 
<a name="l00448"></a>00448 
<a name="l00449"></a>00449 
<a name="l00457"></a>00457 GtkWidget *gsb_transactions_list_create_tree_view ( GtkTreeModel *model )
<a name="l00458"></a>00458 {
<a name="l00459"></a>00459     GtkWidget *tree_view;
<a name="l00460"></a>00460     gint i;
<a name="l00461"></a>00461 
<a name="l00462"></a>00462     tree_view = gtk_tree_view_new ();
<a name="l00463"></a>00463 
<a name="l00464"></a>00464     <span class="comment">/*  we cannot do a selection */</span>
<a name="l00465"></a>00465     gtk_tree_selection_set_mode ( GTK_TREE_SELECTION ( gtk_tree_view_get_selection (
<a name="l00466"></a>00466                         GTK_TREE_VIEW( tree_view ))),
<a name="l00467"></a>00467                                         GTK_SELECTION_NONE );
<a name="l00468"></a>00468 
<a name="l00469"></a>00469     <span class="comment">/* check the buttons on the list */</span>
<a name="l00470"></a>00470     g_signal_connect ( G_OBJECT ( tree_view ),
<a name="l00471"></a>00471                                 <span class="stringliteral">&quot;button_press_event&quot;</span>,
<a name="l00472"></a>00472                                 G_CALLBACK ( gsb_transactions_list_button_press ),
<a name="l00473"></a>00473                                 NULL );
<a name="l00474"></a>00474 
<a name="l00475"></a>00475     <span class="comment">/* check the keys on the list */</span>
<a name="l00476"></a>00476     g_signal_connect ( G_OBJECT ( tree_view ),
<a name="l00477"></a>00477                                 <span class="stringliteral">&quot;key_press_event&quot;</span>,
<a name="l00478"></a>00478                                 G_CALLBACK ( gsb_transactions_list_key_press ),
<a name="l00479"></a>00479                                 NULL );
<a name="l00480"></a>00480 
<a name="l00481"></a>00481     g_signal_connect ( G_OBJECT ( tree_view ),
<a name="l00482"></a>00482                                 <span class="stringliteral">&quot;size_allocate&quot;</span>,
<a name="l00483"></a>00483                                 G_CALLBACK (gsb_transactions_list_size_allocate),
<a name="l00484"></a>00484                                 NULL );
<a name="l00485"></a>00485 
<a name="l00486"></a>00486     <span class="comment">/* we create the columns of the tree view */</span>
<a name="l00487"></a>00487     gsb_transactions_list_create_tree_view_columns ();
<a name="l00488"></a>00488 
<a name="l00489"></a>00489     <span class="keywordflow">for</span> ( i = 0 ; i &lt; CUSTOM_MODEL_N_VISIBLES_COLUMN ; i++ )
<a name="l00490"></a>00490     {
<a name="l00491"></a>00491             gtk_tree_view_append_column ( GTK_TREE_VIEW ( tree_view ),
<a name="l00492"></a>00492                                         <a class="code" href="gsb__transactions__list_8c.html#a4f11139c6cd90bf0cd17d761652b069b">transactions_tree_view_columns</a>[i] );
<a name="l00493"></a>00493 
<a name="l00494"></a>00494             gtk_tree_view_column_set_clickable ( <a class="code" href="gsb__transactions__list_8c.html#a4f11139c6cd90bf0cd17d761652b069b">transactions_tree_view_columns</a>[i],
<a name="l00495"></a>00495                                             TRUE );
<a name="l00496"></a>00496 
<a name="l00497"></a>00497         <span class="comment">/*          set the tooltips */</span>
<a name="l00498"></a>00498             gtk_widget_set_tooltip_text ( GTK_WIDGET (<a class="code" href="gsb__transactions__list_8c.html#a4f11139c6cd90bf0cd17d761652b069b">transactions_tree_view_columns</a>[i] -&gt; button),
<a name="l00499"></a>00499                                         <a class="code" href="affichage__liste_8c.html#a7d49023563c9144cf16b6b4c2b65ce05">tips_col_liste_operations</a>[i] );
<a name="l00500"></a>00500 
<a name="l00501"></a>00501             g_signal_connect ( G_OBJECT ( <a class="code" href="gsb__transactions__list_8c.html#a4f11139c6cd90bf0cd17d761652b069b">transactions_tree_view_columns</a>[i] -&gt; button),
<a name="l00502"></a>00502                                     <span class="stringliteral">&quot;button-press-event&quot;</span>,
<a name="l00503"></a>00503                                     G_CALLBACK ( gsb_transactions_list_title_column_button_press ),
<a name="l00504"></a>00504                                     GINT_TO_POINTER ( i ) );
<a name="l00505"></a>00505 
<a name="l00506"></a>00506             <span class="comment">/* use the click to sort the list */</span>
<a name="l00507"></a>00507             g_signal_connect ( G_OBJECT ( <a class="code" href="gsb__transactions__list_8c.html#a4f11139c6cd90bf0cd17d761652b069b">transactions_tree_view_columns</a>[i] ),
<a name="l00508"></a>00508                                     <span class="stringliteral">&quot;clicked&quot;</span>,
<a name="l00509"></a>00509                                     G_CALLBACK ( gsb_transactions_list_change_sort_column ),
<a name="l00510"></a>00510                                     GINT_TO_POINTER ( i ) );
<a name="l00511"></a>00511     }
<a name="l00512"></a>00512 
<a name="l00513"></a>00513     gtk_tree_view_set_model ( GTK_TREE_VIEW ( tree_view ),
<a name="l00514"></a>00514                                     GTK_TREE_MODEL ( model ) );
<a name="l00515"></a>00515     <span class="keywordflow">return</span> tree_view;
<a name="l00516"></a>00516 }
<a name="l00517"></a>00517 
<a name="l00518"></a>00518 
<a name="l00527"></a>00527 gboolean gsb_transactions_list_fill_model ( <span class="keywordtype">void</span> )
<a name="l00528"></a>00528 {
<a name="l00529"></a>00529     GSList *tmp_list;
<a name="l00530"></a>00530     gint transaction_number;
<a name="l00531"></a>00531 
<a name="l00532"></a>00532     <a class="code" href="erreur_8h.html#a17bfffc4306bc76edd79e060a8947dc4">devel_debug</a> (NULL);
<a name="l00533"></a>00533 
<a name="l00534"></a>00534     <span class="comment">/* add the transations wich represent the archives to the store</span>
<a name="l00535"></a>00535 <span class="comment">     * 1 line per archive and per account */</span>
<a name="l00536"></a>00536     <a class="code" href="gsb__transactions__list_8c.html#a1a818af14b9c3c740d85b2c76cae24d5">gsb_transactions_list_fill_archive_store</a> ();
<a name="l00537"></a>00537 
<a name="l00538"></a>00538     <a class="code" href="gsb__transactions__list_8c.html#ac2f7ca891d6c3a7cfb5c8df02918cf7c">orphan_child_transactions</a> = NULL;
<a name="l00539"></a>00539 
<a name="l00540"></a>00540     <span class="comment">/* add the transactions to the store */</span>
<a name="l00541"></a>00541     tmp_list = <a class="code" href="gsb__data__transaction_8c.html#af781a71a62eece020188ef62847f2887">gsb_data_transaction_get_transactions_list</a> ();
<a name="l00542"></a>00542     <span class="keywordflow">while</span> (tmp_list)
<a name="l00543"></a>00543     {
<a name="l00544"></a>00544         transaction_number = <a class="code" href="gsb__data__transaction_8c.html#a99bf548513083f4a71fe019faeccbe0a">gsb_data_transaction_get_transaction_number</a> (tmp_list -&gt; data);
<a name="l00545"></a>00545         <a class="code" href="transaction__list_8c.html#aa34d9e30792bb09d3dfef963febee748">transaction_list_append_transaction</a> (transaction_number);
<a name="l00546"></a>00546         tmp_list = tmp_list -&gt; next;
<a name="l00547"></a>00547     }
<a name="l00548"></a>00548 
<a name="l00549"></a>00549     <span class="comment">/* if orphan_child_transactions if filled, there are some children wich didn&#39;t fing their</span>
<a name="l00550"></a>00550 <span class="comment">     * mother, we try again now that all the mothers are in the model */</span>
<a name="l00551"></a>00551     <span class="keywordflow">if</span> (<a class="code" href="gsb__transactions__list_8c.html#ac2f7ca891d6c3a7cfb5c8df02918cf7c">orphan_child_transactions</a>)
<a name="l00552"></a>00552     {
<a name="l00553"></a>00553         GSList *orphan_list_copy;
<a name="l00554"></a>00554 
<a name="l00555"></a>00555         orphan_list_copy = g_slist_copy (<a class="code" href="gsb__transactions__list_8c.html#ac2f7ca891d6c3a7cfb5c8df02918cf7c">orphan_child_transactions</a>);
<a name="l00556"></a>00556         g_slist_free (<a class="code" href="gsb__transactions__list_8c.html#ac2f7ca891d6c3a7cfb5c8df02918cf7c">orphan_child_transactions</a>);
<a name="l00557"></a>00557         <a class="code" href="gsb__transactions__list_8c.html#ac2f7ca891d6c3a7cfb5c8df02918cf7c">orphan_child_transactions</a> = NULL;
<a name="l00558"></a>00558 
<a name="l00559"></a>00559         tmp_list = orphan_list_copy;
<a name="l00560"></a>00560         <span class="keywordflow">while</span> (tmp_list)
<a name="l00561"></a>00561         {
<a name="l00562"></a>00562             transaction_number = GPOINTER_TO_INT (tmp_list -&gt; data);
<a name="l00563"></a>00563             <a class="code" href="transaction__list_8c.html#aa34d9e30792bb09d3dfef963febee748">transaction_list_append_transaction</a> (transaction_number);
<a name="l00564"></a>00564             tmp_list = tmp_list -&gt; next;
<a name="l00565"></a>00565         }
<a name="l00566"></a>00566         g_slist_free (orphan_list_copy);
<a name="l00567"></a>00567 
<a name="l00568"></a>00568         <span class="comment">/* if orphan_child_transactions is not null, there is still some children</span>
<a name="l00569"></a>00569 <span class="comment">         * wich didn&#39;t find their mother. show them now */</span>
<a name="l00570"></a>00570         <span class="keywordflow">if</span> (<a class="code" href="gsb__transactions__list_8c.html#ac2f7ca891d6c3a7cfb5c8df02918cf7c">orphan_child_transactions</a>)
<a name="l00571"></a>00571         {
<a name="l00572"></a>00572             gchar *<a class="code" href="structconditional__message.html#a1ac78264fd28b6819d5bfaa1e9b0ef39">message</a> = _(<span class="stringliteral">&quot;Some children didn&#39;t find their mother in the list, this &quot;</span>
<a name="l00573"></a>00573                            <span class="stringliteral">&quot;shouldn&#39;t happen and there is probably a bug behind that. &quot;</span>
<a name="l00574"></a>00574                            <span class="stringliteral">&quot;Please contact the Grisbi team.\n\nThe concerned children &quot;</span>
<a name="l00575"></a>00575                            <span class="stringliteral">&quot;number are :\n&quot;</span>);
<a name="l00576"></a>00576             gchar *string_1;
<a name="l00577"></a>00577             gchar *string_2;
<a name="l00578"></a>00578 
<a name="l00579"></a>00579             string_1 = g_strconcat (message, NULL);
<a name="l00580"></a>00580             tmp_list = <a class="code" href="gsb__transactions__list_8c.html#ac2f7ca891d6c3a7cfb5c8df02918cf7c">orphan_child_transactions</a>;
<a name="l00581"></a>00581             <span class="keywordflow">while</span> (tmp_list)
<a name="l00582"></a>00582             {
<a name="l00583"></a>00583                 string_2 = g_strconcat ( string_1,
<a name="l00584"></a>00584                                          <a class="code" href="utils__str_8c.html#a1e50f3be459180b9dea9f14eb7e1204e" title="convert an integer into a gchar based string">utils_str_itoa</a> (GPOINTER_TO_INT (tmp_list -&gt; data)),
<a name="l00585"></a>00585                                          <span class="stringliteral">&quot; - &quot;</span>,
<a name="l00586"></a>00586                                          NULL);
<a name="l00587"></a>00587                 g_free (string_1);
<a name="l00588"></a>00588                 string_1 = string_2;
<a name="l00589"></a>00589                 tmp_list = tmp_list -&gt; next;
<a name="l00590"></a>00590             }
<a name="l00591"></a>00591             <a class="code" href="dialog_8c.html#a198880c6e09a934c62fd541c9cb302f9">dialogue_warning</a> (string_1);
<a name="l00592"></a>00592             g_free (string_1);
<a name="l00593"></a>00593         }
<a name="l00594"></a>00594     }
<a name="l00595"></a>00595     <span class="keywordflow">return</span> FALSE;
<a name="l00596"></a>00596 }
<a name="l00597"></a>00597 
<a name="l00598"></a>00598 
<a name="l00608"></a><a class="code" href="gsb__transactions__list_8h.html#a1a818af14b9c3c740d85b2c76cae24d5">00608</a> gboolean <a class="code" href="gsb__transactions__list_8c.html#a1a818af14b9c3c740d85b2c76cae24d5">gsb_transactions_list_fill_archive_store</a> ( <span class="keywordtype">void</span> )
<a name="l00609"></a>00609 {
<a name="l00610"></a>00610     GSList *tmp_list;
<a name="l00611"></a>00611 
<a name="l00612"></a>00612     <a class="code" href="erreur_8h.html#a17bfffc4306bc76edd79e060a8947dc4">devel_debug</a> (NULL);
<a name="l00613"></a>00613 
<a name="l00614"></a>00614     tmp_list = <a class="code" href="gsb__data__archive__store_8c.html#aaa582320ef1a27b7c506540b8f43df99">gsb_data_archive_store_get_archives_list</a> ();
<a name="l00615"></a>00615     <span class="keywordflow">while</span> (tmp_list)
<a name="l00616"></a>00616     {
<a name="l00617"></a>00617     gint archive_store_number;
<a name="l00618"></a>00618 
<a name="l00619"></a>00619     <span class="comment">/* get the store archive struct */</span>
<a name="l00620"></a>00620     archive_store_number = <a class="code" href="gsb__data__archive__store_8c.html#a33d414762707f17772146fca8dc8db36">gsb_data_archive_store_get_number</a> (tmp_list -&gt; data);
<a name="l00621"></a>00621     <a class="code" href="transaction__list_8c.html#afbdc1da83c1a8ae632c753d56acad64c">transaction_list_append_archive</a> (archive_store_number);
<a name="l00622"></a>00622     tmp_list = tmp_list -&gt; next;
<a name="l00623"></a>00623     }
<a name="l00624"></a>00624     <span class="keywordflow">return</span> FALSE;
<a name="l00625"></a>00625 }
<a name="l00626"></a>00626 
<a name="l00627"></a>00627 
<a name="l00628"></a>00628 
<a name="l00647"></a><a class="code" href="gsb__transactions__list_8h.html#ab384002f4635a570bc9907b04b3efd24">00647</a> gboolean <a class="code" href="gsb__transactions__list_8c.html#ab384002f4635a570bc9907b04b3efd24">gsb_transactions_list_append_new_transaction</a> ( gint transaction_number,
<a name="l00648"></a>00648                         gboolean update_tree_view )
<a name="l00649"></a>00649 {
<a name="l00650"></a>00650     gint account_number;
<a name="l00651"></a>00651 
<a name="l00652"></a>00652     account_number = <a class="code" href="gsb__data__transaction_8c.html#a5b486efbc486f946e9c998a114054bce">gsb_data_transaction_get_account_number</a> (transaction_number);
<a name="l00653"></a>00653 
<a name="l00654"></a>00654     <span class="comment">/* append the transaction to the tree view */</span>
<a name="l00655"></a>00655     <a class="code" href="transaction__list_8c.html#aa34d9e30792bb09d3dfef963febee748">transaction_list_append_transaction</a> (transaction_number);
<a name="l00656"></a>00656 
<a name="l00657"></a>00657     <span class="comment">/* update the transaction list only if the account is showed,</span>
<a name="l00658"></a>00658 <span class="comment">     * else it&#39;s because we execute a scheduled transaction and all</span>
<a name="l00659"></a>00659 <span class="comment">     * of that stuff will be done when we will show the account */</span>
<a name="l00660"></a>00660     <span class="keywordflow">if</span> (update_tree_view
<a name="l00661"></a>00661      &amp;&amp;
<a name="l00662"></a>00662      <a class="code" href="navigation_8c.html#a3b668bf52ce71dcff3ea10c9db7be859">gsb_gui_navigation_get_current_account</a> () == account_number
<a name="l00663"></a>00663      &amp;&amp;
<a name="l00664"></a>00664      !<a class="code" href="gsb__data__transaction_8c.html#a6018560ece7ab02e8d46bc9bdaffd607">gsb_data_transaction_get_mother_transaction_number</a> (transaction_number))
<a name="l00665"></a>00665     {
<a name="l00666"></a>00666         <a class="code" href="gsb__transactions__list_8c.html#ab7d08f59bcf7149edda9db47e67333a4">gsb_transactions_list_update_tree_view</a> ( account_number, TRUE );
<a name="l00667"></a>00667         <a class="code" href="gsb__data__account_8c.html#a4607ab78b42360bded7a2203dca78931">gsb_data_account_colorize_current_balance</a> ( account_number );
<a name="l00668"></a>00668 
<a name="l00669"></a>00669         <span class="comment">/* if it&#39;s a mother, open the expander */</span>
<a name="l00670"></a>00670         <span class="keywordflow">if</span> (<a class="code" href="gsb__data__transaction_8c.html#a2de1ba38ee196b44e3c00c10e1d645cc">gsb_data_transaction_get_split_of_transaction</a> (transaction_number))
<a name="l00671"></a>00671             <a class="code" href="gsb__transactions__list_8c.html#a6089f07015c6278f5d0a689783fe4019">gsb_transactions_list_switch_expander</a> (transaction_number);
<a name="l00672"></a>00672     }
<a name="l00673"></a>00673 
<a name="l00674"></a>00674     <span class="comment">/* on réaffichera l&#39;accueil */</span>
<a name="l00675"></a>00675     <a class="code" href="accueil_8c.html#a018917e8dacfd8fbe4e94d0f99a59c08">mise_a_jour_liste_comptes_accueil</a> = 1;
<a name="l00676"></a>00676     <a class="code" href="accueil_8c.html#afaffaedc4fd0ae8638f7158c6777b35b">mise_a_jour_soldes_minimaux</a> = 1;
<a name="l00677"></a>00677     <a class="code" href="accueil_8c.html#a9ebd251de44611d97ec364d1867a75ff">mise_a_jour_fin_comptes_passifs</a> = 1;
<a name="l00678"></a>00678     <span class="keywordflow">return</span> FALSE;
<a name="l00679"></a>00679 }
<a name="l00680"></a>00680 
<a name="l00681"></a>00681 
<a name="l00682"></a>00682 
<a name="l00683"></a>00683 
<a name="l00693"></a><a class="code" href="gsb__transactions__list_8h.html#a1e229d05133af4abe35b72675491f580">00693</a> gchar *<a class="code" href="gsb__transactions__list_8c.html#a1e229d05133af4abe35b72675491f580">gsb_transactions_list_grep_cell_content</a> ( gint transaction_number,
<a name="l00694"></a>00694                         gint cell_content_number )
<a name="l00695"></a>00695 {
<a name="l00696"></a>00696     gint account_currency;
<a name="l00697"></a>00697 
<a name="l00698"></a>00698     <span class="comment">/* for a child of split, we show only the category (instead of party or category), the</span>
<a name="l00699"></a>00699 <span class="comment">     * debit and credit, nothing else */</span>
<a name="l00700"></a>00700     <span class="keywordflow">if</span> (<a class="code" href="gsb__data__transaction_8c.html#a6018560ece7ab02e8d46bc9bdaffd607">gsb_data_transaction_get_mother_transaction_number</a> (transaction_number))
<a name="l00701"></a>00701     {
<a name="l00702"></a>00702         <span class="keywordflow">switch</span> (cell_content_number)
<a name="l00703"></a>00703         {
<a name="l00704"></a>00704             <span class="keywordflow">case</span> <a class="code" href="gsb__transactions__list_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57a2c500de74c55386754d7406fec8040ce">ELEMENT_PARTY</a>:
<a name="l00705"></a>00705                 <span class="comment">/* here want to show the category instead of the payee */</span>
<a name="l00706"></a>00706                 cell_content_number = <a class="code" href="gsb__transactions__list_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57a14d07ec8c3f6be2c40010a64205711be">ELEMENT_CATEGORY</a>;
<a name="l00707"></a>00707                 <span class="keywordflow">break</span>;
<a name="l00708"></a>00708 
<a name="l00709"></a>00709             <span class="keywordflow">case</span> <a class="code" href="gsb__transactions__list_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57a14d07ec8c3f6be2c40010a64205711be">ELEMENT_CATEGORY</a>:
<a name="l00710"></a>00710             <span class="keywordflow">case</span> <a class="code" href="gsb__transactions__list_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57a562334a8510015ee6bd6be39ec899828">ELEMENT_DEBIT</a>:
<a name="l00711"></a>00711             <span class="keywordflow">case</span> <a class="code" href="gsb__transactions__list_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57adb5de8e2e54fe03605af16b9eb86452e">ELEMENT_CREDIT</a>:
<a name="l00712"></a>00712                 <span class="keywordflow">break</span>;
<a name="l00713"></a>00713 
<a name="l00714"></a>00714             <span class="keywordflow">default</span>:
<a name="l00715"></a>00715                 <span class="keywordflow">return</span> NULL;
<a name="l00716"></a>00716         }
<a name="l00717"></a>00717     }
<a name="l00718"></a>00718 
<a name="l00719"></a>00719     <span class="keywordflow">switch</span> ( cell_content_number )
<a name="l00720"></a>00720     {
<a name="l00721"></a>00721         <span class="comment">/* mise en forme de la date */</span>
<a name="l00722"></a>00722 
<a name="l00723"></a>00723         <span class="keywordflow">case</span> <a class="code" href="gsb__transactions__list_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57a23886a6e4002c32ce2faadbc7caa5e5a">ELEMENT_DATE</a>:
<a name="l00724"></a>00724             <span class="keywordflow">return</span> <a class="code" href="utils__dates_8c.html#a6e7537390d7569da5efc74f96ea57da7">gsb_format_gdate</a>(<a class="code" href="gsb__data__transaction_8c.html#ab0b62014885bcf3e2fbfff1ae9b32080">gsb_data_transaction_get_date</a> (transaction_number));
<a name="l00725"></a>00725 
<a name="l00726"></a>00726             <span class="comment">/* mise en forme de la date de valeur */</span>
<a name="l00727"></a>00727 
<a name="l00728"></a>00728         <span class="keywordflow">case</span> <a class="code" href="gsb__transactions__list_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57ab761a8d812187a4600c7525771f7f8e6">ELEMENT_VALUE_DATE</a>:
<a name="l00729"></a>00729             <span class="keywordflow">return</span> <a class="code" href="utils__dates_8c.html#a6e7537390d7569da5efc74f96ea57da7">gsb_format_gdate</a>(<a class="code" href="gsb__data__transaction_8c.html#a5851b4114a8f23b40107fba99ae2fbef">gsb_data_transaction_get_value_date</a> (transaction_number));
<a name="l00730"></a>00730 
<a name="l00731"></a>00731             <span class="comment">/* mise en forme du tiers */</span>
<a name="l00732"></a>00732 
<a name="l00733"></a>00733         <span class="keywordflow">case</span> <a class="code" href="gsb__transactions__list_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57a2c500de74c55386754d7406fec8040ce">ELEMENT_PARTY</a>:
<a name="l00734"></a>00734             <span class="keywordflow">return</span> ( <a class="code" href="utils__str_8c.html#ad9a37361694eeaa2847b0fe11389824d">my_strdup</a> (<a class="code" href="gsb__data__payee_8c.html#adc6080b7376628d3902f5fd861deb45a">gsb_data_payee_get_name</a> ( <a class="code" href="gsb__data__transaction_8c.html#afa032df45afa2ad7a4be48449a7e8d15">gsb_data_transaction_get_party_number</a> (transaction_number), TRUE )));
<a name="l00735"></a>00735 
<a name="l00736"></a>00736             <span class="comment">/* mise en forme de l&#39;ib */</span>
<a name="l00737"></a>00737 
<a name="l00738"></a>00738         <span class="keywordflow">case</span> <a class="code" href="gsb__transactions__list_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57a9ac9d9fa61388060ab239d177bd6eda8">ELEMENT_BUDGET</a>:
<a name="l00739"></a>00739             <span class="keywordflow">return</span> ( <a class="code" href="utils__str_8c.html#ad9a37361694eeaa2847b0fe11389824d">my_strdup</a> (<a class="code" href="gsb__data__budget_8c.html#af857141b1d34674997a047500fd76060">gsb_data_budget_get_name</a> ( <a class="code" href="gsb__data__transaction_8c.html#a4d84c55dbdfa032c500f4ade0754501f">gsb_data_transaction_get_budgetary_number</a> (transaction_number),
<a name="l00740"></a>00740                                                            <a class="code" href="gsb__data__transaction_8c.html#a44dbcf1f953a233d0038027289aa2372">gsb_data_transaction_get_sub_budgetary_number</a> (transaction_number),
<a name="l00741"></a>00741                                                            NULL )));
<a name="l00742"></a>00742 
<a name="l00743"></a>00743         <span class="keywordflow">case</span> <a class="code" href="gsb__transactions__list_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57a562334a8510015ee6bd6be39ec899828">ELEMENT_DEBIT</a>:
<a name="l00744"></a>00744         <span class="keywordflow">case</span> <a class="code" href="gsb__transactions__list_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57adb5de8e2e54fe03605af16b9eb86452e">ELEMENT_CREDIT</a>:
<a name="l00745"></a>00745             <span class="comment">/* give the amount of the transaction on the transaction currency */</span>
<a name="l00746"></a>00746             <span class="keywordflow">if</span> ( (cell_content_number == <a class="code" href="gsb__transactions__list_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57a562334a8510015ee6bd6be39ec899828">ELEMENT_DEBIT</a>
<a name="l00747"></a>00747                   &amp;&amp;
<a name="l00748"></a>00748                   <a class="code" href="gsb__data__transaction_8c.html#a632c5ba71e742b3ac063b4b3207cf032">gsb_data_transaction_get_amount</a> ( transaction_number).mantissa &lt; 0 )
<a name="l00749"></a>00749                  ||
<a name="l00750"></a>00750                  (cell_content_number == <a class="code" href="gsb__transactions__list_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57adb5de8e2e54fe03605af16b9eb86452e">ELEMENT_CREDIT</a>
<a name="l00751"></a>00751                   &amp;&amp;
<a name="l00752"></a>00752                   <a class="code" href="gsb__data__transaction_8c.html#a632c5ba71e742b3ac063b4b3207cf032">gsb_data_transaction_get_amount</a> ( transaction_number).mantissa &gt;= 0 ))
<a name="l00753"></a>00753                     <span class="keywordflow">return</span> <a class="code" href="gsb__real_8c.html#a03f4474a9a4269e384951af9be4acedd">gsb_real_get_string_with_currency</a> (
<a name="l00754"></a>00754                         <a class="code" href="gsb__real_8c.html#ae727c3ee72397bb23657fb3571bcf4da">gsb_real_abs</a> ( <a class="code" href="gsb__data__transaction_8c.html#a632c5ba71e742b3ac063b4b3207cf032">gsb_data_transaction_get_amount</a> ( transaction_number ) ),
<a name="l00755"></a>00755                                             <a class="code" href="gsb__data__transaction_8c.html#aa39edcb597bd75a438b00b67cf898e88">gsb_data_transaction_get_currency_number</a> ( transaction_number ), TRUE );
<a name="l00756"></a>00756             <span class="keywordflow">else</span>
<a name="l00757"></a>00757                 <span class="keywordflow">return</span> NULL;
<a name="l00758"></a>00758             <span class="keywordflow">break</span>;
<a name="l00759"></a>00759 
<a name="l00760"></a>00760         <span class="keywordflow">case</span> <a class="code" href="gsb__transactions__list_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57a0f73340eb5af6e8a5454c1aa833339e8">ELEMENT_BALANCE</a>:
<a name="l00761"></a>00761             <span class="keywordflow">return</span> NULL;
<a name="l00762"></a>00762 
<a name="l00763"></a>00763         <span class="keywordflow">case</span> <a class="code" href="gsb__transactions__list_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57ab1d48e2978669bb807a1baaa8cdea794">ELEMENT_AMOUNT</a>:
<a name="l00764"></a>00764             <span class="comment">/* give the amount of the transaction in the currency of the account */</span>
<a name="l00765"></a>00765             account_currency = <a class="code" href="gsb__data__account_8c.html#a9f8d132b988ca73a7061fca955f6bc2c">gsb_data_account_get_currency</a> (
<a name="l00766"></a>00766                         <a class="code" href="gsb__data__transaction_8c.html#a5b486efbc486f946e9c998a114054bce">gsb_data_transaction_get_account_number</a> ( transaction_number ) );
<a name="l00767"></a>00767             <span class="keywordflow">if</span> ( account_currency != <a class="code" href="gsb__data__transaction_8c.html#aa39edcb597bd75a438b00b67cf898e88">gsb_data_transaction_get_currency_number</a> (
<a name="l00768"></a>00768          transaction_number ) )
<a name="l00769"></a>00769             {
<a name="l00770"></a>00770             gchar* tmpstr;
<a name="l00771"></a>00771             gchar* result;
<a name="l00772"></a>00772 
<a name="l00773"></a>00773             tmpstr = <a class="code" href="gsb__real_8c.html#a9207a2084e51e49584c038b6c8ae4433">gsb_real_get_string</a> (
<a name="l00774"></a>00774                         <a class="code" href="gsb__data__transaction_8c.html#a8f44da078801e109873c479399b72191">gsb_data_transaction_get_adjusted_amount_for_currency</a> (
<a name="l00775"></a>00775                         transaction_number,
<a name="l00776"></a>00776                         account_currency,
<a name="l00777"></a>00777                         <a class="code" href="gsb__data__currency_8c.html#ae61136d9086c83d0fc0c8ea42e463c11">gsb_data_currency_get_floating_point</a> ( account_currency ) ) );
<a name="l00778"></a>00778             result = g_strconcat ( <span class="stringliteral">&quot;(&quot;</span>,
<a name="l00779"></a>00779                         tmpstr,
<a name="l00780"></a>00780                         <span class="stringliteral">&quot; &quot;</span>,
<a name="l00781"></a>00781                         <a class="code" href="gsb__data__currency_8c.html#ab8327a4b2ece3d38dab932c9872b850b">gsb_data_currency_get_code_or_isocode</a> ( account_currency ),
<a name="l00782"></a>00782                                             <span class="stringliteral">&quot;)&quot;</span>,
<a name="l00783"></a>00783                                             NULL );
<a name="l00784"></a>00784             g_free ( tmpstr );
<a name="l00785"></a>00785             <span class="keywordflow">return</span> result;
<a name="l00786"></a>00786             }
<a name="l00787"></a>00787             <span class="keywordflow">else</span>
<a name="l00788"></a>00788             <span class="keywordflow">return</span> NULL;
<a name="l00789"></a>00789             <span class="keywordflow">break</span>;
<a name="l00790"></a>00790 
<a name="l00791"></a>00791             <span class="comment">/* mise en forme du moyen de paiement */</span>
<a name="l00792"></a>00792 
<a name="l00793"></a>00793         <span class="keywordflow">case</span> <a class="code" href="gsb__transactions__list_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57ab990b13349c34bf1524cab596b6c614b">ELEMENT_PAYMENT_TYPE</a>:
<a name="l00794"></a>00794             <span class="keywordflow">return</span> ( <a class="code" href="utils__str_8c.html#ad9a37361694eeaa2847b0fe11389824d">my_strdup</a> (<a class="code" href="gsb__data__payment_8c.html#a3384c18af92833d2152faad71ccd16c4">gsb_data_payment_get_name</a> ( <a class="code" href="gsb__data__transaction_8c.html#aa9bc2b3aba6d0a4df30e0584ab56ede0">gsb_data_transaction_get_method_of_payment_number</a> ( transaction_number))));
<a name="l00795"></a>00795 
<a name="l00796"></a>00796             <span class="comment">/* mise en forme du no de rapprochement */</span>
<a name="l00797"></a>00797 
<a name="l00798"></a>00798         <span class="keywordflow">case</span> <a class="code" href="gsb__transactions__list_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57af5e128aeac4005857a0cc18fd45b9ea2">ELEMENT_RECONCILE_NB</a>:
<a name="l00799"></a>00799             <span class="keywordflow">return</span> ( <a class="code" href="utils__str_8c.html#ad9a37361694eeaa2847b0fe11389824d">my_strdup</a> (<a class="code" href="gsb__data__reconcile_8c.html#a0f88a3f39b7944967f373097fe9d1474">gsb_data_reconcile_get_name</a> ( <a class="code" href="gsb__data__transaction_8c.html#a1f902ce2841e41d3eda536f2fdd3c32f">gsb_data_transaction_get_reconcile_number</a> ( transaction_number))));
<a name="l00800"></a>00800 
<a name="l00801"></a>00801             <span class="comment">/* mise en place de l&#39;exo */</span>
<a name="l00802"></a>00802 
<a name="l00803"></a>00803         <span class="keywordflow">case</span> <a class="code" href="gsb__transactions__list_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57a4825ce568dc0468f2fc4c1bc5ab11ff6">ELEMENT_EXERCICE</a>:
<a name="l00804"></a>00804             <span class="keywordflow">return</span> ( <a class="code" href="utils__str_8c.html#ad9a37361694eeaa2847b0fe11389824d">my_strdup</a> (<a class="code" href="gsb__data__fyear_8c.html#ad6c1d7c774990722a69d741ab0d4785e">gsb_data_fyear_get_name</a> (<a class="code" href="gsb__data__transaction_8c.html#ae8f3e659e304f02abd6c2ae7dd759203">gsb_data_transaction_get_financial_year_number</a> ( transaction_number))));
<a name="l00805"></a>00805 
<a name="l00806"></a>00806             <span class="comment">/* mise en place des catégories */</span>
<a name="l00807"></a>00807 
<a name="l00808"></a>00808         <span class="keywordflow">case</span> <a class="code" href="gsb__transactions__list_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57a14d07ec8c3f6be2c40010a64205711be">ELEMENT_CATEGORY</a>:
<a name="l00809"></a>00809 
<a name="l00810"></a>00810             <span class="keywordflow">return</span> ( <a class="code" href="gsb__transactions__list_8c.html#a1144ff7dd8c9bf6a2a6eb870fc8ae2df">gsb_transactions_get_category_real_name</a> ( transaction_number ));
<a name="l00811"></a>00811 
<a name="l00812"></a>00812             <span class="comment">/* mise en forme R/P */</span>
<a name="l00813"></a>00813 
<a name="l00814"></a>00814         <span class="keywordflow">case</span> <a class="code" href="gsb__transactions__list_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57a1c9bb425c66169e4464498e2d76c6f00">ELEMENT_MARK</a>:
<a name="l00815"></a>00815             <span class="keywordflow">if</span> ( <a class="code" href="gsb__data__transaction_8c.html#a52cf9684818c3930c5c688b54f7cf393">gsb_data_transaction_get_marked_transaction</a> ( transaction_number)== <a class="code" href="gsb__data__transaction_8h.html#a82f385a1c75ac98496b5c09a123bf521a0d2386ee3dfac40bf6fa775bc7d6325e">OPERATION_POINTEE</a> )
<a name="l00816"></a>00816                 <span class="keywordflow">return</span> ( <a class="code" href="utils__str_8c.html#ad9a37361694eeaa2847b0fe11389824d">my_strdup</a> (_(<span class="stringliteral">&quot;P&quot;</span>)));
<a name="l00817"></a>00817             <span class="keywordflow">else</span>
<a name="l00818"></a>00818             {
<a name="l00819"></a>00819                 <span class="keywordflow">if</span> ( <a class="code" href="gsb__data__transaction_8c.html#a52cf9684818c3930c5c688b54f7cf393">gsb_data_transaction_get_marked_transaction</a> ( transaction_number)== <a class="code" href="gsb__data__transaction_8h.html#a82f385a1c75ac98496b5c09a123bf521ad2c1596b5d07a043b0cfaef131372b01">OPERATION_TELERAPPROCHEE</a> )
<a name="l00820"></a>00820                     <span class="keywordflow">return</span> ( <a class="code" href="utils__str_8c.html#ad9a37361694eeaa2847b0fe11389824d">my_strdup</a> (_(<span class="stringliteral">&quot;T&quot;</span>)));
<a name="l00821"></a>00821                 <span class="keywordflow">else</span>
<a name="l00822"></a>00822                 {
<a name="l00823"></a>00823                     <span class="keywordflow">if</span> ( <a class="code" href="gsb__data__transaction_8c.html#a52cf9684818c3930c5c688b54f7cf393">gsb_data_transaction_get_marked_transaction</a> ( transaction_number)== <a class="code" href="gsb__data__transaction_8h.html#a82f385a1c75ac98496b5c09a123bf521a41425f55add3a05ffc4c7aa366048fc9">OPERATION_RAPPROCHEE</a> )
<a name="l00824"></a>00824                         <span class="keywordflow">return</span> ( <a class="code" href="utils__str_8c.html#ad9a37361694eeaa2847b0fe11389824d">my_strdup</a> (_(<span class="stringliteral">&quot;R&quot;</span>)));
<a name="l00825"></a>00825                     <span class="keywordflow">else</span>
<a name="l00826"></a>00826                         <span class="keywordflow">return</span> ( NULL );
<a name="l00827"></a>00827                 }
<a name="l00828"></a>00828             }
<a name="l00829"></a>00829             <span class="keywordflow">break</span>;
<a name="l00830"></a>00830 
<a name="l00831"></a>00831             <span class="comment">/* mise en place de la pièce comptable */</span>
<a name="l00832"></a>00832 
<a name="l00833"></a>00833         <span class="keywordflow">case</span> <a class="code" href="gsb__transactions__list_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57aa39a67b0d3d908e1564af0b203c5d585">ELEMENT_VOUCHER</a>:
<a name="l00834"></a>00834             <span class="keywordflow">return</span> ( <a class="code" href="utils__str_8c.html#ad9a37361694eeaa2847b0fe11389824d">my_strdup</a> (<a class="code" href="gsb__data__transaction_8c.html#ad9886b09c3afc57a5c551896046a849a">gsb_data_transaction_get_voucher</a> ( transaction_number)));
<a name="l00835"></a>00835 
<a name="l00836"></a>00836             <span class="comment">/* mise en forme des notes */</span>
<a name="l00837"></a>00837 
<a name="l00838"></a>00838         <span class="keywordflow">case</span> <a class="code" href="gsb__transactions__list_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57a5bc876fbf3281eb4cc86a5fefdfc4487">ELEMENT_NOTES</a>:
<a name="l00839"></a>00839             <span class="keywordflow">return</span> ( <a class="code" href="utils__str_8c.html#ad9a37361694eeaa2847b0fe11389824d">my_strdup</a> (<a class="code" href="gsb__data__transaction_8c.html#ad73b393673217f5b9cc295c74e030550">gsb_data_transaction_get_notes</a> ( transaction_number)));
<a name="l00840"></a>00840 
<a name="l00841"></a>00841             <span class="comment">/* mise en place de l&#39;info banque/guichet */</span>
<a name="l00842"></a>00842 
<a name="l00843"></a>00843         <span class="keywordflow">case</span> <a class="code" href="gsb__transactions__list_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57aa1f58a928f37cd97e2ef66a05cb18f47">ELEMENT_BANK</a>:
<a name="l00844"></a>00844             <span class="keywordflow">return</span> ( <a class="code" href="utils__str_8c.html#ad9a37361694eeaa2847b0fe11389824d">my_strdup</a> (<a class="code" href="gsb__data__transaction_8c.html#a8ef7712f47278152551c3d9454ecf36a">gsb_data_transaction_get_bank_references</a> ( transaction_number)));
<a name="l00845"></a>00845 
<a name="l00846"></a>00846             <span class="comment">/* mise en place du no d&#39;opé */</span>
<a name="l00847"></a>00847 
<a name="l00848"></a>00848         <span class="keywordflow">case</span> <a class="code" href="gsb__transactions__list_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57ac81545daeefa24557d7b18826cb11fad">ELEMENT_NO</a>:
<a name="l00849"></a>00849             <span class="keywordflow">return</span> ( <a class="code" href="utils__str_8c.html#a1e50f3be459180b9dea9f14eb7e1204e" title="convert an integer into a gchar based string">utils_str_itoa</a> ( transaction_number ));
<a name="l00850"></a>00850 
<a name="l00851"></a>00851             <span class="comment">/* mise en place du no de chèque/virement */</span>
<a name="l00852"></a>00852 
<a name="l00853"></a>00853         <span class="keywordflow">case</span> <a class="code" href="gsb__transactions__list_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57aa2c405cbd6e9496265ce869d0fad27c0">ELEMENT_CHQ</a>:
<a name="l00854"></a>00854             <span class="keywordflow">if</span> ( <a class="code" href="gsb__data__transaction_8c.html#a018a31b8a8fe99e813b4876206cf59a1">gsb_data_transaction_get_method_of_payment_content</a> ( transaction_number))
<a name="l00855"></a>00855                 <span class="keywordflow">return</span> ( g_strconcat ( <span class="stringliteral">&quot;(&quot;</span>,
<a name="l00856"></a>00856                                        <a class="code" href="gsb__data__transaction_8c.html#a018a31b8a8fe99e813b4876206cf59a1">gsb_data_transaction_get_method_of_payment_content</a> ( transaction_number),
<a name="l00857"></a>00857                                        <span class="stringliteral">&quot;)&quot;</span>,
<a name="l00858"></a>00858                                        NULL ));
<a name="l00859"></a>00859             <span class="keywordflow">else</span>
<a name="l00860"></a>00860                 <span class="keywordflow">return</span> ( NULL );
<a name="l00861"></a>00861             <span class="keywordflow">break</span>;
<a name="l00862"></a>00862     }
<a name="l00863"></a>00863     <span class="keywordflow">return</span> ( NULL );
<a name="l00864"></a>00864 }
<a name="l00865"></a>00865 
<a name="l00873"></a><a class="code" href="gsb__transactions__list_8h.html#a83f53b0c0b9da33efa7f7691ea939f9e">00873</a> gboolean <a class="code" href="gsb__transactions__list_8c.html#a83f53b0c0b9da33efa7f7691ea939f9e">gsb_transactions_list_update_transaction</a> ( gint transaction_number )
<a name="l00874"></a>00874 {
<a name="l00875"></a>00875     gint account_number;
<a name="l00876"></a>00876 
<a name="l00877"></a>00877     <a class="code" href="erreur_8h.html#a10f4eeae4cc251a8d632fd62ec1057fb">devel_debug_int</a> (transaction_number);
<a name="l00878"></a>00878 
<a name="l00879"></a>00879     <span class="comment">/* first, modify the transaction in the tree view */</span>
<a name="l00880"></a>00880     <a class="code" href="transaction__list_8c.html#a7530aa4be260035a39dc5de2acbb8f62">transaction_list_update_transaction</a> (transaction_number);
<a name="l00881"></a>00881 
<a name="l00882"></a>00882     <span class="comment">/* update the balances */</span>
<a name="l00883"></a>00883     <a class="code" href="transaction__list_8c.html#a59ee075b27fa18fb9691201b52ec6692">transaction_list_set_balances</a> ();
<a name="l00884"></a>00884 
<a name="l00885"></a>00885     account_number = <a class="code" href="gsb__data__transaction_8c.html#a5b486efbc486f946e9c998a114054bce">gsb_data_transaction_get_account_number</a> (transaction_number);
<a name="l00886"></a>00886     <a class="code" href="gsb__data__account_8c.html#a4607ab78b42360bded7a2203dca78931">gsb_data_account_colorize_current_balance</a> ( account_number );
<a name="l00887"></a>00887 
<a name="l00888"></a>00888     <span class="comment">/* update first page */</span>
<a name="l00889"></a>00889     <a class="code" href="accueil_8c.html#a018917e8dacfd8fbe4e94d0f99a59c08">mise_a_jour_liste_comptes_accueil</a> = 1;
<a name="l00890"></a>00890     <a class="code" href="accueil_8c.html#afaffaedc4fd0ae8638f7158c6777b35b">mise_a_jour_soldes_minimaux</a> = 1;
<a name="l00891"></a>00891     <a class="code" href="accueil_8c.html#a9ebd251de44611d97ec364d1867a75ff">mise_a_jour_fin_comptes_passifs</a> = 1;
<a name="l00892"></a>00892 
<a name="l00893"></a>00893     <span class="keywordflow">return</span> FALSE;
<a name="l00894"></a>00894 }
<a name="l00895"></a>00895 
<a name="l00896"></a>00896 
<a name="l00897"></a>00897 
<a name="l00906"></a><a class="code" href="gsb__transactions__list_8h.html#aaae69a76295b86b7baace98ce4066738">00906</a> gfloat <a class="code" href="gsb__transactions__list_8c.html#aaae69a76295b86b7baace98ce4066738">gsb_transactions_list_get_row_align</a> ( <span class="keywordtype">void</span> )
<a name="l00907"></a>00907 {
<a name="l00908"></a>00908     GtkTreePath *path;
<a name="l00909"></a>00909     GtkTreeView *tree_view;
<a name="l00910"></a>00910     GdkRectangle back_rect;
<a name="l00911"></a>00911     gint height_win;
<a name="l00912"></a>00912     gfloat row_align;
<a name="l00913"></a>00913     gfloat height, rect_y;
<a name="l00914"></a>00914 
<a name="l00915"></a>00915     <a class="code" href="erreur_8h.html#a17bfffc4306bc76edd79e060a8947dc4">devel_debug</a> (NULL);
<a name="l00916"></a>00916 
<a name="l00917"></a>00917     tree_view = GTK_TREE_VIEW (<a class="code" href="gsb__transactions__list_8c.html#a9c93505713234d8fa4727b067a140641">gsb_transactions_list_get_tree_view</a> ());
<a name="l00918"></a>00918     path = <a class="code" href="transaction__list__select_8c.html#ac4dba240fa9e06af594157c07e62c2d8">transaction_list_select_get_path</a> (0);
<a name="l00919"></a>00919 
<a name="l00920"></a>00920     <span class="keywordflow">if</span> (!path)
<a name="l00921"></a>00921         <span class="keywordflow">return</span> 0;
<a name="l00922"></a>00922 
<a name="l00923"></a>00923     gdk_drawable_get_size ( GDK_DRAWABLE (gtk_tree_view_get_bin_window (tree_view)),
<a name="l00924"></a>00924                             NULL, &amp;height_win);
<a name="l00925"></a>00925     gtk_tree_view_get_background_area (tree_view, path, NULL, &amp;back_rect);
<a name="l00926"></a>00926     gtk_tree_path_free (path);
<a name="l00927"></a>00927 
<a name="l00928"></a>00928     <span class="comment">/* i didn&#39;t find another hack to transform gint to float */</span>
<a name="l00929"></a>00929     height = height_win;
<a name="l00930"></a>00930     rect_y = back_rect.y;
<a name="l00931"></a>00931 
<a name="l00932"></a>00932     row_align = rect_y/height;
<a name="l00933"></a>00933     <span class="keywordflow">return</span> (row_align);
<a name="l00934"></a>00934 }
<a name="l00935"></a>00935 
<a name="l00936"></a>00936 
<a name="l00937"></a>00937 
<a name="l00947"></a><a class="code" href="gsb__transactions__list_8h.html#a6de9b44e088a49d4d6328209a24443c2">00947</a> gboolean <a class="code" href="gsb__transactions__list_8c.html#a6de9b44e088a49d4d6328209a24443c2">gsb_transactions_list_set_row_align</a> ( gfloat row_align )
<a name="l00948"></a>00948 {
<a name="l00949"></a>00949     GtkTreePath *path;
<a name="l00950"></a>00950     gint transaction_number;
<a name="l00951"></a>00951     gint mother_transaction;
<a name="l00952"></a>00952     gint account_number;
<a name="l00953"></a>00953 
<a name="l00954"></a>00954     <span class="comment">/* devel_debug (NULL); */</span>
<a name="l00955"></a>00955 
<a name="l00956"></a>00956     <span class="keywordflow">if</span> ( ( account_number = <a class="code" href="navigation_8c.html#a3b668bf52ce71dcff3ea10c9db7be859">gsb_gui_navigation_get_current_account</a> ( ) ) == -1)
<a name="l00957"></a>00957             <span class="keywordflow">return</span> FALSE;
<a name="l00958"></a>00958 
<a name="l00959"></a>00959     <span class="comment">/* if we just want to let the tree view by himself, it&#39;s here</span>
<a name="l00960"></a>00960 <span class="comment">     * we get the path of the last line in transaction because untill now,</span>
<a name="l00961"></a>00961 <span class="comment">     * we do that when open the form, so only the last line interest us */</span>
<a name="l00962"></a>00962     <span class="keywordflow">if</span> (row_align &lt; 0)
<a name="l00963"></a>00963     {
<a name="l00964"></a>00964         path = <a class="code" href="transaction__list__select_8c.html#ac4dba240fa9e06af594157c07e62c2d8">transaction_list_select_get_path</a> ( <a class="code" href="transaction__list_8c.html#a8a1d86e0958c09384cf1363b0f07eb3b">transaction_list_get_last_line</a> (
<a name="l00965"></a>00965                             <a class="code" href="gsb__data__account_8c.html#a3daed40b7bb578a2e1e3f0b948ea0bf6">gsb_data_account_get_nb_rows</a> ( account_number ) ) );
<a name="l00966"></a>00966         <span class="keywordflow">if</span> ( path )
<a name="l00967"></a>00967         {
<a name="l00968"></a>00968             gtk_tree_view_scroll_to_cell ( GTK_TREE_VIEW (<a class="code" href="gsb__transactions__list_8c.html#a9c93505713234d8fa4727b067a140641">gsb_transactions_list_get_tree_view</a> ()),
<a name="l00969"></a>00969                            path, NULL,
<a name="l00970"></a>00970                            FALSE, 0.0, 0.0 );
<a name="l00971"></a>00971             gtk_tree_path_free (path);
<a name="l00972"></a>00972         }
<a name="l00973"></a>00973         <span class="keywordflow">return</span> FALSE;
<a name="l00974"></a>00974     }
<a name="l00975"></a>00975 
<a name="l00976"></a>00976     <span class="comment">/* ok, we want to use row_align */</span>
<a name="l00977"></a>00977     transaction_number = <a class="code" href="transaction__list__select_8c.html#a0a2effd6ee01ec6f9b848593b797398a">transaction_list_select_get</a> ();
<a name="l00978"></a>00978 
<a name="l00979"></a>00979     <span class="comment">/* if we are on a child, open the mother */</span>
<a name="l00980"></a>00980     mother_transaction = <a class="code" href="gsb__data__transaction_8c.html#a6018560ece7ab02e8d46bc9bdaffd607">gsb_data_transaction_get_mother_transaction_number</a> (transaction_number);
<a name="l00981"></a>00981     <span class="keywordflow">if</span> (mother_transaction)
<a name="l00982"></a>00982             <a class="code" href="gsb__transactions__list_8c.html#a6089f07015c6278f5d0a689783fe4019">gsb_transactions_list_switch_expander</a> (mother_transaction);
<a name="l00983"></a>00983 
<a name="l00984"></a>00984     <span class="comment">/* if we are on white line, go to the end directly,</span>
<a name="l00985"></a>00985 <span class="comment">     * else at the opening, the white line is hidden */</span>
<a name="l00986"></a>00986     <span class="keywordflow">if</span> (transaction_number == -1)
<a name="l00987"></a>00987     {
<a name="l00988"></a>00988         path = <a class="code" href="transaction__list__select_8c.html#ac4dba240fa9e06af594157c07e62c2d8">transaction_list_select_get_path</a> ( <a class="code" href="transaction__list_8c.html#a8a1d86e0958c09384cf1363b0f07eb3b">transaction_list_get_last_line</a> (
<a name="l00989"></a>00989                             <a class="code" href="gsb__data__account_8c.html#a3daed40b7bb578a2e1e3f0b948ea0bf6">gsb_data_account_get_nb_rows</a> ( account_number ) ) );
<a name="l00990"></a>00990         row_align = 1.0;
<a name="l00991"></a>00991     }
<a name="l00992"></a>00992     <span class="keywordflow">else</span>
<a name="l00993"></a>00993             path = <a class="code" href="transaction__list__select_8c.html#ac4dba240fa9e06af594157c07e62c2d8">transaction_list_select_get_path</a> (0);
<a name="l00994"></a>00994 
<a name="l00995"></a>00995     <span class="comment">/* we need to use scroll_to_cell function because at this stade,</span>
<a name="l00996"></a>00996 <span class="comment">     * the tree view is not refreshed so all value with alignment don&#39;t work</span>
<a name="l00997"></a>00997 <span class="comment">     * but scroll_to_cell will place us on the good position despite that */</span>
<a name="l00998"></a>00998     gtk_tree_view_scroll_to_cell ( GTK_TREE_VIEW (<a class="code" href="gsb__transactions__list_8c.html#a9c93505713234d8fa4727b067a140641">gsb_transactions_list_get_tree_view</a> ()),
<a name="l00999"></a>00999                                    path, NULL,
<a name="l01000"></a>01000                                    TRUE, row_align, 0.0 );
<a name="l01001"></a>01001     gtk_tree_path_free (path);
<a name="l01002"></a>01002     <span class="keywordflow">return</span> FALSE;
<a name="l01003"></a>01003 }
<a name="l01004"></a>01004 
<a name="l01005"></a>01005 
<a name="l01006"></a>01006 
<a name="l01014"></a><a class="code" href="gsb__transactions__list_8h.html#a8be7f66c4c8f7c67eb187290c18fb6f7">01014</a> gint <a class="code" href="gsb__transactions__list_8c.html#a8be7f66c4c8f7c67eb187290c18fb6f7">find_element_col</a> ( gint element_number )
<a name="l01015"></a>01015 {
<a name="l01016"></a>01016     gint i, j;
<a name="l01017"></a>01017 
<a name="l01018"></a>01018     <span class="keywordflow">for</span> ( i=0 ; i&lt;<a class="code" href="custom__list_8h.html#a738de041650943c6854c2fa523b2e2e5">TRANSACTION_LIST_ROWS_NB</a> ; i++ )
<a name="l01019"></a>01019     {
<a name="l01020"></a>01020         <span class="keywordflow">for</span> ( j=0 ; j&lt;CUSTOM_MODEL_N_VISIBLES_COLUMN ; j++ )
<a name="l01021"></a>01021         {
<a name="l01022"></a>01022             <span class="keywordflow">if</span> ( <a class="code" href="affichage__liste_8c.html#a0c444565adac369ff42631d4b7b7e6bb">tab_affichage_ope</a>[i][j] == element_number )
<a name="l01023"></a>01023                 <span class="keywordflow">return</span> j;
<a name="l01024"></a>01024         }
<a name="l01025"></a>01025     }
<a name="l01026"></a>01026 
<a name="l01027"></a>01027     <span class="keywordflow">return</span> -1;
<a name="l01028"></a>01028 }
<a name="l01029"></a>01029 
<a name="l01037"></a><a class="code" href="gsb__transactions__list_8h.html#a17bf5dcbc82415220a20244112d65aef">01037</a> gint <a class="code" href="gsb__transactions__list_8c.html#a17bf5dcbc82415220a20244112d65aef">find_element_line</a> ( gint element_number )
<a name="l01038"></a>01038 {
<a name="l01039"></a>01039     gint i, j;
<a name="l01040"></a>01040 
<a name="l01041"></a>01041     <span class="keywordflow">for</span> ( i=0 ; i&lt;<a class="code" href="custom__list_8h.html#a738de041650943c6854c2fa523b2e2e5">TRANSACTION_LIST_ROWS_NB</a> ; i++ )
<a name="l01042"></a>01042     {
<a name="l01043"></a>01043         <span class="keywordflow">for</span> ( j=0 ; j&lt;CUSTOM_MODEL_N_VISIBLES_COLUMN ; j++ )
<a name="l01044"></a>01044         {
<a name="l01045"></a>01045             <span class="keywordflow">if</span> ( <a class="code" href="affichage__liste_8c.html#a0c444565adac369ff42631d4b7b7e6bb">tab_affichage_ope</a>[i][j] == element_number )
<a name="l01046"></a>01046                 <span class="keywordflow">return</span> i;
<a name="l01047"></a>01047         }
<a name="l01048"></a>01048     }
<a name="l01049"></a>01049 
<a name="l01050"></a>01050     <span class="keywordflow">return</span> -1;
<a name="l01051"></a>01051 }
<a name="l01052"></a>01052 
<a name="l01062"></a><a class="code" href="gsb__transactions__list_8h.html#aa33a589932f8d657a321fd0bb5a4447f">01062</a> gint <a class="code" href="gsb__transactions__list_8c.html#aa33a589932f8d657a321fd0bb5a4447f">find_element_col_split</a> ( gint element_number )
<a name="l01063"></a>01063 {
<a name="l01064"></a>01064     <span class="keywordflow">switch</span> (element_number)
<a name="l01065"></a>01065     {
<a name="l01066"></a>01066         <span class="keywordflow">case</span> <a class="code" href="gsb__transactions__list_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57a14d07ec8c3f6be2c40010a64205711be">ELEMENT_CATEGORY</a>:
<a name="l01067"></a>01067             <span class="keywordflow">return</span> <a class="code" href="custom__list_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba88b547dd8c2ed9955f2fc15ffaddf77b">CUSTOM_MODEL_COL_2</a>;
<a name="l01068"></a>01068 
<a name="l01069"></a>01069         <span class="keywordflow">case</span> <a class="code" href="gsb__transactions__list_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57adb5de8e2e54fe03605af16b9eb86452e">ELEMENT_CREDIT</a>:
<a name="l01070"></a>01070             <span class="keywordflow">return</span> <a class="code" href="custom__list_8h.html#a06fc87d81c62e9abb8790b6e5713c55bae24d6b83c76a2a80e03b75b511c337f2">CUSTOM_MODEL_COL_4</a>;
<a name="l01071"></a>01071 
<a name="l01072"></a>01072         <span class="keywordflow">case</span> <a class="code" href="gsb__transactions__list_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57a562334a8510015ee6bd6be39ec899828">ELEMENT_DEBIT</a>:
<a name="l01073"></a>01073             <span class="keywordflow">return</span> <a class="code" href="custom__list_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba61fe3dfa1de31f02d354b1b061d25b03">CUSTOM_MODEL_COL_5</a>;
<a name="l01074"></a>01074     }
<a name="l01075"></a>01075     <span class="keywordflow">return</span> -1;
<a name="l01076"></a>01076 }
<a name="l01077"></a>01077 
<a name="l01078"></a>01078 
<a name="l01079"></a>01079 
<a name="l01080"></a>01080 
<a name="l01087"></a><a class="code" href="gsb__transactions__list_8h.html#ad8b68b6ef2fd8238d726e11c981fc701">01087</a> <a class="code" href="structgsb__real.html">gsb_real</a> <a class="code" href="gsb__transactions__list_8c.html#ad8b68b6ef2fd8238d726e11c981fc701">solde_debut_affichage</a> ( gint account_number,
<a name="l01088"></a>01088                         gint floating_point)
<a name="l01089"></a>01089 {
<a name="l01090"></a>01090     <a class="code" href="structgsb__real.html">gsb_real</a> solde;
<a name="l01091"></a>01091     GSList *list_tmp_transactions;
<a name="l01092"></a>01092 
<a name="l01093"></a>01093     solde = <a class="code" href="gsb__data__account_8c.html#aeef4070a2b411519cf998f79106b6c96">gsb_data_account_get_init_balance</a> ( account_number, floating_point );
<a name="l01094"></a>01094 
<a name="l01095"></a>01095     <span class="keywordflow">if</span> ( <a class="code" href="gsb__data__account_8c.html#acbc8b219af2e0520506d34eded08ad34">gsb_data_account_get_l</a> ( account_number ) == 0 )
<a name="l01096"></a>01096         solde = <a class="code" href="gsb__real_8c.html#a5a3e9b2189f43f10c28333b09179e335">gsb_real_add</a> ( solde,
<a name="l01097"></a>01097                         <a class="code" href="gsb__data__archive__store_8c.html#ac1dc6c9d5f8039ac88d633d3bcbd32a5">gsb_data_archive_store_get_archives_balance</a> ( account_number ) );
<a name="l01098"></a>01098 
<a name="l01099"></a>01099     <span class="keywordflow">if</span> ( <a class="code" href="gsb__data__account_8c.html#aca61a61a56a3e161716a443b366cd899">gsb_data_account_get_r</a> ( account_number ) )
<a name="l01100"></a>01100             <span class="keywordflow">return</span> solde;
<a name="l01101"></a>01101 
<a name="l01102"></a>01102     <span class="comment">/* the marked R transactions are not showed, add their balance to the initial balance */</span>
<a name="l01103"></a>01103     list_tmp_transactions = <a class="code" href="gsb__data__transaction_8c.html#af781a71a62eece020188ef62847f2887">gsb_data_transaction_get_transactions_list</a> ();
<a name="l01104"></a>01104 
<a name="l01105"></a>01105     <span class="keywordflow">while</span> ( list_tmp_transactions )
<a name="l01106"></a>01106     {
<a name="l01107"></a>01107         gint transaction_number_tmp;
<a name="l01108"></a>01108         transaction_number_tmp = <a class="code" href="gsb__data__transaction_8c.html#a99bf548513083f4a71fe019faeccbe0a">gsb_data_transaction_get_transaction_number</a> (
<a name="l01109"></a>01109                         list_tmp_transactions -&gt; data);
<a name="l01110"></a>01110 
<a name="l01111"></a>01111         <span class="comment">/*      si l&#39;opé est ventilée ou non relevée, on saute */</span>
<a name="l01112"></a>01112 
<a name="l01113"></a>01113         <span class="keywordflow">if</span> ( <a class="code" href="gsb__data__transaction_8c.html#a5b486efbc486f946e9c998a114054bce">gsb_data_transaction_get_account_number</a> (transaction_number_tmp) == account_number
<a name="l01114"></a>01114              &amp;&amp;
<a name="l01115"></a>01115              !<a class="code" href="gsb__data__transaction_8c.html#a6018560ece7ab02e8d46bc9bdaffd607">gsb_data_transaction_get_mother_transaction_number</a> (transaction_number_tmp)
<a name="l01116"></a>01116              &amp;&amp;
<a name="l01117"></a>01117              <a class="code" href="gsb__data__transaction_8c.html#a52cf9684818c3930c5c688b54f7cf393">gsb_data_transaction_get_marked_transaction</a> (transaction_number_tmp) == <a class="code" href="gsb__data__transaction_8h.html#a82f385a1c75ac98496b5c09a123bf521a41425f55add3a05ffc4c7aa366048fc9">OPERATION_RAPPROCHEE</a> )
<a name="l01118"></a>01118             solde = <a class="code" href="gsb__real_8c.html#a5a3e9b2189f43f10c28333b09179e335">gsb_real_add</a> ( solde,
<a name="l01119"></a>01119                         <a class="code" href="gsb__data__transaction_8c.html#aa3739bd33106e8dbce2c0938f5f2a882">gsb_data_transaction_get_adjusted_amount</a> ( transaction_number_tmp,
<a name="l01120"></a>01120                         floating_point ) );
<a name="l01121"></a>01121 
<a name="l01122"></a>01122         list_tmp_transactions = list_tmp_transactions -&gt; next;
<a name="l01123"></a>01123     }
<a name="l01124"></a>01124 
<a name="l01125"></a>01125     <span class="keywordflow">return</span> ( solde );
<a name="l01126"></a>01126 }
<a name="l01127"></a>01127 
<a name="l01128"></a>01128 
<a name="l01137"></a>01137 gboolean gsb_transactions_list_button_press ( GtkWidget *tree_view,
<a name="l01138"></a>01138                         GdkEventButton *ev,
<a name="l01139"></a>01139                         gpointer null )
<a name="l01140"></a>01140 {
<a name="l01141"></a>01141     GtkTreeIter iter;
<a name="l01142"></a>01142     GtkTreeModel *model;
<a name="l01143"></a>01143     GtkTreePath *path;
<a name="l01144"></a>01144     GtkTreeViewColumn *tree_column;
<a name="l01145"></a>01145     gpointer transaction_pointer;
<a name="l01146"></a>01146     gint transaction_number, column, line_in_transaction;
<a name="l01147"></a>01147     gint what_is_line;
<a name="l01148"></a>01148 
<a name="l01149"></a>01149     <span class="comment">/*     if we are not in the list, go away */</span>
<a name="l01150"></a>01150     <span class="keywordflow">if</span> ( ev -&gt; <a class="code" href="accueil_8c.html#a3d346c08cf2d67c388caabffb412b293">window</a> != gtk_tree_view_get_bin_window ( GTK_TREE_VIEW ( tree_view )) )
<a name="l01151"></a>01151         <span class="keywordflow">return</span>(FALSE);
<a name="l01152"></a>01152 
<a name="l01153"></a>01153     <span class="comment">/* first, give the focus to the list */</span>
<a name="l01154"></a>01154     gtk_widget_grab_focus (tree_view);
<a name="l01155"></a>01155 
<a name="l01156"></a>01156     <span class="comment">/* get the path,</span>
<a name="l01157"></a>01157 <span class="comment">     * if it&#39;s a right button and we are not in the list, show the partial popup</span>
<a name="l01158"></a>01158 <span class="comment">     * else go away */</span>
<a name="l01159"></a>01159     <span class="keywordflow">if</span> ( !gtk_tree_view_get_path_at_pos ( GTK_TREE_VIEW ( tree_view ),
<a name="l01160"></a>01160                                           ev -&gt; x,
<a name="l01161"></a>01161                                           ev -&gt; y,
<a name="l01162"></a>01162                                           &amp;path,
<a name="l01163"></a>01163                                           &amp;tree_column,
<a name="l01164"></a>01164                                           NULL,
<a name="l01165"></a>01165                                           NULL ))
<a name="l01166"></a>01166     {
<a name="l01167"></a>01167         <span class="comment">/* show the partial popup */</span>
<a name="l01168"></a>01168         <span class="keywordflow">if</span> ( ev -&gt; button == <a class="code" href="mouse_8h.html#aeb17351958162535ab6af2cd6b030955">RIGHT_BUTTON</a> )
<a name="l01169"></a>01169             popup_transaction_context_menu ( FALSE, -1, -1 );
<a name="l01170"></a>01170         <span class="keywordflow">return</span> (TRUE);
<a name="l01171"></a>01171     }
<a name="l01172"></a>01172 
<a name="l01173"></a>01173     <span class="comment">/* ok we are on the list, get the transaction */</span>
<a name="l01174"></a>01174     model = GTK_TREE_MODEL ( <a class="code" href="transaction__model_8c.html#a416a1ee9231b6f7d74d3b0811902163a">transaction_model_get_model</a>());
<a name="l01175"></a>01175 
<a name="l01176"></a>01176     gtk_tree_model_get_iter ( model, &amp;iter, path );
<a name="l01177"></a>01177     gtk_tree_model_get ( model, &amp;iter,
<a name="l01178"></a>01178                          <a class="code" href="custom__list_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba3e7ba59a4063e09dc7bbffdc48a353f6">CUSTOM_MODEL_TRANSACTION_ADDRESS</a>, &amp;transaction_pointer,
<a name="l01179"></a>01179                          <a class="code" href="custom__list_8h.html#a06fc87d81c62e9abb8790b6e5713c55bafd59f664816369fe6dedc31ef6e38779">CUSTOM_MODEL_TRANSACTION_LINE</a>, &amp;line_in_transaction,
<a name="l01180"></a>01180                          <a class="code" href="custom__list_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba0e1303b078e3aed4993a79f04757049d">CUSTOM_MODEL_WHAT_IS_LINE</a>, &amp;what_is_line,
<a name="l01181"></a>01181                          -1 );
<a name="l01182"></a>01182 
<a name="l01183"></a>01183     <span class="comment">/* for now for an archive, check the double-click */</span>
<a name="l01184"></a>01184     <span class="keywordflow">if</span> (what_is_line == <a class="code" href="custom__list_8h.html#a0caea412748bef9b8222da212aaa0069">IS_ARCHIVE</a>)
<a name="l01185"></a>01185     {
<a name="l01186"></a>01186         <span class="keywordflow">if</span> (ev -&gt; type == GDK_2BUTTON_PRESS)
<a name="l01187"></a>01187         {
<a name="l01188"></a>01188             gint archive_number;
<a name="l01189"></a>01189             <span class="keyword">const</span> gchar *<a class="code" href="structconditional__message.html#a28fcfb79edb0fdb1b5ee82ebb118fce8">name</a>;
<a name="l01190"></a>01190 
<a name="l01191"></a>01191             archive_number = <a class="code" href="gsb__data__archive__store_8c.html#aefc4123694ab2b13c39920917b045f18">gsb_data_archive_store_get_archive_number</a> (<a class="code" href="gsb__data__archive__store_8c.html#a33d414762707f17772146fca8dc8db36">gsb_data_archive_store_get_number</a> (transaction_pointer));
<a name="l01192"></a>01192 
<a name="l01193"></a>01193             <span class="comment">/* i don&#39;t know why but i had a crash with a NULL name of archive, so prevent here */</span>
<a name="l01194"></a>01194             name = <a class="code" href="gsb__data__archive_8c.html#ab61c1a7e1814ae6b8d5fd6f54db3606b">gsb_data_archive_get_name</a> (archive_number);
<a name="l01195"></a>01195             <span class="keywordflow">if</span> (name)
<a name="l01196"></a>01196             {
<a name="l01197"></a>01197                 gchar* tmpstr = g_strdup_printf (
<a name="l01198"></a>01198                         _(<span class="stringliteral">&quot;Do you want to add the transactions of the archive %s &quot;</span>
<a name="l01199"></a>01199                         <span class="stringliteral">&quot;into the list ?&quot;</span>),
<a name="l01200"></a>01200                         name );
<a name="l01201"></a>01201                 <span class="keywordflow">if</span> (<a class="code" href="dialog_8c.html#ae0381692a8f62bcab164df4cf39cca9f">question_yes_no</a> ( tmpstr , GTK_RESPONSE_CANCEL ))
<a name="l01202"></a>01202                     <a class="code" href="gsb__transactions__list_8c.html#afb50643bfc50dcd627a5f720c30c8765">gsb_transactions_list_restore_archive</a> (archive_number, TRUE);
<a name="l01203"></a>01203                 g_free(tmpstr);
<a name="l01204"></a>01204             }
<a name="l01205"></a>01205             <span class="keywordflow">else</span>
<a name="l01206"></a>01206             {
<a name="l01207"></a>01207                 <span class="keywordflow">if</span> (archive_number)
<a name="l01208"></a>01208                     <a class="code" href="erreur_8h.html#a70b10c07513d0694ee36dcdcb1696949">warning_debug</a> ( _(<span class="stringliteral">&quot;An archive was clicked but Grisbi is unable to get the name. &quot;</span>
<a name="l01209"></a>01209                         <span class="stringliteral">&quot;It seems like a bug.\nPlease try to reproduce and contact the &quot;</span>
<a name="l01210"></a>01210                         <span class="stringliteral">&quot;Grisbi team.&quot;</span>) );
<a name="l01211"></a>01211                 <span class="keywordflow">else</span>
<a name="l01212"></a>01212                     <a class="code" href="erreur_8h.html#a70b10c07513d0694ee36dcdcb1696949">warning_debug</a> ( _(<span class="stringliteral">&quot;An archive was clicked but it seems to have the number 0, &quot;</span>
<a name="l01213"></a>01213                         <span class="stringliteral">&quot;wich should not happen.\nPlease try to reproduce and contact &quot;</span>
<a name="l01214"></a>01214                         <span class="stringliteral">&quot;the Grisbi team.&quot;</span>) );
<a name="l01215"></a>01215             }
<a name="l01216"></a>01216         }
<a name="l01217"></a>01217         <span class="keywordflow">return</span> FALSE;
<a name="l01218"></a>01218     }
<a name="l01219"></a>01219 
<a name="l01220"></a>01220     <span class="comment">/* it&#39;s not an archive, so it&#39;s a transaction and select it */</span>
<a name="l01221"></a>01221     transaction_number = <a class="code" href="gsb__data__transaction_8c.html#a99bf548513083f4a71fe019faeccbe0a">gsb_data_transaction_get_transaction_number</a> (transaction_pointer);
<a name="l01222"></a>01222     <a class="code" href="transaction__list__select_8c.html#a85f38a439156b883335de73220dca237">transaction_list_select</a> ( transaction_number );
<a name="l01223"></a>01223 
<a name="l01224"></a>01224     <span class="comment">/* get the column */</span>
<a name="l01225"></a>01225     column = g_list_index ( gtk_tree_view_get_columns ( GTK_TREE_VIEW ( tree_view )),
<a name="l01226"></a>01226                             tree_column );
<a name="l01227"></a>01227 
<a name="l01228"></a>01228     <span class="comment">/*     if it&#39;s the right click, show the good popup */</span>
<a name="l01229"></a>01229     <span class="keywordflow">if</span> ( ev -&gt; button == <a class="code" href="mouse_8h.html#aeb17351958162535ab6af2cd6b030955">RIGHT_BUTTON</a> )
<a name="l01230"></a>01230     {
<a name="l01231"></a>01231         <span class="keywordflow">if</span> ( transaction_number == -1)
<a name="l01232"></a>01232             popup_transaction_context_menu ( FALSE, -1, -1 );
<a name="l01233"></a>01233         <span class="keywordflow">else</span>
<a name="l01234"></a>01234             popup_transaction_context_menu ( TRUE, column, line_in_transaction );
<a name="l01235"></a>01235         <span class="keywordflow">return</span>(TRUE);
<a name="l01236"></a>01236     }
<a name="l01237"></a>01237 
<a name="l01238"></a>01238     <span class="comment">/*     check if we press on the mark */</span>
<a name="l01239"></a>01239     <span class="keywordflow">if</span> ( transaction_number != -1
<a name="l01240"></a>01240          &amp;&amp;
<a name="l01241"></a>01241          column == <a class="code" href="gsb__transactions__list_8c.html#a8be7f66c4c8f7c67eb187290c18fb6f7">find_element_col</a> (<a class="code" href="gsb__transactions__list_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57a1c9bb425c66169e4464498e2d76c6f00">ELEMENT_MARK</a>)
<a name="l01242"></a>01242          &amp;&amp;
<a name="l01243"></a>01243          (( <a class="code" href="parametres_8c.html#ab2a744f5d2124688473d13979420e911">etat</a>.<a class="code" href="structgsb__etat__t.html#ae3a5af3d26105e740e989e5c6804bab2">equilibrage</a>
<a name="l01244"></a>01244             &amp;&amp;
<a name="l01245"></a>01245             line_in_transaction == <a class="code" href="gsb__transactions__list_8c.html#a17bf5dcbc82415220a20244112d65aef">find_element_line</a> (<a class="code" href="gsb__transactions__list_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57a1c9bb425c66169e4464498e2d76c6f00">ELEMENT_MARK</a>))
<a name="l01246"></a>01246           ||
<a name="l01247"></a>01247           (( ev -&gt; state &amp; GDK_CONTROL_MASK ) == GDK_CONTROL_MASK )))
<a name="l01248"></a>01248     {
<a name="l01249"></a>01249         gsb_transactions_list_switch_mark (transaction_number);
<a name="l01250"></a>01250     <a class="code" href="transaction__list_8c.html#a59ee075b27fa18fb9691201b52ec6692">transaction_list_set_balances</a> ( );
<a name="l01251"></a>01251         <span class="keywordflow">return</span> TRUE;
<a name="l01252"></a>01252     }
<a name="l01253"></a>01253 
<a name="l01254"></a>01254     <span class="comment">/*  if double - click */</span>
<a name="l01255"></a>01255     <span class="keywordflow">if</span> ( ev -&gt; type == GDK_2BUTTON_PRESS )
<a name="l01256"></a>01256         <a class="code" href="gsb__transactions__list_8c.html#a01ca41bdcf1f932ae3a4289433d64cf5">gsb_transactions_list_edit_transaction</a> (transaction_number);
<a name="l01257"></a>01257 
<a name="l01258"></a>01258     <span class="comment">/* have to return FALSE to continue the signal and open eventually</span>
<a name="l01259"></a>01259 <span class="comment">     * a child in the tree... but returning FALSE make the selection slower...</span>
<a name="l01260"></a>01260 <span class="comment">     * so check here x of mouse, if &lt;16, so at left of list, perhaps it&#39;s</span>
<a name="l01261"></a>01261 <span class="comment">     * for open a child, so return FALSE, in other case return TRUE because</span>
<a name="l01262"></a>01262 <span class="comment">     * much much faster.*/</span>
<a name="l01263"></a>01263     <span class="keywordflow">if</span> ( ev -&gt; x &lt;16 )
<a name="l01264"></a>01264         <span class="keywordflow">return</span> FALSE;
<a name="l01265"></a>01265 
<a name="l01266"></a>01266     <span class="keywordflow">return</span> TRUE;
<a name="l01267"></a>01267 }
<a name="l01268"></a>01268 
<a name="l01269"></a>01269 
<a name="l01274"></a>01274 gboolean gsb_transactions_list_key_press ( GtkWidget *widget,
<a name="l01275"></a>01275                         GdkEventKey *ev )
<a name="l01276"></a>01276 {
<a name="l01277"></a>01277     gint account_number;
<a name="l01278"></a>01278     gint transaction_number;
<a name="l01279"></a>01279 
<a name="l01280"></a>01280     account_number = <a class="code" href="navigation_8c.html#a3b668bf52ce71dcff3ea10c9db7be859">gsb_gui_navigation_get_current_account</a> ();
<a name="l01281"></a>01281 
<a name="l01282"></a>01282     <span class="keywordflow">switch</span> ( ev -&gt; keyval )
<a name="l01283"></a>01283     {
<a name="l01284"></a>01284     <span class="keywordflow">case</span> GDK_Return :   <span class="comment">/* entrée */</span>
<a name="l01285"></a>01285     <span class="keywordflow">case</span> GDK_KP_Enter :
<a name="l01286"></a>01286     <span class="keywordflow">case</span> GDK_Tab :
<a name="l01287"></a>01287 
<a name="l01288"></a>01288         <a class="code" href="gsb__transactions__list_8c.html#a01ca41bdcf1f932ae3a4289433d64cf5">gsb_transactions_list_edit_transaction</a> (
<a name="l01289"></a>01289                         <a class="code" href="gsb__data__account_8c.html#a6596a8dca0eaab412a036d23cb51a5b0">gsb_data_account_get_current_transaction_number</a> ( account_number ) );
<a name="l01290"></a>01290         <span class="keywordflow">break</span>;
<a name="l01291"></a>01291 
<a name="l01292"></a>01292     <span class="keywordflow">case</span> GDK_Up :       <span class="comment">/* touches flèche haut */</span>
<a name="l01293"></a>01293     <span class="keywordflow">case</span> GDK_KP_Up :
<a name="l01294"></a>01294 
<a name="l01295"></a>01295         <a class="code" href="transaction__list__select_8c.html#afe4cb2b4907b0146fd152277511c5653">transaction_list_select_up</a> (FALSE);
<a name="l01296"></a>01296         <span class="keywordflow">break</span>;
<a name="l01297"></a>01297 
<a name="l01298"></a>01298     <span class="keywordflow">case</span> GDK_Down :     <span class="comment">/* touches flèche bas */</span>
<a name="l01299"></a>01299     <span class="keywordflow">case</span> GDK_KP_Down :
<a name="l01300"></a>01300 
<a name="l01301"></a>01301         <a class="code" href="transaction__list__select_8c.html#aad826f93d59044effba7ca1c31eccabb">transaction_list_select_down</a> (FALSE);
<a name="l01302"></a>01302         <span class="keywordflow">break</span>;
<a name="l01303"></a>01303 
<a name="l01304"></a>01304     <span class="keywordflow">case</span> GDK_Delete:    <span class="comment">/*  del  */</span>
<a name="l01305"></a>01305         <a class="code" href="gsb__transactions__list_8c.html#ab0651c16a8ca47b70e7ccdb2d9c18ba1">gsb_transactions_list_delete_transaction</a> (
<a name="l01306"></a>01306                         <a class="code" href="gsb__data__account_8c.html#a6596a8dca0eaab412a036d23cb51a5b0">gsb_data_account_get_current_transaction_number</a> ( account_number ),
<a name="l01307"></a>01307                         TRUE );
<a name="l01308"></a>01308         <span class="keywordflow">break</span>;
<a name="l01309"></a>01309 
<a name="l01310"></a>01310     <span class="keywordflow">case</span> GDK_P:         <span class="comment">/* touche P */</span>
<a name="l01311"></a>01311     <span class="keywordflow">case</span> GDK_p:         <span class="comment">/* touche p */</span>
<a name="l01312"></a>01312     <span class="keywordflow">case</span> GDK_F12:       <span class="comment">/* touche F12 pour pointer dépointer comme avec &lt;ctrl&gt;p*/</span> 
<a name="l01313"></a>01313 
<a name="l01314"></a>01314         <span class="keywordflow">if</span> ( ( ev -&gt; state &amp; GDK_CONTROL_MASK ) == GDK_CONTROL_MASK
<a name="l01315"></a>01315             ||
<a name="l01316"></a>01316             ev -&gt; keyval == GDK_F12 )
<a name="l01317"></a>01317         {
<a name="l01318"></a>01318             gsb_transactions_list_switch_mark (
<a name="l01319"></a>01319                         <a class="code" href="gsb__data__account_8c.html#a6596a8dca0eaab412a036d23cb51a5b0">gsb_data_account_get_current_transaction_number</a> ( account_number ) );
<a name="l01320"></a>01320             <a class="code" href="transaction__list_8c.html#a59ee075b27fa18fb9691201b52ec6692">transaction_list_set_balances</a> ( );
<a name="l01321"></a>01321         }
<a name="l01322"></a>01322         <span class="keywordflow">break</span>;
<a name="l01323"></a>01323 
<a name="l01324"></a>01324     <span class="keywordflow">case</span> GDK_r:         <span class="comment">/* touche r */</span>
<a name="l01325"></a>01325     <span class="keywordflow">case</span> GDK_R:         <span class="comment">/* touche R */</span>
<a name="l01326"></a>01326 
<a name="l01327"></a>01327         <span class="keywordflow">if</span> ( ( ev -&gt; state &amp; GDK_CONTROL_MASK ) == GDK_CONTROL_MASK )
<a name="l01328"></a>01328         {
<a name="l01329"></a>01329             gsb_transactions_list_switch_R_mark (
<a name="l01330"></a>01330                             <a class="code" href="gsb__data__account_8c.html#a6596a8dca0eaab412a036d23cb51a5b0">gsb_data_account_get_current_transaction_number</a> ( account_number ) );
<a name="l01331"></a>01331             <a class="code" href="transaction__list_8c.html#a59ee075b27fa18fb9691201b52ec6692">transaction_list_set_balances</a> ( );
<a name="l01332"></a>01332         }
<a name="l01333"></a>01333         <span class="keywordflow">break</span>;
<a name="l01334"></a>01334 
<a name="l01335"></a>01335     <span class="keywordflow">case</span> GDK_t:         <span class="comment">/* touche t */</span>
<a name="l01336"></a>01336     <span class="keywordflow">case</span> GDK_T:         <span class="comment">/* touche T */</span>
<a name="l01337"></a>01337         <a class="code" href="transaction__list__select_8c.html#a85f38a439156b883335de73220dca237">transaction_list_select</a> ( -1 );
<a name="l01338"></a>01338         <span class="keywordflow">break</span>;
<a name="l01339"></a>01339 
<a name="l01340"></a>01340     <span class="keywordflow">case</span> GDK_space:
<a name="l01341"></a>01341         transaction_number = <a class="code" href="gsb__data__account_8c.html#a6596a8dca0eaab412a036d23cb51a5b0">gsb_data_account_get_current_transaction_number</a> ( account_number );
<a name="l01342"></a>01342         <span class="keywordflow">if</span> ( transaction_number &gt; 0 )
<a name="l01343"></a>01343         {
<a name="l01344"></a>01344         <span class="keywordflow">if</span> ( <a class="code" href="parametres_8c.html#ab2a744f5d2124688473d13979420e911">etat</a>.<a class="code" href="structgsb__etat__t.html#ae3a5af3d26105e740e989e5c6804bab2">equilibrage</a> )
<a name="l01345"></a>01345         {
<a name="l01346"></a>01346             <span class="comment">/* we are reconciling, so mark/unmark the transaction */</span>
<a name="l01347"></a>01347             gsb_transactions_list_switch_mark ( transaction_number );
<a name="l01348"></a>01348             <a class="code" href="transaction__list__select_8c.html#aad826f93d59044effba7ca1c31eccabb">transaction_list_select_down</a> ( FALSE );
<a name="l01349"></a>01349         }
<a name="l01350"></a>01350         <span class="keywordflow">else</span>
<a name="l01351"></a>01351             <span class="comment">/* space open/close a split */</span>
<a name="l01352"></a>01352             <a class="code" href="gsb__transactions__list_8c.html#a6089f07015c6278f5d0a689783fe4019">gsb_transactions_list_switch_expander</a> ( transaction_number );
<a name="l01353"></a>01353         }
<a name="l01354"></a>01354         <span class="keywordflow">break</span>;
<a name="l01355"></a>01355 
<a name="l01356"></a>01356     <span class="keywordflow">case</span> GDK_Left:
<a name="l01357"></a>01357         <span class="comment">/* if we press left, give back the focus to the tree at left */</span>
<a name="l01358"></a>01358         gtk_widget_grab_focus ( <a class="code" href="etats__config_8c.html#a1cd17e8b2fd91a191f8d5d6a7e5f6979">navigation_tree_view</a> );
<a name="l01359"></a>01359         <span class="keywordflow">break</span>;
<a name="l01360"></a>01360     }
<a name="l01361"></a>01361 
<a name="l01362"></a>01362     <span class="keywordflow">return</span> TRUE;
<a name="l01363"></a>01363 }
<a name="l01364"></a>01364 
<a name="l01365"></a>01365 
<a name="l01374"></a><a class="code" href="gsb__transactions__list_8h.html#a2528e018beffeb0d2ce2f2386e690360">01374</a> <span class="keywordtype">void</span> <a class="code" href="gsb__transactions__list_8c.html#a2528e018beffeb0d2ce2f2386e690360">gsb_transactions_list_selection_changed</a> ( gint new_selected_transaction )
<a name="l01375"></a>01375 {
<a name="l01376"></a>01376     gint account_number;
<a name="l01377"></a>01377 
<a name="l01378"></a>01378     <a class="code" href="erreur_8h.html#a10f4eeae4cc251a8d632fd62ec1057fb">devel_debug_int</a> (new_selected_transaction);
<a name="l01379"></a>01379 
<a name="l01380"></a>01380     <span class="comment">/* the white number has no account number, so we take the current account */</span>
<a name="l01381"></a>01381     <span class="keywordflow">if</span> ( new_selected_transaction != -1 )
<a name="l01382"></a>01382     {
<a name="l01383"></a>01383     account_number = <a class="code" href="gsb__data__transaction_8c.html#a5b486efbc486f946e9c998a114054bce">gsb_data_transaction_get_account_number</a> (new_selected_transaction);
<a name="l01384"></a>01384     <a class="code" href="menu_8c.html#a2cd0fa9a87d28146f743c30d75c3ee00">gsb_menu_transaction_operations_set_sensitive</a> ( TRUE );
<a name="l01385"></a>01385     }
<a name="l01386"></a>01386     <span class="keywordflow">else</span>
<a name="l01387"></a>01387     {
<a name="l01388"></a>01388     account_number = <a class="code" href="navigation_8c.html#a3b668bf52ce71dcff3ea10c9db7be859">gsb_gui_navigation_get_current_account</a> ();
<a name="l01389"></a>01389     <a class="code" href="menu_8c.html#a2cd0fa9a87d28146f743c30d75c3ee00">gsb_menu_transaction_operations_set_sensitive</a> ( FALSE );
<a name="l01390"></a>01390     }
<a name="l01391"></a>01391 
<a name="l01392"></a>01392     <span class="comment">/* save the new current transaction */</span>
<a name="l01393"></a>01393     <a class="code" href="gsb__data__account_8c.html#ab22a22f66d9be40495e220aa93b3a700">gsb_data_account_set_current_transaction_number</a> ( account_number,
<a name="l01394"></a>01394                         new_selected_transaction);
<a name="l01395"></a>01395 
<a name="l01396"></a>01396     <span class="comment">/* show the content of the transaction in the form,</span>
<a name="l01397"></a>01397 <span class="comment">     * only if the form is shown */</span>
<a name="l01398"></a>01398     <span class="keywordflow">if</span> ( <a class="code" href="gsb__file__config_8c.html#ac390e947e97cef2bec2f5d59d6ec1071">conf</a>.<a class="code" href="structgsb__conf__t.html#a2e6917fe4ddb0d329be926062c2cccbd">show_transaction_selected_in_form</a>
<a name="l01399"></a>01399     &amp;&amp;
<a name="l01400"></a>01400     <a class="code" href="gsb__form_8c.html#aa8d4c0a5ce5d891427405bcc9ce9372e">gsb_form_is_visible</a> () )
<a name="l01401"></a>01401         <a class="code" href="gsb__form_8c.html#af0e251779d36898a65c54b5a51d700f2">gsb_form_fill_by_transaction</a> (new_selected_transaction, TRUE, FALSE);
<a name="l01402"></a>01402 
<a name="l01403"></a>01403     <span class="comment">/* give the focus to the transaction_tree_view pbiava 02/09/2009 </span>
<a name="l01404"></a>01404 <span class="comment">     * edit due to a regression loss of &lt;CtrlR&gt; */</span>
<a name="l01405"></a>01405     <span class="keywordflow">if</span> ( transactions_tree_view )
<a name="l01406"></a>01406         gtk_widget_grab_focus ( transactions_tree_view );
<a name="l01407"></a>01407 }
<a name="l01408"></a>01408 
<a name="l01409"></a>01409 
<a name="l01410"></a>01410 
<a name="l01411"></a>01411 
<a name="l01419"></a><a class="code" href="gsb__transactions__list_8h.html#a01ca41bdcf1f932ae3a4289433d64cf5">01419</a> gboolean <a class="code" href="gsb__transactions__list_8c.html#a01ca41bdcf1f932ae3a4289433d64cf5">gsb_transactions_list_edit_transaction</a> ( gint transaction_number )
<a name="l01420"></a>01420 {
<a name="l01421"></a>01421     <a class="code" href="erreur_8h.html#a10f4eeae4cc251a8d632fd62ec1057fb">devel_debug_int</a> (transaction_number);
<a name="l01422"></a>01422 
<a name="l01423"></a>01423     <a class="code" href="navigation_8c.html#a3fb9bd34026d724eefe1309fb63bf8fc">gsb_gui_navigation_set_selection</a> ( <a class="code" href="fenetre__principale_8h.html#a1667fdc1081851887c24c98c97d51767aa0842b1ab75cc108643f94f240f11905">GSB_ACCOUNT_PAGE</a>,
<a name="l01424"></a>01424                         <a class="code" href="gsb__data__transaction_8c.html#a5b486efbc486f946e9c998a114054bce">gsb_data_transaction_get_account_number</a> ( transaction_number ),
<a name="l01425"></a>01425                         NULL );
<a name="l01426"></a>01426     <a class="code" href="transaction__list__select_8c.html#a85f38a439156b883335de73220dca237">transaction_list_select</a> ( transaction_number );
<a name="l01427"></a>01427     <a class="code" href="gsb__form_8c.html#af0e251779d36898a65c54b5a51d700f2">gsb_form_fill_by_transaction</a> ( transaction_number, TRUE, TRUE );
<a name="l01428"></a>01428 
<a name="l01429"></a>01429     <span class="keywordflow">return</span> FALSE;
<a name="l01430"></a>01430 }
<a name="l01431"></a>01431 
<a name="l01432"></a>01432 
<a name="l01441"></a><a class="code" href="gsb__transactions__list_8h.html#a586edcd7d904b6fd75ab87544f8609fa">01441</a> gboolean <a class="code" href="gsb__transactions__list_8c.html#a586edcd7d904b6fd75ab87544f8609fa">gsb_transactions_list_edit_transaction_by_pointer</a> ( gint *transaction_number )
<a name="l01442"></a>01442 {
<a name="l01443"></a>01443     <a class="code" href="erreur_8h.html#a10f4eeae4cc251a8d632fd62ec1057fb">devel_debug_int</a> (GPOINTER_TO_INT (transaction_number));
<a name="l01444"></a>01444     <a class="code" href="gsb__transactions__list_8c.html#a01ca41bdcf1f932ae3a4289433d64cf5">gsb_transactions_list_edit_transaction</a> ( GPOINTER_TO_INT (transaction_number));
<a name="l01445"></a>01445     <span class="keywordflow">return</span> FALSE;
<a name="l01446"></a>01446 }
<a name="l01447"></a>01447 
<a name="l01448"></a>01448 
<a name="l01449"></a>01449 
<a name="l01457"></a><a class="code" href="gsb__transactions__list_8h.html#a78ae21515e884855e82af687571bb3c2">01457</a> gboolean <a class="code" href="gsb__transactions__list_8c.html#a78ae21515e884855e82af687571bb3c2">gsb_transactions_list_edit_current_transaction</a> ( <span class="keywordtype">void</span> )
<a name="l01458"></a>01458 {
<a name="l01459"></a>01459     <a class="code" href="erreur_8h.html#a17bfffc4306bc76edd79e060a8947dc4">devel_debug</a> (NULL);
<a name="l01460"></a>01460     <a class="code" href="gsb__transactions__list_8c.html#a01ca41bdcf1f932ae3a4289433d64cf5">gsb_transactions_list_edit_transaction</a> (<a class="code" href="gsb__data__account_8c.html#a6596a8dca0eaab412a036d23cb51a5b0">gsb_data_account_get_current_transaction_number</a> (<a class="code" href="navigation_8c.html#a3b668bf52ce71dcff3ea10c9db7be859">gsb_gui_navigation_get_current_account</a> ()));
<a name="l01461"></a>01461     <span class="keywordflow">return</span> FALSE;
<a name="l01462"></a>01462 }
<a name="l01463"></a>01463 
<a name="l01464"></a>01464 
<a name="l01465"></a>01465 
<a name="l01475"></a>01475 gboolean gsb_transactions_list_switch_mark ( gint transaction_number )
<a name="l01476"></a>01476 {
<a name="l01477"></a>01477     gint col;
<a name="l01478"></a>01478     <a class="code" href="structgsb__real.html">gsb_real</a> amount;
<a name="l01479"></a>01479     gint account_number;
<a name="l01480"></a>01480 
<a name="l01481"></a>01481     <a class="code" href="erreur_8h.html#a10f4eeae4cc251a8d632fd62ec1057fb">devel_debug_int</a> (transaction_number);
<a name="l01482"></a>01482 
<a name="l01483"></a>01483     <span class="comment">/* if no P/R column, cannot really mark/unmark the transaction... */</span>
<a name="l01484"></a>01484     col = <a class="code" href="gsb__transactions__list_8c.html#a8be7f66c4c8f7c67eb187290c18fb6f7">find_element_col</a> (<a class="code" href="gsb__transactions__list_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57a1c9bb425c66169e4464498e2d76c6f00">ELEMENT_MARK</a>);
<a name="l01485"></a>01485     <span class="keywordflow">if</span> ( col == -1 )
<a name="l01486"></a>01486             <span class="keywordflow">return</span> FALSE;
<a name="l01487"></a>01487 
<a name="l01488"></a>01488     <span class="comment">/* if we are on the white line, a R transaction or a child of split, do nothing */</span>
<a name="l01489"></a>01489     <span class="keywordflow">if</span> ( transaction_number == -1
<a name="l01490"></a>01490          ||
<a name="l01491"></a>01491          <a class="code" href="gsb__data__transaction_8c.html#a52cf9684818c3930c5c688b54f7cf393">gsb_data_transaction_get_marked_transaction</a> (transaction_number)== <a class="code" href="gsb__data__transaction_8h.html#a82f385a1c75ac98496b5c09a123bf521a41425f55add3a05ffc4c7aa366048fc9">OPERATION_RAPPROCHEE</a>
<a name="l01492"></a>01492          ||
<a name="l01493"></a>01493          <a class="code" href="gsb__data__transaction_8c.html#a6018560ece7ab02e8d46bc9bdaffd607">gsb_data_transaction_get_mother_transaction_number</a> (transaction_number))
<a name="l01494"></a>01494         <span class="keywordflow">return</span> FALSE;
<a name="l01495"></a>01495 
<a name="l01496"></a>01496     account_number = <a class="code" href="navigation_8c.html#a3b668bf52ce71dcff3ea10c9db7be859">gsb_gui_navigation_get_current_account</a> ();
<a name="l01497"></a>01497     amount = <a class="code" href="gsb__data__transaction_8c.html#aa3739bd33106e8dbce2c0938f5f2a882">gsb_data_transaction_get_adjusted_amount</a> (transaction_number, -1);
<a name="l01498"></a>01498 
<a name="l01499"></a>01499     <span class="keywordflow">if</span> (<a class="code" href="gsb__data__transaction_8c.html#a52cf9684818c3930c5c688b54f7cf393">gsb_data_transaction_get_marked_transaction</a> (transaction_number))
<a name="l01500"></a>01500     {
<a name="l01501"></a>01501         <a class="code" href="gsb__data__transaction_8c.html#ad6f2f1403737959c3aee7059b7115399">gsb_data_transaction_set_marked_transaction</a> ( transaction_number,
<a name="l01502"></a>01502                                   <a class="code" href="gsb__data__transaction_8h.html#a82f385a1c75ac98496b5c09a123bf521a10e43b2cd416b38f68109a4898d3080e">OPERATION_NORMALE</a> );
<a name="l01503"></a>01503     }
<a name="l01504"></a>01504     <span class="keywordflow">else</span>
<a name="l01505"></a>01505     {
<a name="l01506"></a>01506         <a class="code" href="gsb__data__transaction_8c.html#ad6f2f1403737959c3aee7059b7115399">gsb_data_transaction_set_marked_transaction</a> ( transaction_number,
<a name="l01507"></a>01507                                   <a class="code" href="gsb__data__transaction_8h.html#a82f385a1c75ac98496b5c09a123bf521a0d2386ee3dfac40bf6fa775bc7d6325e">OPERATION_POINTEE</a> );
<a name="l01508"></a>01508     }
<a name="l01509"></a>01509 
<a name="l01510"></a>01510     <a class="code" href="transaction__list_8c.html#a7530aa4be260035a39dc5de2acbb8f62">transaction_list_update_transaction</a> (transaction_number);
<a name="l01511"></a>01511 
<a name="l01512"></a>01512     <span class="comment">/* if it&#39;s a split, set the mark to the children */</span>
<a name="l01513"></a>01513     <span class="keywordflow">if</span> ( <a class="code" href="gsb__data__transaction_8c.html#a2de1ba38ee196b44e3c00c10e1d645cc">gsb_data_transaction_get_split_of_transaction</a> ( transaction_number))
<a name="l01514"></a>01514     {
<a name="l01515"></a>01515         GSList *list_tmp_transactions;
<a name="l01516"></a>01516         gint mark;
<a name="l01517"></a>01517 
<a name="l01518"></a>01518         mark = <a class="code" href="gsb__data__transaction_8c.html#a52cf9684818c3930c5c688b54f7cf393">gsb_data_transaction_get_marked_transaction</a> ( transaction_number);
<a name="l01519"></a>01519         list_tmp_transactions = <a class="code" href="gsb__data__transaction_8c.html#af781a71a62eece020188ef62847f2887">gsb_data_transaction_get_transactions_list</a> ();
<a name="l01520"></a>01520 
<a name="l01521"></a>01521         <span class="keywordflow">while</span> ( list_tmp_transactions )
<a name="l01522"></a>01522         {
<a name="l01523"></a>01523             gint transaction_number_tmp;
<a name="l01524"></a>01524             transaction_number_tmp = <a class="code" href="gsb__data__transaction_8c.html#a99bf548513083f4a71fe019faeccbe0a">gsb_data_transaction_get_transaction_number</a> (list_tmp_transactions -&gt; data);
<a name="l01525"></a>01525 
<a name="l01526"></a>01526             <span class="keywordflow">if</span> ( <a class="code" href="gsb__data__transaction_8c.html#a6018560ece7ab02e8d46bc9bdaffd607">gsb_data_transaction_get_mother_transaction_number</a> (transaction_number_tmp) == transaction_number)
<a name="l01527"></a>01527                 <a class="code" href="gsb__data__transaction_8c.html#ad6f2f1403737959c3aee7059b7115399">gsb_data_transaction_set_marked_transaction</a> ( transaction_number_tmp,
<a name="l01528"></a>01528                                                               mark );
<a name="l01529"></a>01529             list_tmp_transactions = list_tmp_transactions -&gt; next;
<a name="l01530"></a>01530         }
<a name="l01531"></a>01531     }
<a name="l01532"></a>01532 
<a name="l01533"></a>01533     <span class="comment">/* if we are reconciling, update the amounts label */</span>
<a name="l01534"></a>01534     <span class="keywordflow">if</span> ( <a class="code" href="parametres_8c.html#ab2a744f5d2124688473d13979420e911">etat</a>.<a class="code" href="structgsb__etat__t.html#ae3a5af3d26105e740e989e5c6804bab2">equilibrage</a> )
<a name="l01535"></a>01535     {
<a name="l01536"></a>01536     <span class="comment">/* pbiava 02/12/2009 : shows the balance after you mark the transaction */</span>
<a name="l01537"></a>01537     <a class="code" href="transaction__list_8c.html#a59ee075b27fa18fb9691201b52ec6692">transaction_list_set_balances</a> (  );
<a name="l01538"></a>01538         <a class="code" href="gsb__reconcile_8c.html#ad4e6ccb1415c9f71f856acbb73ce8be3">gsb_reconcile_update_amounts</a> (NULL, NULL);
<a name="l01539"></a>01539     }
<a name="l01540"></a>01540     <span class="comment">/* need to update the marked amount on the home page */</span>
<a name="l01541"></a>01541     <a class="code" href="navigation_8c.html#a342b7c00db1370b25971fbc56df7b02e">gsb_navigation_update_statement_label</a> ( account_number );
<a name="l01542"></a>01542     <a class="code" href="accueil_8c.html#a018917e8dacfd8fbe4e94d0f99a59c08">mise_a_jour_liste_comptes_accueil</a> = 1;
<a name="l01543"></a>01543 
<a name="l01544"></a>01544     <span class="keywordflow">if</span> ( <a class="code" href="parametres_8c.html#ab2a744f5d2124688473d13979420e911">etat</a>.<a class="code" href="structgsb__etat__t.html#a9d0fa9057da603e64a601d69d7bf2b51">modification_fichier</a> == 0 )
<a name="l01545"></a>01545         <a class="code" href="traitement__variables_8c.html#aa4084b9e508b1d1fea1d09c6b6208021">modification_fichier</a> ( TRUE );
<a name="l01546"></a>01546 
<a name="l01547"></a>01547     <span class="keywordflow">return</span> FALSE;
<a name="l01548"></a>01548 }
<a name="l01549"></a>01549 
<a name="l01550"></a>01550 
<a name="l01564"></a>01564 gboolean gsb_transactions_list_switch_R_mark ( gint transaction_number )
<a name="l01565"></a>01565 {
<a name="l01566"></a>01566     <a class="code" href="structgsb__real.html">gsb_real</a> amount;
<a name="l01567"></a>01567     gint account_number;
<a name="l01568"></a>01568     GtkTreeIter iter;
<a name="l01569"></a>01569     gint r_column;
<a name="l01570"></a>01570     GtkTreeModel *model;
<a name="l01571"></a>01571     gint msg_no = 0;
<a name="l01572"></a>01572     gchar *tmp_str;
<a name="l01573"></a>01573 
<a name="l01574"></a>01574     r_column = <a class="code" href="gsb__transactions__list_8c.html#a8be7f66c4c8f7c67eb187290c18fb6f7">find_element_col</a> (<a class="code" href="gsb__transactions__list_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57a1c9bb425c66169e4464498e2d76c6f00">ELEMENT_MARK</a>);
<a name="l01575"></a>01575     <span class="keywordflow">if</span> ( r_column == -1 )
<a name="l01576"></a>01576         <span class="keywordflow">return</span> FALSE;
<a name="l01577"></a>01577 
<a name="l01578"></a>01578     <span class="comment">/* if we are on the white line or a child of split, do nothing */</span>
<a name="l01579"></a>01579     <span class="keywordflow">if</span> ( transaction_number == -1 )
<a name="l01580"></a>01580         <span class="keywordflow">return</span> FALSE;
<a name="l01581"></a>01581 
<a name="l01582"></a>01582     <span class="comment">/* if we are reconciling, cancel the action */</span>
<a name="l01583"></a>01583     <span class="keywordflow">if</span> (<a class="code" href="parametres_8c.html#ab2a744f5d2124688473d13979420e911">etat</a>.<a class="code" href="structgsb__etat__t.html#ae3a5af3d26105e740e989e5c6804bab2">equilibrage</a>)
<a name="l01584"></a>01584     {
<a name="l01585"></a>01585         <a class="code" href="dialog_8c.html#aa88d9d93c78818a177e9a14eff15f360">dialogue_error</a> ( _(<span class="stringliteral">&quot;You cannot switch a transaction between R and non R &quot;</span>
<a name="l01586"></a>01586                          <span class="stringliteral">&quot;while reconciling.\nPlease finish or cancel the &quot;</span>
<a name="l01587"></a>01587                          <span class="stringliteral">&quot;reconciliation first.&quot;</span>) );
<a name="l01588"></a>01588         <span class="keywordflow">return</span> FALSE;
<a name="l01589"></a>01589     }
<a name="l01590"></a>01590 
<a name="l01591"></a>01591     <span class="comment">/* if it&#39;s a child, we ask if we want to work with the mother */</span>
<a name="l01592"></a>01592     <span class="keywordflow">if</span> (<a class="code" href="gsb__data__transaction_8c.html#a6018560ece7ab02e8d46bc9bdaffd607">gsb_data_transaction_get_mother_transaction_number</a> (transaction_number))
<a name="l01593"></a>01593     {
<a name="l01594"></a>01594         msg_no = <a class="code" href="dialog_8c.html#ac46f7502c30130a2c344685a46638d2e">question_conditional_yes_no_get_no_struct</a> ( &amp;<a class="code" href="dialog_8c.html#a430b9f94c0af809780196ca7d7040fde">messages</a>[0],
<a name="l01595"></a>01595                         <span class="stringliteral">&quot;reconcile-transaction&quot;</span> );
<a name="l01596"></a>01596         tmp_str = g_strdup_printf ( 
<a name="l01597"></a>01597                                    _(<span class="stringliteral">&quot;You are trying to reconcile or unreconcile a transaction manually, &quot;</span>
<a name="l01598"></a>01598                                      <span class="stringliteral">&quot;which is not a recommended action.This is the wrong approach.\n\n&quot;</span>
<a name="l01599"></a>01599                                      <span class="stringliteral">&quot;And moreover the transaction you try to reconcile is a child of split, so &quot;</span>
<a name="l01600"></a>01600                                      <span class="stringliteral">&quot;the modification will be done on the mother and all its children.\n\n&quot;</span>
<a name="l01601"></a>01601                                      <span class="stringliteral">&quot;Are you really sure to know what you do?&quot;</span>) );
<a name="l01602"></a>01602         <a class="code" href="dialog_8c.html#a430b9f94c0af809780196ca7d7040fde">messages</a>[msg_no].<a class="code" href="structconditional__message.html#a1ac78264fd28b6819d5bfaa1e9b0ef39">message</a> = tmp_str;
<a name="l01603"></a>01603         <span class="keywordflow">if</span> ( <a class="code" href="dialog_8c.html#acdc10d7ad7ab05de8c606827a1126034">question_conditional_yes_no_with_struct</a> ( &amp;<a class="code" href="dialog_8c.html#a430b9f94c0af809780196ca7d7040fde">messages</a>[msg_no] ) )
<a name="l01604"></a>01604         {
<a name="l01605"></a>01605             <span class="comment">/* he says ok, so transaction_number becomes the mother */</span>
<a name="l01606"></a>01606             transaction_number = <a class="code" href="gsb__data__transaction_8c.html#a6018560ece7ab02e8d46bc9bdaffd607">gsb_data_transaction_get_mother_transaction_number</a> (
<a name="l01607"></a>01607                         transaction_number );
<a name="l01608"></a>01608             g_free ( tmp_str );
<a name="l01609"></a>01609         }
<a name="l01610"></a>01610             <span class="keywordflow">else</span>
<a name="l01611"></a>01611         {
<a name="l01612"></a>01612             g_free ( tmp_str );
<a name="l01613"></a>01613                 <span class="keywordflow">return</span> FALSE;
<a name="l01614"></a>01614         }
<a name="l01615"></a>01615     }
<a name="l01616"></a>01616     <span class="keywordflow">else</span>
<a name="l01617"></a>01617             <span class="comment">/* it&#39;s a normal transaction, ask to be sure */</span>
<a name="l01618"></a>01618         <span class="keywordflow">if</span> ( !<a class="code" href="dialog_8c.html#a757c418753eff02db57f09f216befbdf">question_conditional_yes_no</a> ( <span class="stringliteral">&quot;reconcile-transaction&quot;</span> ) )
<a name="l01619"></a>01619                 <span class="keywordflow">return</span> FALSE;
<a name="l01620"></a>01620 
<a name="l01621"></a>01621     model = GTK_TREE_MODEL (<a class="code" href="transaction__model_8c.html#a416a1ee9231b6f7d74d3b0811902163a">transaction_model_get_model</a>());
<a name="l01622"></a>01622 
<a name="l01623"></a>01623     <span class="keywordflow">if</span> (!<a class="code" href="transaction__model_8c.html#af10137737c1d42087c8fed2fa2d8c9ee">transaction_model_get_transaction_iter</a> ( &amp;iter,
<a name="l01624"></a>01624                                                   transaction_number, 0))
<a name="l01625"></a>01625         <span class="keywordflow">return</span> FALSE;
<a name="l01626"></a>01626 
<a name="l01627"></a>01627     account_number = <a class="code" href="navigation_8c.html#a3b668bf52ce71dcff3ea10c9db7be859">gsb_gui_navigation_get_current_account</a> ();
<a name="l01628"></a>01628     amount = <a class="code" href="gsb__data__transaction_8c.html#aa3739bd33106e8dbce2c0938f5f2a882">gsb_data_transaction_get_adjusted_amount</a> (transaction_number, -1);
<a name="l01629"></a>01629 
<a name="l01630"></a>01630     <span class="keywordflow">if</span> ( <a class="code" href="gsb__data__transaction_8c.html#a52cf9684818c3930c5c688b54f7cf393">gsb_data_transaction_get_marked_transaction</a> ( transaction_number) == <a class="code" href="gsb__data__transaction_8h.html#a82f385a1c75ac98496b5c09a123bf521a41425f55add3a05ffc4c7aa366048fc9">OPERATION_RAPPROCHEE</a>)
<a name="l01631"></a>01631     {
<a name="l01632"></a>01632         <span class="comment">/* ok, this is a R transaction, we just un-R it but keep the reconcile_number into the transaction */</span>
<a name="l01633"></a>01633         <a class="code" href="gsb__data__transaction_8c.html#ad6f2f1403737959c3aee7059b7115399">gsb_data_transaction_set_marked_transaction</a> ( transaction_number,
<a name="l01634"></a>01634                                                       <a class="code" href="gsb__data__transaction_8h.html#a82f385a1c75ac98496b5c09a123bf521a10e43b2cd416b38f68109a4898d3080e">OPERATION_NORMALE</a> );
<a name="l01635"></a>01635         <a class="code" href="transaction__list_8c.html#ab23532a1ddd63489aaf16011032bd09b">transaction_list_set</a> ( &amp;iter, r_column, NULL, -1 );
<a name="l01636"></a>01636     }
<a name="l01637"></a>01637     <span class="keywordflow">else</span>
<a name="l01638"></a>01638     {
<a name="l01639"></a>01639         <span class="comment">/* this is a non R transaction we want to mark R</span>
<a name="l01640"></a>01640 <span class="comment">         * we show a list of possible reconcile to the user ; he must</span>
<a name="l01641"></a>01641 <span class="comment">         * associate the transaction with a reconcile */</span>
<a name="l01642"></a>01642         gint reconcile_number;
<a name="l01643"></a>01643 
<a name="l01644"></a>01644         reconcile_number = gsb_transactions_list_choose_reconcile ( account_number,
<a name="l01645"></a>01645                                                 <a class="code" href="gsb__data__transaction_8c.html#a1f902ce2841e41d3eda536f2fdd3c32f">gsb_data_transaction_get_reconcile_number</a> (transaction_number));
<a name="l01646"></a>01646         <span class="keywordflow">if</span> (!reconcile_number)
<a name="l01647"></a>01647             <span class="keywordflow">return</span> FALSE;
<a name="l01648"></a>01648 
<a name="l01649"></a>01649         <a class="code" href="gsb__data__transaction_8c.html#ad6f2f1403737959c3aee7059b7115399">gsb_data_transaction_set_marked_transaction</a> ( transaction_number,
<a name="l01650"></a>01650                                                       <a class="code" href="gsb__data__transaction_8h.html#a82f385a1c75ac98496b5c09a123bf521a41425f55add3a05ffc4c7aa366048fc9">OPERATION_RAPPROCHEE</a> );
<a name="l01651"></a>01651         <a class="code" href="gsb__data__transaction_8c.html#ab8a486754eb6b78bc3eaf156de7cec3f">gsb_data_transaction_set_reconcile_number</a> ( transaction_number,
<a name="l01652"></a>01652                                                     reconcile_number );
<a name="l01653"></a>01653 
<a name="l01654"></a>01654         <span class="comment">/* set the R on the transaction */</span>
<a name="l01655"></a>01655         <a class="code" href="transaction__list_8c.html#ab23532a1ddd63489aaf16011032bd09b">transaction_list_set</a> ( &amp;iter, r_column, g_strdup ( _(<span class="stringliteral">&quot;R&quot;</span>) ), -1 );
<a name="l01656"></a>01656 
<a name="l01657"></a>01657         <span class="comment">/* if we don&#39;t want to see the marked R transactions, we re-filter the model */</span>
<a name="l01658"></a>01658         <span class="keywordflow">if</span> ( !<a class="code" href="gsb__data__account_8c.html#aca61a61a56a3e161716a443b366cd899">gsb_data_account_get_r</a> (account_number) )
<a name="l01659"></a>01659         {
<a name="l01660"></a>01660             <a class="code" href="transaction__list__select_8c.html#aad826f93d59044effba7ca1c31eccabb">transaction_list_select_down</a> (FALSE);
<a name="l01661"></a>01661             <a class="code" href="gsb__data__account_8c.html#ab22a22f66d9be40495e220aa93b3a700">gsb_data_account_set_current_transaction_number</a> ( account_number,
<a name="l01662"></a>01662                                                               <a class="code" href="transaction__list__select_8c.html#a0a2effd6ee01ec6f9b848593b797398a">transaction_list_select_get</a> ());
<a name="l01663"></a>01663             <a class="code" href="gsb__transactions__list_8c.html#ab7d08f59bcf7149edda9db47e67333a4">gsb_transactions_list_update_tree_view</a> (account_number, TRUE);
<a name="l01664"></a>01664 
<a name="l01665"></a>01665             <span class="comment">/* we warn the user the transaction disappear</span>
<a name="l01666"></a>01666 <span class="comment">             * don&#39;t laugh ! there were several bugs reports about a transaction wich disappear :-) */</span>
<a name="l01667"></a>01667             <a class="code" href="dialog_8c.html#a1ae76010f96aab227a640333d3933277">dialogue_hint</a> ( _(<span class="stringliteral">&quot;The transaction has disappear from the list...\nDon&#39;t worry, it&#39;s because you marked it as R, and you choosed not to show the R transactions into the list ; show them if you want to check what you did.&quot;</span>),
<a name="l01668"></a>01668                            _(<span class="stringliteral">&quot;Marking a transaction as R&quot;</span>));
<a name="l01669"></a>01669         }
<a name="l01670"></a>01670     }
<a name="l01671"></a>01671 
<a name="l01672"></a>01672     <span class="comment">/* if it&#39;s a split, set the mark to the children */</span>
<a name="l01673"></a>01673     <span class="keywordflow">if</span> ( <a class="code" href="gsb__data__transaction_8c.html#a2de1ba38ee196b44e3c00c10e1d645cc">gsb_data_transaction_get_split_of_transaction</a> (transaction_number))
<a name="l01674"></a>01674     {
<a name="l01675"></a>01675         GSList *list_tmp_transactions;
<a name="l01676"></a>01676         gint mark;
<a name="l01677"></a>01677 
<a name="l01678"></a>01678         mark = <a class="code" href="gsb__data__transaction_8c.html#a52cf9684818c3930c5c688b54f7cf393">gsb_data_transaction_get_marked_transaction</a> ( transaction_number);
<a name="l01679"></a>01679         list_tmp_transactions = <a class="code" href="gsb__data__transaction_8c.html#af781a71a62eece020188ef62847f2887">gsb_data_transaction_get_transactions_list</a> ();
<a name="l01680"></a>01680 
<a name="l01681"></a>01681         <span class="keywordflow">while</span> ( list_tmp_transactions )
<a name="l01682"></a>01682         {
<a name="l01683"></a>01683             gint transaction_number_tmp;
<a name="l01684"></a>01684             transaction_number_tmp = <a class="code" href="gsb__data__transaction_8c.html#a99bf548513083f4a71fe019faeccbe0a">gsb_data_transaction_get_transaction_number</a> (list_tmp_transactions -&gt; data);
<a name="l01685"></a>01685 
<a name="l01686"></a>01686             <span class="keywordflow">if</span> ( <a class="code" href="gsb__data__transaction_8c.html#a5b486efbc486f946e9c998a114054bce">gsb_data_transaction_get_account_number</a> (transaction_number_tmp) == account_number
<a name="l01687"></a>01687                  &amp;&amp;
<a name="l01688"></a>01688                  <a class="code" href="gsb__data__transaction_8c.html#a6018560ece7ab02e8d46bc9bdaffd607">gsb_data_transaction_get_mother_transaction_number</a> (transaction_number_tmp) == transaction_number)
<a name="l01689"></a>01689                 <a class="code" href="gsb__data__transaction_8c.html#ad6f2f1403737959c3aee7059b7115399">gsb_data_transaction_set_marked_transaction</a> ( transaction_number_tmp,
<a name="l01690"></a>01690                                                               mark );
<a name="l01691"></a>01691 
<a name="l01692"></a>01692             list_tmp_transactions = list_tmp_transactions -&gt; next;
<a name="l01693"></a>01693         }
<a name="l01694"></a>01694         <a class="code" href="transaction__list_8c.html#aee9667138888c4cb946225cae2972363">transaction_list_update_element</a> ( <a class="code" href="gsb__transactions__list_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57a1c9bb425c66169e4464498e2d76c6f00">ELEMENT_MARK</a> );
<a name="l01695"></a>01695     }
<a name="l01696"></a>01696     <span class="comment">/* need to update the marked amount on the home page */</span>
<a name="l01697"></a>01697     <a class="code" href="accueil_8c.html#a018917e8dacfd8fbe4e94d0f99a59c08">mise_a_jour_liste_comptes_accueil</a> = 1;
<a name="l01698"></a>01698 
<a name="l01699"></a>01699     <span class="keywordflow">if</span> ( <a class="code" href="parametres_8c.html#ab2a744f5d2124688473d13979420e911">etat</a>.<a class="code" href="structgsb__etat__t.html#a9d0fa9057da603e64a601d69d7bf2b51">modification_fichier</a> == 0 )
<a name="l01700"></a>01700         <a class="code" href="traitement__variables_8c.html#aa4084b9e508b1d1fea1d09c6b6208021">modification_fichier</a> ( TRUE );
<a name="l01701"></a>01701 
<a name="l01702"></a>01702     <span class="keywordflow">return</span> FALSE;
<a name="l01703"></a>01703 }
<a name="l01704"></a>01704 
<a name="l01705"></a>01705 
<a name="l01715"></a>01715 gint gsb_transactions_list_choose_reconcile ( gint account_number,
<a name="l01716"></a>01716                         gint selected_reconcile_number )
<a name="l01717"></a>01717 {
<a name="l01718"></a>01718     GtkWidget *dialog;
<a name="l01719"></a>01719     GtkWidget *tree_view;
<a name="l01720"></a>01720     GtkListStore *store;
<a name="l01721"></a>01721     GtkWidget *label;
<a name="l01722"></a>01722     GtkWidget *scrolled_window;
<a name="l01723"></a>01723     gint return_value;
<a name="l01724"></a>01724     GList *tmp_list;
<a name="l01725"></a>01725     gint i;
<a name="l01726"></a>01726     <span class="keyword">enum</span> reconcile_choose_column {
<a name="l01727"></a>01727         RECONCILE_CHOOSE_NAME = 0,
<a name="l01728"></a>01728         RECONCILE_CHOOSE_INIT_DATE,
<a name="l01729"></a>01729         RECONCILE_CHOOSE_FINAL_DATE,
<a name="l01730"></a>01730         RECONCILE_NUMBER,
<a name="l01731"></a>01731         RECONCILE_NB_COL };
<a name="l01732"></a>01732     GtkTreeSelection *selection;
<a name="l01733"></a>01733     GtkTreeIter iter;
<a name="l01734"></a>01734     gint reconcile_number;
<a name="l01735"></a>01735 
<a name="l01736"></a>01736     dialog = gtk_dialog_new_with_buttons ( _(<span class="stringliteral">&quot;Selection of a reconciliation&quot;</span>),
<a name="l01737"></a>01737                                            GTK_WINDOW ( <a class="code" href="accueil_8c.html#a3d346c08cf2d67c388caabffb412b293">window</a> ),
<a name="l01738"></a>01738                                            GTK_DIALOG_MODAL,
<a name="l01739"></a>01739                                            GTK_STOCK_CANCEL, GTK_RESPONSE_CANCEL,
<a name="l01740"></a>01740                                            GTK_STOCK_OK, GTK_RESPONSE_OK,
<a name="l01741"></a>01741                                            NULL );
<a name="l01742"></a>01742 
<a name="l01743"></a>01743     gtk_window_set_default_size ( GTK_WINDOW ( dialog ), 770, 412 );
<a name="l01744"></a>01744     gtk_window_set_position ( GTK_WINDOW ( dialog ), GTK_WIN_POS_CENTER_ON_PARENT );
<a name="l01745"></a>01745     gtk_window_set_resizable ( GTK_WINDOW ( dialog ), TRUE );
<a name="l01746"></a>01746     gtk_container_set_border_width ( GTK_CONTAINER ( dialog ), 12 );
<a name="l01747"></a>01747 
<a name="l01748"></a>01748     label = gtk_label_new (<a class="code" href="structures_8h.html#aaad3270d56994a956f6956f142c1c103">COLON</a>(_(<span class="stringliteral">&quot;Select the reconciliation to associate to the selected transaction&quot;</span>)));
<a name="l01749"></a>01749     gtk_misc_set_alignment ( GTK_MISC ( label ), 0.0, 0.0 );
<a name="l01750"></a>01750     gtk_box_pack_start ( GTK_BOX (GTK_DIALOG (dialog) -&gt; vbox),
<a name="l01751"></a>01751                          label,
<a name="l01752"></a>01752                          FALSE, FALSE, 10 );
<a name="l01753"></a>01753     gtk_widget_show (label);
<a name="l01754"></a>01754 
<a name="l01755"></a>01755     scrolled_window = gtk_scrolled_window_new (FALSE, FALSE);
<a name="l01756"></a>01756     gtk_scrolled_window_set_policy ( GTK_SCROLLED_WINDOW (scrolled_window),
<a name="l01757"></a>01757                                      GTK_POLICY_AUTOMATIC,
<a name="l01758"></a>01758                                      GTK_POLICY_AUTOMATIC );
<a name="l01759"></a>01759     gtk_box_pack_start ( GTK_BOX (GTK_DIALOG (dialog) -&gt; vbox),
<a name="l01760"></a>01760                          scrolled_window,
<a name="l01761"></a>01761                          TRUE, TRUE, 0 );
<a name="l01762"></a>01762     gtk_widget_show (scrolled_window);
<a name="l01763"></a>01763 
<a name="l01764"></a>01764     <span class="comment">/* set up the tree view */</span>
<a name="l01765"></a>01765     store = gtk_list_store_new ( RECONCILE_NB_COL,
<a name="l01766"></a>01766                                  G_TYPE_STRING,
<a name="l01767"></a>01767                                  G_TYPE_STRING,
<a name="l01768"></a>01768                                  G_TYPE_STRING,
<a name="l01769"></a>01769                                  G_TYPE_INT );
<a name="l01770"></a>01770     tree_view = gtk_tree_view_new_with_model (GTK_TREE_MODEL (store));
<a name="l01771"></a>01771     g_object_unref ( G_OBJECT(store) );
<a name="l01772"></a>01772     gtk_tree_view_set_rules_hint (GTK_TREE_VIEW (tree_view), TRUE);
<a name="l01773"></a>01773     gtk_tree_selection_set_mode ( gtk_tree_view_get_selection (GTK_TREE_VIEW (tree_view)),
<a name="l01774"></a>01774                                   GTK_SELECTION_SINGLE );
<a name="l01775"></a>01775     gtk_container_add ( GTK_CONTAINER (scrolled_window),
<a name="l01776"></a>01776                         tree_view );
<a name="l01777"></a>01777     gtk_widget_show (tree_view);
<a name="l01778"></a>01778 
<a name="l01779"></a>01779     <span class="comment">/* set the columns */</span>
<a name="l01780"></a>01780     <span class="keywordflow">for</span> (i=RECONCILE_CHOOSE_NAME ; i&lt;RECONCILE_NUMBER ; i++)
<a name="l01781"></a>01781     {
<a name="l01782"></a>01782         GtkTreeViewColumn *column;
<a name="l01783"></a>01783         GtkCellRenderer *cell;
<a name="l01784"></a>01784         gchar *titles[] = {
<a name="l01785"></a>01785             _(<span class="stringliteral">&quot;Name&quot;</span>), _(<span class="stringliteral">&quot;Init date&quot;</span>), _(<span class="stringliteral">&quot;Final date&quot;</span>)
<a name="l01786"></a>01786         };
<a name="l01787"></a>01787         gfloat alignment[] = {
<a name="l01788"></a>01788             <a class="code" href="gsb__transactions__list_8h.html#a6af7ccb9deda7edaeea9ca8bfc7c6b37">COLUMN_LEFT</a>, <a class="code" href="gsb__transactions__list_8h.html#a1acc57689f7f1675288fb8a4b29fb4e7">COLUMN_CENTER</a>, COLUMN_CENTER
<a name="l01789"></a>01789         };
<a name="l01790"></a>01790 
<a name="l01791"></a>01791         cell = gtk_cell_renderer_text_new ();
<a name="l01792"></a>01792         g_object_set ( G_OBJECT (cell),
<a name="l01793"></a>01793                        <span class="stringliteral">&quot;xalign&quot;</span>, alignment[i],
<a name="l01794"></a>01794                        NULL );
<a name="l01795"></a>01795         column = gtk_tree_view_column_new ();
<a name="l01796"></a>01796         gtk_tree_view_column_set_sizing ( column,
<a name="l01797"></a>01797                                           GTK_TREE_VIEW_COLUMN_AUTOSIZE );
<a name="l01798"></a>01798         gtk_tree_view_column_set_alignment ( column,
<a name="l01799"></a>01799                                              alignment[i] );
<a name="l01800"></a>01800         gtk_tree_view_column_pack_start ( column, cell, TRUE );
<a name="l01801"></a>01801         gtk_tree_view_column_set_title ( column, titles[i] );
<a name="l01802"></a>01802         gtk_tree_view_column_set_attributes (column, cell,
<a name="l01803"></a>01803                                              <span class="stringliteral">&quot;text&quot;</span>, i,
<a name="l01804"></a>01804                                              NULL);
<a name="l01805"></a>01805         gtk_tree_view_column_set_expand ( column, TRUE );
<a name="l01806"></a>01806         gtk_tree_view_column_set_resizable ( column,
<a name="l01807"></a>01807                                              TRUE );
<a name="l01808"></a>01808         gtk_tree_view_append_column ( GTK_TREE_VIEW(tree_view), column);
<a name="l01809"></a>01809     }
<a name="l01810"></a>01810 
<a name="l01811"></a>01811     <span class="comment">/* get the tree view selection here to select the good reconcile */</span>
<a name="l01812"></a>01812     selection = gtk_tree_view_get_selection (GTK_TREE_VIEW (tree_view));
<a name="l01813"></a>01813 
<a name="l01814"></a>01814     <span class="comment">/* fill the list */</span>
<a name="l01815"></a>01815     tmp_list = <a class="code" href="gsb__data__reconcile_8c.html#aa78fc612a3b6c450f074b879633c6db3">gsb_data_reconcile_get_reconcile_list</a> ();
<a name="l01816"></a>01816     <span class="keywordflow">while</span> (tmp_list)
<a name="l01817"></a>01817     {
<a name="l01818"></a>01818         reconcile_number = <a class="code" href="gsb__data__reconcile_8c.html#a834a5ace0380c21559fb87cb88f7da80">gsb_data_reconcile_get_no_reconcile</a> (tmp_list -&gt; data);
<a name="l01819"></a>01819 
<a name="l01820"></a>01820         <span class="keywordflow">if</span> (<a class="code" href="gsb__data__reconcile_8c.html#a57f4a52c653f13e27564fc8ff2b4350b">gsb_data_reconcile_get_account</a> (reconcile_number) == account_number)
<a name="l01821"></a>01821         {
<a name="l01822"></a>01822             gchar *init_date, *final_date;
<a name="l01823"></a>01823 
<a name="l01824"></a>01824             init_date = <a class="code" href="utils__dates_8c.html#a6e7537390d7569da5efc74f96ea57da7">gsb_format_gdate</a> (<a class="code" href="gsb__data__reconcile_8c.html#a34a53feb10b93744a7230407d599b788">gsb_data_reconcile_get_init_date</a> (reconcile_number));
<a name="l01825"></a>01825             final_date = <a class="code" href="utils__dates_8c.html#a6e7537390d7569da5efc74f96ea57da7">gsb_format_gdate</a> (<a class="code" href="gsb__data__reconcile_8c.html#ac2e105ad149161a371283aa75049d3b6">gsb_data_reconcile_get_final_date</a> (reconcile_number));
<a name="l01826"></a>01826 
<a name="l01827"></a>01827             gtk_list_store_append ( GTK_LIST_STORE (store),
<a name="l01828"></a>01828                                     &amp;iter );
<a name="l01829"></a>01829             gtk_list_store_set ( GTK_LIST_STORE (store),
<a name="l01830"></a>01830                                  &amp;iter,
<a name="l01831"></a>01831                                  RECONCILE_CHOOSE_NAME, <a class="code" href="gsb__data__reconcile_8c.html#a0f88a3f39b7944967f373097fe9d1474">gsb_data_reconcile_get_name</a> (reconcile_number),
<a name="l01832"></a>01832                                  RECONCILE_CHOOSE_INIT_DATE, init_date,
<a name="l01833"></a>01833                                  RECONCILE_CHOOSE_FINAL_DATE, final_date,
<a name="l01834"></a>01834                                  RECONCILE_NUMBER, reconcile_number,
<a name="l01835"></a>01835                                  -1 );
<a name="l01836"></a>01836             g_free (init_date);
<a name="l01837"></a>01837             g_free (final_date);
<a name="l01838"></a>01838 
<a name="l01839"></a>01839             <span class="comment">/* if we are on the reconcile to select, do it here */</span>
<a name="l01840"></a>01840             <span class="keywordflow">if</span> (selected_reconcile_number == reconcile_number)
<a name="l01841"></a>01841                 gtk_tree_selection_select_iter ( selection,
<a name="l01842"></a>01842                                                  &amp;iter );
<a name="l01843"></a>01843         }
<a name="l01844"></a>01844         tmp_list = tmp_list -&gt; next;
<a name="l01845"></a>01845     }
<a name="l01846"></a>01846 
<a name="l01847"></a>01847     <span class="comment">/* run the dialog */</span>
<a name="l01848"></a>01848     return_value = gtk_dialog_run (GTK_DIALOG (dialog));
<a name="l01849"></a>01849 
<a name="l01850"></a>01850     <span class="keywordflow">if</span> (return_value != GTK_RESPONSE_OK)
<a name="l01851"></a>01851     {
<a name="l01852"></a>01852         gtk_widget_destroy (dialog);
<a name="l01853"></a>01853         <span class="keywordflow">return</span> 0;
<a name="l01854"></a>01854     }
<a name="l01855"></a>01855 
<a name="l01856"></a>01856     <span class="keywordflow">if</span> (gtk_tree_selection_get_selected ( GTK_TREE_SELECTION (selection),
<a name="l01857"></a>01857                                           NULL,
<a name="l01858"></a>01858                                           &amp;iter))
<a name="l01859"></a>01859     {
<a name="l01860"></a>01860         <span class="comment">/* ok, we have a selection */</span>
<a name="l01861"></a>01861 
<a name="l01862"></a>01862         gtk_tree_model_get ( GTK_TREE_MODEL (store),
<a name="l01863"></a>01863                              &amp;iter,
<a name="l01864"></a>01864                              RECONCILE_NUMBER, &amp;reconcile_number,
<a name="l01865"></a>01865                              -1 );
<a name="l01866"></a>01866         gtk_widget_destroy (dialog);
<a name="l01867"></a>01867         <span class="keywordflow">return</span> reconcile_number;
<a name="l01868"></a>01868     }
<a name="l01869"></a>01869 
<a name="l01870"></a>01870     <a class="code" href="dialog_8c.html#aa88d9d93c78818a177e9a14eff15f360">dialogue_error</a> ( _(<span class="stringliteral">&quot;Grisbi couldn&#39;t get the selection, operation canceled...&quot;</span>));
<a name="l01871"></a>01871     gtk_widget_destroy (dialog);
<a name="l01872"></a>01872     <span class="keywordflow">return</span> 0;
<a name="l01873"></a>01873 }
<a name="l01874"></a>01874 
<a name="l01875"></a>01875 
<a name="l01876"></a>01876 
<a name="l01888"></a><a class="code" href="gsb__transactions__list_8h.html#ab0651c16a8ca47b70e7ccdb2d9c18ba1">01888</a> gboolean <a class="code" href="gsb__transactions__list_8c.html#ab0651c16a8ca47b70e7ccdb2d9c18ba1">gsb_transactions_list_delete_transaction</a> ( gint transaction_number,
<a name="l01889"></a>01889                         gint show_warning )
<a name="l01890"></a>01890 {
<a name="l01891"></a>01891     gchar *tmpstr;
<a name="l01892"></a>01892     gint account_number;
<a name="l01893"></a>01893     gint msg_no = 0;
<a name="l01894"></a>01894 
<a name="l01895"></a>01895     <a class="code" href="erreur_8h.html#a10f4eeae4cc251a8d632fd62ec1057fb">devel_debug_int</a> (transaction_number);
<a name="l01896"></a>01896 
<a name="l01897"></a>01897     <span class="comment">/* we cannot delete the general white line (-1), but all the others white lines are possibles</span>
<a name="l01898"></a>01898 <span class="comment">     * if show_warning it FALSE (ie this is automatic, and not done by user action */</span>
<a name="l01899"></a>01899     <span class="keywordflow">if</span> ( !transaction_number
<a name="l01900"></a>01900          ||
<a name="l01901"></a>01901          transaction_number == -1 )
<a name="l01902"></a>01902         <span class="keywordflow">return</span> FALSE;
<a name="l01903"></a>01903 
<a name="l01904"></a>01904     <span class="comment">/* if we cannot ask for a white line, so this shouldn&#39;t append,</span>
<a name="l01905"></a>01905 <span class="comment">     * if we want to delete a child white line, show_warning must be FALSE (force) */</span>
<a name="l01906"></a>01906     <span class="keywordflow">if</span> ( show_warning
<a name="l01907"></a>01907          &amp;&amp;
<a name="l01908"></a>01908          transaction_number &lt; 0 )
<a name="l01909"></a>01909         <span class="keywordflow">return</span> FALSE;
<a name="l01910"></a>01910 
<a name="l01911"></a>01911     <span class="comment">/* if the transaction is archived, cannot delete it */</span>
<a name="l01912"></a>01912     <span class="keywordflow">if</span> (<a class="code" href="gsb__data__transaction_8c.html#a5dfc3ab337c363b46380bf962a97d8d2">gsb_data_transaction_get_archive_number</a> (transaction_number))
<a name="l01913"></a>01913     {
<a name="l01914"></a>01914         <a class="code" href="dialog_8c.html#aa88d9d93c78818a177e9a14eff15f360">dialogue_error</a> ( _(<span class="stringliteral">&quot;Impossible to delete an archived transaction.&quot;</span>) );
<a name="l01915"></a>01915         <span class="keywordflow">return</span> FALSE;
<a name="l01916"></a>01916     }
<a name="l01917"></a>01917 
<a name="l01918"></a>01918     account_number = <a class="code" href="gsb__data__transaction_8c.html#a5b486efbc486f946e9c998a114054bce">gsb_data_transaction_get_account_number</a> (transaction_number);
<a name="l01919"></a>01919 
<a name="l01920"></a>01920     <span class="comment">/* check if the transaction is not reconciled */</span>
<a name="l01921"></a>01921     <span class="keywordflow">if</span> ( gsb_transactions_list_check_mark (transaction_number))
<a name="l01922"></a>01922     {
<a name="l01923"></a>01923         <a class="code" href="dialog_8c.html#aa88d9d93c78818a177e9a14eff15f360">dialogue_error</a> ( _(<span class="stringliteral">&quot;Impossible to delete a reconciled transaction.\nThe transaction, &quot;</span>
<a name="l01924"></a>01924                         <span class="stringliteral">&quot;the contra-transaction or the children if it is a split are &quot;</span>
<a name="l01925"></a>01925                         <span class="stringliteral">&quot;reconciled. You can remove the reconciliation with Ctrl R if &quot;</span>
<a name="l01926"></a>01926                         <span class="stringliteral">&quot;it is really necessary.&quot;</span>) );
<a name="l01927"></a>01927         <span class="keywordflow">return</span> FALSE;
<a name="l01928"></a>01928     }
<a name="l01929"></a>01929 
<a name="l01930"></a>01930     <span class="comment">/* show a warning */</span>
<a name="l01931"></a>01931     <span class="keywordflow">if</span> (show_warning)
<a name="l01932"></a>01932     {
<a name="l01933"></a>01933         <span class="keywordflow">if</span> (<a class="code" href="gsb__data__transaction_8c.html#a6018560ece7ab02e8d46bc9bdaffd607">gsb_data_transaction_get_mother_transaction_number</a> (transaction_number))
<a name="l01934"></a>01934         {
<a name="l01935"></a>01935             msg_no = <a class="code" href="dialog_8c.html#ac46f7502c30130a2c344685a46638d2e">question_conditional_yes_no_get_no_struct</a> ( &amp;delete_msg[0],
<a name="l01936"></a>01936                         <span class="stringliteral">&quot;delete-child-transaction&quot;</span> );
<a name="l01937"></a>01937             tmpstr = g_strdup_printf (
<a name="l01938"></a>01938                         _(<span class="stringliteral">&quot;Do you really want to delete the child of the transaction &quot;</span>
<a name="l01939"></a>01939                         <span class="stringliteral">&quot;with party &#39;%s&#39; ?&quot;</span>),
<a name="l01940"></a>01940                         <a class="code" href="gsb__data__payee_8c.html#adc6080b7376628d3902f5fd861deb45a">gsb_data_payee_get_name</a> (
<a name="l01941"></a>01941                         <a class="code" href="gsb__data__transaction_8c.html#afa032df45afa2ad7a4be48449a7e8d15">gsb_data_transaction_get_party_number</a> ( transaction_number ),
<a name="l01942"></a>01942                         FALSE ) );
<a name="l01943"></a>01943             delete_msg[msg_no].<a class="code" href="structconditional__message.html#a1ac78264fd28b6819d5bfaa1e9b0ef39">message</a> = tmpstr;
<a name="l01944"></a>01944         }
<a name="l01945"></a>01945         <span class="keywordflow">else</span>
<a name="l01946"></a>01946         {
<a name="l01947"></a>01947             msg_no = <a class="code" href="dialog_8c.html#ac46f7502c30130a2c344685a46638d2e">question_conditional_yes_no_get_no_struct</a> ( &amp;delete_msg[0],
<a name="l01948"></a>01948                         <span class="stringliteral">&quot;delete-transaction&quot;</span> );
<a name="l01949"></a>01949             tmpstr = g_strdup_printf (
<a name="l01950"></a>01950                          _(<span class="stringliteral">&quot;Do you really want to delete transaction with party &#39;%s&#39; ?&quot;</span>),
<a name="l01951"></a>01951                          <a class="code" href="gsb__data__payee_8c.html#adc6080b7376628d3902f5fd861deb45a">gsb_data_payee_get_name</a> (
<a name="l01952"></a>01952                          <a class="code" href="gsb__data__transaction_8c.html#afa032df45afa2ad7a4be48449a7e8d15">gsb_data_transaction_get_party_number</a> ( transaction_number),
<a name="l01953"></a>01953                                              FALSE ) );
<a name="l01954"></a>01954             delete_msg[msg_no].<a class="code" href="structconditional__message.html#a1ac78264fd28b6819d5bfaa1e9b0ef39">message</a> = tmpstr;
<a name="l01955"></a>01955         }
<a name="l01956"></a>01956         <span class="keywordflow">if</span> ( !<a class="code" href="dialog_8c.html#acdc10d7ad7ab05de8c606827a1126034">question_conditional_yes_no_with_struct</a> ( &amp;delete_msg[msg_no] ) )
<a name="l01957"></a>01957         {
<a name="l01958"></a>01958             g_free(tmpstr);
<a name="l01959"></a>01959             <span class="keywordflow">return</span> FALSE;
<a name="l01960"></a>01960         }
<a name="l01961"></a>01961         g_free(tmpstr);
<a name="l01962"></a>01962     }
<a name="l01963"></a>01963 
<a name="l01964"></a>01964     <span class="comment">/* move the selection */</span>
<a name="l01965"></a>01965     <span class="keywordflow">if</span> (<a class="code" href="transaction__list__select_8c.html#a0a2effd6ee01ec6f9b848593b797398a">transaction_list_select_get</a> () == transaction_number)
<a name="l01966"></a>01966     {
<a name="l01967"></a>01967         <a class="code" href="transaction__list__select_8c.html#aad826f93d59044effba7ca1c31eccabb">transaction_list_select_down</a> (FALSE);
<a name="l01968"></a>01968         <a class="code" href="gsb__data__account_8c.html#ab22a22f66d9be40495e220aa93b3a700">gsb_data_account_set_current_transaction_number</a> ( account_number,
<a name="l01969"></a>01969                                                           <a class="code" href="transaction__list__select_8c.html#a0a2effd6ee01ec6f9b848593b797398a">transaction_list_select_get</a> ());
<a name="l01970"></a>01970     }
<a name="l01971"></a>01971 
<a name="l01972"></a>01972     <span class="comment">/* delete the transaction from the tree view,</span>
<a name="l01973"></a>01973 <span class="comment">     * all the children and contra transaction will be removed with that */</span>
<a name="l01974"></a>01974     <a class="code" href="gsb__transactions__list_8c.html#af4607ecfa510ff666ad6f3a12b898e4f">gsb_transactions_list_delete_transaction_from_tree_view</a> (transaction_number);
<a name="l01975"></a>01975 
<a name="l01976"></a>01976     <span class="comment">/*  update the metatrees, this MUST be before remove_transaction */</span>
<a name="l01977"></a>01977     <a class="code" href="utils__operations_8c.html#a3e5da28eed95cd789a2b084e60463ac8">delete_transaction_in_trees</a> (transaction_number);
<a name="l01978"></a>01978 
<a name="l01979"></a>01979     <span class="comment">/* delete the transaction in memory,</span>
<a name="l01980"></a>01980 <span class="comment">     * all the children and contra transaction will be removed with that */</span>
<a name="l01981"></a>01981     <a class="code" href="gsb__data__transaction_8c.html#aef8db2326b8eb8bce54ee20df4f49c1e">gsb_data_transaction_remove_transaction</a> ( transaction_number);
<a name="l01982"></a>01982 
<a name="l01983"></a>01983     <span class="comment">/* update the tree view */</span>
<a name="l01984"></a>01984     <a class="code" href="transaction__list_8c.html#a31251e7e47a79c21b63cffdea74a2ee9">transaction_list_colorize</a> ();
<a name="l01985"></a>01985     <span class="keywordflow">if</span> ( <a class="code" href="gsb__file__config_8c.html#ac390e947e97cef2bec2f5d59d6ec1071">conf</a>.<a class="code" href="structgsb__conf__t.html#afe3b36b196c6045e42ce4afdd915d506">show_transaction_gives_balance</a> )
<a name="l01986"></a>01986         <a class="code" href="transaction__list_8c.html#a8e2f2c3981823494ae5f16f0e8db383b">transaction_list_set_color_jour</a> ( account_number );
<a name="l01987"></a>01987     <a class="code" href="transaction__list_8c.html#a59ee075b27fa18fb9691201b52ec6692">transaction_list_set_balances</a> ();
<a name="l01988"></a>01988     <a class="code" href="transaction__list__select_8c.html#a85f38a439156b883335de73220dca237">transaction_list_select</a> (<a class="code" href="gsb__data__account_8c.html#a6596a8dca0eaab412a036d23cb51a5b0">gsb_data_account_get_current_transaction_number</a> (account_number));
<a name="l01989"></a>01989 
<a name="l01990"></a>01990     <span class="comment">/* if we are reconciling, update the amounts */</span>
<a name="l01991"></a>01991     <span class="keywordflow">if</span> ( <a class="code" href="parametres_8c.html#ab2a744f5d2124688473d13979420e911">etat</a>.<a class="code" href="structgsb__etat__t.html#ae3a5af3d26105e740e989e5c6804bab2">equilibrage</a> )
<a name="l01992"></a>01992         <a class="code" href="gsb__reconcile_8c.html#ad4e6ccb1415c9f71f856acbb73ce8be3">gsb_reconcile_update_amounts</a> (NULL, NULL);
<a name="l01993"></a>01993 
<a name="l01994"></a>01994     <span class="comment">/* we will update the home page */</span>
<a name="l01995"></a>01995     <a class="code" href="accueil_8c.html#a018917e8dacfd8fbe4e94d0f99a59c08">mise_a_jour_liste_comptes_accueil</a> = 1;
<a name="l01996"></a>01996     <a class="code" href="accueil_8c.html#afaffaedc4fd0ae8638f7158c6777b35b">mise_a_jour_soldes_minimaux</a> = 1;
<a name="l01997"></a>01997     <a class="code" href="accueil_8c.html#a14c0d85dd53f652a98e6a0ff81d9123b">affiche_dialogue_soldes_minimaux</a> ();
<a name="l01998"></a>01998 
<a name="l01999"></a>01999     <span class="comment">/* We blank form. */</span>
<a name="l02000"></a>02000     <span class="keywordflow">if</span> (show_warning)
<a name="l02001"></a>02001         <a class="code" href="gsb__form_8c.html#a5629926349c0078b226ef9da39c6c7c3">gsb_form_escape_form</a> ();
<a name="l02002"></a>02002 
<a name="l02003"></a>02003     <span class="keywordflow">if</span> ( <a class="code" href="parametres_8c.html#ab2a744f5d2124688473d13979420e911">etat</a>.<a class="code" href="structgsb__etat__t.html#a9d0fa9057da603e64a601d69d7bf2b51">modification_fichier</a> == 0 )
<a name="l02004"></a>02004         <a class="code" href="traitement__variables_8c.html#aa4084b9e508b1d1fea1d09c6b6208021">modification_fichier</a> ( TRUE );
<a name="l02005"></a>02005     <span class="keywordflow">return</span> TRUE;
<a name="l02006"></a>02006 }
<a name="l02007"></a>02007 
<a name="l02008"></a>02008 
<a name="l02009"></a>02009 
<a name="l02017"></a>02017 gboolean gsb_transactions_list_check_mark ( gint transaction_number )
<a name="l02018"></a>02018 {
<a name="l02019"></a>02019     gint contra_transaction_number;
<a name="l02020"></a>02020 
<a name="l02021"></a>02021     <span class="comment">/* vérifications de bases */</span>
<a name="l02022"></a>02022     <span class="keywordflow">if</span> (transaction_number &lt;= 0)
<a name="l02023"></a>02023         <span class="keywordflow">return</span> FALSE;
<a name="l02024"></a>02024 
<a name="l02025"></a>02025     <span class="keywordflow">if</span> ( <a class="code" href="gsb__data__transaction_8c.html#a52cf9684818c3930c5c688b54f7cf393">gsb_data_transaction_get_marked_transaction</a> (transaction_number)== <a class="code" href="gsb__data__transaction_8h.html#a82f385a1c75ac98496b5c09a123bf521a41425f55add3a05ffc4c7aa366048fc9">OPERATION_RAPPROCHEE</a> )
<a name="l02026"></a>02026         <span class="keywordflow">return</span> TRUE;
<a name="l02027"></a>02027 
<a name="l02028"></a>02028     <span class="comment">/* if it&#39;s a transfer, check the contra-transaction */</span>
<a name="l02029"></a>02029     contra_transaction_number = <a class="code" href="gsb__data__transaction_8c.html#a4040925a3db49485b5a2b0a8ea19d2ee">gsb_data_transaction_get_contra_transaction_number</a> (transaction_number);
<a name="l02030"></a>02030     <span class="keywordflow">if</span> ( contra_transaction_number &gt; 0 )
<a name="l02031"></a>02031     {
<a name="l02032"></a>02032         <span class="keywordflow">if</span> (<a class="code" href="gsb__data__transaction_8c.html#a52cf9684818c3930c5c688b54f7cf393">gsb_data_transaction_get_marked_transaction</a> (contra_transaction_number) == <a class="code" href="gsb__data__transaction_8h.html#a82f385a1c75ac98496b5c09a123bf521a41425f55add3a05ffc4c7aa366048fc9">OPERATION_RAPPROCHEE</a> )
<a name="l02033"></a>02033             <span class="keywordflow">return</span> TRUE;
<a name="l02034"></a>02034     }
<a name="l02035"></a>02035 
<a name="l02036"></a>02036     <span class="comment">/* if it&#39;s a split of transaction, check all the children</span>
<a name="l02037"></a>02037 <span class="comment">     * if there is not a transfer which is marked */</span>
<a name="l02038"></a>02038     <span class="keywordflow">if</span> ( <a class="code" href="gsb__data__transaction_8c.html#a2de1ba38ee196b44e3c00c10e1d645cc">gsb_data_transaction_get_split_of_transaction</a> ( transaction_number))
<a name="l02039"></a>02039     {
<a name="l02040"></a>02040         GSList *list_tmp_transactions;
<a name="l02041"></a>02041         list_tmp_transactions = <a class="code" href="gsb__data__transaction_8c.html#af781a71a62eece020188ef62847f2887">gsb_data_transaction_get_transactions_list</a> ();
<a name="l02042"></a>02042 
<a name="l02043"></a>02043         <span class="keywordflow">while</span> ( list_tmp_transactions )
<a name="l02044"></a>02044         {
<a name="l02045"></a>02045             gint transaction_number_tmp = <a class="code" href="gsb__data__transaction_8c.html#a99bf548513083f4a71fe019faeccbe0a">gsb_data_transaction_get_transaction_number</a> (list_tmp_transactions -&gt; data);
<a name="l02046"></a>02046 
<a name="l02047"></a>02047             <span class="keywordflow">if</span> ( <a class="code" href="gsb__data__transaction_8c.html#a5b486efbc486f946e9c998a114054bce">gsb_data_transaction_get_account_number</a> (transaction_number_tmp) == <a class="code" href="gsb__data__transaction_8c.html#a5b486efbc486f946e9c998a114054bce">gsb_data_transaction_get_account_number</a> (transaction_number)
<a name="l02048"></a>02048                  &amp;&amp;
<a name="l02049"></a>02049                  <a class="code" href="gsb__data__transaction_8c.html#a6018560ece7ab02e8d46bc9bdaffd607">gsb_data_transaction_get_mother_transaction_number</a> (transaction_number_tmp) == transaction_number)
<a name="l02050"></a>02050             {
<a name="l02051"></a>02051                 <span class="comment">/* transactions_tmp is a child of transaction */</span>
<a name="l02052"></a>02052                 <span class="keywordflow">if</span> ( <a class="code" href="gsb__data__transaction_8c.html#a52cf9684818c3930c5c688b54f7cf393">gsb_data_transaction_get_marked_transaction</a> (transaction_number_tmp) == <a class="code" href="gsb__data__transaction_8h.html#a82f385a1c75ac98496b5c09a123bf521a41425f55add3a05ffc4c7aa366048fc9">OPERATION_RAPPROCHEE</a> )
<a name="l02053"></a>02053                     <span class="keywordflow">return</span> TRUE;
<a name="l02054"></a>02054 
<a name="l02055"></a>02055                 contra_transaction_number = <a class="code" href="gsb__data__transaction_8c.html#a4040925a3db49485b5a2b0a8ea19d2ee">gsb_data_transaction_get_contra_transaction_number</a> (transaction_number_tmp);
<a name="l02056"></a>02056 
<a name="l02057"></a>02057                 <span class="keywordflow">if</span> ( contra_transaction_number &gt; 0)
<a name="l02058"></a>02058                 {
<a name="l02059"></a>02059                     <span class="comment">/* the split is a transfer, we check the contra-transaction */</span>
<a name="l02060"></a>02060                     <span class="keywordflow">if</span> ( <a class="code" href="gsb__data__transaction_8c.html#a52cf9684818c3930c5c688b54f7cf393">gsb_data_transaction_get_marked_transaction</a> (contra_transaction_number)== <a class="code" href="gsb__data__transaction_8h.html#a82f385a1c75ac98496b5c09a123bf521a41425f55add3a05ffc4c7aa366048fc9">OPERATION_RAPPROCHEE</a> )
<a name="l02061"></a>02061                         <span class="keywordflow">return</span> TRUE;
<a name="l02062"></a>02062                 }
<a name="l02063"></a>02063             }
<a name="l02064"></a>02064             list_tmp_transactions = list_tmp_transactions -&gt; next;
<a name="l02065"></a>02065         }
<a name="l02066"></a>02066     }
<a name="l02067"></a>02067     <span class="keywordflow">return</span> FALSE;
<a name="l02068"></a>02068 }
<a name="l02069"></a>02069 
<a name="l02070"></a>02070 
<a name="l02083"></a><a class="code" href="gsb__transactions__list_8h.html#af4607ecfa510ff666ad6f3a12b898e4f">02083</a> gboolean <a class="code" href="gsb__transactions__list_8c.html#af4607ecfa510ff666ad6f3a12b898e4f">gsb_transactions_list_delete_transaction_from_tree_view</a> ( gint transaction_number )
<a name="l02084"></a>02084 {
<a name="l02085"></a>02085     gint contra_transaction_number;
<a name="l02086"></a>02086 
<a name="l02087"></a>02087     <span class="comment">/* devel_debug_int (transaction_number); */</span>
<a name="l02088"></a>02088 
<a name="l02089"></a>02089     <span class="keywordflow">if</span> ( transaction_number == -1 )
<a name="l02090"></a>02090         <span class="keywordflow">return</span> FALSE;
<a name="l02091"></a>02091 
<a name="l02092"></a>02092     <span class="comment">/* if the transaction is a transfer, erase the contra-transaction */</span>
<a name="l02093"></a>02093     contra_transaction_number = <a class="code" href="gsb__data__transaction_8c.html#a4040925a3db49485b5a2b0a8ea19d2ee">gsb_data_transaction_get_contra_transaction_number</a> (transaction_number);
<a name="l02094"></a>02094     <span class="keywordflow">if</span> (contra_transaction_number &gt; 0)
<a name="l02095"></a>02095         <a class="code" href="transaction__list_8c.html#aaf9d03a4407c95f392ef53378ce1fd0f">transaction_list_remove_transaction</a> (contra_transaction_number);
<a name="l02096"></a>02096 
<a name="l02097"></a>02097     <span class="comment">/* check if it&#39;s a split, we needn&#39;t to erase all splits children, they will be deleted</span>
<a name="l02098"></a>02098 <span class="comment">     * with the mother, but if one of them if a transfer, we need to delete it now */</span>
<a name="l02099"></a>02099     <span class="keywordflow">if</span> (<a class="code" href="gsb__data__transaction_8c.html#a2de1ba38ee196b44e3c00c10e1d645cc">gsb_data_transaction_get_split_of_transaction</a> (transaction_number))
<a name="l02100"></a>02100     {
<a name="l02101"></a>02101         GSList *tmp_list;
<a name="l02102"></a>02102 
<a name="l02103"></a>02103         tmp_list = <a class="code" href="gsb__data__transaction_8c.html#af781a71a62eece020188ef62847f2887">gsb_data_transaction_get_transactions_list</a> ();
<a name="l02104"></a>02104         <span class="keywordflow">while</span> (tmp_list)
<a name="l02105"></a>02105         {
<a name="l02106"></a>02106             gint test_transaction = <a class="code" href="gsb__data__transaction_8c.html#a99bf548513083f4a71fe019faeccbe0a">gsb_data_transaction_get_transaction_number</a> (tmp_list -&gt; data);
<a name="l02107"></a>02107 
<a name="l02108"></a>02108             contra_transaction_number = <a class="code" href="gsb__data__transaction_8c.html#a4040925a3db49485b5a2b0a8ea19d2ee">gsb_data_transaction_get_contra_transaction_number</a> (test_transaction);
<a name="l02109"></a>02109 
<a name="l02110"></a>02110             <span class="keywordflow">if</span> ( <a class="code" href="gsb__data__transaction_8c.html#a6018560ece7ab02e8d46bc9bdaffd607">gsb_data_transaction_get_mother_transaction_number</a> (test_transaction) == transaction_number
<a name="l02111"></a>02111                  &amp;&amp;
<a name="l02112"></a>02112                  contra_transaction_number &gt; 0)
<a name="l02113"></a>02113                 <a class="code" href="transaction__list_8c.html#aaf9d03a4407c95f392ef53378ce1fd0f">transaction_list_remove_transaction</a> (contra_transaction_number);
<a name="l02114"></a>02114 
<a name="l02115"></a>02115             tmp_list = tmp_list -&gt; next;
<a name="l02116"></a>02116         }
<a name="l02117"></a>02117     }
<a name="l02118"></a>02118 
<a name="l02119"></a>02119     <span class="comment">/* now we can just delete the wanted transaction */</span>
<a name="l02120"></a>02120     <a class="code" href="transaction__list_8c.html#aaf9d03a4407c95f392ef53378ce1fd0f">transaction_list_remove_transaction</a> (transaction_number);
<a name="l02121"></a>02121     <span class="keywordflow">return</span> FALSE;
<a name="l02122"></a>02122 }
<a name="l02123"></a>02123 
<a name="l02124"></a>02124 
<a name="l02125"></a>02125 
<a name="l02132"></a>02132 <span class="keywordtype">void</span> popup_transaction_context_menu ( gboolean full, <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y )
<a name="l02133"></a>02133 {
<a name="l02134"></a>02134     GtkWidget *menu, *menu_item;
<a name="l02135"></a>02135     gint transaction_number;
<a name="l02136"></a>02136     gboolean mi_full = TRUE;
<a name="l02137"></a>02137 
<a name="l02138"></a>02138     transaction_number = <a class="code" href="gsb__data__account_8c.html#a6596a8dca0eaab412a036d23cb51a5b0">gsb_data_account_get_current_transaction_number</a> (<a class="code" href="navigation_8c.html#a3b668bf52ce71dcff3ea10c9db7be859">gsb_gui_navigation_get_current_account</a> ());
<a name="l02139"></a>02139 
<a name="l02140"></a>02140     <span class="comment">/* full is used for the whites line, to unsensitive some fields in the menu */</span>
<a name="l02141"></a>02141     <span class="keywordflow">if</span> ( transaction_number &lt; 0 )
<a name="l02142"></a>02142         full = FALSE;
<a name="l02143"></a>02143 
<a name="l02144"></a>02144     <span class="comment">/* mi_full is used for children of transactions, to unselect some fields in the menu */</span>
<a name="l02145"></a>02145     <span class="keywordflow">if</span> (<a class="code" href="gsb__data__transaction_8c.html#a6018560ece7ab02e8d46bc9bdaffd607">gsb_data_transaction_get_mother_transaction_number</a> (transaction_number))
<a name="l02146"></a>02146         mi_full = FALSE;
<a name="l02147"></a>02147 
<a name="l02148"></a>02148     menu = gtk_menu_new ();
<a name="l02149"></a>02149 
<a name="l02150"></a>02150     <span class="comment">/* Edit transaction */</span>
<a name="l02151"></a>02151     menu_item = gtk_image_menu_item_new_with_label ( _(<span class="stringliteral">&quot;Edit transaction&quot;</span>) );
<a name="l02152"></a>02152     gtk_image_menu_item_set_image ( GTK_IMAGE_MENU_ITEM(menu_item),
<a name="l02153"></a>02153                                     gtk_image_new_from_stock ( GTK_STOCK_PROPERTIES,
<a name="l02154"></a>02154                                                                GTK_ICON_SIZE_MENU ));
<a name="l02155"></a>02155     g_signal_connect_swapped ( G_OBJECT(menu_item),
<a name="l02156"></a>02156                                <span class="stringliteral">&quot;activate&quot;</span>,
<a name="l02157"></a>02157                                G_CALLBACK (<a class="code" href="gsb__transactions__list_8c.html#a586edcd7d904b6fd75ab87544f8609fa">gsb_transactions_list_edit_transaction_by_pointer</a>),
<a name="l02158"></a>02158                                GINT_TO_POINTER (transaction_number));
<a name="l02159"></a>02159     gtk_widget_set_sensitive ( menu_item, full );
<a name="l02160"></a>02160     gtk_menu_shell_append ( GTK_MENU_SHELL ( menu ), menu_item );
<a name="l02161"></a>02161 
<a name="l02162"></a>02162     <span class="comment">/* Separator */</span>
<a name="l02163"></a>02163     gtk_menu_shell_append ( GTK_MENU_SHELL ( menu ), gtk_separator_menu_item_new() );
<a name="l02164"></a>02164 
<a name="l02165"></a>02165     <span class="comment">/* New transaction */</span>
<a name="l02166"></a>02166     menu_item = gtk_image_menu_item_new_with_label ( _(<span class="stringliteral">&quot;New transaction&quot;</span>) );
<a name="l02167"></a>02167     gtk_image_menu_item_set_image ( GTK_IMAGE_MENU_ITEM(menu_item),
<a name="l02168"></a>02168                                     gtk_image_new_from_stock ( GTK_STOCK_NEW,
<a name="l02169"></a>02169                                                                GTK_ICON_SIZE_MENU ));
<a name="l02170"></a>02170     g_signal_connect ( G_OBJECT(menu_item), <span class="stringliteral">&quot;activate&quot;</span>, G_CALLBACK (<a class="code" href="gsb__transactions__list_8c.html#a2f2bb8bf01af048e33c47d43c8370a21">new_transaction</a>), NULL );
<a name="l02171"></a>02171     gtk_menu_shell_append ( GTK_MENU_SHELL ( menu ), menu_item );
<a name="l02172"></a>02172 
<a name="l02173"></a>02173     <span class="comment">/* Delete transaction */</span>
<a name="l02174"></a>02174     menu_item = gtk_image_menu_item_new_with_label ( _(<span class="stringliteral">&quot;Delete transaction&quot;</span>) );
<a name="l02175"></a>02175     gtk_image_menu_item_set_image ( GTK_IMAGE_MENU_ITEM(menu_item),
<a name="l02176"></a>02176                                     gtk_image_new_from_stock ( GTK_STOCK_DELETE,
<a name="l02177"></a>02177                                                                GTK_ICON_SIZE_MENU ));
<a name="l02178"></a>02178     g_signal_connect ( G_OBJECT(menu_item), <span class="stringliteral">&quot;activate&quot;</span>, G_CALLBACK(<a class="code" href="gsb__transactions__list_8c.html#aa52082e3faa52c7be3aa7d5dd41d0731">remove_transaction</a>), NULL );
<a name="l02179"></a>02179     <span class="keywordflow">if</span> ( !full
<a name="l02180"></a>02180          ||
<a name="l02181"></a>02181          <a class="code" href="gsb__data__transaction_8c.html#a52cf9684818c3930c5c688b54f7cf393">gsb_data_transaction_get_marked_transaction</a> (transaction_number) == <a class="code" href="gsb__data__transaction_8h.html#a82f385a1c75ac98496b5c09a123bf521a41425f55add3a05ffc4c7aa366048fc9">OPERATION_RAPPROCHEE</a>
<a name="l02182"></a>02182          ||
<a name="l02183"></a>02183          <a class="code" href="gsb__data__transaction_8c.html#a52cf9684818c3930c5c688b54f7cf393">gsb_data_transaction_get_marked_transaction</a> (transaction_number) == <a class="code" href="gsb__data__transaction_8h.html#a82f385a1c75ac98496b5c09a123bf521ad2c1596b5d07a043b0cfaef131372b01">OPERATION_TELERAPPROCHEE</a> )
<a name="l02184"></a>02184         gtk_widget_set_sensitive ( menu_item, FALSE );
<a name="l02185"></a>02185     gtk_menu_shell_append ( GTK_MENU_SHELL ( menu ), menu_item );
<a name="l02186"></a>02186 
<a name="l02187"></a>02187     <span class="comment">/* use transaction as template */</span>
<a name="l02188"></a>02188     menu_item = gtk_image_menu_item_new_with_label ( _(<span class="stringliteral">&quot;Use selected transaction as a template&quot;</span>) );
<a name="l02189"></a>02189     gtk_image_menu_item_set_image ( GTK_IMAGE_MENU_ITEM(menu_item),
<a name="l02190"></a>02190                                     gtk_image_new_from_stock ( GTK_STOCK_COPY,
<a name="l02191"></a>02191                                                                GTK_ICON_SIZE_MENU ));
<a name="l02192"></a>02192     g_signal_connect ( G_OBJECT(menu_item), <span class="stringliteral">&quot;activate&quot;</span>,
<a name="l02193"></a>02193                        G_CALLBACK (gsb_transactions_list_clone_template), NULL );
<a name="l02194"></a>02194     gtk_widget_set_sensitive ( menu_item, full );
<a name="l02195"></a>02195     gtk_menu_shell_append ( GTK_MENU_SHELL ( menu ), menu_item );
<a name="l02196"></a>02196 
<a name="l02197"></a>02197     <span class="comment">/* Clone transaction */</span>
<a name="l02198"></a>02198     menu_item = gtk_image_menu_item_new_with_label ( _(<span class="stringliteral">&quot;Clone transaction&quot;</span>) );
<a name="l02199"></a>02199     gtk_image_menu_item_set_image ( GTK_IMAGE_MENU_ITEM(menu_item),
<a name="l02200"></a>02200                                     gtk_image_new_from_stock ( GTK_STOCK_COPY,
<a name="l02201"></a>02201                                                                GTK_ICON_SIZE_MENU ));
<a name="l02202"></a>02202     g_signal_connect ( G_OBJECT(menu_item), <span class="stringliteral">&quot;activate&quot;</span>,
<a name="l02203"></a>02203                        G_CALLBACK (<a class="code" href="gsb__transactions__list_8c.html#a8da0807401b34e59349e9534ed0e9cd9">clone_selected_transaction</a>), NULL );
<a name="l02204"></a>02204     gtk_widget_set_sensitive ( menu_item, full );
<a name="l02205"></a>02205     gtk_menu_shell_append ( GTK_MENU_SHELL ( menu ), menu_item );
<a name="l02206"></a>02206 
<a name="l02207"></a>02207     <span class="comment">/* Separator */</span>
<a name="l02208"></a>02208     gtk_menu_shell_append ( GTK_MENU_SHELL ( menu ), gtk_separator_menu_item_new() );
<a name="l02209"></a>02209 
<a name="l02210"></a>02210     <span class="comment">/* Convert to scheduled transaction */</span>
<a name="l02211"></a>02211     menu_item = gtk_image_menu_item_new_with_label ( _(<span class="stringliteral">&quot;Convert transaction to scheduled transaction&quot;</span>) );
<a name="l02212"></a>02212     gtk_image_menu_item_set_image ( GTK_IMAGE_MENU_ITEM(menu_item),
<a name="l02213"></a>02213                                     gtk_image_new_from_stock ( GTK_STOCK_CONVERT,
<a name="l02214"></a>02214                                                                GTK_ICON_SIZE_MENU ));
<a name="l02215"></a>02215     g_signal_connect ( G_OBJECT(menu_item), <span class="stringliteral">&quot;activate&quot;</span>, G_CALLBACK(<a class="code" href="gsb__transactions__list_8c.html#a57f2d9faad61b1154270e444656bd275">schedule_selected_transaction</a>), NULL );
<a name="l02216"></a>02216     gtk_widget_set_sensitive ( menu_item, full &amp;&amp; mi_full );
<a name="l02217"></a>02217     gtk_menu_shell_append ( GTK_MENU_SHELL ( menu ), menu_item );
<a name="l02218"></a>02218 
<a name="l02219"></a>02219     <span class="comment">/* Move to another account */</span>
<a name="l02220"></a>02220     menu_item = gtk_image_menu_item_new_with_label ( _(<span class="stringliteral">&quot;Move transaction to another account&quot;</span>) );
<a name="l02221"></a>02221     gtk_image_menu_item_set_image ( GTK_IMAGE_MENU_ITEM(menu_item),
<a name="l02222"></a>02222                                     gtk_image_new_from_stock ( GTK_STOCK_JUMP_TO,
<a name="l02223"></a>02223                                                                GTK_ICON_SIZE_MENU ));
<a name="l02224"></a>02224     <span class="keywordflow">if</span> ( !full
<a name="l02225"></a>02225          ||
<a name="l02226"></a>02226          !mi_full
<a name="l02227"></a>02227          ||
<a name="l02228"></a>02228          <a class="code" href="gsb__data__transaction_8c.html#a52cf9684818c3930c5c688b54f7cf393">gsb_data_transaction_get_marked_transaction</a> (transaction_number) == <a class="code" href="gsb__data__transaction_8h.html#a82f385a1c75ac98496b5c09a123bf521a41425f55add3a05ffc4c7aa366048fc9">OPERATION_RAPPROCHEE</a>
<a name="l02229"></a>02229          ||
<a name="l02230"></a>02230          <a class="code" href="gsb__data__transaction_8c.html#a52cf9684818c3930c5c688b54f7cf393">gsb_data_transaction_get_marked_transaction</a> (transaction_number) == <a class="code" href="gsb__data__transaction_8h.html#a82f385a1c75ac98496b5c09a123bf521ad2c1596b5d07a043b0cfaef131372b01">OPERATION_TELERAPPROCHEE</a> )
<a name="l02231"></a>02231         gtk_widget_set_sensitive ( menu_item, FALSE );
<a name="l02232"></a>02232     gtk_menu_shell_append ( GTK_MENU_SHELL ( menu ), menu_item );
<a name="l02233"></a>02233 
<a name="l02234"></a>02234     <span class="comment">/* Add accounts submenu */</span>
<a name="l02235"></a>02235     gtk_menu_item_set_submenu ( GTK_MENU_ITEM(menu_item),
<a name="l02236"></a>02236                                 GTK_WIDGET(<a class="code" href="gsb__account_8c.html#ac49429f60593df9fe4e9674cd8645fc2">gsb_account_create_menu_list</a> (G_CALLBACK(move_selected_operation_to_account), FALSE, FALSE)) );
<a name="l02237"></a>02237 
<a name="l02238"></a>02238 
<a name="l02239"></a>02239     <span class="comment">/* Separator */</span>
<a name="l02240"></a>02240     gtk_menu_shell_append ( GTK_MENU_SHELL ( menu ), gtk_separator_menu_item_new() );
<a name="l02241"></a>02241 
<a name="l02242"></a>02242     <span class="comment">/* Change cell content. */</span>
<a name="l02243"></a>02243     menu_item = gtk_menu_item_new_with_label ( _(<span class="stringliteral">&quot;Change cell content&quot;</span>) );
<a name="l02244"></a>02244     <span class="keywordflow">if</span> ( full )
<a name="l02245"></a>02245         gtk_menu_item_set_submenu ( GTK_MENU_ITEM ( menu_item ),
<a name="l02246"></a>02246                                     GTK_WIDGET ( gsb_gui_create_cell_contents_menu ( x, y ) ) );
<a name="l02247"></a>02247     gtk_widget_set_sensitive ( menu_item, full );
<a name="l02248"></a>02248     gtk_menu_shell_append ( GTK_MENU_SHELL ( menu ), menu_item );
<a name="l02249"></a>02249 
<a name="l02250"></a>02250     <span class="comment">/* Finish all. */</span>
<a name="l02251"></a>02251     gtk_widget_show_all (menu);
<a name="l02252"></a>02252     gtk_menu_popup ( GTK_MENU(menu), NULL, NULL, NULL, NULL, 3, gtk_get_current_event_time());
<a name="l02253"></a>02253 }
<a name="l02254"></a>02254 
<a name="l02255"></a>02255 
<a name="l02256"></a>02256 
<a name="l02267"></a>02267 GtkWidget *gsb_gui_create_cell_contents_menu ( <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y )
<a name="l02268"></a>02268 {
<a name="l02269"></a>02269     GtkWidget * menu, * item;
<a name="l02270"></a>02270     gint i;
<a name="l02271"></a>02271 
<a name="l02272"></a>02272     menu = gtk_menu_new ();
<a name="l02273"></a>02273 
<a name="l02274"></a>02274     <span class="keywordflow">for</span> ( i = 0 ; <a class="code" href="gsb__transactions__list_8c.html#aa9959039948028badde16d39e1a74c43">cell_views</a>[i] != NULL ; i++ )
<a name="l02275"></a>02275     {
<a name="l02276"></a>02276         item = gtk_menu_item_new_with_label ( _(<a class="code" href="gsb__transactions__list_8c.html#aa9959039948028badde16d39e1a74c43">cell_views</a>[i]) );
<a name="l02277"></a>02277 
<a name="l02278"></a>02278         g_object_set_data ( G_OBJECT (item), <span class="stringliteral">&quot;x&quot;</span>, GINT_TO_POINTER (x) );
<a name="l02279"></a>02279         g_object_set_data ( G_OBJECT (item), <span class="stringliteral">&quot;y&quot;</span>, GINT_TO_POINTER (y) );
<a name="l02280"></a>02280         g_signal_connect ( G_OBJECT(item), <span class="stringliteral">&quot;activate&quot;</span>,
<a name="l02281"></a>02281                            G_CALLBACK(gsb_gui_change_cell_content), GINT_TO_POINTER (i+1));
<a name="l02282"></a>02282         gtk_menu_shell_append ( GTK_MENU_SHELL ( menu ), item );
<a name="l02283"></a>02283     }
<a name="l02284"></a>02284     <span class="comment">/* set a menu to clear the cell except for the first line */</span>
<a name="l02285"></a>02285     <span class="keywordflow">if</span> ( y &gt; 0 )
<a name="l02286"></a>02286     {
<a name="l02287"></a>02287         item = gtk_menu_item_new_with_label ( _(<span class="stringliteral">&quot;Clear cell&quot;</span>) );
<a name="l02288"></a>02288 
<a name="l02289"></a>02289         g_object_set_data ( G_OBJECT ( item ), <span class="stringliteral">&quot;x&quot;</span>, GINT_TO_POINTER ( x ) );
<a name="l02290"></a>02290         g_object_set_data ( G_OBJECT ( item ), <span class="stringliteral">&quot;y&quot;</span>, GINT_TO_POINTER ( y ) );
<a name="l02291"></a>02291         g_signal_connect ( G_OBJECT ( item ),
<a name="l02292"></a>02292                         <span class="stringliteral">&quot;activate&quot;</span>,
<a name="l02293"></a>02293                                     G_CALLBACK ( gsb_gui_change_cell_content ),
<a name="l02294"></a>02294                         GINT_TO_POINTER ( i+1 ) );
<a name="l02295"></a>02295         gtk_menu_shell_append ( GTK_MENU_SHELL ( menu ), item );
<a name="l02296"></a>02296     }
<a name="l02297"></a>02297     <span class="keywordflow">return</span> menu;
<a name="l02298"></a>02298 }
<a name="l02299"></a>02299 
<a name="l02300"></a>02300 
<a name="l02301"></a>02301 
<a name="l02315"></a>02315 gboolean gsb_gui_change_cell_content ( GtkWidget * item, gint *element_ptr )
<a name="l02316"></a>02316 {
<a name="l02317"></a>02317     gint col, line;
<a name="l02318"></a>02318     gint last_col, last_line;
<a name="l02319"></a>02319     gint element;
<a name="l02320"></a>02320     gint sort_column;
<a name="l02321"></a>02321     gint current_account;
<a name="l02322"></a>02322 
<a name="l02323"></a>02323     element = GPOINTER_TO_INT ( element_ptr );
<a name="l02324"></a>02324 
<a name="l02325"></a>02325     <a class="code" href="erreur_8h.html#a10f4eeae4cc251a8d632fd62ec1057fb">devel_debug_int</a> ( element );
<a name="l02326"></a>02326 
<a name="l02327"></a>02327     last_col = <a class="code" href="gsb__transactions__list_8c.html#a8be7f66c4c8f7c67eb187290c18fb6f7">find_element_col</a> ( element );
<a name="l02328"></a>02328     last_line = <a class="code" href="gsb__transactions__list_8c.html#a17bf5dcbc82415220a20244112d65aef">find_element_line</a> ( element );
<a name="l02329"></a>02329     current_account = <a class="code" href="navigation_8c.html#a3b668bf52ce71dcff3ea10c9db7be859">gsb_gui_navigation_get_current_account</a> ( );
<a name="l02330"></a>02330     sort_column = <a class="code" href="gsb__data__account_8c.html#affc711f565e08ad4062076cb11d7730f">gsb_data_account_get_sort_column</a> ( current_account );
<a name="l02331"></a>02331 
<a name="l02332"></a>02332     col = GPOINTER_TO_INT ( g_object_get_data ( G_OBJECT ( item ), <span class="stringliteral">&quot;x&quot;</span> ) );
<a name="l02333"></a>02333     line = GPOINTER_TO_INT ( g_object_get_data ( G_OBJECT ( item ), <span class="stringliteral">&quot;y&quot;</span> ) );
<a name="l02334"></a>02334 
<a name="l02335"></a>02335     <span class="comment">/* if no change, change nothing */</span>
<a name="l02336"></a>02336     <span class="keywordflow">if</span> ( last_col == col
<a name="l02337"></a>02337         &amp;&amp;
<a name="l02338"></a>02338         last_line == line )
<a name="l02339"></a>02339         <span class="keywordflow">return</span> FALSE;
<a name="l02340"></a>02340 
<a name="l02341"></a>02341     <span class="comment">/* save the new position */</span>
<a name="l02342"></a>02342     <a class="code" href="affichage__liste_8c.html#a0c444565adac369ff42631d4b7b7e6bb">tab_affichage_ope</a>[line][col] = element;
<a name="l02343"></a>02343 
<a name="l02344"></a>02344     <span class="keywordflow">if</span> (last_col != -1 &amp;&amp; last_line != -1)
<a name="l02345"></a>02345     {
<a name="l02346"></a>02346         <span class="comment">/* the element was already showed, we need to erase the last cell first */</span>
<a name="l02347"></a>02347         <a class="code" href="affichage__liste_8c.html#a0c444565adac369ff42631d4b7b7e6bb">tab_affichage_ope</a>[last_line][last_col] = 0;
<a name="l02348"></a>02348         <a class="code" href="transaction__list_8c.html#afc18493ff506a23b7c89174b7e6a8992">transaction_list_update_cell</a> (last_col, last_line);
<a name="l02349"></a>02349     }
<a name="l02350"></a>02350 
<a name="l02351"></a>02351     <span class="comment">/* now we can update the element */</span>
<a name="l02352"></a>02352     <a class="code" href="transaction__list_8c.html#aee9667138888c4cb946225cae2972363">transaction_list_update_element</a> ( element );
<a name="l02353"></a>02353     <a class="code" href="affichage__liste_8c.html#a0c0358b4457dcb87adf267e8fd04d971">recuperation_noms_colonnes_et_tips</a> ( );
<a name="l02354"></a>02354     update_titres_tree_view ( );
<a name="l02355"></a>02355 
<a name="l02356"></a>02356     <span class="comment">/* update the sort column */</span>
<a name="l02357"></a>02357     <span class="keywordflow">if</span> ( sort_column == last_col )
<a name="l02358"></a>02358     {
<a name="l02359"></a>02359         <a class="code" href="gsb__data__account_8c.html#a97c12eafdc8f9d87e352ad56553d0876">gsb_data_account_set_sort_column</a> ( current_account, col );
<a name="l02360"></a>02360         <a class="code" href="gsb__data__account_8c.html#a6af4a18a46285f8f08c87c7f47bd43cb">gsb_data_account_set_element_sort</a> ( current_account, col, element );
<a name="l02361"></a>02361         <a class="code" href="transaction__list__sort_8c.html#ad124c81fa4121869ac23b1e67a96a9d2">transaction_list_sort_set_column</a> ( col, 
<a name="l02362"></a>02362                                         <a class="code" href="gsb__data__account_8c.html#a241abfc115b880dab53eabba773be190">gsb_data_account_get_sort_type</a> ( current_account ) );
<a name="l02363"></a>02363     }
<a name="l02364"></a>02364 
<a name="l02365"></a>02365     <span class="keywordflow">if</span> ( <a class="code" href="parametres_8c.html#ab2a744f5d2124688473d13979420e911">etat</a>.<a class="code" href="structgsb__etat__t.html#a9d0fa9057da603e64a601d69d7bf2b51">modification_fichier</a> == 0 )
<a name="l02366"></a>02366         <a class="code" href="traitement__variables_8c.html#aa4084b9e508b1d1fea1d09c6b6208021">modification_fichier</a> ( TRUE );
<a name="l02367"></a>02367 
<a name="l02368"></a>02368     <span class="keywordflow">return</span> FALSE;
<a name="l02369"></a>02369 }
<a name="l02370"></a>02370 
<a name="l02371"></a>02371 
<a name="l02372"></a>02372 
<a name="l02378"></a>02378 gboolean assert_selected_transaction ()
<a name="l02379"></a>02379 {
<a name="l02380"></a>02380     <span class="keywordflow">if</span> ( <a class="code" href="gsb__data__account_8c.html#a6596a8dca0eaab412a036d23cb51a5b0">gsb_data_account_get_current_transaction_number</a> (<a class="code" href="navigation_8c.html#a3b668bf52ce71dcff3ea10c9db7be859">gsb_gui_navigation_get_current_account</a> ()) == -1 )
<a name="l02381"></a>02381         <span class="keywordflow">return</span> FALSE;
<a name="l02382"></a>02382 
<a name="l02383"></a>02383     <span class="keywordflow">return</span> TRUE;
<a name="l02384"></a>02384 }
<a name="l02385"></a>02385 
<a name="l02386"></a>02386 
<a name="l02390"></a><a class="code" href="gsb__transactions__list_8h.html#a2f2bb8bf01af048e33c47d43c8370a21">02390</a> gboolean <a class="code" href="gsb__transactions__list_8c.html#a2f2bb8bf01af048e33c47d43c8370a21">new_transaction</a> ()
<a name="l02391"></a>02391 {
<a name="l02392"></a>02392         <span class="keywordflow">if</span> ( <a class="code" href="navigation_8c.html#a3b668bf52ce71dcff3ea10c9db7be859">gsb_gui_navigation_get_current_account</a> ( ) == -1 )
<a name="l02393"></a>02393                 <span class="keywordflow">return</span> FALSE;
<a name="l02394"></a>02394 
<a name="l02395"></a>02395     gtk_notebook_set_current_page ( GTK_NOTEBOOK ( <a class="code" href="bet__config_8c.html#a8924516aa4170f932308e93cf93a785b">notebook_general</a> ), 1 );
<a name="l02396"></a>02396     <a class="code" href="gsb__form_8c.html#a5629926349c0078b226ef9da39c6c7c3">gsb_form_escape_form</a>();
<a name="l02397"></a>02397     <a class="code" href="gsb__form_8c.html#a6c04fa27ec8a5ddc37d4626cf4803648">gsb_form_show</a> (TRUE);
<a name="l02398"></a>02398     <a class="code" href="transaction__list__select_8c.html#a85f38a439156b883335de73220dca237">transaction_list_select</a> ( -1 );
<a name="l02399"></a>02399     <a class="code" href="gsb__transactions__list_8c.html#a01ca41bdcf1f932ae3a4289433d64cf5">gsb_transactions_list_edit_transaction</a> (-1);
<a name="l02400"></a>02400 
<a name="l02401"></a>02401     <span class="keywordflow">return</span> FALSE;
<a name="l02402"></a>02402 }
<a name="l02403"></a>02403 
<a name="l02404"></a>02404 
<a name="l02405"></a>02405 
<a name="l02409"></a><a class="code" href="gsb__transactions__list_8h.html#aa52082e3faa52c7be3aa7d5dd41d0731">02409</a> <span class="keywordtype">void</span> <a class="code" href="gsb__transactions__list_8c.html#aa52082e3faa52c7be3aa7d5dd41d0731">remove_transaction</a> ()
<a name="l02410"></a>02410 {
<a name="l02411"></a>02411     <span class="keywordflow">if</span> (! assert_selected_transaction()) <span class="keywordflow">return</span>;
<a name="l02412"></a>02412 
<a name="l02413"></a>02413     <a class="code" href="gsb__transactions__list_8c.html#ab0651c16a8ca47b70e7ccdb2d9c18ba1">gsb_transactions_list_delete_transaction</a> (<a class="code" href="gsb__data__account_8c.html#a6596a8dca0eaab412a036d23cb51a5b0">gsb_data_account_get_current_transaction_number</a> (<a class="code" href="navigation_8c.html#a3b668bf52ce71dcff3ea10c9db7be859">gsb_gui_navigation_get_current_account</a> ()),
<a name="l02414"></a>02414                                               TRUE );
<a name="l02415"></a>02415     gtk_notebook_set_current_page ( GTK_NOTEBOOK ( <a class="code" href="bet__config_8c.html#a8924516aa4170f932308e93cf93a785b">notebook_general</a> ), 1 );
<a name="l02416"></a>02416 }
<a name="l02417"></a>02417 
<a name="l02418"></a>02418 
<a name="l02419"></a>02419 
<a name="l02428"></a><a class="code" href="gsb__transactions__list_8h.html#a8da0807401b34e59349e9534ed0e9cd9">02428</a> gboolean <a class="code" href="gsb__transactions__list_8c.html#a8da0807401b34e59349e9534ed0e9cd9">clone_selected_transaction</a> ( GtkWidget *menu_item,
<a name="l02429"></a>02429                         gpointer null )
<a name="l02430"></a>02430 {
<a name="l02431"></a>02431     gint new_transaction_number;
<a name="l02432"></a>02432 
<a name="l02433"></a>02433     <span class="keywordflow">if</span> (! assert_selected_transaction())
<a name="l02434"></a>02434         <span class="keywordflow">return</span> FALSE;
<a name="l02435"></a>02435 
<a name="l02436"></a>02436     new_transaction_number = gsb_transactions_list_clone_transaction (
<a name="l02437"></a>02437                         <a class="code" href="gsb__data__account_8c.html#a6596a8dca0eaab412a036d23cb51a5b0">gsb_data_account_get_current_transaction_number</a> (
<a name="l02438"></a>02438                         <a class="code" href="navigation_8c.html#a3b668bf52ce71dcff3ea10c9db7be859">gsb_gui_navigation_get_current_account</a> ()),
<a name="l02439"></a>02439                         0 );
<a name="l02440"></a>02440 
<a name="l02441"></a>02441     <a class="code" href="utils__operations_8c.html#a74b8b20760e6e001d3344a0c9fc2204a">update_transaction_in_trees</a> (new_transaction_number);
<a name="l02442"></a>02442 
<a name="l02443"></a>02443     gtk_notebook_set_current_page ( GTK_NOTEBOOK ( <a class="code" href="bet__config_8c.html#a8924516aa4170f932308e93cf93a785b">notebook_general</a> ), 1 );
<a name="l02444"></a>02444 
<a name="l02445"></a>02445     <span class="comment">/* force the update module budget */</span>
<a name="l02446"></a>02446     <a class="code" href="gsb__data__account_8c.html#aad11cfab16ac44e8de3dd6d792fce4cd">gsb_data_account_set_bet_maj</a> ( <a class="code" href="navigation_8c.html#a3b668bf52ce71dcff3ea10c9db7be859">gsb_gui_navigation_get_current_account</a> ( ), <a class="code" href="structures_8h.html#ab021d1439ce505d767a56f4fc41af400a9d574c71c6a04cadf85be9083be54eed">BET_MAJ_ALL</a> );
<a name="l02447"></a>02447 
<a name="l02448"></a>02448     <span class="keywordflow">if</span> ( <a class="code" href="parametres_8c.html#ab2a744f5d2124688473d13979420e911">etat</a>.<a class="code" href="structgsb__etat__t.html#a9d0fa9057da603e64a601d69d7bf2b51">modification_fichier</a> == 0 )
<a name="l02449"></a>02449         <a class="code" href="traitement__variables_8c.html#aa4084b9e508b1d1fea1d09c6b6208021">modification_fichier</a> ( TRUE );
<a name="l02450"></a>02450     <span class="keywordflow">return</span> FALSE;
<a name="l02451"></a>02451 }
<a name="l02452"></a>02452 
<a name="l02453"></a>02453 
<a name="l02462"></a>02462 <span class="keyword">static</span> gboolean gsb_transactions_list_clone_template ( GtkWidget *menu_item,
<a name="l02463"></a>02463                         gpointer null )
<a name="l02464"></a>02464 {
<a name="l02465"></a>02465     gint new_transaction_number;
<a name="l02466"></a>02466 
<a name="l02467"></a>02467     <span class="keywordflow">if</span> ( !assert_selected_transaction ( ) )
<a name="l02468"></a>02468         <span class="keywordflow">return</span> FALSE;
<a name="l02469"></a>02469 
<a name="l02470"></a>02470     new_transaction_number = gsb_transactions_list_clone_transaction (
<a name="l02471"></a>02471                                     <a class="code" href="gsb__data__account_8c.html#a6596a8dca0eaab412a036d23cb51a5b0">gsb_data_account_get_current_transaction_number</a> (
<a name="l02472"></a>02472                                     <a class="code" href="navigation_8c.html#a3b668bf52ce71dcff3ea10c9db7be859">gsb_gui_navigation_get_current_account</a> ( ) ),
<a name="l02473"></a>02473                                                                     0 );
<a name="l02474"></a>02474 
<a name="l02475"></a>02475     <a class="code" href="utils__operations_8c.html#a74b8b20760e6e001d3344a0c9fc2204a">update_transaction_in_trees</a> ( new_transaction_number );
<a name="l02476"></a>02476 
<a name="l02477"></a>02477     <a class="code" href="transaction__list__select_8c.html#a85f38a439156b883335de73220dca237">transaction_list_select</a> ( new_transaction_number );
<a name="l02478"></a>02478     <a class="code" href="gsb__transactions__list_8c.html#a01ca41bdcf1f932ae3a4289433d64cf5">gsb_transactions_list_edit_transaction</a> ( new_transaction_number );
<a name="l02479"></a>02479     g_object_set_data ( G_OBJECT ( <a class="code" href="gsb__form_8c.html#a8cc8131c63a611a38f617ecd1e86b1e3">gsb_form_get_form_widget</a> ( ) ),
<a name="l02480"></a>02480                             <span class="stringliteral">&quot;transaction_selected_in_form&quot;</span>,
<a name="l02481"></a>02481                             GINT_TO_POINTER ( -1 ) );
<a name="l02482"></a>02482 
<a name="l02483"></a>02483     <span class="comment">/* force the update module budget */</span>
<a name="l02484"></a>02484     <a class="code" href="gsb__data__account_8c.html#aad11cfab16ac44e8de3dd6d792fce4cd">gsb_data_account_set_bet_maj</a> ( <a class="code" href="navigation_8c.html#a3b668bf52ce71dcff3ea10c9db7be859">gsb_gui_navigation_get_current_account</a> ( ), <a class="code" href="structures_8h.html#ab021d1439ce505d767a56f4fc41af400a9d574c71c6a04cadf85be9083be54eed">BET_MAJ_ALL</a> );
<a name="l02485"></a>02485 
<a name="l02486"></a>02486     <span class="keywordflow">if</span> ( <a class="code" href="parametres_8c.html#ab2a744f5d2124688473d13979420e911">etat</a>.<a class="code" href="structgsb__etat__t.html#a9d0fa9057da603e64a601d69d7bf2b51">modification_fichier</a> == 0 )
<a name="l02487"></a>02487         <a class="code" href="traitement__variables_8c.html#aa4084b9e508b1d1fea1d09c6b6208021">modification_fichier</a> ( TRUE );
<a name="l02488"></a>02488     <span class="keywordflow">return</span> FALSE;
<a name="l02489"></a>02489 }
<a name="l02490"></a>02490 
<a name="l02491"></a>02491 
<a name="l02501"></a>02501 gint gsb_transactions_list_clone_transaction ( gint transaction_number,
<a name="l02502"></a>02502                         gint mother_transaction_number )
<a name="l02503"></a>02503 {
<a name="l02504"></a>02504     gint new_transaction_number;
<a name="l02505"></a>02505 
<a name="l02506"></a>02506     <span class="comment">/* dupplicate the transaction */</span>
<a name="l02507"></a>02507     new_transaction_number = <a class="code" href="gsb__data__transaction_8c.html#af65a20fc0270cbfbc5d69f5d55da8112">gsb_data_transaction_new_transaction</a> (
<a name="l02508"></a>02508                                     <a class="code" href="gsb__data__transaction_8c.html#a5b486efbc486f946e9c998a114054bce">gsb_data_transaction_get_account_number</a> ( transaction_number ) );
<a name="l02509"></a>02509     <a class="code" href="gsb__data__transaction_8c.html#a62c650817612964ece479ede76beb9f3">gsb_data_transaction_copy_transaction</a> ( transaction_number,
<a name="l02510"></a>02510                                             new_transaction_number, TRUE );
<a name="l02511"></a>02511 
<a name="l02512"></a>02512     <span class="keywordflow">if</span> ( <a class="code" href="gsb__data__transaction_8c.html#a6018560ece7ab02e8d46bc9bdaffd607">gsb_data_transaction_get_mother_transaction_number</a> ( transaction_number )
<a name="l02513"></a>02513          &amp;&amp;
<a name="l02514"></a>02514          mother_transaction_number )
<a name="l02515"></a>02515         <a class="code" href="gsb__data__transaction_8c.html#abfffebad5a6949bd032c09311e3f995e">gsb_data_transaction_set_mother_transaction_number</a> ( new_transaction_number,
<a name="l02516"></a>02516                                                              mother_transaction_number );
<a name="l02517"></a>02517 
<a name="l02518"></a>02518     <span class="comment">/* create the contra-transaction if necessary */</span>
<a name="l02519"></a>02519     <span class="keywordflow">if</span> ( <a class="code" href="gsb__data__transaction_8c.html#a4040925a3db49485b5a2b0a8ea19d2ee">gsb_data_transaction_get_contra_transaction_number</a> ( transaction_number ) &gt; 0 )
<a name="l02520"></a>02520     {
<a name="l02521"></a>02521         <a class="code" href="gsb__form__transaction_8c.html#a71dba4f06ba2ca8857c36a489844dad7">gsb_form_transaction_validate_transfer</a> ( new_transaction_number,
<a name="l02522"></a>02522                                                 1,
<a name="l02523"></a>02523                                                 <a class="code" href="gsb__data__transaction_8c.html#a655b6ad03fae3a20ff86adffc95a3ab3">gsb_data_transaction_get_contra_transaction_account</a> (
<a name="l02524"></a>02524                         transaction_number ) );
<a name="l02525"></a>02525 
<a name="l02526"></a>02526         <span class="comment">/* we need to set the contra method of payment of the transfer */</span>
<a name="l02527"></a>02527         <a class="code" href="gsb__data__transaction_8c.html#a2ec47094f3a4b930dc6057f574af8019">gsb_data_transaction_set_method_of_payment_number</a> (
<a name="l02528"></a>02528                         <a class="code" href="gsb__data__transaction_8c.html#a4040925a3db49485b5a2b0a8ea19d2ee">gsb_data_transaction_get_contra_transaction_number</a> (
<a name="l02529"></a>02529                         new_transaction_number ),
<a name="l02530"></a>02530                                             <a class="code" href="gsb__data__transaction_8c.html#aa9bc2b3aba6d0a4df30e0584ab56ede0">gsb_data_transaction_get_method_of_payment_number</a> (
<a name="l02531"></a>02531                         <a class="code" href="gsb__data__transaction_8c.html#a4040925a3db49485b5a2b0a8ea19d2ee">gsb_data_transaction_get_contra_transaction_number</a> (
<a name="l02532"></a>02532                         transaction_number ) ) );
<a name="l02533"></a>02533     }
<a name="l02534"></a>02534 
<a name="l02535"></a>02535     <a class="code" href="gsb__transactions__list_8c.html#ab384002f4635a570bc9907b04b3efd24">gsb_transactions_list_append_new_transaction</a> ( new_transaction_number, TRUE );
<a name="l02536"></a>02536 
<a name="l02537"></a>02537     <span class="keywordflow">if</span> ( <a class="code" href="gsb__data__transaction_8c.html#a2de1ba38ee196b44e3c00c10e1d645cc">gsb_data_transaction_get_split_of_transaction</a> ( transaction_number ) )
<a name="l02538"></a>02538     {
<a name="l02539"></a>02539         <span class="comment">/* the transaction was a split, we look for the children to copy them */</span>
<a name="l02540"></a>02540 
<a name="l02541"></a>02541         GSList *list_tmp_transactions;
<a name="l02542"></a>02542         list_tmp_transactions = <a class="code" href="gsb__data__transaction_8c.html#af781a71a62eece020188ef62847f2887">gsb_data_transaction_get_transactions_list</a> ( );
<a name="l02543"></a>02543 
<a name="l02544"></a>02544         <span class="keywordflow">while</span> ( list_tmp_transactions )
<a name="l02545"></a>02545         {
<a name="l02546"></a>02546             gint transaction_number_tmp;
<a name="l02547"></a>02547             transaction_number_tmp = <a class="code" href="gsb__data__transaction_8c.html#a99bf548513083f4a71fe019faeccbe0a">gsb_data_transaction_get_transaction_number</a> (
<a name="l02548"></a>02548                                             list_tmp_transactions -&gt; data );
<a name="l02549"></a>02549 
<a name="l02550"></a>02550             <span class="keywordflow">if</span> ( <a class="code" href="gsb__data__transaction_8c.html#a5b486efbc486f946e9c998a114054bce">gsb_data_transaction_get_account_number</a> ( transaction_number_tmp )
<a name="l02551"></a>02551              == <a class="code" href="gsb__data__transaction_8c.html#a5b486efbc486f946e9c998a114054bce">gsb_data_transaction_get_account_number</a> ( transaction_number )
<a name="l02552"></a>02552              &amp;&amp;
<a name="l02553"></a>02553              <a class="code" href="gsb__data__transaction_8c.html#a6018560ece7ab02e8d46bc9bdaffd607">gsb_data_transaction_get_mother_transaction_number</a> ( transaction_number_tmp )
<a name="l02554"></a>02554              == transaction_number )
<a name="l02555"></a>02555                 gsb_transactions_list_clone_transaction (
<a name="l02556"></a>02556                             transaction_number_tmp, new_transaction_number );
<a name="l02557"></a>02557 
<a name="l02558"></a>02558             list_tmp_transactions = list_tmp_transactions -&gt; next;
<a name="l02559"></a>02559         }
<a name="l02560"></a>02560     }
<a name="l02561"></a>02561     <span class="keywordflow">if</span> ( <a class="code" href="parametres_8c.html#ab2a744f5d2124688473d13979420e911">etat</a>.<a class="code" href="structgsb__etat__t.html#ae3a5af3d26105e740e989e5c6804bab2">equilibrage</a> )
<a name="l02562"></a>02562         <a class="code" href="transaction__list_8c.html#acb52b4ec82acaa5e86ef02efad179bdd">transaction_list_show_toggle_mark</a> ( TRUE );
<a name="l02563"></a>02563 
<a name="l02564"></a>02564     <span class="keywordflow">return</span> new_transaction_number;
<a name="l02565"></a>02565 }
<a name="l02566"></a>02566 
<a name="l02567"></a>02567 
<a name="l02568"></a>02568 
<a name="l02577"></a>02577 gboolean move_selected_operation_to_account ( GtkMenuItem * menu_item,
<a name="l02578"></a>02578                         gpointer null )
<a name="l02579"></a>02579 {
<a name="l02580"></a>02580     gint target_account, source_account;
<a name="l02581"></a>02581 
<a name="l02582"></a>02582     <span class="keywordflow">if</span> (! assert_selected_transaction()) <span class="keywordflow">return</span> FALSE;
<a name="l02583"></a>02583 
<a name="l02584"></a>02584     source_account = <a class="code" href="navigation_8c.html#a3b668bf52ce71dcff3ea10c9db7be859">gsb_gui_navigation_get_current_account</a> ();
<a name="l02585"></a>02585     target_account = GPOINTER_TO_INT ( g_object_get_data ( G_OBJECT(menu_item),
<a name="l02586"></a>02586                                                              <span class="stringliteral">&quot;account_number&quot;</span> ) );
<a name="l02587"></a>02587 
<a name="l02588"></a>02588     <span class="keywordflow">if</span> ( gsb_transactions_list_move_transaction_to_account ( <a class="code" href="gsb__data__account_8c.html#a6596a8dca0eaab412a036d23cb51a5b0">gsb_data_account_get_current_transaction_number</a> (source_account),
<a name="l02589"></a>02589                                                              target_account ))
<a name="l02590"></a>02590     {
<a name="l02591"></a>02591         gtk_notebook_set_current_page ( GTK_NOTEBOOK ( <a class="code" href="bet__config_8c.html#a8924516aa4170f932308e93cf93a785b">notebook_general</a> ), 1 );
<a name="l02592"></a>02592 
<a name="l02593"></a>02593         <a class="code" href="utils__operations_8c.html#a74b8b20760e6e001d3344a0c9fc2204a">update_transaction_in_trees</a> (<a class="code" href="gsb__data__account_8c.html#a6596a8dca0eaab412a036d23cb51a5b0">gsb_data_account_get_current_transaction_number</a> (source_account));
<a name="l02594"></a>02594 
<a name="l02595"></a>02595     <a class="code" href="gsb__data__account_8c.html#a4607ab78b42360bded7a2203dca78931">gsb_data_account_colorize_current_balance</a> ( source_account );
<a name="l02596"></a>02596 
<a name="l02597"></a>02597     <a class="code" href="accueil_8c.html#a15511226739a34542ef8d7b979aedcf0">mise_a_jour_accueil</a> (FALSE);
<a name="l02598"></a>02598 
<a name="l02599"></a>02599         <span class="keywordflow">if</span> ( <a class="code" href="parametres_8c.html#ab2a744f5d2124688473d13979420e911">etat</a>.<a class="code" href="structgsb__etat__t.html#a9d0fa9057da603e64a601d69d7bf2b51">modification_fichier</a> == 0 )
<a name="l02600"></a>02600         <a class="code" href="traitement__variables_8c.html#aa4084b9e508b1d1fea1d09c6b6208021">modification_fichier</a> ( TRUE );
<a name="l02601"></a>02601     }
<a name="l02602"></a>02602     <span class="keywordflow">return</span> FALSE;
<a name="l02603"></a>02603 }
<a name="l02604"></a>02604 
<a name="l02605"></a>02605 
<a name="l02606"></a>02606 
<a name="l02613"></a><a class="code" href="gsb__transactions__list_8h.html#a28b9f175715bce0ac88b473e29ac2fea">02613</a> <span class="keywordtype">void</span> <a class="code" href="gsb__transactions__list_8c.html#a28b9f175715bce0ac88b473e29ac2fea">move_selected_operation_to_account_nb</a> ( gint *account )
<a name="l02614"></a>02614 {
<a name="l02615"></a>02615     gint target_account, source_account;
<a name="l02616"></a>02616 
<a name="l02617"></a>02617     <span class="keywordflow">if</span> (! assert_selected_transaction()) <span class="keywordflow">return</span>;
<a name="l02618"></a>02618 
<a name="l02619"></a>02619     source_account = <a class="code" href="navigation_8c.html#a3b668bf52ce71dcff3ea10c9db7be859">gsb_gui_navigation_get_current_account</a> ();
<a name="l02620"></a>02620     target_account = GPOINTER_TO_INT ( account );
<a name="l02621"></a>02621 
<a name="l02622"></a>02622     <span class="keywordflow">if</span> ( gsb_transactions_list_move_transaction_to_account ( <a class="code" href="gsb__data__account_8c.html#a6596a8dca0eaab412a036d23cb51a5b0">gsb_data_account_get_current_transaction_number</a> (source_account),
<a name="l02623"></a>02623                                                              target_account ))
<a name="l02624"></a>02624     {
<a name="l02625"></a>02625         gtk_notebook_set_current_page ( GTK_NOTEBOOK ( <a class="code" href="bet__config_8c.html#a8924516aa4170f932308e93cf93a785b">notebook_general</a> ), 1 );
<a name="l02626"></a>02626 
<a name="l02627"></a>02627         <a class="code" href="utils__operations_8c.html#a74b8b20760e6e001d3344a0c9fc2204a">update_transaction_in_trees</a> ( <a class="code" href="gsb__data__account_8c.html#a6596a8dca0eaab412a036d23cb51a5b0">gsb_data_account_get_current_transaction_number</a> (
<a name="l02628"></a>02628                         source_account ) ) ;
<a name="l02629"></a>02629 
<a name="l02630"></a>02630     <a class="code" href="gsb__data__account_8c.html#a4607ab78b42360bded7a2203dca78931">gsb_data_account_colorize_current_balance</a> ( source_account );
<a name="l02631"></a>02631 
<a name="l02632"></a>02632         <span class="keywordflow">if</span> ( <a class="code" href="parametres_8c.html#ab2a744f5d2124688473d13979420e911">etat</a>.<a class="code" href="structgsb__etat__t.html#a9d0fa9057da603e64a601d69d7bf2b51">modification_fichier</a> == 0 )
<a name="l02633"></a>02633         <a class="code" href="traitement__variables_8c.html#aa4084b9e508b1d1fea1d09c6b6208021">modification_fichier</a> ( TRUE );
<a name="l02634"></a>02634     }
<a name="l02635"></a>02635 }
<a name="l02636"></a>02636 
<a name="l02637"></a>02637 
<a name="l02638"></a>02638 
<a name="l02646"></a>02646 gboolean gsb_transactions_list_move_transaction_to_account ( gint transaction_number,
<a name="l02647"></a>02647                         gint target_account )
<a name="l02648"></a>02648 {
<a name="l02649"></a>02649     gint source_account;
<a name="l02650"></a>02650     gint contra_transaction_number;
<a name="l02651"></a>02651     gint current_account;
<a name="l02652"></a>02652 
<a name="l02653"></a>02653     <a class="code" href="erreur_8h.html#a10f4eeae4cc251a8d632fd62ec1057fb">devel_debug_int</a> ( target_account );
<a name="l02654"></a>02654 
<a name="l02655"></a>02655     source_account = <a class="code" href="gsb__data__transaction_8c.html#a5b486efbc486f946e9c998a114054bce">gsb_data_transaction_get_account_number</a> (transaction_number);
<a name="l02656"></a>02656     contra_transaction_number = <a class="code" href="gsb__data__transaction_8c.html#a4040925a3db49485b5a2b0a8ea19d2ee">gsb_data_transaction_get_contra_transaction_number</a> (
<a name="l02657"></a>02657                         transaction_number);
<a name="l02658"></a>02658 
<a name="l02659"></a>02659     <span class="comment">/* if it&#39;s a transfer, update the contra-transaction category line */</span>
<a name="l02660"></a>02660     <span class="keywordflow">if</span> (contra_transaction_number &gt; 0)
<a name="l02661"></a>02661     {
<a name="l02662"></a>02662         <span class="comment">/* the transaction is a transfer, we check if the contra-transaction is not on </span>
<a name="l02663"></a>02663 <span class="comment">         * the target account */</span>
<a name="l02664"></a>02664         <span class="keywordflow">if</span> ( <a class="code" href="gsb__data__transaction_8c.html#a5b486efbc486f946e9c998a114054bce">gsb_data_transaction_get_account_number</a> (
<a name="l02665"></a>02665                         contra_transaction_number) == target_account )
<a name="l02666"></a>02666         {
<a name="l02667"></a>02667             <a class="code" href="dialog_8c.html#aa88d9d93c78818a177e9a14eff15f360">dialogue_error</a> ( _(<span class="stringliteral">&quot;Cannot move a transfer on his contra-account&quot;</span>));
<a name="l02668"></a>02668             <span class="keywordflow">return</span> FALSE;
<a name="l02669"></a>02669         }
<a name="l02670"></a>02670     }
<a name="l02671"></a>02671 
<a name="l02672"></a>02672     <span class="comment">/* we change now the account of the transaction */</span>
<a name="l02673"></a>02673     <a class="code" href="gsb__data__transaction_8c.html#a06c1da0256f9341801ea21685bb99186">gsb_data_transaction_set_account_number</a> ( transaction_number,
<a name="l02674"></a>02674                                               target_account );
<a name="l02675"></a>02675 
<a name="l02676"></a>02676     <span class="comment">/* update the field of the contra transaction if necessary. Ce transfert ne doit pas</span>
<a name="l02677"></a>02677 <span class="comment">     * modifier la balance du compte */</span>
<a name="l02678"></a>02678     <span class="keywordflow">if</span> (contra_transaction_number &gt; 0)
<a name="l02679"></a>02679         <a class="code" href="transaction__list_8c.html#a7530aa4be260035a39dc5de2acbb8f62">transaction_list_update_transaction</a> (contra_transaction_number);
<a name="l02680"></a>02680 
<a name="l02681"></a>02681 
<a name="l02682"></a>02682     <span class="comment">/* normally we can change the account only by right click button</span>
<a name="l02683"></a>02683 <span class="comment">     * so the current transaction is selected,</span>
<a name="l02684"></a>02684 <span class="comment">     * so move the selection down */</span>
<a name="l02685"></a>02685     <a class="code" href="transaction__list__select_8c.html#aad826f93d59044effba7ca1c31eccabb">transaction_list_select_down</a> (FALSE);
<a name="l02686"></a>02686 
<a name="l02687"></a>02687     <span class="comment">/* normally we are on the source account, if ever we are not, check here</span>
<a name="l02688"></a>02688 <span class="comment">     * what we have to update */</span>
<a name="l02689"></a>02689     current_account = <a class="code" href="navigation_8c.html#a3b668bf52ce71dcff3ea10c9db7be859">gsb_gui_navigation_get_current_account</a> ();
<a name="l02690"></a>02690     <span class="keywordflow">if</span> (current_account == source_account
<a name="l02691"></a>02691         ||
<a name="l02692"></a>02692         current_account == target_account)
<a name="l02693"></a>02693         <a class="code" href="gsb__transactions__list_8c.html#ab7d08f59bcf7149edda9db47e67333a4">gsb_transactions_list_update_tree_view</a> ( current_account, FALSE );
<a name="l02694"></a>02694 
<a name="l02695"></a>02695     <span class="comment">/* update the first page */</span>
<a name="l02696"></a>02696     <a class="code" href="accueil_8c.html#a018917e8dacfd8fbe4e94d0f99a59c08">mise_a_jour_liste_comptes_accueil</a> = 1;
<a name="l02697"></a>02697     <a class="code" href="accueil_8c.html#afaffaedc4fd0ae8638f7158c6777b35b">mise_a_jour_soldes_minimaux</a> = 1;
<a name="l02698"></a>02698 
<a name="l02699"></a>02699     <span class="keywordflow">return</span> TRUE;
<a name="l02700"></a>02700 }
<a name="l02701"></a>02701 
<a name="l02702"></a>02702 
<a name="l02703"></a>02703 
<a name="l02708"></a><a class="code" href="gsb__transactions__list_8h.html#a57f2d9faad61b1154270e444656bd275">02708</a> <span class="keywordtype">void</span> <a class="code" href="gsb__transactions__list_8c.html#a57f2d9faad61b1154270e444656bd275">schedule_selected_transaction</a> ()
<a name="l02709"></a>02709 {
<a name="l02710"></a>02710     gint scheduled_number;
<a name="l02711"></a>02711 
<a name="l02712"></a>02712     <span class="keywordflow">if</span> (!assert_selected_transaction())
<a name="l02713"></a>02713         <span class="keywordflow">return</span>;
<a name="l02714"></a>02714 
<a name="l02715"></a>02715     scheduled_number = schedule_transaction ( <a class="code" href="gsb__data__account_8c.html#a6596a8dca0eaab412a036d23cb51a5b0">gsb_data_account_get_current_transaction_number</a> (<a class="code" href="navigation_8c.html#a3b668bf52ce71dcff3ea10c9db7be859">gsb_gui_navigation_get_current_account</a> ()));
<a name="l02716"></a>02716 
<a name="l02717"></a>02717     <a class="code" href="accueil_8c.html#a097d2eb216e05a68a5a153e7b68b6469">mise_a_jour_liste_echeances_auto_accueil</a> = 1;
<a name="l02718"></a>02718 
<a name="l02719"></a>02719     <a class="code" href="navigation_8c.html#a3fb9bd34026d724eefe1309fb63bf8fc">gsb_gui_navigation_set_selection</a> (<a class="code" href="fenetre__principale_8h.html#a1667fdc1081851887c24c98c97d51767abcbf0d210d0e459dd61aeb38b8a94a34">GSB_SCHEDULER_PAGE</a>, 0, NULL);
<a name="l02720"></a>02720     <a class="code" href="gsb__scheduler__list_8c.html#acbc7a6e13ae89beb5afb56a3e8bba495">gsb_scheduler_list_select</a> (scheduled_number);
<a name="l02721"></a>02721     <a class="code" href="gsb__scheduler__list_8c.html#a10a206d10ab971adb3ea36ec263c34d2">gsb_scheduler_list_edit_transaction</a> (scheduled_number);
<a name="l02722"></a>02722 
<a name="l02723"></a>02723     <span class="keywordflow">if</span> ( <a class="code" href="parametres_8c.html#ab2a744f5d2124688473d13979420e911">etat</a>.<a class="code" href="structgsb__etat__t.html#a9d0fa9057da603e64a601d69d7bf2b51">modification_fichier</a> == 0 )
<a name="l02724"></a>02724         <a class="code" href="traitement__variables_8c.html#aa4084b9e508b1d1fea1d09c6b6208021">modification_fichier</a> ( TRUE );
<a name="l02725"></a>02725 }
<a name="l02726"></a>02726 
<a name="l02727"></a>02727 
<a name="l02728"></a>02728 
<a name="l02736"></a>02736 gint schedule_transaction ( gint transaction_number )
<a name="l02737"></a>02737 {
<a name="l02738"></a>02738     gint scheduled_number;
<a name="l02739"></a>02739 
<a name="l02740"></a>02740     scheduled_number = <a class="code" href="gsb__data__scheduled_8c.html#a2ee4e80b44acc9dfebb787bb5e99b79f">gsb_data_scheduled_new_scheduled</a> ();
<a name="l02741"></a>02741 
<a name="l02742"></a>02742     <span class="keywordflow">if</span> ( !scheduled_number)
<a name="l02743"></a>02743         <span class="keywordflow">return</span> FALSE;
<a name="l02744"></a>02744 
<a name="l02745"></a>02745     <a class="code" href="gsb__data__scheduled_8c.html#a07c390be754930ef6fc318936fb358bd">gsb_data_scheduled_set_account_number</a> ( scheduled_number,
<a name="l02746"></a>02746                                             <a class="code" href="gsb__data__transaction_8c.html#a5b486efbc486f946e9c998a114054bce">gsb_data_transaction_get_account_number</a> (transaction_number));
<a name="l02747"></a>02747     <a class="code" href="gsb__data__scheduled_8c.html#a99a6e04b2a44d0050dd9c2028df91d6a">gsb_data_scheduled_set_date</a> ( scheduled_number,
<a name="l02748"></a>02748                                   <a class="code" href="gsb__data__transaction_8c.html#ab0b62014885bcf3e2fbfff1ae9b32080">gsb_data_transaction_get_date</a> (transaction_number));
<a name="l02749"></a>02749     <a class="code" href="gsb__data__scheduled_8c.html#a7015befa34c5a73725f1ba06512b5a09">gsb_data_scheduled_set_amount</a> ( scheduled_number,
<a name="l02750"></a>02750                                     <a class="code" href="gsb__data__transaction_8c.html#a632c5ba71e742b3ac063b4b3207cf032">gsb_data_transaction_get_amount</a> (transaction_number));
<a name="l02751"></a>02751     <a class="code" href="gsb__data__scheduled_8c.html#a3825c62dc8b89912d6fe910f5190ab0e">gsb_data_scheduled_set_currency_number</a> ( scheduled_number,
<a name="l02752"></a>02752                                              <a class="code" href="gsb__data__transaction_8c.html#aa39edcb597bd75a438b00b67cf898e88">gsb_data_transaction_get_currency_number</a> (transaction_number));
<a name="l02753"></a>02753     <a class="code" href="gsb__data__scheduled_8c.html#a91c6d9659e496ece4de95ce4fbc24f25">gsb_data_scheduled_set_party_number</a> ( scheduled_number,
<a name="l02754"></a>02754                                           <a class="code" href="gsb__data__transaction_8c.html#afa032df45afa2ad7a4be48449a7e8d15">gsb_data_transaction_get_party_number</a> (transaction_number));
<a name="l02755"></a>02755     <a class="code" href="gsb__data__scheduled_8c.html#ad29b4497cacf9929c087ab5a84bcfc08">gsb_data_scheduled_set_category_number</a> ( scheduled_number,
<a name="l02756"></a>02756                                              <a class="code" href="gsb__data__transaction_8c.html#a5cdaf5e8911118bf8d1dbdfc42dc4761">gsb_data_transaction_get_category_number</a> (transaction_number));
<a name="l02757"></a>02757     <a class="code" href="gsb__data__scheduled_8c.html#ae7231fb0de3b9b5c8a4f5dfebedfac75">gsb_data_scheduled_set_sub_category_number</a> ( scheduled_number,
<a name="l02758"></a>02758                                                  <a class="code" href="gsb__data__transaction_8c.html#a2e0ed6fbd584d4363d75e4b0155660b7">gsb_data_transaction_get_sub_category_number</a> (transaction_number));
<a name="l02759"></a>02759 
<a name="l02760"></a>02760     <span class="comment">/*     pour 1 virement, categ et sous categ sont à 0, et compte_virement contient le no de compte */</span>
<a name="l02761"></a>02761     <span class="comment">/*  mais si categ et sous categ sont à 0 et que ce n&#39;est pas un virement ni une ventil, compte_virement = -1 */</span>
<a name="l02762"></a>02762     <span class="comment">/*     on va changer ça la prochaine version, dès que c&#39;est pas un virement -&gt; -1 */</span>
<a name="l02763"></a>02763 
<a name="l02764"></a>02764     <span class="keywordflow">if</span> ( <a class="code" href="gsb__data__transaction_8c.html#a4040925a3db49485b5a2b0a8ea19d2ee">gsb_data_transaction_get_contra_transaction_number</a> (transaction_number) &gt; 0)
<a name="l02765"></a>02765     {
<a name="l02766"></a>02766         <span class="comment">/*      c&#39;est un virement, on met la relation et on recherche le type de la contre opération */</span>
<a name="l02767"></a>02767 
<a name="l02768"></a>02768         gint contra_transaction_number;
<a name="l02769"></a>02769 
<a name="l02770"></a>02770         <a class="code" href="gsb__data__scheduled_8c.html#ae87ba81a40b3b2906f57caf4234cb92f">gsb_data_scheduled_set_account_number_transfer</a> ( scheduled_number,
<a name="l02771"></a>02771                                                          <a class="code" href="gsb__data__transaction_8c.html#a655b6ad03fae3a20ff86adffc95a3ab3">gsb_data_transaction_get_contra_transaction_account</a> (transaction_number));
<a name="l02772"></a>02772 
<a name="l02773"></a>02773         contra_transaction_number = <a class="code" href="gsb__data__transaction_8c.html#a4040925a3db49485b5a2b0a8ea19d2ee">gsb_data_transaction_get_contra_transaction_number</a> (transaction_number);
<a name="l02774"></a>02774 
<a name="l02775"></a>02775         <a class="code" href="gsb__data__scheduled_8c.html#a8fcb6154f8ab3b51eb2c9aa99b4f4362">gsb_data_scheduled_set_contra_method_of_payment_number</a> ( scheduled_number,
<a name="l02776"></a>02776                                                                  <a class="code" href="gsb__data__transaction_8c.html#aa9bc2b3aba6d0a4df30e0584ab56ede0">gsb_data_transaction_get_method_of_payment_number</a> (contra_transaction_number));
<a name="l02777"></a>02777     }
<a name="l02778"></a>02778     <span class="keywordflow">else</span>
<a name="l02779"></a>02779         <span class="keywordflow">if</span> ( !<a class="code" href="gsb__data__scheduled_8c.html#a6d9e3ecf8c981f4d49d7b4c3d0f5dd86">gsb_data_scheduled_get_category_number</a> (scheduled_number)
<a name="l02780"></a>02780              &amp;&amp;
<a name="l02781"></a>02781              !<a class="code" href="gsb__data__transaction_8c.html#a2de1ba38ee196b44e3c00c10e1d645cc">gsb_data_transaction_get_split_of_transaction</a> (transaction_number))
<a name="l02782"></a>02782             <a class="code" href="gsb__data__scheduled_8c.html#ae87ba81a40b3b2906f57caf4234cb92f">gsb_data_scheduled_set_account_number_transfer</a> ( scheduled_number,
<a name="l02783"></a>02783                                                              -1 );
<a name="l02784"></a>02784 
<a name="l02785"></a>02785     <a class="code" href="gsb__data__scheduled_8c.html#aeb1f51ee0889bf8736e7ab914e0aeec1">gsb_data_scheduled_set_notes</a> ( scheduled_number,
<a name="l02786"></a>02786                                    <a class="code" href="gsb__data__transaction_8c.html#ad73b393673217f5b9cc295c74e030550">gsb_data_transaction_get_notes</a> (transaction_number));
<a name="l02787"></a>02787     <a class="code" href="gsb__data__scheduled_8c.html#a8ab4146a9644d811614d40761cffb8ff">gsb_data_scheduled_set_method_of_payment_number</a> ( scheduled_number,
<a name="l02788"></a>02788                                                       <a class="code" href="gsb__data__transaction_8c.html#aa9bc2b3aba6d0a4df30e0584ab56ede0">gsb_data_transaction_get_method_of_payment_number</a> (transaction_number));
<a name="l02789"></a>02789     <a class="code" href="gsb__data__scheduled_8c.html#a3aff926c0e3cccd2731a1d023e770a34">gsb_data_scheduled_set_method_of_payment_content</a> ( scheduled_number,
<a name="l02790"></a>02790                                                        <a class="code" href="gsb__data__transaction_8c.html#a018a31b8a8fe99e813b4876206cf59a1">gsb_data_transaction_get_method_of_payment_content</a> (transaction_number));
<a name="l02791"></a>02791 
<a name="l02792"></a>02792     <a class="code" href="gsb__data__scheduled_8c.html#ac692709b96f3876b8df8a081021e1bab">gsb_data_scheduled_set_financial_year_number</a> ( scheduled_number,
<a name="l02793"></a>02793                                                    <a class="code" href="gsb__data__transaction_8c.html#ae8f3e659e304f02abd6c2ae7dd759203">gsb_data_transaction_get_financial_year_number</a> (transaction_number));
<a name="l02794"></a>02794     <a class="code" href="gsb__data__scheduled_8c.html#a2e5a09822c03b4147c3d0b7c0b727e78">gsb_data_scheduled_set_budgetary_number</a> ( scheduled_number,
<a name="l02795"></a>02795                                               <a class="code" href="gsb__data__transaction_8c.html#a4d84c55dbdfa032c500f4ade0754501f">gsb_data_transaction_get_budgetary_number</a> (transaction_number));
<a name="l02796"></a>02796     <a class="code" href="gsb__data__scheduled_8c.html#a8bf824ef47fb1e26554ac1c4b7df2438">gsb_data_scheduled_set_sub_budgetary_number</a> ( scheduled_number,
<a name="l02797"></a>02797                                                   <a class="code" href="gsb__data__transaction_8c.html#a44dbcf1f953a233d0038027289aa2372">gsb_data_transaction_get_sub_budgetary_number</a> (transaction_number));
<a name="l02798"></a>02798     <a class="code" href="gsb__data__scheduled_8c.html#a99239d1e344d4e3d86a28c95632ab234">gsb_data_scheduled_set_split_of_scheduled</a> ( scheduled_number,
<a name="l02799"></a>02799                                                 <a class="code" href="gsb__data__transaction_8c.html#a2de1ba38ee196b44e3c00c10e1d645cc">gsb_data_transaction_get_split_of_transaction</a> (transaction_number));
<a name="l02800"></a>02800 
<a name="l02801"></a>02801     <span class="comment">/*     par défaut, on met en manuel, pour éviter si l&#39;utilisateur se gourre dans la date, */</span>
<a name="l02802"></a>02802     <span class="comment">/*     (c&#39;est le cas, à 0 avec g_malloc0) */</span>
<a name="l02803"></a>02803     <span class="comment">/*     que l&#39;opé soit enregistrée immédiatement ; de même on le met en mensuel par défaut */</span>
<a name="l02804"></a>02804     <span class="comment">/*  pour la même raison */</span>
<a name="l02805"></a>02805 
<a name="l02806"></a>02806     <a class="code" href="gsb__data__scheduled_8c.html#a3752ff74a4faa566975281e33ae6318b">gsb_data_scheduled_set_frequency</a> ( scheduled_number,
<a name="l02807"></a>02807                                        2);
<a name="l02808"></a>02808 
<a name="l02809"></a>02809     <span class="comment">/*     on récupère les opés de ventil si c&#39;était une opé ventilée */</span>
<a name="l02810"></a>02810 
<a name="l02811"></a>02811     <span class="keywordflow">if</span> ( <a class="code" href="gsb__data__scheduled_8c.html#ae2bbf34058b508781bd4af1292b64d6a">gsb_data_scheduled_get_split_of_scheduled</a> ( scheduled_number))
<a name="l02812"></a>02812         <a class="code" href="gsb__transactions__list_8c.html#a0ea3d83f0d74d289b6ae23c495f4aa7d">gsb_transactions_list_splitted_to_scheduled</a> (transaction_number, scheduled_number);
<a name="l02813"></a>02813     <span class="keywordflow">return</span> scheduled_number;
<a name="l02814"></a>02814 }
<a name="l02815"></a>02815 
<a name="l02816"></a>02816 
<a name="l02817"></a>02817 
<a name="l02826"></a><a class="code" href="gsb__transactions__list_8h.html#a0ea3d83f0d74d289b6ae23c495f4aa7d">02826</a> <span class="keywordtype">void</span> <a class="code" href="gsb__transactions__list_8c.html#a0ea3d83f0d74d289b6ae23c495f4aa7d">gsb_transactions_list_splitted_to_scheduled</a> ( gint transaction_number,
<a name="l02827"></a>02827                         gint scheduled_number )
<a name="l02828"></a>02828 {
<a name="l02829"></a>02829     GSList *list_tmp_transactions;
<a name="l02830"></a>02830     list_tmp_transactions = <a class="code" href="gsb__data__transaction_8c.html#af781a71a62eece020188ef62847f2887">gsb_data_transaction_get_transactions_list</a> ();
<a name="l02831"></a>02831 
<a name="l02832"></a>02832     <span class="keywordflow">while</span> ( list_tmp_transactions )
<a name="l02833"></a>02833     {
<a name="l02834"></a>02834         gint transaction_number_tmp;
<a name="l02835"></a>02835         transaction_number_tmp = <a class="code" href="gsb__data__transaction_8c.html#a99bf548513083f4a71fe019faeccbe0a">gsb_data_transaction_get_transaction_number</a> (list_tmp_transactions -&gt; data);
<a name="l02836"></a>02836 
<a name="l02837"></a>02837         <span class="keywordflow">if</span> ( <a class="code" href="gsb__data__transaction_8c.html#a5b486efbc486f946e9c998a114054bce">gsb_data_transaction_get_account_number</a> (transaction_number_tmp) == <a class="code" href="gsb__data__transaction_8c.html#a5b486efbc486f946e9c998a114054bce">gsb_data_transaction_get_account_number</a> (transaction_number)
<a name="l02838"></a>02838              &amp;&amp;
<a name="l02839"></a>02839              <a class="code" href="gsb__data__transaction_8c.html#a6018560ece7ab02e8d46bc9bdaffd607">gsb_data_transaction_get_mother_transaction_number</a> (transaction_number_tmp) == transaction_number)
<a name="l02840"></a>02840         {
<a name="l02841"></a>02841             gint split_scheduled_number;
<a name="l02842"></a>02842 
<a name="l02843"></a>02843             split_scheduled_number = <a class="code" href="gsb__data__scheduled_8c.html#a2ee4e80b44acc9dfebb787bb5e99b79f">gsb_data_scheduled_new_scheduled</a> ();
<a name="l02844"></a>02844 
<a name="l02845"></a>02845             <span class="keywordflow">if</span> ( !split_scheduled_number)
<a name="l02846"></a>02846                 <span class="keywordflow">return</span>;
<a name="l02847"></a>02847 
<a name="l02848"></a>02848             <a class="code" href="gsb__data__scheduled_8c.html#a07c390be754930ef6fc318936fb358bd">gsb_data_scheduled_set_account_number</a> ( split_scheduled_number,
<a name="l02849"></a>02849                                                     <a class="code" href="gsb__data__transaction_8c.html#a5b486efbc486f946e9c998a114054bce">gsb_data_transaction_get_account_number</a> (transaction_number_tmp));
<a name="l02850"></a>02850             <a class="code" href="gsb__data__scheduled_8c.html#a99a6e04b2a44d0050dd9c2028df91d6a">gsb_data_scheduled_set_date</a> ( split_scheduled_number,
<a name="l02851"></a>02851                                           <a class="code" href="gsb__data__transaction_8c.html#ab0b62014885bcf3e2fbfff1ae9b32080">gsb_data_transaction_get_date</a> (transaction_number_tmp));
<a name="l02852"></a>02852             <a class="code" href="gsb__data__scheduled_8c.html#a7015befa34c5a73725f1ba06512b5a09">gsb_data_scheduled_set_amount</a> ( split_scheduled_number,
<a name="l02853"></a>02853                                             <a class="code" href="gsb__data__transaction_8c.html#a632c5ba71e742b3ac063b4b3207cf032">gsb_data_transaction_get_amount</a> (transaction_number_tmp));
<a name="l02854"></a>02854             <a class="code" href="gsb__data__scheduled_8c.html#a3825c62dc8b89912d6fe910f5190ab0e">gsb_data_scheduled_set_currency_number</a> ( split_scheduled_number,
<a name="l02855"></a>02855                                                      <a class="code" href="gsb__data__transaction_8c.html#aa39edcb597bd75a438b00b67cf898e88">gsb_data_transaction_get_currency_number</a> (transaction_number_tmp));
<a name="l02856"></a>02856             <a class="code" href="gsb__data__scheduled_8c.html#a91c6d9659e496ece4de95ce4fbc24f25">gsb_data_scheduled_set_party_number</a> ( split_scheduled_number,
<a name="l02857"></a>02857                                                   <a class="code" href="gsb__data__transaction_8c.html#afa032df45afa2ad7a4be48449a7e8d15">gsb_data_transaction_get_party_number</a> (transaction_number_tmp));
<a name="l02858"></a>02858             <a class="code" href="gsb__data__scheduled_8c.html#ad29b4497cacf9929c087ab5a84bcfc08">gsb_data_scheduled_set_category_number</a> ( split_scheduled_number,
<a name="l02859"></a>02859                                                      <a class="code" href="gsb__data__transaction_8c.html#a5cdaf5e8911118bf8d1dbdfc42dc4761">gsb_data_transaction_get_category_number</a> (transaction_number_tmp));
<a name="l02860"></a>02860             <a class="code" href="gsb__data__scheduled_8c.html#ae7231fb0de3b9b5c8a4f5dfebedfac75">gsb_data_scheduled_set_sub_category_number</a> ( split_scheduled_number,
<a name="l02861"></a>02861                                                          <a class="code" href="gsb__data__transaction_8c.html#a2e0ed6fbd584d4363d75e4b0155660b7">gsb_data_transaction_get_sub_category_number</a> (transaction_number_tmp));
<a name="l02862"></a>02862 
<a name="l02863"></a>02863             <span class="comment">/*     pour 1 virement, categ et sous categ sont à 0, et compte_virement contient le no de compte */</span>
<a name="l02864"></a>02864             <span class="comment">/*  mais si categ et sous categ sont à 0 et que ce n&#39;est pas un virement, compte_virement = -1 */</span>
<a name="l02865"></a>02865             <span class="comment">/*     on va changer ça la prochaine version, dès que c&#39;est pas un virement -&gt; -1 */</span>
<a name="l02866"></a>02866 
<a name="l02867"></a>02867             <span class="keywordflow">if</span> ( <a class="code" href="gsb__data__transaction_8c.html#a4040925a3db49485b5a2b0a8ea19d2ee">gsb_data_transaction_get_contra_transaction_number</a> (transaction_number_tmp) &gt; 0)
<a name="l02868"></a>02868             {
<a name="l02869"></a>02869                 <span class="comment">/*      c&#39;est un virement, on met la relation et on recherche le type de la contre opération */</span>
<a name="l02870"></a>02870 
<a name="l02871"></a>02871                 gint contra_transaction_number;
<a name="l02872"></a>02872 
<a name="l02873"></a>02873                 <a class="code" href="gsb__data__scheduled_8c.html#ae87ba81a40b3b2906f57caf4234cb92f">gsb_data_scheduled_set_account_number_transfer</a> ( split_scheduled_number,
<a name="l02874"></a>02874                                                                  <a class="code" href="gsb__data__transaction_8c.html#a655b6ad03fae3a20ff86adffc95a3ab3">gsb_data_transaction_get_contra_transaction_account</a> (transaction_number_tmp));
<a name="l02875"></a>02875 
<a name="l02876"></a>02876                 contra_transaction_number = <a class="code" href="gsb__data__transaction_8c.html#a4040925a3db49485b5a2b0a8ea19d2ee">gsb_data_transaction_get_contra_transaction_number</a> (transaction_number_tmp);
<a name="l02877"></a>02877 
<a name="l02878"></a>02878                 <a class="code" href="gsb__data__scheduled_8c.html#a8fcb6154f8ab3b51eb2c9aa99b4f4362">gsb_data_scheduled_set_contra_method_of_payment_number</a> ( split_scheduled_number,
<a name="l02879"></a>02879                                                                          <a class="code" href="gsb__data__transaction_8c.html#aa9bc2b3aba6d0a4df30e0584ab56ede0">gsb_data_transaction_get_method_of_payment_number</a> (contra_transaction_number));
<a name="l02880"></a>02880             }
<a name="l02881"></a>02881             <span class="keywordflow">else</span>
<a name="l02882"></a>02882                 <span class="keywordflow">if</span> ( !<a class="code" href="gsb__data__scheduled_8c.html#a6d9e3ecf8c981f4d49d7b4c3d0f5dd86">gsb_data_scheduled_get_category_number</a> (split_scheduled_number))
<a name="l02883"></a>02883                     <a class="code" href="gsb__data__scheduled_8c.html#ae87ba81a40b3b2906f57caf4234cb92f">gsb_data_scheduled_set_account_number_transfer</a> ( split_scheduled_number,
<a name="l02884"></a>02884                                                                      -1 );
<a name="l02885"></a>02885 
<a name="l02886"></a>02886             <a class="code" href="gsb__data__scheduled_8c.html#aeb1f51ee0889bf8736e7ab914e0aeec1">gsb_data_scheduled_set_notes</a> ( split_scheduled_number,
<a name="l02887"></a>02887                                            <a class="code" href="gsb__data__transaction_8c.html#ad73b393673217f5b9cc295c74e030550">gsb_data_transaction_get_notes</a> (transaction_number_tmp));
<a name="l02888"></a>02888             <a class="code" href="gsb__data__scheduled_8c.html#a8ab4146a9644d811614d40761cffb8ff">gsb_data_scheduled_set_method_of_payment_number</a> ( split_scheduled_number,
<a name="l02889"></a>02889                                                               <a class="code" href="gsb__data__transaction_8c.html#aa9bc2b3aba6d0a4df30e0584ab56ede0">gsb_data_transaction_get_method_of_payment_number</a> (transaction_number_tmp));
<a name="l02890"></a>02890             <a class="code" href="gsb__data__scheduled_8c.html#a3aff926c0e3cccd2731a1d023e770a34">gsb_data_scheduled_set_method_of_payment_content</a> ( split_scheduled_number,
<a name="l02891"></a>02891                                                                <a class="code" href="gsb__data__transaction_8c.html#a018a31b8a8fe99e813b4876206cf59a1">gsb_data_transaction_get_method_of_payment_content</a> (transaction_number_tmp));
<a name="l02892"></a>02892             <a class="code" href="gsb__data__scheduled_8c.html#ac692709b96f3876b8df8a081021e1bab">gsb_data_scheduled_set_financial_year_number</a> ( split_scheduled_number,
<a name="l02893"></a>02893                                                            <a class="code" href="gsb__data__transaction_8c.html#ae8f3e659e304f02abd6c2ae7dd759203">gsb_data_transaction_get_financial_year_number</a> (transaction_number_tmp));
<a name="l02894"></a>02894             <a class="code" href="gsb__data__scheduled_8c.html#a2e5a09822c03b4147c3d0b7c0b727e78">gsb_data_scheduled_set_budgetary_number</a> ( split_scheduled_number,
<a name="l02895"></a>02895                                                       <a class="code" href="gsb__data__transaction_8c.html#a4d84c55dbdfa032c500f4ade0754501f">gsb_data_transaction_get_budgetary_number</a> (transaction_number_tmp));
<a name="l02896"></a>02896             <a class="code" href="gsb__data__scheduled_8c.html#a8bf824ef47fb1e26554ac1c4b7df2438">gsb_data_scheduled_set_sub_budgetary_number</a> ( split_scheduled_number,
<a name="l02897"></a>02897                                                           <a class="code" href="gsb__data__transaction_8c.html#a44dbcf1f953a233d0038027289aa2372">gsb_data_transaction_get_sub_budgetary_number</a> (transaction_number_tmp));
<a name="l02898"></a>02898 
<a name="l02899"></a>02899             <a class="code" href="gsb__data__scheduled_8c.html#a81e177057b8cee058231df2a82c98800">gsb_data_scheduled_set_mother_scheduled_number</a> ( split_scheduled_number,
<a name="l02900"></a>02900                                                              scheduled_number );
<a name="l02901"></a>02901 
<a name="l02902"></a>02902             <span class="comment">/*     par défaut, on met en manuel, pour éviter si l&#39;utilisateur se gourre dans la date, */</span>
<a name="l02903"></a>02903             <span class="comment">/*     (c&#39;est le cas, à 0 avec g_malloc0) */</span>
<a name="l02904"></a>02904             <span class="comment">/*     que l&#39;opé soit enregistrée immédiatement ; de même on le met en mensuel par défaut */</span>
<a name="l02905"></a>02905             <span class="comment">/*  pour la même raison */</span>
<a name="l02906"></a>02906 
<a name="l02907"></a>02907             <a class="code" href="gsb__data__scheduled_8c.html#a3752ff74a4faa566975281e33ae6318b">gsb_data_scheduled_set_frequency</a> ( split_scheduled_number,
<a name="l02908"></a>02908                                                2);
<a name="l02909"></a>02909         }
<a name="l02910"></a>02910         list_tmp_transactions = list_tmp_transactions -&gt; next;
<a name="l02911"></a>02911     }
<a name="l02912"></a>02912 }
<a name="l02913"></a>02913 
<a name="l02914"></a>02914 
<a name="l02926"></a>02926 gboolean gsb_transactions_list_title_column_button_press ( GtkWidget *button,
<a name="l02927"></a>02927                         GdkEventButton *ev,
<a name="l02928"></a>02928                         gint *no_column )
<a name="l02929"></a>02929 {
<a name="l02930"></a>02930     GtkWidget *menu, *menu_item;
<a name="l02931"></a>02931     gint i;
<a name="l02932"></a>02932     gint active_sort;
<a name="l02933"></a>02933     gint column_number;
<a name="l02934"></a>02934 
<a name="l02935"></a>02935     column_number = GPOINTER_TO_INT (no_column);
<a name="l02936"></a>02936     <a class="code" href="erreur_8h.html#a10f4eeae4cc251a8d632fd62ec1057fb">devel_debug_int</a> (column_number);
<a name="l02937"></a>02937 
<a name="l02938"></a>02938     <span class="keywordflow">switch</span> ( ev -&gt; button )
<a name="l02939"></a>02939     {
<a name="l02940"></a>02940         <span class="keywordflow">case</span> 3:
<a name="l02941"></a>02941             <span class="comment">/* we press the right button, show the popup */</span>
<a name="l02942"></a>02942 
<a name="l02943"></a>02943             menu = gtk_menu_new ();
<a name="l02944"></a>02944 
<a name="l02945"></a>02945             <span class="comment">/*  sort by line */</span>
<a name="l02946"></a>02946             menu_item = gtk_menu_item_new_with_label ( _(<span class="stringliteral">&quot;Sort list by :&quot;</span>) );
<a name="l02947"></a>02947 
<a name="l02948"></a>02948             <span class="comment">/*     les 2 signaux sont bloqués pour éviter que la ligne s&#39;affiche comme un bouton */</span>
<a name="l02949"></a>02949             <span class="comment">/* pas réussi à faire autrement... */</span>
<a name="l02950"></a>02950 
<a name="l02951"></a>02951             g_signal_connect ( G_OBJECT ( menu_item),
<a name="l02952"></a>02952                                <span class="stringliteral">&quot;enter-notify-event&quot;</span>,
<a name="l02953"></a>02953                                G_CALLBACK ( gtk_true ),
<a name="l02954"></a>02954                                NULL );
<a name="l02955"></a>02955             g_signal_connect ( G_OBJECT ( menu_item),
<a name="l02956"></a>02956                                <span class="stringliteral">&quot;motion-notify-event&quot;</span>,
<a name="l02957"></a>02957                                G_CALLBACK ( gtk_true ),
<a name="l02958"></a>02958                                NULL );
<a name="l02959"></a>02959 
<a name="l02960"></a>02960             gtk_menu_shell_append ( GTK_MENU_SHELL ( menu ),
<a name="l02961"></a>02961                               menu_item );
<a name="l02962"></a>02962             gtk_widget_show_all ( menu_item );
<a name="l02963"></a>02963 
<a name="l02964"></a>02964             menu_item = gtk_separator_menu_item_new ();
<a name="l02965"></a>02965             gtk_menu_shell_append ( GTK_MENU_SHELL ( menu ),
<a name="l02966"></a>02966                               menu_item );
<a name="l02967"></a>02967             gtk_widget_show ( menu_item );
<a name="l02968"></a>02968 
<a name="l02969"></a>02969 
<a name="l02970"></a>02970             active_sort = <a class="code" href="gsb__data__account_8c.html#a3a33d34a6980db2d4467d8f2fcb580d2">gsb_data_account_get_element_sort</a> ( <a class="code" href="navigation_8c.html#a3b668bf52ce71dcff3ea10c9db7be859">gsb_gui_navigation_get_current_account</a> (),
<a name="l02971"></a>02971                                                               column_number);
<a name="l02972"></a>02972 
<a name="l02973"></a>02973             <span class="comment">/*     get the name of the labels of the columns and put them in a menu */</span>
<a name="l02974"></a>02974             <span class="keywordflow">for</span> ( i=0 ; i&lt;4 ; i++ )
<a name="l02975"></a>02975             {
<a name="l02976"></a>02976                 gchar *temp;
<a name="l02977"></a>02977 
<a name="l02978"></a>02978                 <span class="keywordflow">switch</span> ( <a class="code" href="affichage__liste_8c.html#a0c444565adac369ff42631d4b7b7e6bb">tab_affichage_ope</a>[i][column_number] )
<a name="l02979"></a>02979                 {
<a name="l02980"></a>02980                     <span class="keywordflow">case</span> 0:
<a name="l02981"></a>02981                         temp = NULL;
<a name="l02982"></a>02982                         <span class="keywordflow">break</span>;
<a name="l02983"></a>02983 
<a name="l02984"></a>02984                     <span class="keywordflow">default</span>:
<a name="l02985"></a>02985                         temp = _(g_slist_nth_data ( <a class="code" href="affichage__liste_8c.html#a53693b9d5a4ba330fa5650e09ef0519f">liste_labels_titres_colonnes_liste_ope</a>,
<a name="l02986"></a>02986                                                   <a class="code" href="affichage__liste_8c.html#a0c444565adac369ff42631d4b7b7e6bb">tab_affichage_ope</a>[i][column_number] - 1 ));
<a name="l02987"></a>02987                 }
<a name="l02988"></a>02988 
<a name="l02989"></a>02989                 <span class="keywordflow">if</span> ( temp
<a name="l02990"></a>02990                      &amp;&amp;
<a name="l02991"></a>02991                      strcmp ( temp,
<a name="l02992"></a>02992                               N_(<span class="stringliteral">&quot;Balance&quot;</span>)))
<a name="l02993"></a>02993                 {
<a name="l02994"></a>02994                     <span class="keywordflow">if</span> ( i )
<a name="l02995"></a>02995                         menu_item = gtk_radio_menu_item_new_with_label_from_widget ( GTK_RADIO_MENU_ITEM ( menu_item ),
<a name="l02996"></a>02996                                                                                      temp );
<a name="l02997"></a>02997                     <span class="keywordflow">else</span>
<a name="l02998"></a>02998                         menu_item = gtk_radio_menu_item_new_with_label ( NULL,
<a name="l02999"></a>02999                                                                          temp );
<a name="l03000"></a>03000 
<a name="l03001"></a>03001                     <span class="keywordflow">if</span> ( <a class="code" href="affichage__liste_8c.html#a0c444565adac369ff42631d4b7b7e6bb">tab_affichage_ope</a>[i][column_number] == active_sort )
<a name="l03002"></a>03002                         gtk_check_menu_item_set_active ( GTK_CHECK_MENU_ITEM ( menu_item ),
<a name="l03003"></a>03003                                                          TRUE );
<a name="l03004"></a>03004 
<a name="l03005"></a>03005                     g_object_set_data ( G_OBJECT ( menu_item ),
<a name="l03006"></a>03006                                         <span class="stringliteral">&quot;no_sort&quot;</span>,
<a name="l03007"></a>03007                                         GINT_TO_POINTER (<a class="code" href="affichage__liste_8c.html#a0c444565adac369ff42631d4b7b7e6bb">tab_affichage_ope</a>[i][column_number]));
<a name="l03008"></a>03008                     g_signal_connect ( G_OBJECT(menu_item),
<a name="l03009"></a>03009                                        <span class="stringliteral">&quot;activate&quot;</span>,
<a name="l03010"></a>03010                                        G_CALLBACK ( gsb_transactions_list_change_sort_type ),
<a name="l03011"></a>03011                                        no_column );
<a name="l03012"></a>03012                     gtk_menu_shell_append ( GTK_MENU_SHELL ( menu ),
<a name="l03013"></a>03013                                       menu_item );
<a name="l03014"></a>03014                     gtk_widget_show ( menu_item );
<a name="l03015"></a>03015                 }
<a name="l03016"></a>03016 
<a name="l03017"></a>03017             }
<a name="l03018"></a>03018 
<a name="l03019"></a>03019             gtk_menu_popup ( GTK_MENU(menu),
<a name="l03020"></a>03020                              NULL,
<a name="l03021"></a>03021                              NULL,
<a name="l03022"></a>03022                              NULL,
<a name="l03023"></a>03023                              NULL,
<a name="l03024"></a>03024                              3,
<a name="l03025"></a>03025                              gtk_get_current_event_time());
<a name="l03026"></a>03026             gtk_widget_show (menu);
<a name="l03027"></a>03027             <span class="keywordflow">break</span>;
<a name="l03028"></a>03028     }
<a name="l03029"></a>03029     <span class="keywordflow">return</span> FALSE;
<a name="l03030"></a>03030 }
<a name="l03031"></a>03031 
<a name="l03032"></a>03032 
<a name="l03042"></a>03042 gboolean gsb_transactions_list_change_sort_type ( GtkWidget *menu_item,
<a name="l03043"></a>03043                         gint *no_column )
<a name="l03044"></a>03044 {
<a name="l03045"></a>03045     gint column_number;
<a name="l03046"></a>03046     gint account_number;
<a name="l03047"></a>03047 
<a name="l03048"></a>03048     <a class="code" href="erreur_8h.html#a10f4eeae4cc251a8d632fd62ec1057fb">devel_debug_int</a> (GPOINTER_TO_INT (no_column));
<a name="l03049"></a>03049 
<a name="l03050"></a>03050     <span class="keywordflow">if</span> ( !gtk_check_menu_item_get_active ( GTK_CHECK_MENU_ITEM ( menu_item )))
<a name="l03051"></a>03051         <span class="keywordflow">return</span> FALSE;
<a name="l03052"></a>03052 
<a name="l03053"></a>03053     column_number = GPOINTER_TO_INT (no_column);
<a name="l03054"></a>03054     account_number = <a class="code" href="navigation_8c.html#a3b668bf52ce71dcff3ea10c9db7be859">gsb_gui_navigation_get_current_account</a> ();
<a name="l03055"></a>03055 
<a name="l03056"></a>03056     <span class="comment">/* set the new column to sort */</span>
<a name="l03057"></a>03057     <a class="code" href="gsb__data__account_8c.html#a97c12eafdc8f9d87e352ad56553d0876">gsb_data_account_set_sort_column</a> ( account_number,
<a name="l03058"></a>03058                                        column_number );
<a name="l03059"></a>03059 
<a name="l03060"></a>03060     <span class="comment">/* set the new element number used to sort this column */</span>
<a name="l03061"></a>03061     <a class="code" href="gsb__data__account_8c.html#a6af4a18a46285f8f08c87c7f47bd43cb">gsb_data_account_set_element_sort</a> ( account_number,
<a name="l03062"></a>03062                                         column_number,
<a name="l03063"></a>03063                                         GPOINTER_TO_INT ( g_object_get_data ( G_OBJECT ( menu_item),
<a name="l03064"></a>03064                                                                               <span class="stringliteral">&quot;no_sort&quot;</span> )));
<a name="l03065"></a>03065 
<a name="l03066"></a>03066     <span class="comment">/* we want a descending sort but gsb_transactions_list_change_sort_column will</span>
<a name="l03067"></a>03067 <span class="comment">     * invert the order, so set DESCENDING for now */</span>
<a name="l03068"></a>03068     <a class="code" href="transaction__list__sort_8c.html#ad124c81fa4121869ac23b1e67a96a9d2">transaction_list_sort_set_column</a> ( column_number,
<a name="l03069"></a>03069                                         GTK_SORT_DESCENDING );
<a name="l03070"></a>03070     gsb_transactions_list_change_sort_column (NULL, no_column);
<a name="l03071"></a>03071     <span class="keywordflow">return</span> FALSE;
<a name="l03072"></a>03072 }
<a name="l03073"></a>03073 
<a name="l03074"></a>03074 
<a name="l03075"></a>03075 
<a name="l03085"></a>03085 gboolean gsb_transactions_list_change_sort_column ( GtkTreeViewColumn *tree_view_column,
<a name="l03086"></a>03086                         gint *column_ptr )
<a name="l03087"></a>03087 {
<a name="l03088"></a>03088     GtkSortType sort_type;
<a name="l03089"></a>03089     gint current_column;
<a name="l03090"></a>03090     gint account_number;
<a name="l03091"></a>03091     gint new_column;
<a name="l03092"></a>03092     GSList *tmp_list;
<a name="l03093"></a>03093     gint selected_transaction;
<a name="l03094"></a>03094 
<a name="l03095"></a>03095     <a class="code" href="erreur_8h.html#a17bfffc4306bc76edd79e060a8947dc4">devel_debug</a> (NULL);
<a name="l03096"></a>03096 
<a name="l03097"></a>03097     account_number = <a class="code" href="navigation_8c.html#a3b668bf52ce71dcff3ea10c9db7be859">gsb_gui_navigation_get_current_account</a> ();
<a name="l03098"></a>03098     <a class="code" href="transaction__list__sort_8c.html#ae3160f04fcf15af961324f65b9759799">transaction_list_sort_get_column</a> ( &amp;current_column,
<a name="l03099"></a>03099                                        &amp;sort_type );
<a name="l03100"></a>03100     new_column = GPOINTER_TO_INT (column_ptr);
<a name="l03101"></a>03101 
<a name="l03102"></a>03102     <span class="comment">/* if we come here and the list was user custom sorted for reconcile,</span>
<a name="l03103"></a>03103 <span class="comment">     * we stop the reconcile sort and set what is asked by the user */</span>
<a name="l03104"></a>03104     <span class="keywordflow">if</span> (<a class="code" href="transaction__list__sort_8c.html#a436b2ef3d8acb82f320e2b9fe2e6c8c6">transaction_list_sort_get_reconcile_sort</a> ())
<a name="l03105"></a>03105     {
<a name="l03106"></a>03106         <a class="code" href="transaction__list__sort_8c.html#aa6a0e83f7d489f7a8cf4e0083d5c2360">transaction_list_sort_set_reconcile_sort</a> (FALSE);
<a name="l03107"></a>03107         gtk_toggle_button_set_active ( GTK_TOGGLE_BUTTON (<a class="code" href="gsb__reconcile_8c.html#a3cc34f74c4d6dae91c269439b2ea894c">reconcile_sort_list_button</a>),
<a name="l03108"></a>03108                                        FALSE );
<a name="l03109"></a>03109         <span class="comment">/* if we asked the same last column, we invert the value,</span>
<a name="l03110"></a>03110 <span class="comment">         * to come back to the last sort_type before the sort reconciliation */</span>
<a name="l03111"></a>03111         <span class="keywordflow">if</span> (new_column == current_column)
<a name="l03112"></a>03112         {
<a name="l03113"></a>03113             <span class="keywordflow">if</span> (sort_type == GTK_SORT_ASCENDING)
<a name="l03114"></a>03114                 sort_type = GTK_SORT_DESCENDING;
<a name="l03115"></a>03115             <span class="keywordflow">else</span>
<a name="l03116"></a>03116                 sort_type = GTK_SORT_ASCENDING;
<a name="l03117"></a>03117         }
<a name="l03118"></a>03118     }
<a name="l03119"></a>03119 
<a name="l03120"></a>03120     <span class="comment">/* if the new column is the same as the old one, we change</span>
<a name="l03121"></a>03121 <span class="comment">     * the sort type */</span>
<a name="l03122"></a>03122     <span class="keywordflow">if</span> (new_column == current_column)
<a name="l03123"></a>03123     {
<a name="l03124"></a>03124         <span class="keywordflow">if</span> (sort_type == GTK_SORT_ASCENDING)
<a name="l03125"></a>03125             sort_type = GTK_SORT_DESCENDING;
<a name="l03126"></a>03126         <span class="keywordflow">else</span>
<a name="l03127"></a>03127             sort_type = GTK_SORT_ASCENDING;
<a name="l03128"></a>03128     }
<a name="l03129"></a>03129     <span class="keywordflow">else</span>
<a name="l03130"></a>03130         <span class="comment">/* we sort by another column, so sort type by default is descending */</span>
<a name="l03131"></a>03131         sort_type = GTK_SORT_ASCENDING;
<a name="l03132"></a>03132 
<a name="l03133"></a>03133     <span class="comment">/* now have to save the new column and sort type in the account</span>
<a name="l03134"></a>03134 <span class="comment">     * or in all account if global conf for all accounts */</span>
<a name="l03135"></a>03135     tmp_list = <a class="code" href="gsb__data__account_8c.html#aaf4d25733c7ea5a0ca263c0ab79e6212">gsb_data_account_get_list_accounts</a> ();
<a name="l03136"></a>03136     <span class="keywordflow">while</span> (tmp_list)
<a name="l03137"></a>03137     {
<a name="l03138"></a>03138         gint tmp_account;
<a name="l03139"></a>03139 
<a name="l03140"></a>03140         tmp_account = <a class="code" href="gsb__data__account_8c.html#ad61190b4638c2be7b7ce320470f1cb5a">gsb_data_account_get_no_account</a> (tmp_list -&gt; data);
<a name="l03141"></a>03141 
<a name="l03142"></a>03142         <span class="keywordflow">if</span> (tmp_account == account_number
<a name="l03143"></a>03143             ||
<a name="l03144"></a>03144             !<a class="code" href="parametres_8c.html#ab2a744f5d2124688473d13979420e911">etat</a>.<a class="code" href="structgsb__etat__t.html#ae45e10b2c70e5cc3844a13a052ad0d78">retient_affichage_par_compte</a>)
<a name="l03145"></a>03145         {
<a name="l03146"></a>03146             <span class="comment">/* set the new column to sort */</span>
<a name="l03147"></a>03147             <a class="code" href="gsb__data__account_8c.html#a97c12eafdc8f9d87e352ad56553d0876">gsb_data_account_set_sort_column</a> ( tmp_account,
<a name="l03148"></a>03148                                                new_column );
<a name="l03149"></a>03149             <span class="comment">/* save the sort_type */</span>
<a name="l03150"></a>03150             <a class="code" href="gsb__data__account_8c.html#a9367526dc0525b19caa82e2227d2a3d5">gsb_data_account_set_sort_type</a> ( tmp_account,
<a name="l03151"></a>03151                                              sort_type );
<a name="l03152"></a>03152         }
<a name="l03153"></a>03153         tmp_list = tmp_list -&gt; next;
<a name="l03154"></a>03154     }
<a name="l03155"></a>03155 
<a name="l03156"></a>03156     selected_transaction = <a class="code" href="transaction__list__select_8c.html#a0a2effd6ee01ec6f9b848593b797398a">transaction_list_select_get</a> ();
<a name="l03157"></a>03157 
<a name="l03158"></a>03158     <span class="comment">/* now we can sort the list */</span>
<a name="l03159"></a>03159     <a class="code" href="transaction__list__sort_8c.html#ad124c81fa4121869ac23b1e67a96a9d2">transaction_list_sort_set_column</a> ( new_column,
<a name="l03160"></a>03160                                        sort_type );
<a name="l03161"></a>03161     <a class="code" href="transaction__list__sort_8c.html#a4437cb573f9bba01a794b2e2695e58d4">transaction_list_sort</a> ();
<a name="l03162"></a>03162     <a class="code" href="transaction__list_8c.html#a31251e7e47a79c21b63cffdea74a2ee9">transaction_list_colorize</a> ();
<a name="l03163"></a>03163     <span class="keywordflow">if</span> ( <a class="code" href="gsb__file__config_8c.html#ac390e947e97cef2bec2f5d59d6ec1071">conf</a>.<a class="code" href="structgsb__conf__t.html#afe3b36b196c6045e42ce4afdd915d506">show_transaction_gives_balance</a> )
<a name="l03164"></a>03164         <a class="code" href="transaction__list_8c.html#a8e2f2c3981823494ae5f16f0e8db383b">transaction_list_set_color_jour</a> ( account_number );
<a name="l03165"></a>03165     <a class="code" href="transaction__list_8c.html#a59ee075b27fa18fb9691201b52ec6692">transaction_list_set_balances</a> ();
<a name="l03166"></a>03166     <a class="code" href="transaction__list__select_8c.html#a85f38a439156b883335de73220dca237">transaction_list_select</a> (selected_transaction);
<a name="l03167"></a>03167 
<a name="l03168"></a>03168     <span class="keywordflow">if</span> ( <a class="code" href="parametres_8c.html#ab2a744f5d2124688473d13979420e911">etat</a>.<a class="code" href="structgsb__etat__t.html#a9d0fa9057da603e64a601d69d7bf2b51">modification_fichier</a> == 0 )
<a name="l03169"></a>03169         <a class="code" href="traitement__variables_8c.html#aa4084b9e508b1d1fea1d09c6b6208021">modification_fichier</a> ( TRUE );
<a name="l03170"></a>03170     <span class="keywordflow">return</span> FALSE;
<a name="l03171"></a>03171 }
<a name="l03172"></a>03172 
<a name="l03173"></a>03173 
<a name="l03181"></a><a class="code" href="gsb__transactions__list_8h.html#a7885778abe9c7b1213f7f0485e666413">03181</a> <span class="keywordtype">void</span> <a class="code" href="gsb__transactions__list_8c.html#a7885778abe9c7b1213f7f0485e666413">mise_a_jour_affichage_r</a> ( gboolean show_r )
<a name="l03182"></a>03182 {
<a name="l03183"></a>03183     gint current_account;
<a name="l03184"></a>03184 
<a name="l03185"></a>03185     <a class="code" href="erreur_8h.html#a10f4eeae4cc251a8d632fd62ec1057fb">devel_debug_int</a> (show_r);
<a name="l03186"></a>03186 
<a name="l03187"></a>03187     current_account = <a class="code" href="navigation_8c.html#a3b668bf52ce71dcff3ea10c9db7be859">gsb_gui_navigation_get_current_account</a> ();
<a name="l03188"></a>03188 
<a name="l03189"></a>03189     <span class="comment">/*  we check all the accounts */</span>
<a name="l03190"></a>03190     <span class="comment">/*  if etat.retient_affichage_par_compte is set, only gsb_gui_navigation_get_current_account () will change */</span>
<a name="l03191"></a>03191     <span class="comment">/*  else, all the accounts change */</span>
<a name="l03192"></a>03192 
<a name="l03193"></a>03193     <span class="keywordflow">if</span> ( show_r == <a class="code" href="gsb__data__account_8c.html#aca61a61a56a3e161716a443b366cd899">gsb_data_account_get_r</a> ( current_account ) )
<a name="l03194"></a>03194     {
<a name="l03195"></a>03195         <a class="code" href="gsb__transactions__list_8c.html#ab7d08f59bcf7149edda9db47e67333a4">gsb_transactions_list_update_tree_view</a> ( current_account, show_r );
<a name="l03196"></a>03196         <a class="code" href="menu_8c.html#a60f727414d6ce8974582d80ae95c1f81">gsb_menu_update_view_menu</a> ( current_account );
<a name="l03197"></a>03197         <span class="keywordflow">return</span>;
<a name="l03198"></a>03198     }
<a name="l03199"></a>03199 
<a name="l03200"></a>03200     <a class="code" href="gsb__data__account_8c.html#a30c0eb4d420396ce451edefa343aa3cc">gsb_data_account_set_r</a> ( current_account, show_r );
<a name="l03201"></a>03201 
<a name="l03202"></a>03202     <span class="keywordflow">if</span> ( !<a class="code" href="parametres_8c.html#ab2a744f5d2124688473d13979420e911">etat</a>.<a class="code" href="structgsb__etat__t.html#ae45e10b2c70e5cc3844a13a052ad0d78">retient_affichage_par_compte</a> )
<a name="l03203"></a>03203     {
<a name="l03204"></a>03204         GSList *list_tmp;
<a name="l03205"></a>03205 
<a name="l03206"></a>03206         list_tmp = <a class="code" href="gsb__data__account_8c.html#aaf4d25733c7ea5a0ca263c0ab79e6212">gsb_data_account_get_list_accounts</a> ();
<a name="l03207"></a>03207 
<a name="l03208"></a>03208         <span class="keywordflow">while</span> ( list_tmp )
<a name="l03209"></a>03209         {
<a name="l03210"></a>03210             gint i;
<a name="l03211"></a>03211 
<a name="l03212"></a>03212             i = <a class="code" href="gsb__data__account_8c.html#ad61190b4638c2be7b7ce320470f1cb5a">gsb_data_account_get_no_account</a> ( list_tmp -&gt; data );
<a name="l03213"></a>03213             <a class="code" href="gsb__data__account_8c.html#a30c0eb4d420396ce451edefa343aa3cc">gsb_data_account_set_r</a> ( i, show_r );
<a name="l03214"></a>03214 
<a name="l03215"></a>03215             list_tmp = list_tmp -&gt; next;
<a name="l03216"></a>03216         }
<a name="l03217"></a>03217     }
<a name="l03218"></a>03218     <a class="code" href="gsb__transactions__list_8c.html#ab7d08f59bcf7149edda9db47e67333a4">gsb_transactions_list_update_tree_view</a> ( current_account, show_r );
<a name="l03219"></a>03219     <a class="code" href="menu_8c.html#a60f727414d6ce8974582d80ae95c1f81">gsb_menu_update_view_menu</a> ( current_account );
<a name="l03220"></a>03220 
<a name="l03221"></a>03221     <span class="keywordflow">return</span>;
<a name="l03222"></a>03222 }
<a name="l03223"></a>03223 
<a name="l03224"></a>03224 
<a name="l03232"></a><a class="code" href="gsb__transactions__list_8h.html#a7a066474fae8e311ca096b15cf9d33cc">03232</a> <span class="keywordtype">void</span> <a class="code" href="gsb__transactions__list_8c.html#a7a066474fae8e311ca096b15cf9d33cc">gsb_transactions_list_show_archives_lines</a> ( gboolean show_l )
<a name="l03233"></a>03233 {
<a name="l03234"></a>03234     gint current_account;
<a name="l03235"></a>03235 
<a name="l03236"></a>03236     <a class="code" href="erreur_8h.html#a10f4eeae4cc251a8d632fd62ec1057fb">devel_debug_int</a> ( show_l );
<a name="l03237"></a>03237 
<a name="l03238"></a>03238     current_account = <a class="code" href="navigation_8c.html#a3b668bf52ce71dcff3ea10c9db7be859">gsb_gui_navigation_get_current_account</a> ( );
<a name="l03239"></a>03239 
<a name="l03240"></a>03240     <span class="comment">/*  we check all the accounts */</span>
<a name="l03241"></a>03241     <span class="comment">/*  if etat.retient_affichage_par_compte is set, only gsb_gui_navigation_get_current_account () will change */</span>
<a name="l03242"></a>03242     <span class="comment">/*  else, all the accounts change */</span>
<a name="l03243"></a>03243 
<a name="l03244"></a>03244     <span class="keywordflow">if</span> ( show_l == <a class="code" href="gsb__data__account_8c.html#acbc8b219af2e0520506d34eded08ad34">gsb_data_account_get_l</a> ( current_account ) )
<a name="l03245"></a>03245     {
<a name="l03246"></a>03246         <a class="code" href="gsb__transactions__list_8c.html#ab7d08f59bcf7149edda9db47e67333a4">gsb_transactions_list_update_tree_view</a> ( current_account, show_l );
<a name="l03247"></a>03247             <span class="keywordflow">return</span>;
<a name="l03248"></a>03248     }
<a name="l03249"></a>03249 
<a name="l03250"></a>03250     <a class="code" href="gsb__data__account_8c.html#ac7a0bc67927db05ce10874bd8eb1aa99">gsb_data_account_set_l</a> ( current_account, show_l );
<a name="l03251"></a>03251 
<a name="l03252"></a>03252     <span class="keywordflow">if</span> ( !<a class="code" href="parametres_8c.html#ab2a744f5d2124688473d13979420e911">etat</a>.<a class="code" href="structgsb__etat__t.html#ae45e10b2c70e5cc3844a13a052ad0d78">retient_affichage_par_compte</a> )
<a name="l03253"></a>03253     {
<a name="l03254"></a>03254         GSList *list_tmp;
<a name="l03255"></a>03255 
<a name="l03256"></a>03256         list_tmp = <a class="code" href="gsb__data__account_8c.html#aaf4d25733c7ea5a0ca263c0ab79e6212">gsb_data_account_get_list_accounts</a> ( );
<a name="l03257"></a>03257 
<a name="l03258"></a>03258         <span class="keywordflow">while</span> ( list_tmp )
<a name="l03259"></a>03259         {
<a name="l03260"></a>03260             gint i;
<a name="l03261"></a>03261 
<a name="l03262"></a>03262             i = <a class="code" href="gsb__data__account_8c.html#ad61190b4638c2be7b7ce320470f1cb5a">gsb_data_account_get_no_account</a> ( list_tmp -&gt; data );
<a name="l03263"></a>03263             <a class="code" href="gsb__data__account_8c.html#ac7a0bc67927db05ce10874bd8eb1aa99">gsb_data_account_set_l</a> ( i, show_l );
<a name="l03264"></a>03264 
<a name="l03265"></a>03265             list_tmp = list_tmp -&gt; next;
<a name="l03266"></a>03266         }
<a name="l03267"></a>03267     }
<a name="l03268"></a>03268     <a class="code" href="gsb__transactions__list_8c.html#ab7d08f59bcf7149edda9db47e67333a4">gsb_transactions_list_update_tree_view</a> ( current_account, show_l );
<a name="l03269"></a>03269 
<a name="l03270"></a>03270     <span class="keywordflow">return</span>;
<a name="l03271"></a>03271 }
<a name="l03272"></a>03272 
<a name="l03273"></a>03273 
<a name="l03284"></a><a class="code" href="gsb__transactions__list_8h.html#a8da293358f10b57d3107c903fbd4ef12">03284</a> <span class="keywordtype">void</span> <a class="code" href="gsb__transactions__list_8c.html#a8da293358f10b57d3107c903fbd4ef12">gsb_transactions_list_set_visible_rows_number</a> ( gint rows_number )
<a name="l03285"></a>03285 {
<a name="l03286"></a>03286     GSList *list_tmp;
<a name="l03287"></a>03287     gint current_account;
<a name="l03288"></a>03288 
<a name="l03289"></a>03289     <a class="code" href="erreur_8h.html#a10f4eeae4cc251a8d632fd62ec1057fb">devel_debug_int</a> (rows_number);
<a name="l03290"></a>03290 
<a name="l03291"></a>03291     current_account = <a class="code" href="navigation_8c.html#a3b668bf52ce71dcff3ea10c9db7be859">gsb_gui_navigation_get_current_account</a> ();
<a name="l03292"></a>03292     <span class="keywordflow">if</span> ( rows_number == <a class="code" href="gsb__data__account_8c.html#a3daed40b7bb578a2e1e3f0b948ea0bf6">gsb_data_account_get_nb_rows</a> (current_account) &amp;&amp; rows_number &gt; 1 )
<a name="l03293"></a>03293         <span class="keywordflow">return</span>;
<a name="l03294"></a>03294 
<a name="l03295"></a>03295     <span class="comment">/*     we check all the accounts */</span>
<a name="l03296"></a>03296     <span class="comment">/*  if etat.retient_affichage_par_compte is set, only the current account changes */</span>
<a name="l03297"></a>03297     <span class="comment">/*  else, all the accounts change */</span>
<a name="l03298"></a>03298     list_tmp = <a class="code" href="gsb__data__account_8c.html#aaf4d25733c7ea5a0ca263c0ab79e6212">gsb_data_account_get_list_accounts</a> ();
<a name="l03299"></a>03299 
<a name="l03300"></a>03300     <span class="keywordflow">while</span> ( list_tmp )
<a name="l03301"></a>03301     {
<a name="l03302"></a>03302         gint i;
<a name="l03303"></a>03303 
<a name="l03304"></a>03304         i = <a class="code" href="gsb__data__account_8c.html#ad61190b4638c2be7b7ce320470f1cb5a">gsb_data_account_get_no_account</a> ( list_tmp -&gt; data );
<a name="l03305"></a>03305 
<a name="l03306"></a>03306         <span class="keywordflow">if</span> ( !<a class="code" href="parametres_8c.html#ab2a744f5d2124688473d13979420e911">etat</a>.<a class="code" href="structgsb__etat__t.html#ae45e10b2c70e5cc3844a13a052ad0d78">retient_affichage_par_compte</a>
<a name="l03307"></a>03307              ||
<a name="l03308"></a>03308              i == current_account)
<a name="l03309"></a>03309         {
<a name="l03310"></a>03310             <a class="code" href="gsb__data__account_8c.html#a1b6a86b8cdab56cee9535be87877e0f0">gsb_data_account_set_nb_rows</a> ( i, rows_number );
<a name="l03311"></a>03311         }
<a name="l03312"></a>03312         list_tmp = list_tmp -&gt; next;
<a name="l03313"></a>03313     }
<a name="l03314"></a>03314 
<a name="l03315"></a>03315     <span class="comment">/* we update the screen */</span>
<a name="l03316"></a>03316     <a class="code" href="gsb__transactions__list_8c.html#ab7d08f59bcf7149edda9db47e67333a4">gsb_transactions_list_update_tree_view</a> ( current_account, FALSE );
<a name="l03317"></a>03317 }
<a name="l03318"></a>03318 
<a name="l03319"></a>03319 
<a name="l03320"></a>03320 
<a name="l03334"></a><a class="code" href="gsb__transactions__list_8h.html#a3fea90bc90cbcb2b613935cb657fd320">03334</a> gboolean <a class="code" href="gsb__transactions__list_8c.html#a3fea90bc90cbcb2b613935cb657fd320">gsb_transactions_list_transaction_visible</a> ( gpointer transaction_ptr,
<a name="l03335"></a>03335                         gint account_number,
<a name="l03336"></a>03336                         gint line_in_transaction,
<a name="l03337"></a>03337                         gint what_is_line )
<a name="l03338"></a>03338 {
<a name="l03339"></a>03339     gint transaction_number;
<a name="l03340"></a>03340     gint r_shown;
<a name="l03341"></a>03341     gint nb_rows;
<a name="l03342"></a>03342 
<a name="l03343"></a>03343     r_shown = <a class="code" href="gsb__data__account_8c.html#aca61a61a56a3e161716a443b366cd899">gsb_data_account_get_r</a> ( account_number );
<a name="l03344"></a>03344     nb_rows = <a class="code" href="gsb__data__account_8c.html#a3daed40b7bb578a2e1e3f0b948ea0bf6">gsb_data_account_get_nb_rows</a> ( account_number );
<a name="l03345"></a>03345 
<a name="l03346"></a>03346     <span class="comment">/* first check if it&#39;s an archive, if yes and good account, always show it */</span>
<a name="l03347"></a>03347     <span class="keywordflow">if</span> (what_is_line == <a class="code" href="custom__list_8h.html#a0caea412748bef9b8222da212aaa0069">IS_ARCHIVE</a>)
<a name="l03348"></a>03348     {
<a name="l03349"></a>03349         <span class="keywordflow">if</span> ( <a class="code" href="gsb__data__account_8c.html#acbc8b219af2e0520506d34eded08ad34">gsb_data_account_get_l</a> ( account_number ) )
<a name="l03350"></a>03350                 <span class="keywordflow">return</span> ( <a class="code" href="gsb__data__archive__store_8c.html#af8cce1446aecd71b0622144006b3916d">gsb_data_archive_store_get_account_number</a> (
<a name="l03351"></a>03351                         <a class="code" href="gsb__data__archive__store_8c.html#a33d414762707f17772146fca8dc8db36">gsb_data_archive_store_get_number</a> ( transaction_ptr ) ) == account_number );
<a name="l03352"></a>03352         <span class="keywordflow">else</span>
<a name="l03353"></a>03353             <span class="keywordflow">return</span> FALSE;
<a name="l03354"></a>03354     }
<a name="l03355"></a>03355 
<a name="l03356"></a>03356     <span class="comment">/* we don&#39;t check now for the separator, because it won&#39;t be shown if the transaction</span>
<a name="l03357"></a>03357 <span class="comment">     * is not shown, so check the basics for the transaction, and show or not after the separator */</span>
<a name="l03358"></a>03358 
<a name="l03359"></a>03359     <span class="comment">/*  check now for transactions */</span>
<a name="l03360"></a>03360     transaction_number = <a class="code" href="gsb__data__transaction_8c.html#a99bf548513083f4a71fe019faeccbe0a">gsb_data_transaction_get_transaction_number</a> ( transaction_ptr );
<a name="l03361"></a>03361 
<a name="l03362"></a>03362     <span class="comment">/* check the general white line (one for all the list, so no account number) */</span>
<a name="l03363"></a>03363     <span class="keywordflow">if</span> ( transaction_number == -1 )
<a name="l03364"></a>03364             <span class="keywordflow">return</span> ( <a class="code" href="affichage__liste_8c.html#a29ff0d6bb71d4f22c3cfb6fc8d58d0a3">display_mode_check_line</a> ( line_in_transaction, nb_rows ) );
<a name="l03365"></a>03365 
<a name="l03366"></a>03366     <span class="comment">/* check the account */</span>
<a name="l03367"></a>03367     <span class="keywordflow">if</span> ( <a class="code" href="gsb__data__transaction_8c.html#a5b486efbc486f946e9c998a114054bce">gsb_data_transaction_get_account_number</a> (transaction_number) != account_number )
<a name="l03368"></a>03368         <span class="keywordflow">return</span> FALSE;
<a name="l03369"></a>03369 
<a name="l03370"></a>03370     <span class="comment">/*      check if it&#39;s R and if r is shown */</span>
<a name="l03371"></a>03371     <span class="keywordflow">if</span> ( <a class="code" href="gsb__data__transaction_8c.html#a52cf9684818c3930c5c688b54f7cf393">gsb_data_transaction_get_marked_transaction</a> (transaction_number) == <a class="code" href="gsb__data__transaction_8h.html#a82f385a1c75ac98496b5c09a123bf521a41425f55add3a05ffc4c7aa366048fc9">OPERATION_RAPPROCHEE</a>
<a name="l03372"></a>03372          &amp;&amp;
<a name="l03373"></a>03373          !r_shown )
<a name="l03374"></a>03374         <span class="keywordflow">return</span> FALSE;
<a name="l03375"></a>03375 
<a name="l03376"></a>03376     <span class="comment">/*      now we check if we show 1, 2, 3 or 4 lines */</span>
<a name="l03377"></a>03377     <span class="keywordflow">return</span> <a class="code" href="affichage__liste_8c.html#a29ff0d6bb71d4f22c3cfb6fc8d58d0a3">display_mode_check_line</a> ( line_in_transaction, nb_rows );
<a name="l03378"></a>03378 }
<a name="l03379"></a>03379 
<a name="l03380"></a>03380 
<a name="l03381"></a>03381 
<a name="l03382"></a>03382 <span class="comment">/*</span>
<a name="l03383"></a>03383 <span class="comment"> * get the real name of the category of the transaction</span>
<a name="l03384"></a>03384 <span class="comment"> * so return split of transaction, transfer : ..., categ : under_categ</span>
<a name="l03385"></a>03385 <span class="comment"> *</span>
<a name="l03386"></a>03386 <span class="comment"> * \param transaction the adr of the transaction</span>
<a name="l03387"></a>03387 <span class="comment"> *</span>
<a name="l03388"></a>03388 <span class="comment"> * \return the real name. It returns a newly allocated string which must be</span>
<a name="l03389"></a>03389 <span class="comment"> * freed when no more used.</span>
<a name="l03390"></a>03390 <span class="comment"> * */</span>
<a name="l03391"></a><a class="code" href="gsb__transactions__list_8h.html#a1144ff7dd8c9bf6a2a6eb870fc8ae2df">03391</a> gchar *<a class="code" href="gsb__transactions__list_8c.html#a1144ff7dd8c9bf6a2a6eb870fc8ae2df">gsb_transactions_get_category_real_name</a> ( gint transaction_number )
<a name="l03392"></a>03392 {
<a name="l03393"></a>03393     gchar *tmp;
<a name="l03394"></a>03394     gint contra_transaction_number;
<a name="l03395"></a>03395 
<a name="l03396"></a>03396     <span class="keywordflow">if</span> ( <a class="code" href="gsb__data__transaction_8c.html#a2de1ba38ee196b44e3c00c10e1d645cc">gsb_data_transaction_get_split_of_transaction</a> (transaction_number))
<a name="l03397"></a>03397         tmp = g_strdup(_(<span class="stringliteral">&quot;Split of transaction&quot;</span>));
<a name="l03398"></a>03398     <span class="keywordflow">else</span>
<a name="l03399"></a>03399     {
<a name="l03400"></a>03400         contra_transaction_number = <a class="code" href="gsb__data__transaction_8c.html#a4040925a3db49485b5a2b0a8ea19d2ee">gsb_data_transaction_get_contra_transaction_number</a> (transaction_number);
<a name="l03401"></a>03401         <span class="keywordflow">switch</span> (contra_transaction_number)
<a name="l03402"></a>03402         {
<a name="l03403"></a>03403             <span class="keywordflow">case</span> -1:
<a name="l03404"></a>03404                 <span class="comment">/* transfer to deleted account */</span>
<a name="l03405"></a>03405                 <span class="keywordflow">if</span> ( <a class="code" href="gsb__data__transaction_8c.html#a632c5ba71e742b3ac063b4b3207cf032">gsb_data_transaction_get_amount</a> ( transaction_number).mantissa &lt; 0 )
<a name="l03406"></a>03406                     tmp = g_strdup(_(<span class="stringliteral">&quot;Transfer to a deleted account&quot;</span>));
<a name="l03407"></a>03407                 <span class="keywordflow">else</span>
<a name="l03408"></a>03408                     tmp = g_strdup(_(<span class="stringliteral">&quot;Transfer from a deleted account&quot;</span>));
<a name="l03409"></a>03409                 <span class="keywordflow">break</span>;
<a name="l03410"></a>03410             <span class="keywordflow">case</span> 0:
<a name="l03411"></a>03411                 <span class="comment">/* normal category */</span>
<a name="l03412"></a>03412                 tmp = <a class="code" href="gsb__data__category_8c.html#a615342249ac310a61000690303ce88a9">gsb_data_category_get_name</a> ( <a class="code" href="gsb__data__transaction_8c.html#a5cdaf5e8911118bf8d1dbdfc42dc4761">gsb_data_transaction_get_category_number</a> (transaction_number),
<a name="l03413"></a>03413                                                    <a class="code" href="gsb__data__transaction_8c.html#a2e0ed6fbd584d4363d75e4b0155660b7">gsb_data_transaction_get_sub_category_number</a> (transaction_number),
<a name="l03414"></a>03414                                                    NULL );
<a name="l03415"></a>03415                 <span class="keywordflow">break</span>;
<a name="l03416"></a>03416             <span class="keywordflow">default</span>:
<a name="l03417"></a>03417                 <span class="comment">/* transfer */</span>
<a name="l03418"></a>03418                 <span class="keywordflow">if</span> ( <a class="code" href="gsb__data__transaction_8c.html#a632c5ba71e742b3ac063b4b3207cf032">gsb_data_transaction_get_amount</a> (transaction_number).mantissa &lt; 0 )
<a name="l03419"></a>03419                     tmp = g_strdup_printf ( _(<span class="stringliteral">&quot;Transfer to %s&quot;</span>),
<a name="l03420"></a>03420                                             <a class="code" href="gsb__data__account_8c.html#a6b0df19868e38619bff512f2c18ef51e">gsb_data_account_get_name</a> ( <a class="code" href="gsb__data__transaction_8c.html#a5b486efbc486f946e9c998a114054bce">gsb_data_transaction_get_account_number</a> (contra_transaction_number)));
<a name="l03421"></a>03421                 <span class="keywordflow">else</span>
<a name="l03422"></a>03422                     tmp = g_strdup_printf ( _(<span class="stringliteral">&quot;Transfer from %s&quot;</span>),
<a name="l03423"></a>03423                                             <a class="code" href="gsb__data__account_8c.html#a6b0df19868e38619bff512f2c18ef51e">gsb_data_account_get_name</a> ( <a class="code" href="gsb__data__transaction_8c.html#a5b486efbc486f946e9c998a114054bce">gsb_data_transaction_get_account_number</a> (contra_transaction_number)));
<a name="l03424"></a>03424         }
<a name="l03425"></a>03425     }
<a name="l03426"></a>03426     <span class="keywordflow">return</span> tmp;
<a name="l03427"></a>03427 }
<a name="l03428"></a>03428 
<a name="l03429"></a>03429 
<a name="l03430"></a>03430 
<a name="l03438"></a><a class="code" href="gsb__transactions__list_8h.html#a6089f07015c6278f5d0a689783fe4019">03438</a> gboolean <a class="code" href="gsb__transactions__list_8c.html#a6089f07015c6278f5d0a689783fe4019">gsb_transactions_list_switch_expander</a> ( gint transaction_number )
<a name="l03439"></a>03439 {
<a name="l03440"></a>03440     GtkTreePath *path;
<a name="l03441"></a>03441 
<a name="l03442"></a>03442     <a class="code" href="erreur_8h.html#a10f4eeae4cc251a8d632fd62ec1057fb">devel_debug_int</a> (transaction_number);
<a name="l03443"></a>03443 
<a name="l03444"></a>03444     <span class="keywordflow">if</span> ( !<a class="code" href="gsb__data__transaction_8c.html#a2de1ba38ee196b44e3c00c10e1d645cc">gsb_data_transaction_get_split_of_transaction</a> ( transaction_number ) )
<a name="l03445"></a>03445             <span class="keywordflow">return</span> FALSE;
<a name="l03446"></a>03446 
<a name="l03447"></a>03447     path = <a class="code" href="transaction__list__select_8c.html#ac4dba240fa9e06af594157c07e62c2d8">transaction_list_select_get_path</a> ( <a class="code" href="transaction__list_8c.html#a8a1d86e0958c09384cf1363b0f07eb3b">transaction_list_get_last_line</a> (
<a name="l03448"></a>03448                             <a class="code" href="gsb__data__account_8c.html#a3daed40b7bb578a2e1e3f0b948ea0bf6">gsb_data_account_get_nb_rows</a> (
<a name="l03449"></a>03449                             <a class="code" href="navigation_8c.html#a3b668bf52ce71dcff3ea10c9db7be859">gsb_gui_navigation_get_current_account</a> ( ) ) ) );
<a name="l03450"></a>03450 
<a name="l03451"></a>03451     <span class="keywordflow">if</span> ( gtk_tree_view_row_expanded ( GTK_TREE_VIEW ( transactions_tree_view ), path ) )
<a name="l03452"></a>03452             gtk_tree_view_collapse_row ( GTK_TREE_VIEW ( transactions_tree_view ), path );
<a name="l03453"></a>03453     <span class="keywordflow">else</span>
<a name="l03454"></a>03454             gtk_tree_view_expand_row ( GTK_TREE_VIEW ( transactions_tree_view ), path, FALSE );
<a name="l03455"></a>03455 
<a name="l03456"></a>03456     gtk_tree_path_free ( path );
<a name="l03457"></a>03457 
<a name="l03458"></a>03458     <span class="keywordflow">return</span> FALSE;
<a name="l03459"></a>03459 }
<a name="l03460"></a>03460 
<a name="l03471"></a><a class="code" href="gsb__transactions__list_8h.html#afb50643bfc50dcd627a5f720c30c8765">03471</a> gboolean <a class="code" href="gsb__transactions__list_8c.html#afb50643bfc50dcd627a5f720c30c8765">gsb_transactions_list_restore_archive</a> ( gint archive_number,
<a name="l03472"></a>03472                         gboolean show_warning )
<a name="l03473"></a>03473 {
<a name="l03474"></a>03474     GSList *tmp_list;
<a name="l03475"></a>03475     gint account_number;
<a name="l03476"></a>03476     gint transaction_number;
<a name="l03477"></a>03477     gboolean exist = FALSE;
<a name="l03478"></a>03478 
<a name="l03479"></a>03479     <a class="code" href="erreur_8h.html#a10f4eeae4cc251a8d632fd62ec1057fb">devel_debug_int</a> (archive_number);
<a name="l03480"></a>03480 
<a name="l03481"></a>03481     <span class="comment">/* remove the lines of the archive in the model */</span>
<a name="l03482"></a>03482     exist = <a class="code" href="transaction__list_8c.html#aa086653043993d4f3fef7e086c595849">transaction_list_remove_archive</a> (archive_number);
<a name="l03483"></a>03483     <span class="comment">/* remove the structures of archive_model */</span>
<a name="l03484"></a>03484     <a class="code" href="gsb__data__archive__store_8c.html#a27c1f783d9b3538226a3dd233af1a154">gsb_data_archive_store_remove_by_archive</a> (archive_number);
<a name="l03485"></a>03485 
<a name="l03486"></a>03486     <span class="comment">/* si l&#39;archive existait bien on ajoute les transactions dans la liste et dans le </span>
<a name="l03487"></a>03487 <span class="comment">     * tree_view. Evite de charger deux fois les données si on supprime l&#39;archive</span>
<a name="l03488"></a>03488 <span class="comment">     * après avoir ajouté les lignes */</span>
<a name="l03489"></a>03489     <span class="keywordflow">if</span> (exist )
<a name="l03490"></a>03490     {
<a name="l03491"></a>03491         <a class="code" href="gsb__transactions__list_8c.html#ac2f7ca891d6c3a7cfb5c8df02918cf7c">orphan_child_transactions</a> = NULL;
<a name="l03492"></a>03492 
<a name="l03493"></a>03493         <span class="comment">/* second step, we add all the archived transactions of that archive into the</span>
<a name="l03494"></a>03494 <span class="comment">         * transactions_list and into the store */</span>
<a name="l03495"></a>03495         tmp_list = <a class="code" href="gsb__data__transaction_8c.html#aa54aeb205f29c2272154b2998fea490b">gsb_data_transaction_get_complete_transactions_list</a> ();
<a name="l03496"></a>03496         <span class="keywordflow">while</span> (tmp_list)
<a name="l03497"></a>03497         {
<a name="l03498"></a>03498         transaction_number = <a class="code" href="gsb__data__transaction_8c.html#a99bf548513083f4a71fe019faeccbe0a">gsb_data_transaction_get_transaction_number</a> (tmp_list -&gt; data);
<a name="l03499"></a>03499 
<a name="l03500"></a>03500         <span class="keywordflow">if</span> ( <a class="code" href="gsb__data__transaction_8c.html#a5dfc3ab337c363b46380bf962a97d8d2">gsb_data_transaction_get_archive_number</a> (transaction_number) == archive_number)
<a name="l03501"></a>03501         {
<a name="l03502"></a>03502             <span class="comment">/* append the transaction to the list of non archived transactions */</span>
<a name="l03503"></a>03503             <a class="code" href="gsb__data__transaction_8c.html#a0847630734b4419bc233f313ad6d2766">gsb_data_transaction_add_archived_to_list</a> (transaction_number);
<a name="l03504"></a>03504 
<a name="l03505"></a>03505             <span class="comment">/* the transaction belongs to the archive we want to show, so append it to the list store */</span>
<a name="l03506"></a>03506             <a class="code" href="transaction__list_8c.html#aa34d9e30792bb09d3dfef963febee748">transaction_list_append_transaction</a> ( transaction_number);
<a name="l03507"></a>03507         }
<a name="l03508"></a>03508         tmp_list = tmp_list -&gt; next;
<a name="l03509"></a>03509         }
<a name="l03510"></a>03510 
<a name="l03511"></a>03511         <span class="comment">/* if orphan_child_transactions if filled, there are some children wich didn&#39;t find their</span>
<a name="l03512"></a>03512 <span class="comment">         * mother, we try again now that all the mothers are in the model */</span>
<a name="l03513"></a>03513         <span class="keywordflow">if</span> (<a class="code" href="gsb__transactions__list_8c.html#ac2f7ca891d6c3a7cfb5c8df02918cf7c">orphan_child_transactions</a>)
<a name="l03514"></a>03514         {
<a name="l03515"></a>03515         GSList *orphan_list_copy;
<a name="l03516"></a>03516 
<a name="l03517"></a>03517         orphan_list_copy = g_slist_copy (<a class="code" href="gsb__transactions__list_8c.html#ac2f7ca891d6c3a7cfb5c8df02918cf7c">orphan_child_transactions</a>);
<a name="l03518"></a>03518         g_slist_free (<a class="code" href="gsb__transactions__list_8c.html#ac2f7ca891d6c3a7cfb5c8df02918cf7c">orphan_child_transactions</a>);
<a name="l03519"></a>03519         <a class="code" href="gsb__transactions__list_8c.html#ac2f7ca891d6c3a7cfb5c8df02918cf7c">orphan_child_transactions</a> = NULL;
<a name="l03520"></a>03520 
<a name="l03521"></a>03521         tmp_list = orphan_list_copy;
<a name="l03522"></a>03522         <span class="keywordflow">while</span> (tmp_list)
<a name="l03523"></a>03523         {
<a name="l03524"></a>03524             transaction_number = GPOINTER_TO_INT (tmp_list -&gt; data);
<a name="l03525"></a>03525             <a class="code" href="transaction__list_8c.html#aa34d9e30792bb09d3dfef963febee748">transaction_list_append_transaction</a> (transaction_number);
<a name="l03526"></a>03526             tmp_list = tmp_list -&gt; next;
<a name="l03527"></a>03527         }
<a name="l03528"></a>03528         g_slist_free (orphan_list_copy);
<a name="l03529"></a>03529 
<a name="l03530"></a>03530         <span class="comment">/* if orphan_child_transactions is not null, there is still some children</span>
<a name="l03531"></a>03531 <span class="comment">         * wich didn&#39;t find their mother. show them now */</span>
<a name="l03532"></a>03532         <span class="keywordflow">if</span> (<a class="code" href="gsb__transactions__list_8c.html#ac2f7ca891d6c3a7cfb5c8df02918cf7c">orphan_child_transactions</a>)
<a name="l03533"></a>03533         {
<a name="l03534"></a>03534             gchar *message = _(<span class="stringliteral">&quot;Some children didn&#39;t find their mother in the list, this shouldn&#39;t happen and there is probably a bug behind that. Please contact the Grisbi team.\n\nThe concerned children number are :\n&quot;</span>);
<a name="l03535"></a>03535             gchar *string_1;
<a name="l03536"></a>03536             gchar *string_2;
<a name="l03537"></a>03537 
<a name="l03538"></a>03538             string_1 = g_strconcat (message, NULL);
<a name="l03539"></a>03539             tmp_list = <a class="code" href="gsb__transactions__list_8c.html#ac2f7ca891d6c3a7cfb5c8df02918cf7c">orphan_child_transactions</a>;
<a name="l03540"></a>03540             <span class="keywordflow">while</span> (tmp_list)
<a name="l03541"></a>03541             {
<a name="l03542"></a>03542             string_2 = g_strconcat ( string_1,
<a name="l03543"></a>03543                          <a class="code" href="utils__str_8c.html#a1e50f3be459180b9dea9f14eb7e1204e" title="convert an integer into a gchar based string">utils_str_itoa</a> (GPOINTER_TO_INT (tmp_list -&gt; data)),
<a name="l03544"></a>03544                          <span class="stringliteral">&quot; - &quot;</span>,
<a name="l03545"></a>03545                          NULL);
<a name="l03546"></a>03546             g_free (string_1);
<a name="l03547"></a>03547             string_1 = string_2;
<a name="l03548"></a>03548             tmp_list = tmp_list -&gt; next;
<a name="l03549"></a>03549             }
<a name="l03550"></a>03550             <a class="code" href="dialog_8c.html#a198880c6e09a934c62fd541c9cb302f9">dialogue_warning</a> (string_1);
<a name="l03551"></a>03551             g_free (string_1);
<a name="l03552"></a>03552         }
<a name="l03553"></a>03553         }
<a name="l03554"></a>03554     }
<a name="l03555"></a>03555 
<a name="l03556"></a>03556     <span class="comment">/* all the transactions of the archive have been added, we just need to clean the list,</span>
<a name="l03557"></a>03557 <span class="comment">     * but don&#39;t touch to the main page and to the current balances... we didn&#39;t change anything */</span>
<a name="l03558"></a>03558     account_number = <a class="code" href="navigation_8c.html#a3b668bf52ce71dcff3ea10c9db7be859">gsb_gui_navigation_get_current_account</a> ();
<a name="l03559"></a>03559     <span class="keywordflow">if</span> (account_number != -1)
<a name="l03560"></a>03560         <a class="code" href="gsb__transactions__list_8c.html#ab7d08f59bcf7149edda9db47e67333a4">gsb_transactions_list_update_tree_view</a> (account_number, TRUE);
<a name="l03561"></a>03561 
<a name="l03562"></a>03562     <span class="keywordflow">if</span> (!<a class="code" href="gsb__data__account_8c.html#aca61a61a56a3e161716a443b366cd899">gsb_data_account_get_r</a> (account_number) &amp;&amp; show_warning)
<a name="l03563"></a>03563         <a class="code" href="dialog_8c.html#ade6e4adf08627021abf579246f58aac1">dialogue</a> ( _(<span class="stringliteral">&quot;You have just recovered an archive, if you don&#39;t see any new &quot;</span>
<a name="l03564"></a>03564                         <span class="stringliteral">&quot;transaction, remember that the R transactions are not showed &quot;</span>
<a name="l03565"></a>03565                         <span class="stringliteral">&quot;so the archived transactions are certainly hidden...\n\n&quot;</span>
<a name="l03566"></a>03566                         <span class="stringliteral">&quot;Show the R transactions to make them visible.&quot;</span>) );
<a name="l03567"></a>03567 
<a name="l03568"></a>03568     <span class="keywordflow">return</span> FALSE;
<a name="l03569"></a>03569 }
<a name="l03570"></a>03570 
<a name="l03571"></a>03571 
<a name="l03572"></a>03572 
<a name="l03583"></a>03583 gboolean gsb_transactions_list_size_allocate ( GtkWidget *tree_view,
<a name="l03584"></a>03584                         GtkAllocation *allocation,
<a name="l03585"></a>03585                         gpointer null )
<a name="l03586"></a>03586 {
<a name="l03587"></a>03587     gint i;
<a name="l03588"></a>03588 
<a name="l03589"></a>03589     <span class="keywordflow">if</span> (allocation -&gt; width == <a class="code" href="gsb__transactions__list_8c.html#a265408c8482c4045a6e5e022d89696ba">current_tree_view_width</a>)
<a name="l03590"></a>03590     {
<a name="l03591"></a>03591         <span class="comment">/* size of the tree view didn&#39;t change, but we received an allocated signal</span>
<a name="l03592"></a>03592 <span class="comment">         * it happens several times, and especially when we change the columns,</span>
<a name="l03593"></a>03593 <span class="comment">         * so we update the colums */</span>
<a name="l03594"></a>03594 
<a name="l03595"></a>03595         <span class="comment">/* sometimes, when the list is not visible, he will set all the columns to 1%... we block that here */</span>
<a name="l03596"></a>03596         <span class="keywordflow">if</span> (gtk_tree_view_column_get_width (<a class="code" href="gsb__transactions__list_8c.html#a4f11139c6cd90bf0cd17d761652b069b">transactions_tree_view_columns</a>[0]) == 1)
<a name="l03597"></a>03597             <span class="keywordflow">return</span> FALSE;
<a name="l03598"></a>03598 
<a name="l03599"></a>03599         <span class="keywordflow">for</span> (i=0 ; i&lt;CUSTOM_MODEL_N_VISIBLES_COLUMN ; i++)
<a name="l03600"></a>03600             <a class="code" href="gsb__file__load_8c.html#a6e5e85a5f63608656ce9709950bb08e6">transaction_col_width</a>[i] = (gtk_tree_view_column_get_width (<a class="code" href="gsb__transactions__list_8c.html#a4f11139c6cd90bf0cd17d761652b069b">transactions_tree_view_columns</a>[i]) * 100) / allocation -&gt; width + 1;
<a name="l03601"></a>03601 
<a name="l03602"></a>03602         <span class="keywordflow">return</span> FALSE;
<a name="l03603"></a>03603     }
<a name="l03604"></a>03604 
<a name="l03605"></a>03605     <span class="comment">/* the size of the tree view changed, we keep the ration between the columns,</span>
<a name="l03606"></a>03606 <span class="comment">     * we don&#39;t set the size of the last column to avoid the calculate problems,</span>
<a name="l03607"></a>03607 <span class="comment">     * it will take the end of the width alone */</span>
<a name="l03608"></a>03608     <a class="code" href="gsb__transactions__list_8c.html#a265408c8482c4045a6e5e022d89696ba">current_tree_view_width</a> = allocation -&gt; width;
<a name="l03609"></a>03609 
<a name="l03610"></a>03610     <span class="keywordflow">for</span> ( i = 0 ; i &lt; <a class="code" href="custom__list_8h.html#a94bc00a237b4803e1096242436b77bcf">CUSTOM_MODEL_VISIBLE_COLUMNS</a> - 1 ; i++ )
<a name="l03611"></a>03611     {
<a name="l03612"></a>03612         gint width;
<a name="l03613"></a>03613 
<a name="l03614"></a>03614         width = (<a class="code" href="gsb__file__load_8c.html#a6e5e85a5f63608656ce9709950bb08e6">transaction_col_width</a>[i] * (allocation -&gt; width))/ 100;
<a name="l03615"></a>03615     <span class="keywordflow">if</span> ( width &gt; 0 )
<a name="l03616"></a>03616         gtk_tree_view_column_set_fixed_width ( <a class="code" href="gsb__transactions__list_8c.html#a4f11139c6cd90bf0cd17d761652b069b">transactions_tree_view_columns</a>[i],
<a name="l03617"></a>03617                         width );
<a name="l03618"></a>03618     }
<a name="l03619"></a>03619     <span class="keywordflow">return</span> FALSE;
<a name="l03620"></a>03620 }
<a name="l03621"></a>03621 
<a name="l03622"></a>03622 
<a name="l03630"></a><a class="code" href="gsb__transactions__list_8h.html#aa2d81179288c9dd410d36fc58c9a9ca4">03630</a> gint <a class="code" href="gsb__transactions__list_8c.html#aa2d81179288c9dd410d36fc58c9a9ca4">find_element_col_for_archive</a> ( <span class="keywordtype">void</span> )
<a name="l03631"></a>03631 {
<a name="l03632"></a>03632     gint retour;
<a name="l03633"></a>03633 
<a name="l03634"></a>03634     <span class="keywordflow">if</span> ( (retour = <a class="code" href="gsb__transactions__list_8c.html#a8be7f66c4c8f7c67eb187290c18fb6f7">find_element_col</a> ( <a class="code" href="gsb__transactions__list_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57a2c500de74c55386754d7406fec8040ce">ELEMENT_PARTY</a> )) &gt;= 0 )
<a name="l03635"></a>03635         <span class="keywordflow">return</span> retour;
<a name="l03636"></a>03636     <span class="keywordflow">if</span> ( (retour = <a class="code" href="gsb__transactions__list_8c.html#a8be7f66c4c8f7c67eb187290c18fb6f7">find_element_col</a> ( <a class="code" href="gsb__transactions__list_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57a14d07ec8c3f6be2c40010a64205711be">ELEMENT_CATEGORY</a> )) &gt;= 0 )
<a name="l03637"></a>03637         <span class="keywordflow">return</span> retour;
<a name="l03638"></a>03638     <span class="keywordflow">if</span> ( (retour = <a class="code" href="gsb__transactions__list_8c.html#a8be7f66c4c8f7c67eb187290c18fb6f7">find_element_col</a> ( <a class="code" href="gsb__transactions__list_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57a9ac9d9fa61388060ab239d177bd6eda8">ELEMENT_BUDGET</a> )) &gt;= 0 )
<a name="l03639"></a>03639         <span class="keywordflow">return</span> retour;
<a name="l03640"></a>03640     <span class="keywordflow">if</span> ( (retour = <a class="code" href="gsb__transactions__list_8c.html#a8be7f66c4c8f7c67eb187290c18fb6f7">find_element_col</a> ( <a class="code" href="gsb__transactions__list_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57a5bc876fbf3281eb4cc86a5fefdfc4487">ELEMENT_NOTES</a> )) &gt;= 0 )
<a name="l03641"></a>03641         <span class="keywordflow">return</span> retour;
<a name="l03642"></a>03642 
<a name="l03643"></a>03643     <span class="keywordflow">return</span> -1;
<a name="l03644"></a>03644 }
<a name="l03645"></a>03645 
<a name="l03646"></a>03646 <span class="comment">/* Local Variables: */</span>
<a name="l03647"></a>03647 <span class="comment">/* c-basic-offset: 4 */</span>
<a name="l03648"></a>03648 <span class="comment">/* End: */</span>
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Généré le Sat Aug 7 22:12:03 2010 pour Grisbi par&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
