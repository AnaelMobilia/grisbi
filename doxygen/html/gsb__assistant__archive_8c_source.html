<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Grisbi:  Fichier source de gsb_assistant_archive.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Généré par Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Page&nbsp;principale</span></a></li>
      <li><a href="pages.html"><span>Pages&nbsp;associées</span></a></li>
      <li><a href="annotated.html"><span>Structures&nbsp;de&nbsp;données</span></a></li>
      <li class="current"><a href="files.html"><span>Fichiers</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>Liste&nbsp;des&nbsp;fichiers</span></a></li>
      <li><a href="globals.html"><span>Portée&nbsp;globale</span></a></li>
    </ul>
  </div>
<h1>gsb_assistant_archive.c</h1><a href="gsb__assistant__archive_8c.html">Aller à la documentation de ce fichier.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* ************************************************************************** */</span>
<a name="l00002"></a>00002 <span class="comment">/*                                                                            */</span>
<a name="l00003"></a>00003 <span class="comment">/*     Copyright (C)    2000-2007 Cédric Auger (cedric@grisbi.org)            */</span>
<a name="l00004"></a>00004 <span class="comment">/*          2003-2008 Benjamin Drieu (bdrieu@april.org)                       */</span>
<a name="l00005"></a>00005 <span class="comment">/*                      2008-2009 Pierre Biava (grisbi@pierre.biava.name)     */</span>
<a name="l00006"></a>00006 <span class="comment">/*          http://www.grisbi.org                                             */</span>
<a name="l00007"></a>00007 <span class="comment">/*                                                                            */</span>
<a name="l00008"></a>00008 <span class="comment">/*  This program is free software; you can redistribute it and/or modify      */</span>
<a name="l00009"></a>00009 <span class="comment">/*  it under the terms of the GNU General Public License as published by      */</span>
<a name="l00010"></a>00010 <span class="comment">/*  the Free Software Foundation; either version 2 of the License, or         */</span>
<a name="l00011"></a>00011 <span class="comment">/*  (at your option) any later version.                                       */</span>
<a name="l00012"></a>00012 <span class="comment">/*                                                                            */</span>
<a name="l00013"></a>00013 <span class="comment">/*  This program is distributed in the hope that it will be useful,           */</span>
<a name="l00014"></a>00014 <span class="comment">/*  but WITHOUT ANY WARRANTY; without even the implied warranty of            */</span>
<a name="l00015"></a>00015 <span class="comment">/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the             */</span>
<a name="l00016"></a>00016 <span class="comment">/*  GNU General Public License for more details.                              */</span>
<a name="l00017"></a>00017 <span class="comment">/*                                                                            */</span>
<a name="l00018"></a>00018 <span class="comment">/*  You should have received a copy of the GNU General Public License         */</span>
<a name="l00019"></a>00019 <span class="comment">/*  along with this program; if not, write to the Free Software               */</span>
<a name="l00020"></a>00020 <span class="comment">/*  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA */</span>
<a name="l00021"></a>00021 <span class="comment">/*                                                                            */</span>
<a name="l00022"></a>00022 <span class="comment">/* ************************************************************************** */</span>
<a name="l00023"></a>00023 
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="include_8h.html">include.h</a>&quot;</span>
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="comment">/*START_INCLUDE*/</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="gsb__assistant__archive_8h.html">gsb_assistant_archive.h</a>&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="etats__support_8h.html">etats_support.h</a>&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="gsb__assistant_8h.html">gsb_assistant.h</a>&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="gsb__calendar__entry_8h.html">gsb_calendar_entry.h</a>&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="gsb__data__archive_8h.html">gsb_data_archive.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="gsb__data__archive__store_8h.html">gsb_data_archive_store.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="gsb__data__fyear_8h.html">gsb_data_fyear.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="gsb__data__report_8h.html">gsb_data_report.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="gsb__data__transaction_8h.html">gsb_data_transaction.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="utils__dates_8h.html">utils_dates.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="gsb__fyear_8h.html">gsb_fyear.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="navigation_8h.html">navigation.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="gsb__report_8h.html">gsb_report.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="gsb__transactions__list_8h.html">gsb_transactions_list.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="dialog_8h.html">dialog.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="traitement__variables_8h.html">traitement_variables.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="utils__str_8h.html">utils_str.h</a>&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="etats__calculs_8h.html">etats_calculs.h</a>&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="utils_8h.html">utils.h</a>&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="structures_8h.html">structures.h</a>&quot;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="include_8h.html">include.h</a>&quot;</span>
<a name="l00054"></a>00054 <span class="comment">/*END_INCLUDE*/</span>
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 <span class="comment">/*START_STATIC*/</span>
<a name="l00057"></a>00057 <span class="keyword">static</span> <span class="keywordtype">void</span> gsb_assistant_archive_add_children_to_list ( gint transaction_number );
<a name="l00058"></a>00058 <span class="keyword">static</span> <span class="keywordtype">void</span> gsb_assistant_archive_add_contra_transaction_to_list ( gint transaction_number );
<a name="l00059"></a>00059 <span class="keyword">static</span> <span class="keywordtype">void</span> gsb_assistant_archive_add_transaction_to_list ( gpointer transaction_pointer );
<a name="l00060"></a>00060 <span class="keyword">static</span> GtkWidget *gsb_assistant_archive_page_archive_name ( GtkWidget *assistant );
<a name="l00061"></a>00061 <span class="keyword">static</span> GtkWidget *gsb_assistant_archive_page_menu ( GtkWidget *assistant );
<a name="l00062"></a>00062 <span class="keyword">static</span> GtkWidget *gsb_assistant_archive_page_success ( <span class="keywordtype">void</span> );
<a name="l00063"></a>00063 <span class="keyword">static</span> gboolean gsb_assistant_archive_switch_to_archive_name ( GtkWidget *assistant,
<a name="l00064"></a>00064                         gint new_page );
<a name="l00065"></a>00065 <span class="keyword">static</span> gboolean gsb_assistant_archive_switch_to_intro ( GtkWidget *assistant,
<a name="l00066"></a>00066                         gint new_page );
<a name="l00067"></a>00067 <span class="keyword">static</span> gboolean gsb_assistant_archive_switch_to_menu ( GtkWidget *assistant,
<a name="l00068"></a>00068                         gint new_page );
<a name="l00069"></a>00069 <span class="keyword">static</span> gboolean gsb_assistant_archive_switch_to_succes ( GtkWidget *assistant,
<a name="l00070"></a>00070                         gint new_page );
<a name="l00071"></a>00071 <span class="keyword">static</span> gboolean gsb_assistant_archive_update_labels ( GtkWidget *assistant );
<a name="l00072"></a>00072 <span class="comment">/*END_STATIC*/</span>
<a name="l00073"></a>00073 
<a name="l00074"></a>00074 <span class="comment">/*START_EXTERN*/</span>
<a name="l00075"></a>00075 <span class="comment">/*END_EXTERN*/</span>
<a name="l00076"></a>00076 
<a name="l00077"></a><a class="code" href="gsb__assistant__archive_8c.html#a9338eaa443e5fa1dc67b270bb59a4597">00077</a> <span class="keyword">enum</span> <a class="code" href="gsb__assistant__archive_8c.html#a9338eaa443e5fa1dc67b270bb59a4597">archive_assistant_page</a>
<a name="l00078"></a>00078 {
<a name="l00079"></a><a class="code" href="gsb__assistant__archive_8c.html#a9338eaa443e5fa1dc67b270bb59a4597a747307c4f3f09edb50881e75f24a8be1">00079</a>     <a class="code" href="gsb__assistant__archive_8c.html#a9338eaa443e5fa1dc67b270bb59a4597a747307c4f3f09edb50881e75f24a8be1">ARCHIVE_ASSISTANT_INTRO</a>= 0,
<a name="l00080"></a><a class="code" href="gsb__assistant__archive_8c.html#a9338eaa443e5fa1dc67b270bb59a4597a590584282c8c782743f8df3c51482748">00080</a>     <a class="code" href="gsb__assistant__archive_8c.html#a9338eaa443e5fa1dc67b270bb59a4597a590584282c8c782743f8df3c51482748">ARCHIVE_ASSISTANT_MENU</a>,
<a name="l00081"></a><a class="code" href="gsb__assistant__archive_8c.html#a9338eaa443e5fa1dc67b270bb59a4597a4c8f1f0fe076550203e3d9a665f154ce">00081</a>     <a class="code" href="gsb__assistant__archive_8c.html#a9338eaa443e5fa1dc67b270bb59a4597a4c8f1f0fe076550203e3d9a665f154ce">ARCHIVE_ASSISTANT_ARCHIVE_NAME</a>,
<a name="l00082"></a><a class="code" href="gsb__assistant__archive_8c.html#a9338eaa443e5fa1dc67b270bb59a4597a3a05338521296356092250cbdc1f7980">00082</a>     <a class="code" href="gsb__assistant__archive_8c.html#a9338eaa443e5fa1dc67b270bb59a4597a3a05338521296356092250cbdc1f7980">ARCHIVE_ASSISTANT_SUCCESS</a>
<a name="l00083"></a>00083 };
<a name="l00084"></a>00084 
<a name="l00085"></a>00085 <span class="keyword">static</span> GtkWidget *initial_date = NULL;
<a name="l00086"></a>00086 <span class="keyword">static</span> GtkWidget *final_date = NULL;
<a name="l00087"></a>00087 <span class="keyword">static</span> GtkWidget *financial_year_button = NULL;
<a name="l00088"></a>00088 <span class="keyword">static</span> GtkWidget *report_button = NULL;
<a name="l00089"></a>00089 <span class="keyword">static</span> GtkWidget *name_entry = NULL;
<a name="l00090"></a>00090 <span class="keyword">static</span> GtkWidget *label_archived = NULL;
<a name="l00091"></a>00091 
<a name="l00092"></a>00092 <span class="keyword">static</span> GtkWidget *vbox_congratulation = NULL;
<a name="l00093"></a>00093 <span class="keyword">static</span> GtkWidget *vbox_failed = NULL;
<a name="l00094"></a>00094 <span class="keyword">static</span> GtkWidget *congratulations_view = NULL;
<a name="l00095"></a>00095 <span class="keyword">static</span> GtkWidget *failed_view = NULL;
<a name="l00096"></a>00096 
<a name="l00097"></a>00097 <span class="keyword">static</span> GSList *list_transaction_to_archive = NULL;
<a name="l00098"></a>00098 
<a name="l00099"></a>00099 
<a name="l00107"></a><a class="code" href="gsb__assistant__archive_8h.html#a57e51811453ac3de14dd07bfa3b752e2">00107</a> GtkResponseType <a class="code" href="gsb__assistant__archive_8c.html#a57e51811453ac3de14dd07bfa3b752e2">gsb_assistant_archive_run_by_menu</a> (<span class="keywordtype">void</span>)
<a name="l00108"></a>00108 {
<a name="l00109"></a>00109     <span class="keywordflow">return</span> <a class="code" href="gsb__assistant__archive_8c.html#ab704558aef7214e869b6a9a3a87d0b1f">gsb_assistant_archive_run</a> (FALSE);
<a name="l00110"></a>00110 }
<a name="l00111"></a>00111 
<a name="l00112"></a>00112 
<a name="l00120"></a><a class="code" href="gsb__assistant__archive_8h.html#ab704558aef7214e869b6a9a3a87d0b1f">00120</a> GtkResponseType <a class="code" href="gsb__assistant__archive_8c.html#ab704558aef7214e869b6a9a3a87d0b1f">gsb_assistant_archive_run</a> ( gboolean <a class="code" href="gsb__account__property_8c.html#a06dbc3a3eb5aaab80edf32ea607f1ef3">origin</a> )
<a name="l00121"></a>00121 {
<a name="l00122"></a>00122     GtkResponseType return_value;
<a name="l00123"></a>00123     GtkWidget *assistant;
<a name="l00124"></a>00124     gchar *tmpstr;
<a name="l00125"></a>00125 
<a name="l00126"></a>00126     <span class="keywordflow">if</span> (origin)
<a name="l00127"></a>00127         <span class="comment">/* come from check while opening file */</span>
<a name="l00128"></a>00128         tmpstr = g_strdup_printf ( _(<span class="stringliteral">&quot;There are a lot of transactions in your file (%d) and it is advised not to keep more than about %d transactions unarchived.\n&quot;</span>
<a name="l00129"></a>00129                                      <span class="stringliteral">&quot;To increase speed, you should archive them &quot;</span>
<a name="l00130"></a>00130                                      <span class="stringliteral">&quot;(the current limit and the opening check-up can be changed in the Preferences)\n\n&quot;</span>
<a name="l00131"></a>00131                                      <span class="stringliteral">&quot;This assistant will guide you through the process of archiving transactions &quot;</span>
<a name="l00132"></a>00132                                      <span class="stringliteral">&quot;By default, Grisbi does not export any archive into separate files, &quot;</span>
<a name="l00133"></a>00133                                      <span class="stringliteral">&quot;it just mark transactions as archted and do not use them.\n\n&quot;</span>
<a name="l00134"></a>00134                                      <span class="stringliteral">&quot;You can still export them into a separate archive file if necessary.\n\n&quot;</span> 
<a name="l00135"></a>00135                                      <span class="stringliteral">&quot;Press Cancel if you don&#39;t want make an archive now\n&quot;</span>),
<a name="l00136"></a>00136                                    g_slist_length (<a class="code" href="gsb__data__transaction_8c.html#af781a71a62eece020188ef62847f2887">gsb_data_transaction_get_transactions_list</a> ()),
<a name="l00137"></a>00137                                    <a class="code" href="gsb__file__config_8c.html#ac390e947e97cef2bec2f5d59d6ec1071">conf</a>.<a class="code" href="structgsb__conf__t.html#ab73a8c5710e5381f4e54fccf40fbedbe">max_non_archived_transactions_for_check</a> );
<a name="l00138"></a>00138     <span class="keywordflow">else</span>
<a name="l00139"></a>00139         <span class="comment">/* come by menu action */</span>
<a name="l00140"></a>00140         tmpstr = <a class="code" href="utils__str_8c.html#ad9a37361694eeaa2847b0fe11389824d">my_strdup</a> (_(<span class="stringliteral">&quot;This assistant will guide you through the process of archiving transactions &quot;</span>
<a name="l00141"></a>00141                               <span class="stringliteral">&quot;to increase the speed of grisbi.\n\n&quot;</span>
<a name="l00142"></a>00142                               <span class="stringliteral">&quot;By default, Grisbi does not export any archive into separate files, &quot;</span>
<a name="l00143"></a>00143                               <span class="stringliteral">&quot;it just mark transactions as archted and do not use them.\n\n&quot;</span>
<a name="l00144"></a>00144                               <span class="stringliteral">&quot;You can still export them into a separate archive file if necessary.\n&quot;</span>));
<a name="l00145"></a>00145 
<a name="l00146"></a>00146     <span class="comment">/* create the assistant */</span>
<a name="l00147"></a>00147     assistant = <a class="code" href="gsb__assistant_8c.html#a8502128771d8c3f3e8c83d877e1f20ea">gsb_assistant_new</a> ( _(<span class="stringliteral">&quot;Archive transactions&quot;</span>),
<a name="l00148"></a>00148                                     tmpstr,
<a name="l00149"></a>00149                                     <span class="stringliteral">&quot;archive.png&quot;</span>,
<a name="l00150"></a>00150                                     G_CALLBACK (gsb_assistant_archive_switch_to_intro));
<a name="l00151"></a>00151     g_free (tmpstr);
<a name="l00152"></a>00152 
<a name="l00153"></a>00153     <a class="code" href="gsb__assistant_8c.html#a6972bde2415e07b7afb35a062456f129">gsb_assistant_add_page</a> ( assistant,
<a name="l00154"></a>00154                              gsb_assistant_archive_page_menu (assistant),
<a name="l00155"></a>00155                              <a class="code" href="gsb__assistant__archive_8c.html#a9338eaa443e5fa1dc67b270bb59a4597a590584282c8c782743f8df3c51482748">ARCHIVE_ASSISTANT_MENU</a>,
<a name="l00156"></a>00156                              <a class="code" href="gsb__assistant__archive_8c.html#a9338eaa443e5fa1dc67b270bb59a4597a747307c4f3f09edb50881e75f24a8be1">ARCHIVE_ASSISTANT_INTRO</a>,
<a name="l00157"></a>00157                              <a class="code" href="gsb__assistant__archive_8c.html#a9338eaa443e5fa1dc67b270bb59a4597a4c8f1f0fe076550203e3d9a665f154ce">ARCHIVE_ASSISTANT_ARCHIVE_NAME</a>,
<a name="l00158"></a>00158                              G_CALLBACK (gsb_assistant_archive_switch_to_menu));
<a name="l00159"></a>00159     <a class="code" href="gsb__assistant_8c.html#a6972bde2415e07b7afb35a062456f129">gsb_assistant_add_page</a> ( assistant,
<a name="l00160"></a>00160                              gsb_assistant_archive_page_archive_name (assistant),
<a name="l00161"></a>00161                              <a class="code" href="gsb__assistant__archive_8c.html#a9338eaa443e5fa1dc67b270bb59a4597a4c8f1f0fe076550203e3d9a665f154ce">ARCHIVE_ASSISTANT_ARCHIVE_NAME</a>,
<a name="l00162"></a>00162                              <a class="code" href="gsb__assistant__archive_8c.html#a9338eaa443e5fa1dc67b270bb59a4597a590584282c8c782743f8df3c51482748">ARCHIVE_ASSISTANT_MENU</a>,
<a name="l00163"></a>00163                              <a class="code" href="gsb__assistant__archive_8c.html#a9338eaa443e5fa1dc67b270bb59a4597a3a05338521296356092250cbdc1f7980">ARCHIVE_ASSISTANT_SUCCESS</a>,
<a name="l00164"></a>00164                              G_CALLBACK (gsb_assistant_archive_switch_to_archive_name));
<a name="l00165"></a>00165     <a class="code" href="gsb__assistant_8c.html#a6972bde2415e07b7afb35a062456f129">gsb_assistant_add_page</a> ( assistant,
<a name="l00166"></a>00166                              gsb_assistant_archive_page_success (),
<a name="l00167"></a>00167                              <a class="code" href="gsb__assistant__archive_8c.html#a9338eaa443e5fa1dc67b270bb59a4597a3a05338521296356092250cbdc1f7980">ARCHIVE_ASSISTANT_SUCCESS</a>,
<a name="l00168"></a>00168                              <a class="code" href="gsb__assistant__archive_8c.html#a9338eaa443e5fa1dc67b270bb59a4597a590584282c8c782743f8df3c51482748">ARCHIVE_ASSISTANT_MENU</a>,
<a name="l00169"></a>00169                              0,
<a name="l00170"></a>00170                              G_CALLBACK (gsb_assistant_archive_switch_to_succes));
<a name="l00171"></a>00171     return_value = <a class="code" href="gsb__assistant_8c.html#a886a6fa8c458d71d7cfae7b54bd3187f">gsb_assistant_run</a> (assistant);
<a name="l00172"></a>00172     gtk_widget_destroy (assistant);
<a name="l00173"></a>00173 
<a name="l00174"></a>00174     <span class="comment">/* the fyear combobox in grisbi are used with the &quot;Automatic&quot; line,</span>
<a name="l00175"></a>00175 <span class="comment">     * so show it again */</span>
<a name="l00176"></a>00176     <a class="code" href="gsb__fyear_8c.html#a0b7a0d85ac5432e1a72a33493fce76d7">gsb_fyear_set_automatic</a> (TRUE);
<a name="l00177"></a>00177     <span class="keywordflow">return</span> return_value;
<a name="l00178"></a>00178 }
<a name="l00179"></a>00179 
<a name="l00180"></a>00180 
<a name="l00189"></a>00189 <span class="keyword">static</span> GtkWidget *gsb_assistant_archive_page_menu ( GtkWidget *assistant )
<a name="l00190"></a>00190 {
<a name="l00191"></a>00191     GtkWidget *page;
<a name="l00192"></a>00192     GtkWidget *vbox;
<a name="l00193"></a>00193     GtkWidget *label;
<a name="l00194"></a>00194     GtkWidget *button;
<a name="l00195"></a>00195     GtkWidget *hbox;
<a name="l00196"></a>00196 
<a name="l00197"></a>00197     page = gtk_hbox_new (FALSE, 15);
<a name="l00198"></a>00198     gtk_container_set_border_width ( GTK_CONTAINER (page), 10 );
<a name="l00199"></a>00199 
<a name="l00200"></a>00200     vbox = gtk_vbox_new (FALSE, 5);
<a name="l00201"></a>00201     gtk_box_pack_start ( GTK_BOX (page), vbox, FALSE, FALSE, 0 );
<a name="l00202"></a>00202 
<a name="l00203"></a>00203     <span class="comment">/* set up the menu */</span>
<a name="l00204"></a>00204     label = gtk_label_new (_(<span class="stringliteral">&quot;Please select a way to select transactions for this archive&quot;</span>));
<a name="l00205"></a>00205     gtk_misc_set_alignment ( GTK_MISC (label), 0, 0.5 );
<a name="l00206"></a>00206     gtk_box_pack_start ( GTK_BOX (vbox), label,  FALSE, FALSE, 0 );
<a name="l00207"></a>00207 
<a name="l00208"></a>00208     <span class="comment">/* archive by date */</span>
<a name="l00209"></a>00209     button = gtk_radio_button_new_with_label ( NULL, _(<span class="stringliteral">&quot;Archive by date&quot;</span>));
<a name="l00210"></a>00210     g_signal_connect_object ( G_OBJECT (button),
<a name="l00211"></a>00211                         <span class="stringliteral">&quot;toggled&quot;</span>,
<a name="l00212"></a>00212                         G_CALLBACK (gsb_assistant_archive_update_labels),
<a name="l00213"></a>00213                         G_OBJECT (assistant),
<a name="l00214"></a>00214                         G_CONNECT_AFTER | G_CONNECT_SWAPPED);
<a name="l00215"></a>00215     gtk_box_pack_start ( GTK_BOX (vbox), button, FALSE, FALSE, 0 );
<a name="l00216"></a>00216 
<a name="l00217"></a>00217     label = gtk_label_new ( _(<span class="stringliteral">&quot;Grisbi will archive all transactions between initial and &quot;</span>
<a name="l00218"></a>00218                         <span class="stringliteral">&quot;final dates.&quot;</span>) );
<a name="l00219"></a>00219     gtk_misc_set_alignment ( GTK_MISC (label), 0, 0.5 );
<a name="l00220"></a>00220     gtk_misc_set_padding ( GTK_MISC (label), 24, 0 );
<a name="l00221"></a>00221     gtk_box_pack_start ( GTK_BOX (vbox), label, FALSE, FALSE, 0 );
<a name="l00222"></a>00222 
<a name="l00223"></a>00223     hbox = gtk_hbox_new ( FALSE, 6 );
<a name="l00224"></a>00224     g_signal_connect ( G_OBJECT (button),
<a name="l00225"></a>00225                         <span class="stringliteral">&quot;toggled&quot;</span>,
<a name="l00226"></a>00226                         G_CALLBACK  (<a class="code" href="utils_8c.html#ad678079f1b9eb979a0766e9dcbec0fd3">sens_desensitive_pointeur</a>),
<a name="l00227"></a>00227                         G_OBJECT (hbox));
<a name="l00228"></a>00228     gtk_box_pack_start ( GTK_BOX (vbox), hbox, FALSE, FALSE, 0 );
<a name="l00229"></a>00229 
<a name="l00230"></a>00230     label = gtk_label_new ( <a class="code" href="structures_8h.html#aaad3270d56994a956f6956f142c1c103">COLON</a> ( _(<span class="stringliteral">&quot;Initial date&quot;</span> ) ) );
<a name="l00231"></a>00231     gtk_misc_set_padding ( GTK_MISC (label), 24, 0 );
<a name="l00232"></a>00232     gtk_box_pack_start ( GTK_BOX (hbox), label, FALSE, FALSE, 0 );
<a name="l00233"></a>00233 
<a name="l00234"></a>00234     initial_date = <a class="code" href="gsb__calendar__entry_8c.html#afc3a9a10d06b658715e71451cd8bd97f">gsb_calendar_entry_new</a> (FALSE);
<a name="l00235"></a>00235     g_signal_connect_object ( G_OBJECT (initial_date),
<a name="l00236"></a>00236                         <span class="stringliteral">&quot;changed&quot;</span>,
<a name="l00237"></a>00237                         G_CALLBACK (gsb_assistant_archive_update_labels),
<a name="l00238"></a>00238                         G_OBJECT (assistant),
<a name="l00239"></a>00239                         G_CONNECT_AFTER | G_CONNECT_SWAPPED);
<a name="l00240"></a>00240     gtk_box_pack_start ( GTK_BOX (hbox), initial_date, FALSE, FALSE, 0 );
<a name="l00241"></a>00241 
<a name="l00242"></a>00242     label = gtk_label_new ( <a class="code" href="structures_8h.html#aaad3270d56994a956f6956f142c1c103">COLON</a> ( _(<span class="stringliteral">&quot;Final date&quot;</span>)) );
<a name="l00243"></a>00243     gtk_misc_set_padding ( GTK_MISC (label), 24, 0 );
<a name="l00244"></a>00244     gtk_box_pack_start ( GTK_BOX (hbox), label, FALSE, FALSE, 0 );
<a name="l00245"></a>00245 
<a name="l00246"></a>00246     final_date = <a class="code" href="gsb__calendar__entry_8c.html#afc3a9a10d06b658715e71451cd8bd97f">gsb_calendar_entry_new</a> (FALSE);
<a name="l00247"></a>00247     g_signal_connect_object ( G_OBJECT (final_date),
<a name="l00248"></a>00248                         <span class="stringliteral">&quot;changed&quot;</span>,
<a name="l00249"></a>00249                         G_CALLBACK (gsb_assistant_archive_update_labels),
<a name="l00250"></a>00250                         G_OBJECT (assistant),
<a name="l00251"></a>00251                         G_CONNECT_AFTER | G_CONNECT_SWAPPED);
<a name="l00252"></a>00252     gtk_box_pack_start ( GTK_BOX (hbox), final_date, FALSE, FALSE, 0 );
<a name="l00253"></a>00253 
<a name="l00254"></a>00254     <span class="comment">/* archive by financial year */</span>
<a name="l00255"></a>00255     button = gtk_radio_button_new_with_label ( 
<a name="l00256"></a>00256                         gtk_radio_button_get_group ( GTK_RADIO_BUTTON ( button ) ),
<a name="l00257"></a>00257                         _(<span class="stringliteral">&quot;Archive by financial year&quot;</span>) );
<a name="l00258"></a>00258     g_signal_connect_object ( G_OBJECT (button),
<a name="l00259"></a>00259                         <span class="stringliteral">&quot;toggled&quot;</span>,
<a name="l00260"></a>00260                         G_CALLBACK (gsb_assistant_archive_update_labels),
<a name="l00261"></a>00261                         G_OBJECT (assistant),
<a name="l00262"></a>00262                         G_CONNECT_AFTER | G_CONNECT_SWAPPED);
<a name="l00263"></a>00263     gtk_box_pack_start ( GTK_BOX (vbox), button, FALSE, FALSE, 0 );
<a name="l00264"></a>00264 
<a name="l00265"></a>00265     label = gtk_label_new ( _(<span class="stringliteral">&quot;Grisbi will archive all transactions belonging to a &quot;</span>
<a name="l00266"></a>00266                         <span class="stringliteral">&quot;financial year.&quot;</span> ) );
<a name="l00267"></a>00267     gtk_misc_set_padding ( GTK_MISC (label), 24, 0 );
<a name="l00268"></a>00268     gtk_misc_set_alignment ( GTK_MISC (label), 0, 0.5 );
<a name="l00269"></a>00269     gtk_box_pack_start ( GTK_BOX (vbox), label, FALSE, FALSE, 0 );
<a name="l00270"></a>00270 
<a name="l00271"></a>00271     hbox = gtk_hbox_new ( FALSE, 10 );
<a name="l00272"></a>00272     g_signal_connect ( G_OBJECT (button),
<a name="l00273"></a>00273                         <span class="stringliteral">&quot;toggled&quot;</span>,
<a name="l00274"></a>00274                         G_CALLBACK  ( <a class="code" href="utils_8c.html#ad678079f1b9eb979a0766e9dcbec0fd3">sens_desensitive_pointeur</a> ),
<a name="l00275"></a>00275                         G_OBJECT (hbox));
<a name="l00276"></a>00276     gtk_box_pack_start ( GTK_BOX (vbox), hbox, FALSE, FALSE, 0 );
<a name="l00277"></a>00277 
<a name="l00278"></a>00278     label = gtk_label_new ( _(<span class="stringliteral">&quot;Financial year :&quot;</span>) );
<a name="l00279"></a>00279     gtk_misc_set_padding ( GTK_MISC (label), 24, 0 );
<a name="l00280"></a>00280     gtk_box_pack_start ( GTK_BOX (hbox), label, FALSE, FALSE, 0 );
<a name="l00281"></a>00281 
<a name="l00282"></a>00282     financial_year_button = <a class="code" href="gsb__fyear_8c.html#a6f8ef344dde2ca4102a8371319b7565e">gsb_fyear_make_combobox</a> (FALSE);
<a name="l00283"></a>00283     g_signal_connect_object ( G_OBJECT (financial_year_button),
<a name="l00284"></a>00284                         <span class="stringliteral">&quot;changed&quot;</span>,
<a name="l00285"></a>00285                         G_CALLBACK (gsb_assistant_archive_update_labels),
<a name="l00286"></a>00286                         G_OBJECT (assistant),
<a name="l00287"></a>00287                         G_CONNECT_AFTER | G_CONNECT_SWAPPED);
<a name="l00288"></a>00288     gtk_box_pack_start ( GTK_BOX (hbox), financial_year_button, FALSE, FALSE, 0 );
<a name="l00289"></a>00289     gtk_widget_set_sensitive ( hbox, FALSE );
<a name="l00290"></a>00290 
<a name="l00291"></a>00291     <span class="comment">/* archive by budget */</span>
<a name="l00292"></a>00292     button = gtk_radio_button_new_with_label ( gtk_radio_button_get_group (
<a name="l00293"></a>00293                         GTK_RADIO_BUTTON ( button ) ),
<a name="l00294"></a>00294                         _(<span class="stringliteral">&quot;Archive by report&quot;</span>));
<a name="l00295"></a>00295     g_signal_connect_object ( G_OBJECT (button),
<a name="l00296"></a>00296                         <span class="stringliteral">&quot;toggled&quot;</span>,
<a name="l00297"></a>00297                         G_CALLBACK (gsb_assistant_archive_update_labels),
<a name="l00298"></a>00298                         G_OBJECT (assistant),
<a name="l00299"></a>00299                         G_CONNECT_AFTER | G_CONNECT_SWAPPED);
<a name="l00300"></a>00300     gtk_box_pack_start ( GTK_BOX (vbox), button, FALSE, FALSE, 0 );
<a name="l00301"></a>00301 
<a name="l00302"></a>00302     label = gtk_label_new (_(<span class="stringliteral">&quot;Grisbi will archive transactions selected by a report.&quot;</span> ));
<a name="l00303"></a>00303     gtk_misc_set_padding ( GTK_MISC (label), 24, 0 );
<a name="l00304"></a>00304     gtk_misc_set_alignment ( GTK_MISC (label), 0, 0.5 );
<a name="l00305"></a>00305     gtk_box_pack_start ( GTK_BOX (vbox), label, FALSE, FALSE, 0 );
<a name="l00306"></a>00306 
<a name="l00307"></a>00307     hbox = gtk_hbox_new ( FALSE, 10 );
<a name="l00308"></a>00308     g_signal_connect ( G_OBJECT (button),
<a name="l00309"></a>00309                         <span class="stringliteral">&quot;toggled&quot;</span>,
<a name="l00310"></a>00310                         G_CALLBACK  (<a class="code" href="utils_8c.html#ad678079f1b9eb979a0766e9dcbec0fd3">sens_desensitive_pointeur</a>),
<a name="l00311"></a>00311                         G_OBJECT (hbox));
<a name="l00312"></a>00312     gtk_box_pack_start ( GTK_BOX (vbox), hbox, FALSE, FALSE, 0 );
<a name="l00313"></a>00313 
<a name="l00314"></a>00314     label = gtk_label_new ( <a class="code" href="structures_8h.html#aaad3270d56994a956f6956f142c1c103">COLON</a> ( _(<span class="stringliteral">&quot;Report&quot;</span>) ) );
<a name="l00315"></a>00315     gtk_misc_set_padding ( GTK_MISC (label), 24, 0 );
<a name="l00316"></a>00316     gtk_box_pack_start ( GTK_BOX (hbox), label, FALSE, FALSE, 0 );
<a name="l00317"></a>00317     report_button = <a class="code" href="gsb__report_8c.html#af2e1bf81ec2ee8448a590dd793bc1e9f">gsb_report_make_combobox</a> ();
<a name="l00318"></a>00318     g_signal_connect_object ( G_OBJECT (report_button),
<a name="l00319"></a>00319                         <span class="stringliteral">&quot;changed&quot;</span>,
<a name="l00320"></a>00320                         G_CALLBACK (gsb_assistant_archive_update_labels),
<a name="l00321"></a>00321                         G_OBJECT (assistant),
<a name="l00322"></a>00322                         G_CONNECT_AFTER | G_CONNECT_SWAPPED);
<a name="l00323"></a>00323     gtk_box_pack_start ( GTK_BOX (hbox), report_button, FALSE, FALSE, 0 );
<a name="l00324"></a>00324     gtk_widget_set_sensitive ( hbox, FALSE );
<a name="l00325"></a>00325 
<a name="l00326"></a>00326     label_archived = gtk_label_new (NULL);
<a name="l00327"></a>00327     gtk_misc_set_alignment ( GTK_MISC (label_archived), 0, 0 );
<a name="l00328"></a>00328     gtk_box_pack_start ( GTK_BOX (vbox), label_archived, FALSE, FALSE, 0 );
<a name="l00329"></a>00329 
<a name="l00330"></a>00330     <a class="code" href="gsb__assistant_8c.html#ad38c5d761d97d2257a4b35a52c4048c6">gsb_assistant_sensitive_button_next</a> ( assistant, FALSE );
<a name="l00331"></a>00331 
<a name="l00332"></a>00332     gtk_widget_show_all (page);
<a name="l00333"></a>00333     <span class="keywordflow">return</span> page;
<a name="l00334"></a>00334 }
<a name="l00335"></a>00335 
<a name="l00336"></a>00336 
<a name="l00337"></a>00337 
<a name="l00345"></a>00345 <span class="keyword">static</span> GtkWidget *gsb_assistant_archive_page_archive_name ( GtkWidget *assistant )
<a name="l00346"></a>00346 {
<a name="l00347"></a>00347     GtkWidget *page;
<a name="l00348"></a>00348     GtkWidget *vbox;
<a name="l00349"></a>00349     GtkWidget *label;
<a name="l00350"></a>00350 
<a name="l00351"></a>00351     page = gtk_hbox_new (FALSE, 15);
<a name="l00352"></a>00352     gtk_container_set_border_width ( GTK_CONTAINER (page),
<a name="l00353"></a>00353                                      10 );
<a name="l00354"></a>00354 
<a name="l00355"></a>00355     vbox = gtk_vbox_new (FALSE, 5);
<a name="l00356"></a>00356     gtk_box_pack_start ( GTK_BOX (page),
<a name="l00357"></a>00357                          vbox,
<a name="l00358"></a>00358                          FALSE, FALSE, 0 );
<a name="l00359"></a>00359 
<a name="l00360"></a>00360     <span class="comment">/* set up the menu */</span>
<a name="l00361"></a>00361     label = gtk_label_new ( <a class="code" href="structures_8h.html#aaad3270d56994a956f6956f142c1c103">COLON</a>(_(<span class="stringliteral">&quot;Please choose a name for archive&quot;</span>) ) );
<a name="l00362"></a>00362     gtk_misc_set_alignment ( GTK_MISC (label),
<a name="l00363"></a>00363                              0, 0.5 );
<a name="l00364"></a>00364     gtk_box_pack_start ( GTK_BOX (vbox),
<a name="l00365"></a>00365                          label,
<a name="l00366"></a>00366                          FALSE, FALSE, 0 );
<a name="l00367"></a>00367 
<a name="l00368"></a>00368     name_entry = gtk_entry_new ();
<a name="l00369"></a>00369     gtk_widget_set_size_request ( name_entry, 400, -1 );
<a name="l00370"></a>00370     g_signal_connect_object ( G_OBJECT (name_entry),
<a name="l00371"></a>00371                               <span class="stringliteral">&quot;changed&quot;</span>,
<a name="l00372"></a>00372                               G_CALLBACK (gsb_assistant_archive_update_labels),
<a name="l00373"></a>00373                               G_OBJECT (assistant),
<a name="l00374"></a>00374                               G_CONNECT_AFTER | G_CONNECT_SWAPPED);
<a name="l00375"></a>00375     gtk_box_pack_start ( GTK_BOX (vbox),
<a name="l00376"></a>00376                          name_entry,
<a name="l00377"></a>00377                          FALSE, FALSE, 0 );
<a name="l00378"></a>00378 
<a name="l00379"></a>00379     <a class="code" href="gsb__assistant_8c.html#ad38c5d761d97d2257a4b35a52c4048c6">gsb_assistant_sensitive_button_next</a> ( assistant, FALSE );
<a name="l00380"></a>00380 
<a name="l00381"></a>00381     <span class="keywordflow">return</span> page;
<a name="l00382"></a>00382 }
<a name="l00383"></a>00383 
<a name="l00384"></a>00384 
<a name="l00385"></a>00385 
<a name="l00394"></a>00394 <span class="keyword">static</span> GtkWidget *gsb_assistant_archive_page_success ( <span class="keywordtype">void</span> )
<a name="l00395"></a>00395 {
<a name="l00396"></a>00396     GtkWidget * page;
<a name="l00397"></a>00397     GtkTextBuffer * buffer;
<a name="l00398"></a>00398     GtkTextIter iter;
<a name="l00399"></a>00399 
<a name="l00400"></a>00400     page = gtk_vbox_new ( FALSE, 0 );
<a name="l00401"></a>00401     gtk_container_set_border_width ( GTK_CONTAINER (page),
<a name="l00402"></a>00402                                      0 );
<a name="l00403"></a>00403 
<a name="l00404"></a>00404     <span class="comment">/* we create 2 vbox, one for congratulation, one for failed,</span>
<a name="l00405"></a>00405 <span class="comment">     * only one will be showed */</span>
<a name="l00406"></a>00406     vbox_congratulation = gtk_vbox_new (FALSE, 0);
<a name="l00407"></a>00407     gtk_box_pack_start ( GTK_BOX (page),
<a name="l00408"></a>00408                          vbox_congratulation,
<a name="l00409"></a>00409                          TRUE, TRUE, 0 );
<a name="l00410"></a>00410 
<a name="l00411"></a>00411     congratulations_view = gtk_text_view_new ();
<a name="l00412"></a>00412     gtk_text_view_set_wrap_mode (GTK_TEXT_VIEW (congratulations_view), GTK_WRAP_WORD);
<a name="l00413"></a>00413     gtk_text_view_set_editable ( GTK_TEXT_VIEW(congratulations_view), FALSE );
<a name="l00414"></a>00414     gtk_text_view_set_cursor_visible ( GTK_TEXT_VIEW(congratulations_view), FALSE );
<a name="l00415"></a>00415     gtk_text_view_set_left_margin ( GTK_TEXT_VIEW(congratulations_view), 12 );
<a name="l00416"></a>00416     gtk_text_view_set_right_margin ( GTK_TEXT_VIEW(congratulations_view), 12 );
<a name="l00417"></a>00417 
<a name="l00418"></a>00418     buffer = gtk_text_view_get_buffer (GTK_TEXT_VIEW (congratulations_view));
<a name="l00419"></a>00419     gtk_text_buffer_create_tag ( buffer, <span class="stringliteral">&quot;bold&quot;</span>, <span class="stringliteral">&quot;weight&quot;</span>, PANGO_WEIGHT_BOLD, NULL);  
<a name="l00420"></a>00420     gtk_text_buffer_create_tag ( buffer, <span class="stringliteral">&quot;x-large&quot;</span>, <span class="stringliteral">&quot;scale&quot;</span>, PANGO_SCALE_X_LARGE, NULL);
<a name="l00421"></a>00421     gtk_text_buffer_create_tag ( buffer, <span class="stringliteral">&quot;indented&quot;</span>, <span class="stringliteral">&quot;left-margin&quot;</span>, 24, NULL);
<a name="l00422"></a>00422 
<a name="l00423"></a>00423     gtk_text_buffer_get_iter_at_offset (buffer, &amp;iter, 1);
<a name="l00424"></a>00424     gtk_text_buffer_insert ( buffer, &amp;iter, <span class="stringliteral">&quot;\n&quot;</span>, -1 );
<a name="l00425"></a>00425     gtk_text_buffer_insert_with_tags_by_name (buffer, &amp;iter,
<a name="l00426"></a>00426                                               _(<span class="stringliteral">&quot;Congratulations !&quot;</span>), -1,
<a name="l00427"></a>00427                                               <span class="stringliteral">&quot;x-large&quot;</span>, <span class="stringliteral">&quot;bold&quot;</span>, NULL);
<a name="l00428"></a>00428     gtk_text_buffer_insert ( buffer, &amp;iter, <span class="stringliteral">&quot;\n\n&quot;</span>, -1 );
<a name="l00429"></a>00429     
<a name="l00430"></a>00430     gtk_box_pack_start ( GTK_BOX (vbox_congratulation),
<a name="l00431"></a>00431                          congratulations_view,
<a name="l00432"></a>00432                          TRUE, TRUE,
<a name="l00433"></a>00433                          0 );
<a name="l00434"></a>00434     gtk_text_buffer_get_end_iter ( buffer, &amp;iter );
<a name="l00435"></a>00435     gtk_text_buffer_create_mark ( buffer, <span class="stringliteral">&quot;status&quot;</span>, &amp;iter, TRUE );
<a name="l00436"></a>00436 
<a name="l00437"></a>00437     gtk_text_buffer_insert ( buffer, &amp;iter, 
<a name="l00438"></a>00438                              _(<span class="stringliteral">&quot;In case grisbi is still too slow after you created archives,&quot;</span>
<a name="l00439"></a>00439                                <span class="stringliteral">&quot;remember that you can configure it no to load &quot;</span>
<a name="l00440"></a>00440                                <span class="stringliteral">&quot;the marked transactions (R) at startup, to increase speed.\n\n&quot;</span>
<a name="l00441"></a>00441                                <span class="stringliteral">&quot;Press the &#39;Previous&#39; button to create another archive of &#39;Close&#39; &quot;</span>
<a name="l00442"></a>00442                                <span class="stringliteral">&quot;to exit this assistant.&quot;</span>),
<a name="l00443"></a>00443                              -1 );
<a name="l00444"></a>00444 
<a name="l00445"></a>00445     <span class="comment">/* make the failed box */</span>
<a name="l00446"></a>00446     vbox_failed = gtk_vbox_new (FALSE, 0 );
<a name="l00447"></a>00447     gtk_box_pack_start ( GTK_BOX (page),
<a name="l00448"></a>00448                          vbox_failed,
<a name="l00449"></a>00449                          TRUE, TRUE, 0 );
<a name="l00450"></a>00450 
<a name="l00451"></a>00451     failed_view = gtk_text_view_new ();
<a name="l00452"></a>00452     gtk_text_view_set_wrap_mode (GTK_TEXT_VIEW (failed_view), GTK_WRAP_WORD);
<a name="l00453"></a>00453     gtk_text_view_set_editable ( GTK_TEXT_VIEW(failed_view), FALSE );
<a name="l00454"></a>00454     gtk_text_view_set_cursor_visible ( GTK_TEXT_VIEW(failed_view), FALSE );
<a name="l00455"></a>00455     gtk_text_view_set_left_margin ( GTK_TEXT_VIEW(failed_view), 12 );
<a name="l00456"></a>00456     gtk_text_view_set_right_margin ( GTK_TEXT_VIEW(failed_view), 12 );
<a name="l00457"></a>00457 
<a name="l00458"></a>00458     buffer = gtk_text_view_get_buffer (GTK_TEXT_VIEW (failed_view));
<a name="l00459"></a>00459     gtk_text_buffer_create_tag ( buffer, <span class="stringliteral">&quot;bold&quot;</span>, <span class="stringliteral">&quot;weight&quot;</span>, PANGO_WEIGHT_BOLD, NULL);  
<a name="l00460"></a>00460     gtk_text_buffer_create_tag ( buffer, <span class="stringliteral">&quot;x-large&quot;</span>, <span class="stringliteral">&quot;scale&quot;</span>, PANGO_SCALE_X_LARGE, NULL);
<a name="l00461"></a>00461     gtk_text_buffer_create_tag ( buffer, <span class="stringliteral">&quot;indented&quot;</span>, <span class="stringliteral">&quot;left-margin&quot;</span>, 24, NULL);
<a name="l00462"></a>00462 
<a name="l00463"></a>00463     gtk_text_buffer_get_iter_at_offset (buffer, &amp;iter, 1);
<a name="l00464"></a>00464     gtk_text_buffer_insert ( buffer, &amp;iter, <span class="stringliteral">&quot;\n&quot;</span>, -1 );
<a name="l00465"></a>00465     gtk_text_buffer_insert_with_tags_by_name (buffer, &amp;iter,
<a name="l00466"></a>00466                                               _(<span class="stringliteral">&quot;Failed !&quot;</span>), -1,
<a name="l00467"></a>00467                                               <span class="stringliteral">&quot;x-large&quot;</span>, <span class="stringliteral">&quot;bold&quot;</span>, NULL);
<a name="l00468"></a>00468     gtk_text_buffer_insert ( buffer, &amp;iter, <span class="stringliteral">&quot;\n\n&quot;</span>, -1 );
<a name="l00469"></a>00469     
<a name="l00470"></a>00470     gtk_box_pack_start ( GTK_BOX (vbox_failed),
<a name="l00471"></a>00471                          failed_view,
<a name="l00472"></a>00472                          TRUE, TRUE,
<a name="l00473"></a>00473                          0 );
<a name="l00474"></a>00474     gtk_text_buffer_get_end_iter ( buffer, &amp;iter );
<a name="l00475"></a>00475     gtk_text_buffer_create_mark ( buffer, <span class="stringliteral">&quot;status&quot;</span>, &amp;iter, TRUE );
<a name="l00476"></a>00476 
<a name="l00477"></a>00477     gtk_text_buffer_insert ( buffer, &amp;iter, 
<a name="l00478"></a>00478                              _(<span class="stringliteral">&quot;An error occurred while creating the archive...\n&quot;</span>
<a name="l00479"></a>00479                                <span class="stringliteral">&quot;Most probably, you are trying to create an empty archive &quot;</span>
<a name="l00480"></a>00480                                <span class="stringliteral">&quot;that grisbi cowardly refused to create.\n\n&quot;</span>
<a name="l00481"></a>00481                                <span class="stringliteral">&quot;Press the Previous button to try again or cancel this process.&quot;</span>),
<a name="l00482"></a>00482                              -1 );
<a name="l00483"></a>00483 
<a name="l00484"></a>00484     gtk_widget_show_all (page);
<a name="l00485"></a>00485     gtk_widget_hide (vbox_failed);
<a name="l00486"></a>00486 
<a name="l00487"></a>00487     <span class="keywordflow">return</span> page;
<a name="l00488"></a>00488 }
<a name="l00489"></a>00489 
<a name="l00490"></a>00490 
<a name="l00499"></a>00499 <span class="keyword">static</span> gboolean gsb_assistant_archive_switch_to_intro ( GtkWidget *assistant,
<a name="l00500"></a>00500                         gint new_page )
<a name="l00501"></a>00501 {
<a name="l00502"></a>00502 
<a name="l00503"></a>00503     <span class="comment">/* enter into the intro page */</span>
<a name="l00504"></a>00504     <a class="code" href="gsb__assistant_8c.html#af9667499ec49ad50593c8662801d4a9c">gsb_assistant_change_button_next</a> ( assistant,
<a name="l00505"></a>00505                                        GTK_STOCK_GO_FORWARD, GTK_RESPONSE_YES );
<a name="l00506"></a>00506     <a class="code" href="gsb__assistant_8c.html#ad38c5d761d97d2257a4b35a52c4048c6">gsb_assistant_sensitive_button_next</a> ( assistant,
<a name="l00507"></a>00507                                           TRUE );
<a name="l00508"></a>00508     <span class="keywordflow">return</span> FALSE;
<a name="l00509"></a>00509 }
<a name="l00510"></a>00510 
<a name="l00511"></a>00511 
<a name="l00512"></a>00512 
<a name="l00521"></a>00521 <span class="keyword">static</span> gboolean gsb_assistant_archive_switch_to_menu ( GtkWidget *assistant,
<a name="l00522"></a>00522                         gint new_page )
<a name="l00523"></a>00523 {
<a name="l00524"></a>00524     GSList *tmp_list;
<a name="l00525"></a>00525     <span class="keyword">const</span> GDate *date = NULL;
<a name="l00526"></a>00526 
<a name="l00527"></a>00527     <span class="comment">/* enter into the menu page */</span>
<a name="l00528"></a>00528     gtk_label_set_text ( GTK_LABEL (label_archived), NULL );
<a name="l00529"></a>00529     <a class="code" href="gsb__assistant_8c.html#af9667499ec49ad50593c8662801d4a9c">gsb_assistant_change_button_next</a> ( assistant,
<a name="l00530"></a>00530                         GTK_STOCK_GO_FORWARD, GTK_RESPONSE_YES );
<a name="l00531"></a>00531     gsb_assistant_archive_update_labels ( assistant );
<a name="l00532"></a>00532 
<a name="l00533"></a>00533     <span class="comment">/* set the initial date to the first transaction in grisbi */</span>
<a name="l00534"></a>00534     tmp_list = <a class="code" href="gsb__data__transaction_8c.html#af781a71a62eece020188ef62847f2887">gsb_data_transaction_get_transactions_list</a> ();
<a name="l00535"></a>00535     <span class="keywordflow">while</span> (tmp_list)
<a name="l00536"></a>00536     {
<a name="l00537"></a>00537         gint transaction_number;
<a name="l00538"></a>00538 
<a name="l00539"></a>00539         transaction_number = <a class="code" href="gsb__data__transaction_8c.html#a99bf548513083f4a71fe019faeccbe0a">gsb_data_transaction_get_transaction_number</a> (tmp_list -&gt; data);
<a name="l00540"></a>00540         <span class="keywordflow">if</span> (date)
<a name="l00541"></a>00541         {
<a name="l00542"></a>00542             <span class="keywordflow">if</span> (g_date_compare (date, <a class="code" href="gsb__data__transaction_8c.html#ab0b62014885bcf3e2fbfff1ae9b32080">gsb_data_transaction_get_date</a> (transaction_number)) &gt; 0)
<a name="l00543"></a>00543                 date = <a class="code" href="gsb__data__transaction_8c.html#ab0b62014885bcf3e2fbfff1ae9b32080">gsb_data_transaction_get_date</a> (transaction_number);
<a name="l00544"></a>00544         }
<a name="l00545"></a>00545         <span class="keywordflow">else</span>
<a name="l00546"></a>00546             date = <a class="code" href="gsb__data__transaction_8c.html#ab0b62014885bcf3e2fbfff1ae9b32080">gsb_data_transaction_get_date</a> (transaction_number);
<a name="l00547"></a>00547         tmp_list = tmp_list -&gt; next;
<a name="l00548"></a>00548     }
<a name="l00549"></a>00549     <span class="keywordflow">if</span> (date)
<a name="l00550"></a>00550     {
<a name="l00551"></a>00551         gtk_entry_set_text ( GTK_ENTRY (initial_date),
<a name="l00552"></a>00552                              <a class="code" href="utils__dates_8c.html#a6e7537390d7569da5efc74f96ea57da7">gsb_format_gdate</a> (date));
<a name="l00553"></a>00553         gtk_editable_select_region ( GTK_EDITABLE (initial_date),
<a name="l00554"></a>00554                                  0, -1);
<a name="l00555"></a>00555     }
<a name="l00556"></a>00556     gtk_widget_grab_focus (initial_date);
<a name="l00557"></a>00557 
<a name="l00558"></a>00558     <span class="keywordflow">return</span> FALSE;
<a name="l00559"></a>00559 }
<a name="l00560"></a>00560 
<a name="l00561"></a>00561 
<a name="l00570"></a>00570 <span class="keyword">static</span> gboolean gsb_assistant_archive_switch_to_archive_name ( GtkWidget *assistant,
<a name="l00571"></a>00571                         gint new_page )
<a name="l00572"></a>00572 {
<a name="l00573"></a>00573     gchar * <span class="keywordtype">string</span> = NULL;
<a name="l00574"></a>00574 
<a name="l00575"></a>00575     <a class="code" href="gsb__assistant_8c.html#af9667499ec49ad50593c8662801d4a9c">gsb_assistant_change_button_next</a> ( assistant,
<a name="l00576"></a>00576                     GTK_STOCK_APPLY, GTK_RESPONSE_YES );
<a name="l00577"></a>00577 
<a name="l00578"></a>00578     <span class="keywordflow">if</span> ( GTK_WIDGET_IS_SENSITIVE (initial_date) )
<a name="l00579"></a>00579     {
<a name="l00580"></a>00580         gchar * sdate, * fdate;
<a name="l00581"></a>00581 
<a name="l00582"></a>00582         sdate = <a class="code" href="utils__dates_8c.html#a6e7537390d7569da5efc74f96ea57da7">gsb_format_gdate</a> ( <a class="code" href="gsb__calendar__entry_8c.html#a8cb2e700394a337d8442f42cfdb311ef">gsb_calendar_entry_get_date</a> (initial_date));
<a name="l00583"></a>00583         fdate = <a class="code" href="utils__dates_8c.html#a6e7537390d7569da5efc74f96ea57da7">gsb_format_gdate</a> (<a class="code" href="gsb__calendar__entry_8c.html#a8cb2e700394a337d8442f42cfdb311ef">gsb_calendar_entry_get_date</a> (final_date));
<a name="l00584"></a>00584         <span class="keywordtype">string</span> = g_strdup_printf ( _(<span class="stringliteral">&quot;Archive from %s to %s&quot;</span>), sdate, fdate );
<a name="l00585"></a>00585         g_free ( sdate );
<a name="l00586"></a>00586         g_free ( fdate );
<a name="l00587"></a>00587     }
<a name="l00588"></a>00588     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( GTK_WIDGET_IS_SENSITIVE (financial_year_button) )
<a name="l00589"></a>00589     {
<a name="l00590"></a>00590         gint fyear;
<a name="l00591"></a>00591 
<a name="l00592"></a>00592         fyear = <a class="code" href="gsb__fyear_8c.html#a587c6044305c503412e85ce68c61d18f">gsb_fyear_get_fyear_from_combobox</a> ( financial_year_button, NULL );
<a name="l00593"></a>00593         <span class="keywordtype">string</span> = g_strdup_printf ( _(<span class="stringliteral">&quot;Archive of financial year %s&quot;</span>), 
<a name="l00594"></a>00594                             <a class="code" href="gsb__data__fyear_8c.html#ad6c1d7c774990722a69d741ab0d4785e">gsb_data_fyear_get_name</a> ( fyear ) );
<a name="l00595"></a>00595     }
<a name="l00596"></a>00596     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( GTK_WIDGET_IS_SENSITIVE (report_button) )
<a name="l00597"></a>00597     {
<a name="l00598"></a>00598         gint report_number;
<a name="l00599"></a>00599         report_number = <a class="code" href="gsb__report_8c.html#a856eaa582659de20a636421f85de8b00">gsb_report_get_report_from_combobox</a> (report_button);
<a name="l00600"></a>00600         <span class="keywordtype">string</span> = g_strdup_printf ( _(<span class="stringliteral">&quot;Archive of report %s&quot;</span>), 
<a name="l00601"></a>00601                             <a class="code" href="gsb__data__report_8c.html#ace8a87d303afdf89ef8f3a901987db83">gsb_data_report_get_report_name</a> ( report_number ) );
<a name="l00602"></a>00602     }
<a name="l00603"></a>00603 
<a name="l00604"></a>00604     <span class="keywordflow">if</span> ( <span class="keywordtype">string</span> )
<a name="l00605"></a>00605     {
<a name="l00606"></a>00606         gtk_entry_set_text ( GTK_ENTRY ( name_entry ), <span class="keywordtype">string</span> );
<a name="l00607"></a>00607         g_free ( <span class="keywordtype">string</span> );
<a name="l00608"></a>00608     }
<a name="l00609"></a>00609 
<a name="l00610"></a>00610     <a class="code" href="gsb__assistant_8c.html#ad38c5d761d97d2257a4b35a52c4048c6">gsb_assistant_sensitive_button_next</a> ( assistant, TRUE );
<a name="l00611"></a>00611 
<a name="l00612"></a>00612     <span class="keywordflow">return</span> FALSE;
<a name="l00613"></a>00613 }
<a name="l00614"></a>00614 
<a name="l00615"></a>00615 
<a name="l00616"></a>00616 
<a name="l00626"></a>00626 <span class="keyword">static</span> gboolean gsb_assistant_archive_switch_to_succes ( GtkWidget *assistant,
<a name="l00627"></a>00627                         gint new_page )
<a name="l00628"></a>00628 {
<a name="l00629"></a>00629     <span class="comment">/* if we come here, we are sure that :</span>
<a name="l00630"></a>00630 <span class="comment">     * there is a own name to the archive</span>
<a name="l00631"></a>00631 <span class="comment">     * there is some transactions to be archived</span>
<a name="l00632"></a>00632 <span class="comment">     * all the necessary stuff is filled */</span>
<a name="l00633"></a>00633     GSList *tmp_list;
<a name="l00634"></a>00634     gint archive_number;
<a name="l00635"></a>00635     gchar *string;
<a name="l00636"></a>00636     GtkTextBuffer * buffer;
<a name="l00637"></a>00637     GtkTextIter     iter;
<a name="l00638"></a>00638     gint account_nb;
<a name="l00639"></a>00639 
<a name="l00640"></a>00640     <span class="comment">/* This would typically happen if user selected a time period</span>
<a name="l00641"></a>00641 <span class="comment">     * with no transactions related. */</span>
<a name="l00642"></a>00642     <span class="keywordflow">if</span> (!list_transaction_to_archive)
<a name="l00643"></a>00643     {
<a name="l00644"></a>00644         gtk_widget_hide (vbox_congratulation);
<a name="l00645"></a>00645         gtk_widget_show (vbox_failed);
<a name="l00646"></a>00646         <a class="code" href="gsb__assistant_8c.html#ae21578dcc45348d3400059b9c6794252">gsb_assistant_sensitive_button_prev</a> ( assistant, TRUE );
<a name="l00647"></a>00647         <a class="code" href="gsb__assistant_8c.html#ad38c5d761d97d2257a4b35a52c4048c6">gsb_assistant_sensitive_button_next</a> ( assistant, FALSE );
<a name="l00648"></a>00648         <span class="keywordflow">return</span> FALSE;
<a name="l00649"></a>00649     }
<a name="l00650"></a>00650 
<a name="l00651"></a>00651     <span class="comment">/* first, create the archive */</span>
<a name="l00652"></a>00652     archive_number = <a class="code" href="gsb__data__archive_8c.html#af867698152bb736c36b4d02ec8a5b173">gsb_data_archive_new</a> (gtk_entry_get_text (GTK_ENTRY (name_entry)));
<a name="l00653"></a>00653     <span class="keywordflow">if</span> (!archive_number)
<a name="l00654"></a>00654     {
<a name="l00655"></a>00655         gtk_widget_hide (vbox_congratulation);
<a name="l00656"></a>00656         gtk_widget_show (vbox_failed);
<a name="l00657"></a>00657         <span class="keywordflow">return</span> FALSE;
<a name="l00658"></a>00658     }
<a name="l00659"></a>00659 
<a name="l00660"></a>00660     <a class="code" href="gsb__assistant_8c.html#af9667499ec49ad50593c8662801d4a9c">gsb_assistant_change_button_next</a> ( assistant,
<a name="l00661"></a>00661                         GTK_STOCK_CLOSE, GTK_RESPONSE_APPLY );
<a name="l00662"></a>00662 
<a name="l00663"></a>00663     <span class="comment">/* fill the archive */</span>
<a name="l00664"></a>00664     <span class="keywordflow">if</span> (GTK_WIDGET_IS_SENSITIVE (initial_date))
<a name="l00665"></a>00665     {
<a name="l00666"></a>00666         GDate *init_gdate;
<a name="l00667"></a>00667         GDate *final_gdate;
<a name="l00668"></a>00668 
<a name="l00669"></a>00669         init_gdate = <a class="code" href="gsb__calendar__entry_8c.html#a8cb2e700394a337d8442f42cfdb311ef">gsb_calendar_entry_get_date</a> (initial_date);
<a name="l00670"></a>00670         final_gdate = <a class="code" href="gsb__calendar__entry_8c.html#a8cb2e700394a337d8442f42cfdb311ef">gsb_calendar_entry_get_date</a> (final_date);
<a name="l00671"></a>00671 
<a name="l00672"></a>00672         <a class="code" href="gsb__data__archive_8c.html#ad79c38199834ae790c8534d7addc6b9c">gsb_data_archive_set_beginning_date</a> ( archive_number, init_gdate );
<a name="l00673"></a>00673         <a class="code" href="gsb__data__archive_8c.html#a3a502c684a99f9d9d431c7a7a1ba8ce2">gsb_data_archive_set_end_date</a> ( archive_number, final_gdate );
<a name="l00674"></a>00674         g_date_free (init_gdate);
<a name="l00675"></a>00675         g_date_free (final_gdate);
<a name="l00676"></a>00676     }
<a name="l00677"></a>00677     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (GTK_WIDGET_IS_SENSITIVE (financial_year_button))
<a name="l00678"></a>00678         <a class="code" href="gsb__data__archive_8c.html#ae4edb9d1b45b34750d48ba8405db21bf">gsb_data_archive_set_fyear</a> ( archive_number,
<a name="l00679"></a>00679                         <a class="code" href="gsb__fyear_8c.html#a587c6044305c503412e85ce68c61d18f">gsb_fyear_get_fyear_from_combobox</a> ( financial_year_button,NULL ) );
<a name="l00680"></a>00680     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (GTK_WIDGET_IS_SENSITIVE (report_button) )
<a name="l00681"></a>00681     {
<a name="l00682"></a>00682         gint report_number;
<a name="l00683"></a>00683 
<a name="l00684"></a>00684         report_number = <a class="code" href="gsb__report_8c.html#a856eaa582659de20a636421f85de8b00">gsb_report_get_report_from_combobox</a> (report_button);
<a name="l00685"></a>00685 
<a name="l00686"></a>00686         <a class="code" href="gsb__data__archive_8c.html#a29cea4dae2fb32483efd7bc480d07d4d">gsb_data_archive_set_report_title</a> ( archive_number,
<a name="l00687"></a>00687                         <a class="code" href="etats__support_8c.html#afebb1d8c6e6cc8825f96e411d2b9e618">etats_titre</a> (report_number));
<a name="l00688"></a>00688     }
<a name="l00689"></a>00689 
<a name="l00690"></a>00690     <span class="comment">/* mark the transactions as archived */</span>
<a name="l00691"></a>00691     tmp_list = list_transaction_to_archive;
<a name="l00692"></a>00692     <span class="keywordflow">while</span> (tmp_list)
<a name="l00693"></a>00693     {
<a name="l00694"></a>00694         gint transaction_number;
<a name="l00695"></a>00695 
<a name="l00696"></a>00696         transaction_number = <a class="code" href="gsb__data__transaction_8c.html#a99bf548513083f4a71fe019faeccbe0a">gsb_data_transaction_get_transaction_number</a> (tmp_list -&gt; data);
<a name="l00697"></a>00697         <a class="code" href="gsb__data__transaction_8c.html#adc4e030e27ded40c7fde043e91ca8811">gsb_data_transaction_set_archive_number</a> ( transaction_number, archive_number );
<a name="l00698"></a>00698 
<a name="l00699"></a>00699         <span class="comment">/* Delete transaction in the tree_view */</span>
<a name="l00700"></a>00700         <span class="keywordflow">if</span> ( <a class="code" href="gsb__data__transaction_8c.html#a6018560ece7ab02e8d46bc9bdaffd607">gsb_data_transaction_get_mother_transaction_number</a> ( transaction_number ) == 0 )
<a name="l00701"></a>00701             <a class="code" href="gsb__transactions__list_8c.html#af4607ecfa510ff666ad6f3a12b898e4f">gsb_transactions_list_delete_transaction_from_tree_view</a> ( transaction_number );
<a name="l00702"></a>00702         tmp_list = tmp_list -&gt; next;
<a name="l00703"></a>00703     }
<a name="l00704"></a>00704 
<a name="l00705"></a>00705     <span class="comment">/* create again the list of archives by account */</span>
<a name="l00706"></a>00706     <a class="code" href="gsb__data__archive__store_8c.html#a92c3b325efef096b310d0b4303060fa8">gsb_data_archive_store_init_variables</a> ();
<a name="l00707"></a>00707     <a class="code" href="gsb__data__archive__store_8c.html#af1c48e5ac4d5590dc16f386bcfb10391">gsb_data_archive_store_create_list</a> ( );
<a name="l00708"></a>00708     <a class="code" href="gsb__transactions__list_8c.html#a1a818af14b9c3c740d85b2c76cae24d5">gsb_transactions_list_fill_archive_store</a> ( );
<a name="l00709"></a>00709 
<a name="l00710"></a>00710     <span class="comment">/* set the message */</span>
<a name="l00711"></a>00711     <span class="keywordtype">string</span> = g_strdup_printf ( _(<span class="stringliteral">&quot;Archive &#39;%s&#39; was successfully created and %d transactions &quot;</span>
<a name="l00712"></a>00712                                  <span class="stringliteral">&quot;out of %d were archived.\n\n&quot;</span>),
<a name="l00713"></a>00713                         <a class="code" href="gsb__data__archive_8c.html#ab61c1a7e1814ae6b8d5fd6f54db3606b">gsb_data_archive_get_name</a> (archive_number),
<a name="l00714"></a>00714                         g_slist_length (list_transaction_to_archive),
<a name="l00715"></a>00715                         g_slist_length (list_transaction_to_archive) +
<a name="l00716"></a>00716                         g_slist_length (<a class="code" href="gsb__data__transaction_8c.html#af781a71a62eece020188ef62847f2887">gsb_data_transaction_get_transactions_list</a> ()));
<a name="l00717"></a>00717 
<a name="l00718"></a>00718     buffer = gtk_text_view_get_buffer (GTK_TEXT_VIEW (congratulations_view));
<a name="l00719"></a>00719     gtk_text_buffer_get_iter_at_mark ( buffer, &amp;iter, 
<a name="l00720"></a>00720                         gtk_text_buffer_get_mark ( buffer, <span class="stringliteral">&quot;status&quot;</span> ) );
<a name="l00721"></a>00721     gtk_text_buffer_insert ( buffer, &amp;iter, <span class="keywordtype">string</span>, strlen(<span class="keywordtype">string</span>) );
<a name="l00722"></a>00722 
<a name="l00723"></a>00723     g_free (<span class="keywordtype">string</span>);
<a name="l00724"></a>00724 
<a name="l00725"></a>00725     gtk_widget_hide (vbox_failed);
<a name="l00726"></a>00726     gtk_widget_show (vbox_congratulation);
<a name="l00727"></a>00727 
<a name="l00728"></a>00728     <span class="comment">/* free the transactions list to archive */</span>
<a name="l00729"></a>00729     g_slist_free (list_transaction_to_archive);
<a name="l00730"></a>00730     list_transaction_to_archive = NULL;
<a name="l00731"></a>00731 
<a name="l00732"></a>00732     <span class="comment">/* erase all the previous entries */</span>
<a name="l00733"></a>00733     g_signal_handlers_block_by_func ( G_OBJECT ( name_entry ),
<a name="l00734"></a>00734                                         G_CALLBACK ( gsb_assistant_archive_update_labels ),
<a name="l00735"></a>00735                                         assistant );
<a name="l00736"></a>00736     g_signal_handlers_block_by_func ( G_OBJECT ( initial_date ),
<a name="l00737"></a>00737                                         G_CALLBACK ( gsb_assistant_archive_update_labels ),
<a name="l00738"></a>00738                                         assistant );
<a name="l00739"></a>00739     g_signal_handlers_block_by_func ( G_OBJECT ( final_date ),
<a name="l00740"></a>00740                                         G_CALLBACK ( gsb_assistant_archive_update_labels ),
<a name="l00741"></a>00741                                         assistant );
<a name="l00742"></a>00742     gtk_entry_set_text ( GTK_ENTRY (name_entry), <span class="stringliteral">&quot;&quot;</span> );
<a name="l00743"></a>00743     gtk_entry_set_text ( GTK_ENTRY (initial_date), <span class="stringliteral">&quot;&quot;</span> );
<a name="l00744"></a>00744     gtk_entry_set_text ( GTK_ENTRY (final_date), <span class="stringliteral">&quot;&quot;</span> );
<a name="l00745"></a>00745 
<a name="l00746"></a>00746     g_signal_handlers_unblock_by_func ( G_OBJECT ( name_entry ),
<a name="l00747"></a>00747                                         G_CALLBACK ( gsb_assistant_archive_update_labels ),
<a name="l00748"></a>00748                                         assistant );
<a name="l00749"></a>00749     g_signal_handlers_unblock_by_func ( G_OBJECT ( initial_date ),
<a name="l00750"></a>00750                                         G_CALLBACK ( gsb_assistant_archive_update_labels ),
<a name="l00751"></a>00751                                         assistant );
<a name="l00752"></a>00752     g_signal_handlers_unblock_by_func ( G_OBJECT ( final_date ),
<a name="l00753"></a>00753                                         G_CALLBACK ( gsb_assistant_archive_update_labels ),
<a name="l00754"></a>00754                                         assistant );
<a name="l00755"></a>00755 
<a name="l00756"></a>00756     <span class="comment">/* propose to go in one or another way */</span>
<a name="l00757"></a>00757     <a class="code" href="gsb__assistant_8c.html#ae21578dcc45348d3400059b9c6794252">gsb_assistant_sensitive_button_prev</a> ( assistant, TRUE );
<a name="l00758"></a>00758     <a class="code" href="gsb__assistant_8c.html#ad38c5d761d97d2257a4b35a52c4048c6">gsb_assistant_sensitive_button_next</a> ( assistant, TRUE );
<a name="l00759"></a>00759 
<a name="l00760"></a>00760     <span class="keywordflow">if</span> ( <a class="code" href="parametres_8c.html#ab2a744f5d2124688473d13979420e911">etat</a>.<a class="code" href="structgsb__etat__t.html#a9d0fa9057da603e64a601d69d7bf2b51">modification_fichier</a> == 0 )
<a name="l00761"></a>00761         <a class="code" href="traitement__variables_8c.html#aa4084b9e508b1d1fea1d09c6b6208021">modification_fichier</a> ( TRUE );
<a name="l00762"></a>00762 
<a name="l00763"></a>00763     <span class="comment">/* update the display of tree_view if necessary */</span>
<a name="l00764"></a>00764     <span class="keywordflow">if</span> ( ( account_nb = <a class="code" href="navigation_8c.html#a3b668bf52ce71dcff3ea10c9db7be859">gsb_gui_navigation_get_current_account</a> ( ) ) != -1 )
<a name="l00765"></a>00765         <a class="code" href="gsb__transactions__list_8c.html#ab7d08f59bcf7149edda9db47e67333a4">gsb_transactions_list_update_tree_view</a> ( account_nb, TRUE );
<a name="l00766"></a>00766 
<a name="l00767"></a>00767     <span class="keywordflow">return</span> FALSE;
<a name="l00768"></a>00768 }
<a name="l00769"></a>00769 
<a name="l00770"></a>00770 
<a name="l00771"></a>00771 
<a name="l00780"></a>00780 <span class="keyword">static</span> gboolean gsb_assistant_archive_update_labels ( GtkWidget *assistant )
<a name="l00781"></a>00781 {
<a name="l00782"></a>00782     gchar *string;
<a name="l00783"></a>00783     GSList *tmp_list;
<a name="l00784"></a>00784     GtkWidget * notebook;
<a name="l00785"></a>00785     GSList *report_transactions_list;
<a name="l00786"></a>00786 
<a name="l00787"></a>00787     notebook = g_object_get_data ( G_OBJECT(assistant), <span class="stringliteral">&quot;notebook&quot;</span> );
<a name="l00788"></a>00788     
<a name="l00789"></a>00789     <span class="comment">/* erase the last list of transactions to archive */</span>
<a name="l00790"></a>00790     <span class="keywordflow">if</span> (gtk_notebook_get_current_page (GTK_NOTEBOOK(notebook)) == <a class="code" href="gsb__assistant__archive_8c.html#a9338eaa443e5fa1dc67b270bb59a4597a590584282c8c782743f8df3c51482748">ARCHIVE_ASSISTANT_MENU</a>
<a name="l00791"></a>00791      &amp;&amp;
<a name="l00792"></a>00792      list_transaction_to_archive )
<a name="l00793"></a>00793     {
<a name="l00794"></a>00794         g_slist_free (list_transaction_to_archive);
<a name="l00795"></a>00795         list_transaction_to_archive = NULL;
<a name="l00796"></a>00796         <a class="code" href="gsb__assistant_8c.html#ad38c5d761d97d2257a4b35a52c4048c6">gsb_assistant_sensitive_button_next</a> ( assistant, TRUE );
<a name="l00797"></a>00797     }
<a name="l00798"></a>00798 
<a name="l00799"></a>00799     <span class="comment">/* ok for now the choice is on initial/final date */</span>
<a name="l00800"></a>00800     <span class="keywordflow">if</span> ( gtk_notebook_get_current_page (GTK_NOTEBOOK(notebook)) == <a class="code" href="gsb__assistant__archive_8c.html#a9338eaa443e5fa1dc67b270bb59a4597a590584282c8c782743f8df3c51482748">ARCHIVE_ASSISTANT_MENU</a> )
<a name="l00801"></a>00801     {
<a name="l00802"></a>00802         <span class="keywordflow">if</span> ( GTK_WIDGET_IS_SENSITIVE (initial_date) )
<a name="l00803"></a>00803         {
<a name="l00804"></a>00804             GDate *init_gdate;
<a name="l00805"></a>00805             GDate *final_gdate;
<a name="l00806"></a>00806 
<a name="l00807"></a>00807             init_gdate = <a class="code" href="gsb__calendar__entry_8c.html#a8cb2e700394a337d8442f42cfdb311ef">gsb_calendar_entry_get_date</a> (initial_date);
<a name="l00808"></a>00808             final_gdate = <a class="code" href="gsb__calendar__entry_8c.html#a8cb2e700394a337d8442f42cfdb311ef">gsb_calendar_entry_get_date</a> (final_date);
<a name="l00809"></a>00809             <span class="keywordtype">string</span> = NULL;
<a name="l00810"></a>00810 
<a name="l00811"></a>00811             <span class="keywordflow">if</span> ( !strlen ( gtk_entry_get_text ( GTK_ENTRY ( initial_date ) ) ) )
<a name="l00812"></a>00812                 <span class="keywordtype">string</span> = <a class="code" href="dialog_8c.html#a1d3c21e1b14fa2a19ef5f3dae733b2e0">make_red</a> ( _(<span class="stringliteral">&quot;Please fill the initial date.&quot;</span>));
<a name="l00813"></a>00813             <span class="keywordflow">if</span> ( !<span class="keywordtype">string</span>
<a name="l00814"></a>00814                 &amp;&amp;
<a name="l00815"></a>00815                 !strlen ( gtk_entry_get_text ( GTK_ENTRY ( final_date ) ) ) )
<a name="l00816"></a>00816                 <span class="keywordtype">string</span> = <a class="code" href="dialog_8c.html#a1d3c21e1b14fa2a19ef5f3dae733b2e0">make_red</a> ( _(<span class="stringliteral">&quot;Please fill the final date.&quot;</span>) );
<a name="l00817"></a>00817             <span class="keywordflow">if</span> ( !<span class="keywordtype">string</span>
<a name="l00818"></a>00818                  &amp;&amp;
<a name="l00819"></a>00819                  init_gdate
<a name="l00820"></a>00820                  &amp;&amp;
<a name="l00821"></a>00821                  final_gdate
<a name="l00822"></a>00822                  &amp;&amp;
<a name="l00823"></a>00823                  g_date_compare (init_gdate, final_gdate) &gt; 0 )
<a name="l00824"></a>00824                 <span class="keywordtype">string</span> = <a class="code" href="dialog_8c.html#a1d3c21e1b14fa2a19ef5f3dae733b2e0">make_red</a> (_(<span class="stringliteral">&quot;The initial date is after the final date.&quot;</span>));
<a name="l00825"></a>00825             <span class="keywordflow">if</span> ( !<span class="keywordtype">string</span>
<a name="l00826"></a>00826                  &amp;&amp;
<a name="l00827"></a>00827                  !init_gdate)
<a name="l00828"></a>00828                 <span class="keywordtype">string</span> = <a class="code" href="dialog_8c.html#a1d3c21e1b14fa2a19ef5f3dae733b2e0">make_red</a> (_(<span class="stringliteral">&quot;The initial date is not valid.&quot;</span>));
<a name="l00829"></a>00829             <span class="keywordflow">if</span> ( !<span class="keywordtype">string</span>
<a name="l00830"></a>00830                  &amp;&amp;
<a name="l00831"></a>00831                  !final_gdate )
<a name="l00832"></a>00832                 <span class="keywordtype">string</span> = <a class="code" href="dialog_8c.html#a1d3c21e1b14fa2a19ef5f3dae733b2e0">make_red</a> (_(<span class="stringliteral">&quot;The final date is not valid.&quot;</span>));
<a name="l00833"></a>00833             <span class="keywordflow">if</span> ( !<span class="keywordtype">string</span>
<a name="l00834"></a>00834                  &amp;&amp;
<a name="l00835"></a>00835                  <a class="code" href="gsb__data__archive_8c.html#ad4fa84d9de6ee591fbe1d3e3bf42e22f">gsb_data_archive_get_from_date</a> (init_gdate) )
<a name="l00836"></a>00836                 <span class="keywordtype">string</span> = <a class="code" href="dialog_8c.html#a1d3c21e1b14fa2a19ef5f3dae733b2e0">make_red</a> (_(<span class="stringliteral">&quot;The initial date belongs already to an archive.&quot;</span>));
<a name="l00837"></a>00837             <span class="keywordflow">if</span> ( !<span class="keywordtype">string</span>
<a name="l00838"></a>00838                  &amp;&amp;
<a name="l00839"></a>00839                  <a class="code" href="gsb__data__archive_8c.html#ad4fa84d9de6ee591fbe1d3e3bf42e22f">gsb_data_archive_get_from_date</a> (final_gdate) )
<a name="l00840"></a>00840                 <span class="keywordtype">string</span> = <a class="code" href="dialog_8c.html#a1d3c21e1b14fa2a19ef5f3dae733b2e0">make_red</a> (_(<span class="stringliteral">&quot;The final date belongs already to an archive.&quot;</span>));
<a name="l00841"></a>00841 
<a name="l00842"></a>00842             <span class="keywordflow">if</span> (<span class="keywordtype">string</span>)
<a name="l00843"></a>00843             {
<a name="l00844"></a>00844                 gtk_label_set_markup ( GTK_LABEL (label_archived), <span class="keywordtype">string</span> );
<a name="l00845"></a>00845                 g_free (<span class="keywordtype">string</span>);
<a name="l00846"></a>00846                 <a class="code" href="gsb__assistant_8c.html#ad38c5d761d97d2257a4b35a52c4048c6">gsb_assistant_sensitive_button_next</a> ( assistant, FALSE );
<a name="l00847"></a>00847                 <span class="keywordflow">return</span> FALSE;
<a name="l00848"></a>00848             }
<a name="l00849"></a>00849 
<a name="l00850"></a>00850             <span class="comment">/* the dates are ok */</span>
<a name="l00851"></a>00851             tmp_list = <a class="code" href="gsb__data__transaction_8c.html#af781a71a62eece020188ef62847f2887">gsb_data_transaction_get_transactions_list</a> ();
<a name="l00852"></a>00852             <span class="keywordflow">while</span> (tmp_list)
<a name="l00853"></a>00853             {
<a name="l00854"></a>00854                 gint transaction_number;
<a name="l00855"></a>00855 
<a name="l00856"></a>00856                 transaction_number = <a class="code" href="gsb__data__transaction_8c.html#a99bf548513083f4a71fe019faeccbe0a">gsb_data_transaction_get_transaction_number</a> (
<a name="l00857"></a>00857                         tmp_list -&gt; data);
<a name="l00858"></a>00858 
<a name="l00859"></a>00859                 <span class="keywordflow">if</span> ( g_date_compare ( init_gdate,
<a name="l00860"></a>00860                         <a class="code" href="gsb__data__transaction_8c.html#ab0b62014885bcf3e2fbfff1ae9b32080">gsb_data_transaction_get_date</a> (transaction_number)) &lt;= 0
<a name="l00861"></a>00861                  &amp;&amp;
<a name="l00862"></a>00862                  g_date_compare ( final_gdate,
<a name="l00863"></a>00863                         <a class="code" href="gsb__data__transaction_8c.html#ab0b62014885bcf3e2fbfff1ae9b32080">gsb_data_transaction_get_date</a> (transaction_number)) &gt;= 0 )
<a name="l00864"></a>00864                     <span class="comment">/* the transaction is into the dates, we append its address to the list to archive</span>
<a name="l00865"></a>00865 <span class="comment">                     * we could use gsb_assistant_archive_add_transaction_to_list but it&#39;s a lost of time</span>
<a name="l00866"></a>00866 <span class="comment">                     * because all the linked transactions will be taken because we work with dates,</span>
<a name="l00867"></a>00867 <span class="comment">                     * so don&#39;t use that function and add the transaction directly */</span>
<a name="l00868"></a>00868                     list_transaction_to_archive = g_slist_append ( list_transaction_to_archive,
<a name="l00869"></a>00869                                 tmp_list -&gt; data );
<a name="l00870"></a>00870 
<a name="l00871"></a>00871                 tmp_list = tmp_list -&gt; next;
<a name="l00872"></a>00872             }
<a name="l00873"></a>00873             }
<a name="l00874"></a>00874 
<a name="l00875"></a>00875         <span class="comment">/* ok for now the choice is on fyear */</span>
<a name="l00876"></a>00876         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (  GTK_WIDGET_IS_SENSITIVE ( financial_year_button ) )
<a name="l00877"></a>00877         {
<a name="l00878"></a>00878             gint fyear_number;
<a name="l00879"></a>00879             <span class="keywordtype">string</span> = NULL;
<a name="l00880"></a>00880 
<a name="l00881"></a>00881             fyear_number = <a class="code" href="gsb__fyear_8c.html#a587c6044305c503412e85ce68c61d18f">gsb_fyear_get_fyear_from_combobox</a> ( financial_year_button, NULL );
<a name="l00882"></a>00882 
<a name="l00883"></a>00883             <span class="keywordflow">if</span> (!fyear_number)
<a name="l00884"></a>00884                 <span class="keywordtype">string</span> = <a class="code" href="dialog_8c.html#a1d3c21e1b14fa2a19ef5f3dae733b2e0">make_red</a> (_(<span class="stringliteral">&quot;Please choose a financial year.&quot;</span>));
<a name="l00885"></a>00885 
<a name="l00886"></a>00886             <span class="keywordflow">if</span> ( !<span class="keywordtype">string</span>
<a name="l00887"></a>00887              &amp;&amp;
<a name="l00888"></a>00888              <a class="code" href="gsb__data__archive_8c.html#a75a79145c15deb4977a71e7c5ee6db47">gsb_data_archive_get_from_fyear</a> ( fyear_number ) )
<a name="l00889"></a>00889                 <span class="keywordtype">string</span> = <a class="code" href="dialog_8c.html#a1d3c21e1b14fa2a19ef5f3dae733b2e0">make_red</a> (_(<span class="stringliteral">&quot;There is already an archive for that financial year.&quot;</span>));
<a name="l00890"></a>00890 
<a name="l00891"></a>00891             <span class="keywordflow">if</span> (<span class="keywordtype">string</span>)
<a name="l00892"></a>00892             {
<a name="l00893"></a>00893                 gtk_label_set_markup ( GTK_LABEL (label_archived), <span class="keywordtype">string</span> );
<a name="l00894"></a>00894                 g_free (<span class="keywordtype">string</span>);
<a name="l00895"></a>00895                 <a class="code" href="gsb__assistant_8c.html#ad38c5d761d97d2257a4b35a52c4048c6">gsb_assistant_sensitive_button_next</a> ( assistant, FALSE );
<a name="l00896"></a>00896                 <span class="keywordflow">return</span> FALSE;
<a name="l00897"></a>00897             }
<a name="l00898"></a>00898 
<a name="l00899"></a>00899             <span class="comment">/* the fyear is ok */</span>
<a name="l00900"></a>00900             tmp_list = <a class="code" href="gsb__data__transaction_8c.html#af781a71a62eece020188ef62847f2887">gsb_data_transaction_get_transactions_list</a> ();
<a name="l00901"></a>00901             <span class="keywordflow">while</span> (tmp_list)
<a name="l00902"></a>00902             {
<a name="l00903"></a>00903                 gint transaction_number;
<a name="l00904"></a>00904 
<a name="l00905"></a>00905                 transaction_number = <a class="code" href="gsb__data__transaction_8c.html#a99bf548513083f4a71fe019faeccbe0a">gsb_data_transaction_get_transaction_number</a> (tmp_list -&gt; data);
<a name="l00906"></a>00906 
<a name="l00907"></a>00907                 <span class="keywordflow">if</span> (<a class="code" href="gsb__data__transaction_8c.html#ae8f3e659e304f02abd6c2ae7dd759203">gsb_data_transaction_get_financial_year_number</a> (transaction_number) == fyear_number)
<a name="l00908"></a>00908                 {
<a name="l00909"></a>00909                 <span class="comment">/* the transaction belongs to the fyear, we append its address to the list to archive</span>
<a name="l00910"></a>00910 <span class="comment">                 * all the linked transactions will be taken */</span>
<a name="l00911"></a>00911                 gsb_assistant_archive_add_transaction_to_list (tmp_list -&gt; data);
<a name="l00912"></a>00912                 }
<a name="l00913"></a>00913                 tmp_list = tmp_list -&gt; next;
<a name="l00914"></a>00914             }
<a name="l00915"></a>00915         }
<a name="l00916"></a>00916         <span class="comment">/* ok for now the choice is on report */</span>
<a name="l00917"></a>00917         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (  GTK_WIDGET_IS_SENSITIVE (report_button))
<a name="l00918"></a>00918         {
<a name="l00919"></a>00919             gint report_number;
<a name="l00920"></a>00920             <span class="keywordtype">string</span> = NULL;
<a name="l00921"></a>00921 
<a name="l00922"></a>00922             report_number = <a class="code" href="gsb__report_8c.html#a856eaa582659de20a636421f85de8b00">gsb_report_get_report_from_combobox</a> (report_button);
<a name="l00923"></a>00923 
<a name="l00924"></a>00924             <span class="keywordflow">if</span> (!report_number)
<a name="l00925"></a>00925                 <span class="keywordtype">string</span> = <a class="code" href="dialog_8c.html#a1d3c21e1b14fa2a19ef5f3dae733b2e0">make_red</a> (_(<span class="stringliteral">&quot;Please choose a report.&quot;</span>));
<a name="l00926"></a>00926 
<a name="l00927"></a>00927             <span class="keywordflow">if</span> (<span class="keywordtype">string</span>)
<a name="l00928"></a>00928             {
<a name="l00929"></a>00929                 gtk_label_set_markup ( GTK_LABEL (label_archived), <span class="keywordtype">string</span> );
<a name="l00930"></a>00930                 g_free (<span class="keywordtype">string</span>);
<a name="l00931"></a>00931                 <a class="code" href="gsb__assistant_8c.html#ad38c5d761d97d2257a4b35a52c4048c6">gsb_assistant_sensitive_button_next</a> ( assistant, FALSE );
<a name="l00932"></a>00932                 <span class="keywordflow">return</span> FALSE;
<a name="l00933"></a>00933             }
<a name="l00934"></a>00934 
<a name="l00935"></a>00935             <span class="comment">/* the report is ok */</span>
<a name="l00936"></a>00936             report_transactions_list = <a class="code" href="etats__calculs_8c.html#afbec2d5bda4c558e44362eeaa0ed847e">recupere_opes_etat</a> (report_number);
<a name="l00937"></a>00937 
<a name="l00938"></a>00938             <span class="comment">/* the list from report doesn&#39;t contain contra-transaction and mother/children split,</span>
<a name="l00939"></a>00939 <span class="comment">             * so for each transaction of that list, we need to check the contra-transaction, the mother and children</span>
<a name="l00940"></a>00940 <span class="comment">             * and add them to the list */</span>
<a name="l00941"></a>00941             tmp_list = report_transactions_list;
<a name="l00942"></a>00942             <span class="keywordflow">while</span> (tmp_list)
<a name="l00943"></a>00943             {
<a name="l00944"></a>00944                 <span class="comment">/* just call add_transaction_to_list, all the linked transactions will be taken */</span>
<a name="l00945"></a>00945                 gsb_assistant_archive_add_transaction_to_list (tmp_list -&gt; data);
<a name="l00946"></a>00946                 tmp_list = tmp_list -&gt; next;
<a name="l00947"></a>00947             }
<a name="l00948"></a>00948             g_slist_free (report_transactions_list);
<a name="l00949"></a>00949         }
<a name="l00950"></a>00950 
<a name="l00951"></a>00951         <span class="comment">/* there is some transactions to archive */</span>
<a name="l00952"></a>00952         <span class="keywordtype">string</span> = g_strdup_printf (_(<span class="stringliteral">&quot;%d transactions out of %d will be archived.&quot;</span>),
<a name="l00953"></a>00953                             g_slist_length (list_transaction_to_archive),
<a name="l00954"></a>00954                             g_slist_length (<a class="code" href="gsb__data__transaction_8c.html#af781a71a62eece020188ef62847f2887">gsb_data_transaction_get_transactions_list</a> () ) );
<a name="l00955"></a>00955         gtk_label_set_text ( GTK_LABEL (label_archived), <span class="keywordtype">string</span>);
<a name="l00956"></a>00956         g_free (<span class="keywordtype">string</span>);
<a name="l00957"></a>00957 
<a name="l00958"></a>00958         <a class="code" href="gsb__assistant_8c.html#ad38c5d761d97d2257a4b35a52c4048c6">gsb_assistant_sensitive_button_next</a> ( assistant, TRUE );
<a name="l00959"></a>00959     }
<a name="l00960"></a>00960 
<a name="l00961"></a>00961     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( gtk_notebook_get_current_page (GTK_NOTEBOOK(notebook)) == 
<a name="l00962"></a>00962      <a class="code" href="gsb__assistant__archive_8c.html#a9338eaa443e5fa1dc67b270bb59a4597a4c8f1f0fe076550203e3d9a665f154ce">ARCHIVE_ASSISTANT_ARCHIVE_NAME</a> )
<a name="l00963"></a>00963     {
<a name="l00964"></a>00964         <span class="keywordflow">if</span> ( strlen ( gtk_entry_get_text ( GTK_ENTRY ( name_entry ) ) ) )
<a name="l00965"></a>00965             <a class="code" href="gsb__assistant_8c.html#ad38c5d761d97d2257a4b35a52c4048c6">gsb_assistant_sensitive_button_next</a> ( assistant, TRUE );
<a name="l00966"></a>00966         <span class="keywordflow">else</span>
<a name="l00967"></a>00967             <a class="code" href="gsb__assistant_8c.html#ad38c5d761d97d2257a4b35a52c4048c6">gsb_assistant_sensitive_button_next</a> ( assistant, FALSE );
<a name="l00968"></a>00968     }
<a name="l00969"></a>00969     
<a name="l00970"></a>00970     <span class="keywordflow">return</span> FALSE;
<a name="l00971"></a>00971 }
<a name="l00972"></a>00972 
<a name="l00973"></a>00973 
<a name="l00989"></a>00989 <span class="keyword">static</span> <span class="keywordtype">void</span> gsb_assistant_archive_add_transaction_to_list ( gpointer transaction_pointer )
<a name="l00990"></a>00990 {
<a name="l00991"></a>00991     gint transaction_number;
<a name="l00992"></a>00992 
<a name="l00993"></a>00993     <span class="keywordflow">if</span> ( !transaction_pointer
<a name="l00994"></a>00994      ||
<a name="l00995"></a>00995      !(transaction_number = <a class="code" href="gsb__data__transaction_8c.html#a99bf548513083f4a71fe019faeccbe0a">gsb_data_transaction_get_transaction_number</a> (transaction_pointer)) )
<a name="l00996"></a>00996     <span class="keywordflow">return</span>;
<a name="l00997"></a>00997 
<a name="l00998"></a>00998     <span class="comment">/* add the transaction itself */</span>
<a name="l00999"></a>00999     <span class="keywordflow">if</span> ( !g_slist_find ( list_transaction_to_archive,
<a name="l01000"></a>01000                         transaction_pointer ) )
<a name="l01001"></a>01001     list_transaction_to_archive = g_slist_append ( list_transaction_to_archive,
<a name="l01002"></a>01002                         transaction_pointer );
<a name="l01003"></a>01003 
<a name="l01004"></a>01004     <span class="comment">/* check for contra-transaction */</span>
<a name="l01005"></a>01005     gsb_assistant_archive_add_contra_transaction_to_list (transaction_number);
<a name="l01006"></a>01006  
<a name="l01007"></a>01007     <span class="comment">/* check for split */</span>
<a name="l01008"></a>01008     gsb_assistant_archive_add_children_to_list (transaction_number);
<a name="l01009"></a>01009 
<a name="l01010"></a>01010     <span class="comment">/* check for child</span>
<a name="l01011"></a>01011 <span class="comment">     * if the transaction is a child, the best way is to get the mother and check for split */</span>
<a name="l01012"></a>01012     gsb_assistant_archive_add_children_to_list (<a class="code" href="gsb__data__transaction_8c.html#a6018560ece7ab02e8d46bc9bdaffd607">gsb_data_transaction_get_mother_transaction_number</a> (transaction_number));
<a name="l01013"></a>01013 
<a name="l01014"></a>01014     <span class="keywordflow">return</span>;
<a name="l01015"></a>01015 }
<a name="l01016"></a>01016 
<a name="l01017"></a>01017 
<a name="l01027"></a>01027 <span class="keyword">static</span> <span class="keywordtype">void</span> gsb_assistant_archive_add_contra_transaction_to_list ( gint transaction_number )
<a name="l01028"></a>01028 {
<a name="l01029"></a>01029     gint contra_transaction_number;
<a name="l01030"></a>01030 
<a name="l01031"></a>01031     <span class="keywordflow">if</span> (transaction_number &lt;= 0)
<a name="l01032"></a>01032         <span class="keywordflow">return</span>;
<a name="l01033"></a>01033 
<a name="l01034"></a>01034     contra_transaction_number = <a class="code" href="gsb__data__transaction_8c.html#a4040925a3db49485b5a2b0a8ea19d2ee">gsb_data_transaction_get_contra_transaction_number</a> (
<a name="l01035"></a>01035                         transaction_number);
<a name="l01036"></a>01036     <span class="keywordflow">if</span> (contra_transaction_number &gt; 0)
<a name="l01037"></a>01037     {
<a name="l01038"></a>01038         gpointer contra_transaction_pointer;
<a name="l01039"></a>01039 
<a name="l01040"></a>01040         contra_transaction_pointer = <a class="code" href="gsb__data__transaction_8c.html#a4d90c43dcc4db054a1e2ec3b9ff45acc">gsb_data_transaction_get_pointer_of_transaction</a> (
<a name="l01041"></a>01041                         contra_transaction_number);
<a name="l01042"></a>01042 
<a name="l01043"></a>01043         <span class="comment">/* add the contra-transaction */</span>
<a name="l01044"></a>01044         <span class="keywordflow">if</span> ( !g_slist_find ( list_transaction_to_archive,
<a name="l01045"></a>01045                             contra_transaction_pointer ) )
<a name="l01046"></a>01046             list_transaction_to_archive = g_slist_append ( list_transaction_to_archive,
<a name="l01047"></a>01047                                                            contra_transaction_pointer );
<a name="l01048"></a>01048 
<a name="l01049"></a>01049         <span class="comment">/* if the contra-transaction is a child of split,</span>
<a name="l01050"></a>01050 <span class="comment">         * we need to add the split and all children to the list */</span>
<a name="l01051"></a>01051         gsb_assistant_archive_add_children_to_list (
<a name="l01052"></a>01052                         <a class="code" href="gsb__data__transaction_8c.html#a6018560ece7ab02e8d46bc9bdaffd607">gsb_data_transaction_get_mother_transaction_number</a> (
<a name="l01053"></a>01053                         contra_transaction_number) );
<a name="l01054"></a>01054     }
<a name="l01055"></a>01055     <span class="keywordflow">return</span>;
<a name="l01056"></a>01056 }
<a name="l01057"></a>01057 
<a name="l01067"></a>01067 <span class="keyword">static</span> <span class="keywordtype">void</span> gsb_assistant_archive_add_children_to_list ( gint transaction_number )
<a name="l01068"></a>01068 {
<a name="l01069"></a>01069     <span class="keywordflow">if</span> (transaction_number &lt;= 0)
<a name="l01070"></a>01070         <span class="keywordflow">return</span>;
<a name="l01071"></a>01071 
<a name="l01072"></a>01072     <span class="keywordflow">if</span> (<a class="code" href="gsb__data__transaction_8c.html#a2de1ba38ee196b44e3c00c10e1d645cc">gsb_data_transaction_get_split_of_transaction</a> (transaction_number))
<a name="l01073"></a>01073     {
<a name="l01074"></a>01074         GSList *child_list;
<a name="l01075"></a>01075 
<a name="l01076"></a>01076         <span class="comment">/* add the split */</span>
<a name="l01077"></a>01077         <span class="keywordflow">if</span> (!g_slist_find ( list_transaction_to_archive,
<a name="l01078"></a>01078                             <a class="code" href="gsb__data__transaction_8c.html#a4d90c43dcc4db054a1e2ec3b9ff45acc">gsb_data_transaction_get_pointer_of_transaction</a> (transaction_number)))
<a name="l01079"></a>01079             list_transaction_to_archive = g_slist_append ( list_transaction_to_archive,
<a name="l01080"></a>01080                                                            <a class="code" href="gsb__data__transaction_8c.html#a4d90c43dcc4db054a1e2ec3b9ff45acc">gsb_data_transaction_get_pointer_of_transaction</a> (transaction_number));
<a name="l01081"></a>01081 
<a name="l01082"></a>01082         <span class="comment">/* now add the children */</span>
<a name="l01083"></a>01083         child_list = <a class="code" href="gsb__data__transaction_8c.html#a7694ce23370b2f50ab250c3162aaa0b3">gsb_data_transaction_get_children</a> (transaction_number, FALSE);
<a name="l01084"></a>01084         <span class="keywordflow">while</span> (child_list)
<a name="l01085"></a>01085         {
<a name="l01086"></a>01086             <span class="comment">/* first add the child */</span>
<a name="l01087"></a>01087             <span class="keywordflow">if</span> (!g_slist_find ( list_transaction_to_archive,
<a name="l01088"></a>01088                                 child_list -&gt; data )
<a name="l01089"></a>01089                 &amp;&amp;
<a name="l01090"></a>01090                 <span class="comment">/* we don&#39;t want white lines */</span>
<a name="l01091"></a>01091                 <a class="code" href="gsb__data__transaction_8c.html#a99bf548513083f4a71fe019faeccbe0a">gsb_data_transaction_get_transaction_number</a> (child_list -&gt; data) &gt; 0 )
<a name="l01092"></a>01092                 list_transaction_to_archive = g_slist_append ( list_transaction_to_archive,
<a name="l01093"></a>01093                                                                child_list -&gt; data );
<a name="l01094"></a>01094 
<a name="l01095"></a>01095             <span class="comment">/* check if the child is a transfer */</span>
<a name="l01096"></a>01096             gsb_assistant_archive_add_contra_transaction_to_list (<a class="code" href="gsb__data__transaction_8c.html#a99bf548513083f4a71fe019faeccbe0a">gsb_data_transaction_get_transaction_number</a> (child_list -&gt; data));
<a name="l01097"></a>01097 
<a name="l01098"></a>01098             child_list = child_list -&gt; next;
<a name="l01099"></a>01099         }
<a name="l01100"></a>01100     }
<a name="l01101"></a>01101     <span class="keywordflow">return</span>;
<a name="l01102"></a>01102 }
<a name="l01103"></a>01103 
<a name="l01104"></a>01104 <span class="comment">/* Local Variables: */</span>
<a name="l01105"></a>01105 <span class="comment">/* c-basic-offset: 4 */</span>
<a name="l01106"></a>01106 <span class="comment">/* End: */</span>
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Généré le Sat Aug 7 22:12:01 2010 pour Grisbi par&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
