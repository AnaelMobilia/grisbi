<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Grisbi:  Fichier source de print_transactions_list.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Généré par Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Page&nbsp;principale</span></a></li>
      <li><a href="pages.html"><span>Pages&nbsp;associées</span></a></li>
      <li><a href="annotated.html"><span>Structures&nbsp;de&nbsp;données</span></a></li>
      <li class="current"><a href="files.html"><span>Fichiers</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>Liste&nbsp;des&nbsp;fichiers</span></a></li>
      <li><a href="globals.html"><span>Portée&nbsp;globale</span></a></li>
    </ul>
  </div>
<h1>print_transactions_list.c</h1><a href="print__transactions__list_8c.html">Aller à la documentation de ce fichier.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* ************************************************************************** */</span>
<a name="l00002"></a>00002 <span class="comment">/*                                                                            */</span>
<a name="l00003"></a>00003 <span class="comment">/*     Copyright (C)    2000-2008 Cédric Auger (cedric@grisbi.org)           */</span>
<a name="l00004"></a>00004 <span class="comment">/*                      http://www.grisbi.org                                 */</span>
<a name="l00005"></a>00005 <span class="comment">/*                                                                            */</span>
<a name="l00006"></a>00006 <span class="comment">/*  This program is free software; you can redistribute it and/or modify      */</span>
<a name="l00007"></a>00007 <span class="comment">/*  it under the terms of the GNU General Public License as published by      */</span>
<a name="l00008"></a>00008 <span class="comment">/*  the Free Software Foundation; either version 2 of the License, or         */</span>
<a name="l00009"></a>00009 <span class="comment">/*  (at your option) any later version.                                       */</span>
<a name="l00010"></a>00010 <span class="comment">/*                                                                            */</span>
<a name="l00011"></a>00011 <span class="comment">/*  This program is distributed in the hope that it will be useful,           */</span>
<a name="l00012"></a>00012 <span class="comment">/*  but WITHOUT ANY WARRANTY; without even the implied warranty of            */</span>
<a name="l00013"></a>00013 <span class="comment">/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the             */</span>
<a name="l00014"></a>00014 <span class="comment">/*  GNU General Public License for more details.                              */</span>
<a name="l00015"></a>00015 <span class="comment">/*                                                                            */</span>
<a name="l00016"></a>00016 <span class="comment">/*  You should have received a copy of the GNU General Public License         */</span>
<a name="l00017"></a>00017 <span class="comment">/*  along with this program; if not, write to the Free Software               */</span>
<a name="l00018"></a>00018 <span class="comment">/*  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA */</span>
<a name="l00019"></a>00019 <span class="comment">/*                                                                            */</span>
<a name="l00020"></a>00020 <span class="comment">/* ************************************************************************** */</span>
<a name="l00021"></a>00021 
<a name="l00027"></a>00027 <span class="preprocessor">#include &quot;<a class="code" href="include_8h.html">include.h</a>&quot;</span>
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 <span class="comment">/*START_INCLUDE*/</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="print__transactions__list_8h.html">print_transactions_list.h</a>&quot;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;<a class="code" href="gsb__autofunc_8h.html">gsb_autofunc.h</a>&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="gsb__automem_8h.html">gsb_automem.h</a>&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="gsb__calendar__entry_8h.html">gsb_calendar_entry.h</a>&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="gsb__data__print__config_8h.html">gsb_data_print_config.h</a>&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="gsb__data__transaction_8h.html">gsb_data_transaction.h</a>&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="utils_8h.html">utils.h</a>&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="print__dialog__config_8h.html">print_dialog_config.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="transaction__model_8h.html">transaction_model.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="custom__list_8h.html">custom_list.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="include_8h.html">include.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="structures_8h.html">structures.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="erreur_8h.html">erreur.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="comment">/*END_INCLUDE*/</span>
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 <span class="preprocessor">#if GTK_CHECK_VERSION(2,12,0)</span>
<a name="l00046"></a>00046 <span class="preprocessor"></span>
<a name="l00047"></a>00047 <span class="comment">/*START_STATIC*/</span>
<a name="l00048"></a>00048 <span class="keyword">static</span> gboolean print_transactions_list_apply ( GtkPrintOperation * operation,
<a name="l00049"></a>00049                                          GtkWidget * widget,
<a name="l00050"></a>00050                                          gpointer null );
<a name="l00051"></a>00051 <span class="keyword">static</span> gboolean print_transactions_list_begin ( GtkPrintOperation *operation,
<a name="l00052"></a>00052                                          GtkPrintContext *context,
<a name="l00053"></a>00053                                          gpointer null );
<a name="l00054"></a>00054 <span class="keyword">static</span> <span class="keywordtype">void</span> print_transactions_list_calculate_columns ( gdouble page_width );
<a name="l00055"></a>00055 <span class="keyword">static</span> <span class="keywordtype">void</span> print_transactions_list_draw_background ( <a class="code" href="struct__CustomRecord.html">CustomRecord</a> *record,
<a name="l00056"></a>00056                                                       gboolean color_bg,
<a name="l00057"></a>00057                                                       gint line_position );
<a name="l00058"></a>00058 <span class="keyword">static</span> gint print_transactions_list_draw_column ( gint column_position,
<a name="l00059"></a>00059                                                  gint line_position );
<a name="l00060"></a>00060 <span class="keyword">static</span> gint print_transactions_list_draw_columns_title ( GtkPrintContext *context,
<a name="l00061"></a>00061                                                          gint line_position);
<a name="l00062"></a>00062 <span class="keyword">static</span> gint print_transactions_list_draw_line ( gint line_position );
<a name="l00063"></a>00063 <span class="keyword">static</span> gboolean print_transactions_list_draw_page ( GtkPrintOperation *operation,
<a name="l00064"></a>00064                                              GtkPrintContext *context,
<a name="l00065"></a>00065                                              gint page,
<a name="l00066"></a>00066                                              gpointer null );
<a name="l00067"></a>00067 <span class="keyword">static</span> gint print_transactions_list_draw_row ( GtkPrintContext *context,
<a name="l00068"></a>00068                                               <a class="code" href="struct__CustomRecord.html">CustomRecord</a> *record,
<a name="l00069"></a>00069                                               gint line_position );
<a name="l00070"></a>00070 <span class="keyword">static</span> gint print_transactions_list_draw_title ( GtkPrintContext *context,
<a name="l00071"></a>00071                                                  gint line_position );
<a name="l00072"></a>00072 <span class="keyword">static</span> gboolean print_transactions_list_get_visibles_lines ( gint *number_of_archives,
<a name="l00073"></a>00073                                                       gint *number_of_transactions );
<a name="l00074"></a>00074 <span class="keyword">static</span> GtkWidget * print_transactions_list_layout_config ( GtkPrintOperation * operation,
<a name="l00075"></a>00075                                                     gpointer null );
<a name="l00076"></a>00076 <span class="comment">/*END_STATIC*/</span>
<a name="l00077"></a>00077 
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 <span class="comment">/*START_EXTERN*/</span>
<a name="l00080"></a>00080 <span class="keyword">extern</span> GdkColor <a class="code" href="affichage_8c.html#a881db8e6c000ad504ff0183a674cb196">archive_background_color</a>;
<a name="l00081"></a>00081 <span class="keyword">extern</span> GdkColor <a class="code" href="affichage_8c.html#a58089bf9225ae2e274165369f8bc7a00">couleur_fond</a>[2];
<a name="l00082"></a>00082 <span class="keyword">extern</span> gchar *<a class="code" href="affichage__liste_8c.html#abe5a25ede887e60c7f679c9ff03607f0">titres_colonnes_liste_operations</a>[<a class="code" href="custom__list_8h.html#a5120df6c303afc3c01e77218f39b80b5">CUSTOM_MODEL_N_VISIBLES_COLUMN</a>];
<a name="l00083"></a>00083 <span class="keyword">extern</span> gint <a class="code" href="gsb__file__load_8c.html#a6e5e85a5f63608656ce9709950bb08e6">transaction_col_width</a>[<a class="code" href="custom__list_8h.html#a5120df6c303afc3c01e77218f39b80b5">CUSTOM_MODEL_N_VISIBLES_COLUMN</a>];
<a name="l00084"></a>00084 <span class="comment">/*END_EXTERN*/</span>
<a name="l00085"></a>00085 
<a name="l00086"></a>00086 
<a name="l00088"></a>00088 <span class="keyword">static</span> gint transactions_per_page;
<a name="l00089"></a>00089 <span class="keyword">static</span> gint transactions_in_first_page;
<a name="l00090"></a>00090 
<a name="l00092"></a>00092 <span class="keyword">static</span> gint total_transactions_to_print;
<a name="l00093"></a>00093 
<a name="l00095"></a>00095 <span class="keyword">static</span> gint total_transactions_printed;
<a name="l00096"></a>00096 
<a name="l00098"></a>00098 <span class="keyword">static</span> gint current_row_to_print;
<a name="l00099"></a>00099 
<a name="l00100"></a>00100 <span class="keyword">static</span> gchar *title_string;
<a name="l00101"></a>00101 <span class="keyword">static</span> GDate *draw_initial_date = NULL;
<a name="l00102"></a>00102 <span class="keyword">static</span> GDate *draw_final_date = NULL;
<a name="l00103"></a>00103 
<a name="l00104"></a>00104 
<a name="l00105"></a>00105 <span class="comment">/* size and pos of the columns calculated when begin the print */</span>
<a name="l00106"></a>00106 <span class="keyword">static</span> gdouble columns_position[<a class="code" href="custom__list_8h.html#a94bc00a237b4803e1096242436b77bcf">CUSTOM_MODEL_VISIBLE_COLUMNS</a>];
<a name="l00107"></a>00107 <span class="keyword">static</span> gint columns_width[<a class="code" href="custom__list_8h.html#a94bc00a237b4803e1096242436b77bcf">CUSTOM_MODEL_VISIBLE_COLUMNS</a>];
<a name="l00108"></a>00108 <span class="keyword">static</span> gint size_row = 0;
<a name="l00109"></a>00109 <span class="keyword">static</span> cairo_t *cr = NULL;
<a name="l00110"></a>00110 <span class="keyword">static</span> gdouble page_width = 0.0;
<a name="l00111"></a>00111 <span class="keyword">static</span> gdouble page_height = 0.0;
<a name="l00112"></a>00112 
<a name="l00113"></a>00113 
<a name="l00114"></a>00114 
<a name="l00124"></a>00124 GtkWidget * print_transactions_list_layout_config ( GtkPrintOperation * operation,
<a name="l00125"></a>00125                                                     gpointer null )
<a name="l00126"></a>00126 {
<a name="l00127"></a>00127     GtkWidget *check_button;
<a name="l00128"></a>00128     GtkWidget *label;
<a name="l00129"></a>00129     GtkWidget *hbox;
<a name="l00130"></a>00130     GtkWidget *entry;
<a name="l00131"></a>00131     GtkWidget *font_button_transactions;
<a name="l00132"></a>00132     GtkWidget *font_button_title;
<a name="l00133"></a>00133     gchar *fontname_transactions;
<a name="l00134"></a>00134     gchar *fontname_title;
<a name="l00135"></a>00135     GtkWidget *init_date_entry;
<a name="l00136"></a>00136     GtkWidget *final_date_entry;
<a name="l00137"></a>00137     GtkWidget *vbox;
<a name="l00138"></a>00138     GtkWidget *paddingbox;
<a name="l00139"></a>00139     GtkSizeGroup * size_group;
<a name="l00140"></a>00140 
<a name="l00141"></a>00141     size_group = gtk_size_group_new (GTK_SIZE_GROUP_HORIZONTAL);
<a name="l00142"></a>00142 
<a name="l00143"></a>00143     vbox = gtk_vbox_new ( FALSE, 6 );
<a name="l00144"></a>00144     gtk_container_set_border_width ( GTK_CONTAINER(vbox), 12 );
<a name="l00145"></a>00145     paddingbox = <a class="code" href="utils_8c.html#a22ba81fcf046b5bec6cf6d55d440abc5">new_paddingbox_with_title</a> ( vbox, FALSE, _(<span class="stringliteral">&quot;Layout&quot;</span>) );
<a name="l00146"></a>00146 
<a name="l00147"></a>00147     <span class="comment">/* set up the title and dates, this is never saved, so ask each time */</span>
<a name="l00148"></a>00148     <span class="comment">/* title line */</span>
<a name="l00149"></a>00149     hbox = gtk_hbox_new (FALSE, 10);
<a name="l00150"></a>00150     gtk_box_pack_start (GTK_BOX (paddingbox),
<a name="l00151"></a>00151                         hbox,
<a name="l00152"></a>00152                         FALSE, FALSE, 0);
<a name="l00153"></a>00153 
<a name="l00154"></a>00154     entry = <a class="code" href="gsb__automem_8c.html#afe5c31e5709a71264b93ee912fed12f4">gsb_automem_entry_new</a> (&amp;title_string, NULL, NULL);
<a name="l00155"></a>00155 
<a name="l00156"></a>00156     check_button = <a class="code" href="gsb__autofunc_8c.html#ac0a3d8ad6e17993923e2cbdbe548cd74">gsb_autofunc_checkbutton_new</a> (_(<span class="stringliteral">&quot;Print a title : &quot;</span>),
<a name="l00157"></a>00157                                                  <a class="code" href="gsb__data__print__config_8c.html#afd8a78e043b717e6bc2a6a18b6ced76d">gsb_data_print_config_get_draw_title</a> (),
<a name="l00158"></a>00158                                                  G_CALLBACK (<a class="code" href="utils_8c.html#ad678079f1b9eb979a0766e9dcbec0fd3">sens_desensitive_pointeur</a>), entry,
<a name="l00159"></a>00159                                                  G_CALLBACK (<a class="code" href="gsb__data__print__config_8c.html#a8d6dcd2b99ea76bfb003da07439fee75">gsb_data_print_config_set_draw_title</a>), 0);
<a name="l00160"></a>00160     gtk_box_pack_start (GTK_BOX (hbox),
<a name="l00161"></a>00161                         check_button,
<a name="l00162"></a>00162                         FALSE, FALSE, 0);
<a name="l00163"></a>00163 
<a name="l00164"></a>00164     gtk_widget_set_sensitive (entry, <a class="code" href="gsb__data__print__config_8c.html#afd8a78e043b717e6bc2a6a18b6ced76d">gsb_data_print_config_get_draw_title</a> ());
<a name="l00165"></a>00165     gtk_box_pack_start (GTK_BOX (hbox),
<a name="l00166"></a>00166                         entry,
<a name="l00167"></a>00167                         TRUE, TRUE, 0);
<a name="l00168"></a>00168 
<a name="l00169"></a>00169     <span class="comment">/* add the dates interval */</span>
<a name="l00170"></a>00170     hbox = gtk_hbox_new (FALSE, 10);
<a name="l00171"></a>00171 
<a name="l00172"></a>00172     check_button = <a class="code" href="gsb__autofunc_8c.html#ac0a3d8ad6e17993923e2cbdbe548cd74">gsb_autofunc_checkbutton_new</a> (_(<span class="stringliteral">&quot;Select dates interval : &quot;</span>),
<a name="l00173"></a>00173                                                  <a class="code" href="gsb__data__print__config_8c.html#a10c52e1083f665efc453c87daff007a7">gsb_data_print_config_get_draw_interval_dates</a> (),
<a name="l00174"></a>00174                                                  G_CALLBACK (<a class="code" href="utils_8c.html#ad678079f1b9eb979a0766e9dcbec0fd3">sens_desensitive_pointeur</a>), hbox,
<a name="l00175"></a>00175                                                  G_CALLBACK (<a class="code" href="gsb__data__print__config_8c.html#a672a308b8bc95de4e737f7abd610d0b1">gsb_data_print_config_set_draw_interval_dates</a>), 0);
<a name="l00176"></a>00176     gtk_box_pack_start (GTK_BOX (paddingbox),
<a name="l00177"></a>00177                         check_button,
<a name="l00178"></a>00178                         FALSE, FALSE, 0);
<a name="l00179"></a>00179 
<a name="l00180"></a>00180 
<a name="l00181"></a>00181     gtk_box_pack_start (GTK_BOX (paddingbox),
<a name="l00182"></a>00182                         hbox,
<a name="l00183"></a>00183                         FALSE, FALSE, 0);
<a name="l00184"></a>00184 
<a name="l00185"></a>00185     label = gtk_label_new (_(<span class="stringliteral">&quot;Initial date : &quot;</span>));
<a name="l00186"></a>00186     gtk_box_pack_start (GTK_BOX (hbox),
<a name="l00187"></a>00187                         label,
<a name="l00188"></a>00188                         FALSE, FALSE, 0);
<a name="l00189"></a>00189     
<a name="l00190"></a>00190     init_date_entry = <a class="code" href="gsb__calendar__entry_8c.html#afc3a9a10d06b658715e71451cd8bd97f">gsb_calendar_entry_new</a> (FALSE);
<a name="l00191"></a>00191     <span class="keywordflow">if</span> (draw_initial_date)
<a name="l00192"></a>00192         <a class="code" href="gsb__calendar__entry_8c.html#af96bec76fa28a05a4ea3355cccb68b96">gsb_calendar_entry_set_date</a> (init_date_entry, draw_initial_date);
<a name="l00193"></a>00193     gtk_box_pack_start (GTK_BOX (hbox),
<a name="l00194"></a>00194                         init_date_entry,
<a name="l00195"></a>00195                         FALSE, FALSE, 0);
<a name="l00196"></a>00196 
<a name="l00197"></a>00197     label = gtk_label_new (_(<span class="stringliteral">&quot;Final date : &quot;</span>));
<a name="l00198"></a>00198     gtk_box_pack_start (GTK_BOX (hbox),
<a name="l00199"></a>00199                         label,
<a name="l00200"></a>00200                         FALSE, FALSE, 0);
<a name="l00201"></a>00201     
<a name="l00202"></a>00202     final_date_entry = <a class="code" href="gsb__calendar__entry_8c.html#afc3a9a10d06b658715e71451cd8bd97f">gsb_calendar_entry_new</a> (FALSE);
<a name="l00203"></a>00203     <span class="keywordflow">if</span> (draw_final_date)
<a name="l00204"></a>00204         <a class="code" href="gsb__calendar__entry_8c.html#af96bec76fa28a05a4ea3355cccb68b96">gsb_calendar_entry_set_date</a> (final_date_entry, draw_final_date);
<a name="l00205"></a>00205     gtk_box_pack_start (GTK_BOX (hbox),
<a name="l00206"></a>00206                         final_date_entry,
<a name="l00207"></a>00207                         FALSE, FALSE, 0);
<a name="l00208"></a>00208 
<a name="l00209"></a>00209     check_button = <a class="code" href="gsb__autofunc_8c.html#ac0a3d8ad6e17993923e2cbdbe548cd74">gsb_autofunc_checkbutton_new</a> (_(<span class="stringliteral">&quot;Use value date&quot;</span>),
<a name="l00210"></a>00210                                                  <a class="code" href="gsb__data__print__config_8c.html#a533bc3e1fa5039645557a0d959571497">gsb_data_print_config_get_draw_dates_are_value_dates</a> (),
<a name="l00211"></a>00211                                                  NULL, NULL,
<a name="l00212"></a>00212                                                  G_CALLBACK (<a class="code" href="gsb__data__print__config_8c.html#aaa7ae93d7b50c959a8844a2e6773c7e4">gsb_data_print_config_set_draw_dates_are_value_dates</a>), 0);
<a name="l00213"></a>00213     gtk_box_pack_start (GTK_BOX (hbox),
<a name="l00214"></a>00214                         check_button,
<a name="l00215"></a>00215                         FALSE, FALSE, 0);
<a name="l00216"></a>00216 
<a name="l00217"></a>00217     <span class="keywordflow">if</span> (!<a class="code" href="gsb__data__print__config_8c.html#a10c52e1083f665efc453c87daff007a7">gsb_data_print_config_get_draw_interval_dates</a> ())
<a name="l00218"></a>00218         gtk_widget_set_sensitive (hbox, FALSE);
<a name="l00219"></a>00219 
<a name="l00220"></a>00220 
<a name="l00221"></a>00221     <span class="comment">/* set up all the checkbuttons */</span>
<a name="l00222"></a>00222     check_button = <a class="code" href="gsb__autofunc_8c.html#ac0a3d8ad6e17993923e2cbdbe548cd74">gsb_autofunc_checkbutton_new</a> (_(<span class="stringliteral">&quot;Draw the lines between transactions&quot;</span>),
<a name="l00223"></a>00223                                                  <a class="code" href="gsb__data__print__config_8c.html#a6214f4edbeb618543155d93c1440fb13">gsb_data_print_config_get_draw_lines</a> (),
<a name="l00224"></a>00224                                                  NULL, NULL,
<a name="l00225"></a>00225                                                  G_CALLBACK (<a class="code" href="gsb__data__print__config_8c.html#acbb938f35f95f8ab78bb62f266ea3143">gsb_data_print_config_set_draw_lines</a>), 0);
<a name="l00226"></a>00226     gtk_box_pack_start (GTK_BOX (paddingbox),
<a name="l00227"></a>00227                         check_button,
<a name="l00228"></a>00228                         FALSE, FALSE, 0);
<a name="l00229"></a>00229     check_button = <a class="code" href="gsb__autofunc_8c.html#ac0a3d8ad6e17993923e2cbdbe548cd74">gsb_autofunc_checkbutton_new</a> (_(<span class="stringliteral">&quot;Draw the lines between the columns&quot;</span>),
<a name="l00230"></a>00230                                                  <a class="code" href="gsb__data__print__config_8c.html#a9eee382b1ee81d2291ef4eb4aae4bb7a">gsb_data_print_config_get_draw_column</a> (),
<a name="l00231"></a>00231                                                  NULL, NULL,
<a name="l00232"></a>00232                                                  G_CALLBACK (<a class="code" href="gsb__data__print__config_8c.html#aa24596906e01248f337b10c9ef207a66">gsb_data_print_config_set_draw_column</a>), 0);
<a name="l00233"></a>00233     gtk_box_pack_start (GTK_BOX (paddingbox),
<a name="l00234"></a>00234                         check_button,
<a name="l00235"></a>00235                         FALSE, FALSE, 0);
<a name="l00236"></a>00236 
<a name="l00237"></a>00237     check_button = <a class="code" href="gsb__autofunc_8c.html#ac0a3d8ad6e17993923e2cbdbe548cd74">gsb_autofunc_checkbutton_new</a> (_(<span class="stringliteral">&quot;Fill the background as the transactions list&quot;</span>),
<a name="l00238"></a>00238                                                  <a class="code" href="gsb__data__print__config_8c.html#aba43ee990b36315212df9e30ce5a640e">gsb_data_print_config_get_draw_background</a> (),
<a name="l00239"></a>00239                                                  NULL, NULL,
<a name="l00240"></a>00240                                                  G_CALLBACK (<a class="code" href="gsb__data__print__config_8c.html#ad06a44fa956ad56ee3ecbb4834c541c2">gsb_data_print_config_set_draw_background</a>), 0);
<a name="l00241"></a>00241     gtk_box_pack_start (GTK_BOX (paddingbox),
<a name="l00242"></a>00242                         check_button,
<a name="l00243"></a>00243                         FALSE, FALSE, 0);
<a name="l00244"></a>00244 
<a name="l00245"></a>00245     check_button = <a class="code" href="gsb__autofunc_8c.html#ac0a3d8ad6e17993923e2cbdbe548cd74">gsb_autofunc_checkbutton_new</a> (_(<span class="stringliteral">&quot;Print the archives lines&quot;</span>),
<a name="l00246"></a>00246                                                  <a class="code" href="gsb__data__print__config_8c.html#a6e773923f44e66e6e047ec8bd6bbdb21">gsb_data_print_config_get_draw_archives</a> (),
<a name="l00247"></a>00247                                                  NULL, NULL,
<a name="l00248"></a>00248                                                  G_CALLBACK (<a class="code" href="gsb__data__print__config_8c.html#a39ab91c1594098a305ee245957ce6e2b">gsb_data_print_config_set_draw_archives</a>), 0);
<a name="l00249"></a>00249     gtk_box_pack_start (GTK_BOX (paddingbox),
<a name="l00250"></a>00250                         check_button,
<a name="l00251"></a>00251                         FALSE, FALSE, 0);
<a name="l00252"></a>00252 
<a name="l00253"></a>00253     check_button = <a class="code" href="gsb__autofunc_8c.html#ac0a3d8ad6e17993923e2cbdbe548cd74">gsb_autofunc_checkbutton_new</a> (_(<span class="stringliteral">&quot;Print the names of the columns&quot;</span>),
<a name="l00254"></a>00254                                                  <a class="code" href="gsb__data__print__config_8c.html#a01e892528ff87835487d03a5ba6c24e5">gsb_data_print_config_get_draw_columns_name</a> (),
<a name="l00255"></a>00255                                                  NULL, NULL,
<a name="l00256"></a>00256                                                  G_CALLBACK (<a class="code" href="gsb__data__print__config_8c.html#a59f35cc5d8bddd66c4c302f32820b4b9">gsb_data_print_config_set_draw_columns_name</a>), 0);
<a name="l00257"></a>00257     gtk_box_pack_start (GTK_BOX (paddingbox),
<a name="l00258"></a>00258                         check_button,
<a name="l00259"></a>00259                         FALSE, FALSE, 0);
<a name="l00260"></a>00260 
<a name="l00261"></a>00261     paddingbox = <a class="code" href="utils_8c.html#a22ba81fcf046b5bec6cf6d55d440abc5">new_paddingbox_with_title</a> ( vbox, FALSE, _(<span class="stringliteral">&quot;Fonts&quot;</span>) );
<a name="l00262"></a>00262 
<a name="l00263"></a>00263     <span class="comment">/* set up the font of the transactions,</span>
<a name="l00264"></a>00264 <span class="comment">     * by default use the font of the lists */</span>
<a name="l00265"></a>00265     hbox = gtk_hbox_new (FALSE, 12);
<a name="l00266"></a>00266     gtk_box_pack_start (GTK_BOX (paddingbox),
<a name="l00267"></a>00267                         hbox,
<a name="l00268"></a>00268                         FALSE, FALSE, 0);
<a name="l00269"></a>00269 
<a name="l00270"></a>00270     label = gtk_label_new (_(<span class="stringliteral">&quot;Transactions font&quot;</span>));
<a name="l00271"></a>00271     gtk_label_set_justify ( GTK_LABEL (label), GTK_JUSTIFY_LEFT );
<a name="l00272"></a>00272     gtk_misc_set_alignment ( GTK_MISC ( label ), 0, 0.5);
<a name="l00273"></a>00273     gtk_size_group_add_widget ( size_group, label );
<a name="l00274"></a>00274     gtk_box_pack_start (GTK_BOX (hbox),
<a name="l00275"></a>00275                         label,
<a name="l00276"></a>00276                         FALSE, FALSE, 0);
<a name="l00277"></a>00277 
<a name="l00278"></a>00278     fontname_transactions = pango_font_description_to_string (<a class="code" href="gsb__data__print__config_8c.html#af32e6fae377170c98443900214ddd009">gsb_data_print_config_get_font_transactions</a> ());
<a name="l00279"></a>00279     font_button_transactions = gtk_font_button_new_with_font ( fontname_transactions );
<a name="l00280"></a>00280     gtk_font_button_set_use_font ( GTK_FONT_BUTTON(font_button_transactions), TRUE );
<a name="l00281"></a>00281     gtk_font_button_set_use_size ( GTK_FONT_BUTTON(font_button_transactions), TRUE );
<a name="l00282"></a>00282     gtk_font_button_set_title ( GTK_FONT_BUTTON(font_button_transactions), _(<span class="stringliteral">&quot;Choosing font&quot;</span>) );
<a name="l00283"></a>00283     gtk_box_pack_start (GTK_BOX (hbox),
<a name="l00284"></a>00284                         font_button_transactions,
<a name="l00285"></a>00285                         TRUE, TRUE, 0);
<a name="l00286"></a>00286 
<a name="l00287"></a>00287     <span class="comment">/* set up the font for the title */</span>
<a name="l00288"></a>00288     hbox = gtk_hbox_new (FALSE, 12);
<a name="l00289"></a>00289     gtk_box_pack_start (GTK_BOX (paddingbox),
<a name="l00290"></a>00290                         hbox,
<a name="l00291"></a>00291                         FALSE, FALSE, 0);
<a name="l00292"></a>00292 
<a name="l00293"></a>00293     label = gtk_label_new (_(<span class="stringliteral">&quot;Title font&quot;</span>));
<a name="l00294"></a>00294     gtk_label_set_justify ( GTK_LABEL (label), GTK_JUSTIFY_LEFT );
<a name="l00295"></a>00295     gtk_misc_set_alignment ( GTK_MISC ( label ), 0, 0.5);
<a name="l00296"></a>00296     gtk_size_group_add_widget ( size_group, label );
<a name="l00297"></a>00297     gtk_box_pack_start (GTK_BOX (hbox),
<a name="l00298"></a>00298                         label,
<a name="l00299"></a>00299                         FALSE, FALSE, 0);
<a name="l00300"></a>00300 
<a name="l00301"></a>00301     fontname_title = pango_font_description_to_string (<a class="code" href="gsb__data__print__config_8c.html#a683c317369e1e940e1066cccd3306099">gsb_data_print_config_get_font_title</a> ());
<a name="l00302"></a>00302     font_button_title =  gtk_font_button_new_with_font ( fontname_title );
<a name="l00303"></a>00303     gtk_font_button_set_use_font ( GTK_FONT_BUTTON(font_button_title), TRUE );
<a name="l00304"></a>00304     gtk_font_button_set_use_size ( GTK_FONT_BUTTON(font_button_title), TRUE );
<a name="l00305"></a>00305     gtk_font_button_set_title ( GTK_FONT_BUTTON(font_button_title), _(<span class="stringliteral">&quot;Choosing font&quot;</span>) );
<a name="l00306"></a>00306     gtk_box_pack_start (GTK_BOX (hbox),
<a name="l00307"></a>00307                         font_button_title,
<a name="l00308"></a>00308                         TRUE, TRUE, 0);
<a name="l00309"></a>00309 
<a name="l00310"></a>00310 
<a name="l00311"></a>00311     <span class="comment">/* save what we have done in all cases, so if we cancel and come back, our values</span>
<a name="l00312"></a>00312 <span class="comment">     * come back */</span>
<a name="l00313"></a>00313     <a class="code" href="gsb__data__print__config_8c.html#ab1a5ac2e69698c3aa4cd3cff44344538">gsb_data_print_config_set_font_transaction</a> (pango_font_description_from_string (fontname_transactions));
<a name="l00314"></a>00314     <a class="code" href="gsb__data__print__config_8c.html#a2829de8cc372604bb83ad2f7e80e2ee6">gsb_data_print_config_set_font_title</a> (pango_font_description_from_string (fontname_title));
<a name="l00315"></a>00315     draw_initial_date = <a class="code" href="gsb__calendar__entry_8c.html#a8cb2e700394a337d8442f42cfdb311ef">gsb_calendar_entry_get_date</a> (init_date_entry);
<a name="l00316"></a>00316     draw_final_date = <a class="code" href="gsb__calendar__entry_8c.html#a8cb2e700394a337d8442f42cfdb311ef">gsb_calendar_entry_get_date</a> (final_date_entry);
<a name="l00317"></a>00317 
<a name="l00318"></a>00318     g_object_set_data ( G_OBJECT(operation), <span class="stringliteral">&quot;font_transaction_button&quot;</span>, font_button_transactions );
<a name="l00319"></a>00319     g_object_set_data ( G_OBJECT(operation), <span class="stringliteral">&quot;font_title_button&quot;</span>, font_button_title );
<a name="l00320"></a>00320 
<a name="l00321"></a>00321     gtk_widget_show_all ( vbox );
<a name="l00322"></a>00322 
<a name="l00323"></a>00323     <span class="keywordflow">return</span> vbox;
<a name="l00324"></a>00324 }
<a name="l00325"></a>00325 
<a name="l00326"></a>00326 
<a name="l00327"></a>00327 
<a name="l00339"></a>00339 gboolean print_transactions_list_apply ( GtkPrintOperation * operation,
<a name="l00340"></a>00340                                          GtkWidget * widget,
<a name="l00341"></a>00341                                          gpointer null )
<a name="l00342"></a>00342 {
<a name="l00343"></a>00343     GtkFontButton * font_button_transactions, * font_button_title;
<a name="l00344"></a>00344 
<a name="l00345"></a>00345     font_button_transactions = g_object_get_data ( G_OBJECT(operation), <span class="stringliteral">&quot;font_transaction_button&quot;</span> );
<a name="l00346"></a>00346     font_button_title = g_object_get_data ( G_OBJECT(operation), <span class="stringliteral">&quot;font_title_button&quot;</span> );
<a name="l00347"></a>00347     
<a name="l00348"></a>00348     <a class="code" href="gsb__data__print__config_8c.html#ab1a5ac2e69698c3aa4cd3cff44344538">gsb_data_print_config_set_font_transaction</a> ( pango_font_description_from_string ( gtk_font_button_get_font_name ( font_button_transactions ) ) );
<a name="l00349"></a>00349     <a class="code" href="gsb__data__print__config_8c.html#a2829de8cc372604bb83ad2f7e80e2ee6">gsb_data_print_config_set_font_title</a> ( pango_font_description_from_string ( gtk_font_button_get_font_name ( font_button_title ) ) );
<a name="l00350"></a>00350     
<a name="l00351"></a>00351     <span class="keywordflow">return</span> FALSE;
<a name="l00352"></a>00352 }
<a name="l00353"></a>00353 
<a name="l00354"></a>00354 
<a name="l00355"></a>00355 
<a name="l00364"></a>00364 gboolean <a class="code" href="print__transactions__list_8h.html#a96e50745e721d5b62101639beb10b6e1">print_transactions_list</a> ( GtkWidget * button,
<a name="l00365"></a>00365                                    gpointer null )
<a name="l00366"></a>00366 {
<a name="l00367"></a>00367     <a class="code" href="print__dialog__config_8h.html#a7d3dcba0a3d4fe72caa34435200f1c22">print_dialog_config</a> ( G_CALLBACK (print_transactions_list_begin),
<a name="l00368"></a>00368                           G_CALLBACK (print_transactions_list_draw_page),
<a name="l00369"></a>00369                           _(<span class="stringliteral">&quot;Fonts &amp; layout&quot;</span>),
<a name="l00370"></a>00370                           G_CALLBACK (print_transactions_list_layout_config),
<a name="l00371"></a>00371                           G_CALLBACK (print_transactions_list_apply) );
<a name="l00372"></a>00372     <span class="keywordflow">return</span> FALSE;
<a name="l00373"></a>00373 }
<a name="l00374"></a>00374 
<a name="l00375"></a>00375 
<a name="l00376"></a>00376 
<a name="l00387"></a>00387 gboolean print_transactions_list_begin ( GtkPrintOperation *operation,
<a name="l00388"></a>00388                                          GtkPrintContext *context,
<a name="l00389"></a>00389                                          gpointer null )
<a name="l00390"></a>00390 {
<a name="l00391"></a>00391     <a class="code" href="struct__CustomList.html">CustomList</a> *custom_list;
<a name="l00392"></a>00392     gint size_transaction;
<a name="l00393"></a>00393     gint size_title = 0;
<a name="l00394"></a>00394     gint size_archive = 0;
<a name="l00395"></a>00395     gdouble transactions_per_page_double;
<a name="l00396"></a>00396     gint nb_pages;
<a name="l00397"></a>00397     gint number_of_archives = 0;
<a name="l00398"></a>00398 
<a name="l00399"></a>00399     <a class="code" href="erreur_8h.html#a17bfffc4306bc76edd79e060a8947dc4">devel_debug</a> (NULL);
<a name="l00400"></a>00400 
<a name="l00401"></a>00401     <span class="comment">/* we need to calculate the number of pages */</span>
<a name="l00402"></a>00402     cr = gtk_print_context_get_cairo_context (context);
<a name="l00403"></a>00403     custom_list = <a class="code" href="transaction__model_8c.html#a416a1ee9231b6f7d74d3b0811902163a">transaction_model_get_model</a> ();
<a name="l00404"></a>00404 
<a name="l00405"></a>00405     <span class="comment">/* get the size of the title */</span>
<a name="l00406"></a>00406     <span class="keywordflow">if</span> (<a class="code" href="gsb__data__print__config_8c.html#afd8a78e043b717e6bc2a6a18b6ced76d">gsb_data_print_config_get_draw_title</a> () &amp;&amp; title_string &amp;&amp; strlen (title_string))
<a name="l00407"></a>00407         size_title = pango_font_description_get_size (<a class="code" href="gsb__data__print__config_8c.html#a683c317369e1e940e1066cccd3306099">gsb_data_print_config_get_font_title</a> ())/PANGO_SCALE;
<a name="l00408"></a>00408 
<a name="l00409"></a>00409     <span class="comment">/* we need the number of archives and of transactions to print</span>
<a name="l00410"></a>00410 <span class="comment">     * number_of_archives will be set to 0 if no draw archives */</span>
<a name="l00411"></a>00411     print_transactions_list_get_visibles_lines (&amp;number_of_archives,
<a name="l00412"></a>00412                                                 &amp;total_transactions_to_print );
<a name="l00413"></a>00413 
<a name="l00414"></a>00414 <span class="comment">/*  xxx   mk_include 2 fois de suite modifie qd même des fichiers */</span>
<a name="l00415"></a>00415 
<a name="l00416"></a>00416     <span class="comment">/* get the size of a complete transaction and an archive */</span>
<a name="l00417"></a>00417     size_row = pango_font_description_get_size (<a class="code" href="gsb__data__print__config_8c.html#af32e6fae377170c98443900214ddd009">gsb_data_print_config_get_font_transactions</a> ())/PANGO_SCALE;
<a name="l00418"></a>00418     size_transaction = size_row * custom_list -&gt; nb_rows_by_transaction + 2*<a class="code" href="gsb__data__print__config_8c.html#a6214f4edbeb618543155d93c1440fb13">gsb_data_print_config_get_draw_lines</a> ();
<a name="l00419"></a>00419     size_archive = size_row + 2*<a class="code" href="gsb__data__print__config_8c.html#a6214f4edbeb618543155d93c1440fb13">gsb_data_print_config_get_draw_lines</a> ();
<a name="l00420"></a>00420 
<a name="l00421"></a>00421     <span class="comment">/* the heigh of a page decrease of 1 line if we use the columns titles */</span>
<a name="l00422"></a>00422     page_height = gtk_print_context_get_height (context) - <a class="code" href="gsb__data__print__config_8c.html#a01e892528ff87835487d03a5ba6c24e5">gsb_data_print_config_get_draw_columns_name</a> ()*size_transaction;
<a name="l00423"></a>00423 
<a name="l00424"></a>00424     <span class="comment">/* how much transactions we can show in a page : */</span>
<a name="l00425"></a>00425     transactions_per_page_double = page_height / size_transaction;
<a name="l00426"></a>00426 
<a name="l00427"></a>00427     <span class="keywordflow">if</span> (!size_title &amp;&amp; !<a class="code" href="gsb__data__print__config_8c.html#a6e773923f44e66e6e047ec8bd6bbdb21">gsb_data_print_config_get_draw_archives</a> ())
<a name="l00428"></a>00428     {
<a name="l00429"></a>00429         <span class="comment">/* simple way : no archives and no title */</span>
<a name="l00430"></a>00430         nb_pages = ceil ( total_transactions_to_print / transactions_per_page_double );
<a name="l00431"></a>00431         transactions_in_first_page = floor (transactions_per_page_double);
<a name="l00432"></a>00432     }
<a name="l00433"></a>00433     <span class="keywordflow">else</span>
<a name="l00434"></a>00434     {
<a name="l00435"></a>00435         <span class="comment">/* there are title or archives, it&#39;s more complex because it will have less transactions</span>
<a name="l00436"></a>00436 <span class="comment">         * on the first page */</span>
<a name="l00437"></a>00437         gint first_page_height = page_height - size_title - size_archive*number_of_archives;
<a name="l00438"></a>00438 
<a name="l00439"></a>00439         transactions_in_first_page = floor (first_page_height / size_transaction);
<a name="l00440"></a>00440         nb_pages = 1 + ceil (  (total_transactions_to_print - transactions_in_first_page)/ transactions_per_page_double );
<a name="l00441"></a>00441     }
<a name="l00442"></a>00442 
<a name="l00443"></a>00443     <span class="comment">/* set the number of page */</span>
<a name="l00444"></a>00444     gtk_print_operation_set_n_pages ( GTK_PRINT_OPERATION (operation),
<a name="l00445"></a>00445                                       nb_pages );
<a name="l00446"></a>00446     <span class="comment">/* save the nb of transactions per page */</span>
<a name="l00447"></a>00447     transactions_per_page = floor (transactions_per_page_double);
<a name="l00448"></a>00448 
<a name="l00449"></a>00449     <span class="comment">/* calculate the size and position of the columns */</span>
<a name="l00450"></a>00450     page_width = gtk_print_context_get_width (context);
<a name="l00451"></a>00451     print_transactions_list_calculate_columns (page_width);
<a name="l00452"></a>00452 
<a name="l00453"></a>00453     total_transactions_printed = 0;
<a name="l00454"></a>00454     current_row_to_print = 0;
<a name="l00455"></a>00455     <span class="keywordflow">return</span> FALSE;
<a name="l00456"></a>00456 }
<a name="l00457"></a>00457 
<a name="l00458"></a>00458 
<a name="l00459"></a>00459 
<a name="l00470"></a>00470 gboolean print_transactions_list_draw_page ( GtkPrintOperation *operation,
<a name="l00471"></a>00471                                              GtkPrintContext *context,
<a name="l00472"></a>00472                                              gint page,
<a name="l00473"></a>00473                                              gpointer null )
<a name="l00474"></a>00474 {
<a name="l00475"></a>00475     <a class="code" href="struct__CustomList.html">CustomList</a> *custom_list;
<a name="l00476"></a>00476     gboolean color_bg = TRUE;
<a name="l00477"></a>00477     gint line_position = 0;
<a name="l00478"></a>00478     gint transactions_to_draw;
<a name="l00479"></a>00479 
<a name="l00480"></a>00480     <a class="code" href="erreur_8h.html#a10f4eeae4cc251a8d632fd62ec1057fb">devel_debug_int</a> (page);
<a name="l00481"></a>00481 
<a name="l00482"></a>00482     <span class="comment">/* draw the title */</span>
<a name="l00483"></a>00483     <span class="keywordflow">if</span> (!page)
<a name="l00484"></a>00484         line_position = print_transactions_list_draw_title (context, line_position);
<a name="l00485"></a>00485 
<a name="l00486"></a>00486     <span class="comment">/* draw the columns titles */</span>
<a name="l00487"></a>00487     <span class="keywordflow">if</span> (<a class="code" href="gsb__data__print__config_8c.html#a01e892528ff87835487d03a5ba6c24e5">gsb_data_print_config_get_draw_columns_name</a> ())
<a name="l00488"></a>00488         line_position = print_transactions_list_draw_columns_title (context, line_position);
<a name="l00489"></a>00489 
<a name="l00490"></a>00490     <span class="comment">/* draw the transactions lines */</span>
<a name="l00491"></a>00491     custom_list = <a class="code" href="transaction__model_8c.html#a416a1ee9231b6f7d74d3b0811902163a">transaction_model_get_model</a> ();
<a name="l00492"></a>00492 
<a name="l00493"></a>00493     <span class="keywordflow">if</span> (page)
<a name="l00494"></a>00494         transactions_to_draw = transactions_per_page;
<a name="l00495"></a>00495     <span class="keywordflow">else</span>
<a name="l00496"></a>00496         transactions_to_draw = transactions_in_first_page;
<a name="l00497"></a>00497     <span class="keywordflow">if</span> (transactions_to_draw &gt; (total_transactions_to_print - total_transactions_printed))
<a name="l00498"></a>00498         transactions_to_draw = total_transactions_to_print - total_transactions_printed;
<a name="l00499"></a>00499 
<a name="l00500"></a>00500     <span class="keywordflow">while</span> (transactions_to_draw)
<a name="l00501"></a>00501     {
<a name="l00502"></a>00502         gint i;
<a name="l00503"></a>00503         <a class="code" href="struct__CustomRecord.html">CustomRecord</a> *record = NULL;
<a name="l00504"></a>00504 
<a name="l00505"></a>00505         <span class="comment">/* begin a transaction : fill the line before the transaction */</span>
<a name="l00506"></a>00506         line_position = print_transactions_list_draw_line (line_position);
<a name="l00507"></a>00507 
<a name="l00508"></a>00508         <span class="comment">/* print the transaction */</span>
<a name="l00509"></a>00509         <span class="keywordflow">for</span> (i=0 ; i&lt;custom_list -&gt; nb_rows_by_transaction ; i++)
<a name="l00510"></a>00510         {
<a name="l00511"></a>00511             record = custom_list -&gt; visibles_rows[current_row_to_print];
<a name="l00512"></a>00512 
<a name="l00513"></a>00513             <span class="comment">/* if it&#39;s an archive, check we want it */</span>
<a name="l00514"></a>00514             <span class="keywordflow">if</span> (record -&gt; what_is_line == <a class="code" href="custom__list_8h.html#a0caea412748bef9b8222da212aaa0069">IS_ARCHIVE</a> &amp;&amp; !<a class="code" href="gsb__data__print__config_8c.html#a6e773923f44e66e6e047ec8bd6bbdb21">gsb_data_print_config_get_draw_archives</a> ())
<a name="l00515"></a>00515             {
<a name="l00516"></a>00516                 <span class="comment">/* go to the next row but come back to the first line of transaction */</span>
<a name="l00517"></a>00517                 current_row_to_print++;
<a name="l00518"></a>00518                 i--;
<a name="l00519"></a>00519                 <span class="keywordflow">continue</span>;
<a name="l00520"></a>00520             }
<a name="l00521"></a>00521 
<a name="l00522"></a>00522             <span class="comment">/* if we use the dates, it&#39;s here */</span>
<a name="l00523"></a>00523             <span class="keywordflow">if</span> (<a class="code" href="gsb__data__print__config_8c.html#a10c52e1083f665efc453c87daff007a7">gsb_data_print_config_get_draw_interval_dates</a> () &amp;&amp; draw_initial_date &amp;&amp; draw_final_date
<a name="l00524"></a>00524                 &amp;&amp; record -&gt; what_is_line == <a class="code" href="custom__list_8h.html#a6845cc455dccec2a61535b0faa09414d">IS_TRANSACTION</a>)
<a name="l00525"></a>00525             {
<a name="l00526"></a>00526                 <span class="comment">/* we want an interval, so check the transaction */</span>
<a name="l00527"></a>00527                 gint transaction_number;
<a name="l00528"></a>00528                 <span class="keyword">const</span> GDate *date = NULL;
<a name="l00529"></a>00529 
<a name="l00530"></a>00530                 transaction_number = <a class="code" href="gsb__data__transaction_8c.html#a99bf548513083f4a71fe019faeccbe0a">gsb_data_transaction_get_transaction_number</a> (record -&gt; transaction_pointer);
<a name="l00531"></a>00531                 <span class="keywordflow">if</span> (<a class="code" href="gsb__data__print__config_8c.html#a533bc3e1fa5039645557a0d959571497">gsb_data_print_config_get_draw_dates_are_value_dates</a> ())
<a name="l00532"></a>00532                     date = <a class="code" href="gsb__data__transaction_8c.html#a5851b4114a8f23b40107fba99ae2fbef">gsb_data_transaction_get_value_date</a> (transaction_number);
<a name="l00533"></a>00533 
<a name="l00534"></a>00534                 <span class="comment">/* if no value date, get the date */</span>
<a name="l00535"></a>00535                 <span class="keywordflow">if</span> (!date)
<a name="l00536"></a>00536                     date = <a class="code" href="gsb__data__transaction_8c.html#ab0b62014885bcf3e2fbfff1ae9b32080">gsb_data_transaction_get_date</a> (transaction_number);
<a name="l00537"></a>00537 
<a name="l00538"></a>00538                 <span class="keywordflow">if</span> (g_date_compare (date,
<a name="l00539"></a>00539                                     draw_initial_date) &lt; 0
<a name="l00540"></a>00540                     ||
<a name="l00541"></a>00541                     g_date_compare (date,
<a name="l00542"></a>00542                                     draw_final_date) &gt; 0)
<a name="l00543"></a>00543                 {
<a name="l00544"></a>00544                     <span class="comment">/* the transaction is not into the dates, go to the next transaction */</span>
<a name="l00545"></a>00545                     current_row_to_print = current_row_to_print + custom_list -&gt; nb_rows_by_transaction;
<a name="l00546"></a>00546                     i--;
<a name="l00547"></a>00547                     <span class="keywordflow">continue</span>;
<a name="l00548"></a>00548                 }
<a name="l00549"></a>00549             }
<a name="l00550"></a>00550 
<a name="l00551"></a>00551             <span class="comment">/* begin the transaction, fill the background */</span>
<a name="l00552"></a>00552             <span class="keywordflow">if</span> (!i)
<a name="l00553"></a>00553                 print_transactions_list_draw_background (record, color_bg, line_position );
<a name="l00554"></a>00554 
<a name="l00555"></a>00555             <span class="comment">/* draw the last column */</span>
<a name="l00556"></a>00556             print_transactions_list_draw_column (page_width, line_position);
<a name="l00557"></a>00557 
<a name="l00558"></a>00558             line_position = print_transactions_list_draw_row (context, record, line_position);
<a name="l00559"></a>00559 
<a name="l00560"></a>00560             current_row_to_print++;
<a name="l00561"></a>00561 
<a name="l00562"></a>00562             <span class="comment">/* an archive is 1 line */</span>
<a name="l00563"></a>00563             <span class="keywordflow">if</span> (record -&gt; what_is_line == <a class="code" href="custom__list_8h.html#a0caea412748bef9b8222da212aaa0069">IS_ARCHIVE</a>)
<a name="l00564"></a>00564                 <span class="keywordflow">break</span>;
<a name="l00565"></a>00565         }
<a name="l00566"></a>00566 
<a name="l00567"></a>00567         <span class="comment">/* we are on the last record of the transaction or archive,</span>
<a name="l00568"></a>00568 <span class="comment">         * decrease the number of transactions to draw */</span>
<a name="l00569"></a>00569         <span class="keywordflow">if</span> (record -&gt; what_is_line == <a class="code" href="custom__list_8h.html#a6845cc455dccec2a61535b0faa09414d">IS_TRANSACTION</a>)
<a name="l00570"></a>00570         {
<a name="l00571"></a>00571             transactions_to_draw--;
<a name="l00572"></a>00572             total_transactions_printed++;
<a name="l00573"></a>00573         }
<a name="l00574"></a>00574 
<a name="l00575"></a>00575         <span class="comment">/* add a space between 2 transactions */</span>
<a name="l00576"></a>00576         line_position++;
<a name="l00577"></a>00577 
<a name="l00578"></a>00578         color_bg = !color_bg;
<a name="l00579"></a>00579     }
<a name="l00580"></a>00580 
<a name="l00581"></a>00581     <span class="comment">/* draw the last line */</span>
<a name="l00582"></a>00582     print_transactions_list_draw_line (line_position);
<a name="l00583"></a>00583     <span class="keywordflow">return</span> FALSE;
<a name="l00584"></a>00584 }
<a name="l00585"></a>00585 
<a name="l00586"></a>00586 
<a name="l00587"></a>00587 
<a name="l00597"></a>00597 gboolean print_transactions_list_get_visibles_lines ( gint *number_of_archives,
<a name="l00598"></a>00598                                                       gint *number_of_transactions )
<a name="l00599"></a>00599 {
<a name="l00600"></a>00600     gint i;
<a name="l00601"></a>00601     <a class="code" href="struct__CustomList.html">CustomList</a> *custom_list;
<a name="l00602"></a>00602     gint archives_nb = 0;
<a name="l00603"></a>00603     gint transactions_nb = 0;
<a name="l00604"></a>00604 
<a name="l00605"></a>00605     custom_list = <a class="code" href="transaction__model_8c.html#a416a1ee9231b6f7d74d3b0811902163a">transaction_model_get_model</a> ();
<a name="l00606"></a>00606 
<a name="l00607"></a>00607     <span class="keywordflow">for</span> (i=0 ; i&lt;custom_list -&gt; num_visibles_rows ; i++)
<a name="l00608"></a>00608     {
<a name="l00609"></a>00609         <a class="code" href="struct__CustomRecord.html">CustomRecord</a> *record;
<a name="l00610"></a>00610 
<a name="l00611"></a>00611         record = custom_list -&gt; visibles_rows[i];
<a name="l00612"></a>00612         <span class="keywordflow">switch</span> (record -&gt; what_is_line)
<a name="l00613"></a>00613         {
<a name="l00614"></a>00614             <span class="keywordflow">case</span> <a class="code" href="custom__list_8h.html#a0caea412748bef9b8222da212aaa0069">IS_ARCHIVE</a>:
<a name="l00615"></a>00615                 <span class="keywordflow">if</span> (<a class="code" href="gsb__data__print__config_8c.html#a6e773923f44e66e6e047ec8bd6bbdb21">gsb_data_print_config_get_draw_archives</a> ())
<a name="l00616"></a>00616                     archives_nb++;
<a name="l00617"></a>00617                 <span class="keywordflow">break</span>;
<a name="l00618"></a>00618             <span class="keywordflow">case</span> <a class="code" href="custom__list_8h.html#a6845cc455dccec2a61535b0faa09414d">IS_TRANSACTION</a>:
<a name="l00619"></a>00619                 <span class="keywordflow">if</span> (<a class="code" href="gsb__data__print__config_8c.html#a10c52e1083f665efc453c87daff007a7">gsb_data_print_config_get_draw_interval_dates</a> () &amp;&amp; draw_initial_date &amp;&amp; draw_final_date)
<a name="l00620"></a>00620                 {
<a name="l00621"></a>00621                     <span class="comment">/* we want an interval, so check the transaction */</span>
<a name="l00622"></a>00622                     gint transaction_number;
<a name="l00623"></a>00623                     <span class="keyword">const</span> GDate *date;
<a name="l00624"></a>00624 
<a name="l00625"></a>00625                     transaction_number = <a class="code" href="gsb__data__transaction_8c.html#a99bf548513083f4a71fe019faeccbe0a">gsb_data_transaction_get_transaction_number</a> (record -&gt; transaction_pointer);
<a name="l00626"></a>00626                     <span class="keywordflow">if</span> (<a class="code" href="gsb__data__print__config_8c.html#a533bc3e1fa5039645557a0d959571497">gsb_data_print_config_get_draw_dates_are_value_dates</a> ())
<a name="l00627"></a>00627                     {
<a name="l00628"></a>00628                         date = <a class="code" href="gsb__data__transaction_8c.html#a5851b4114a8f23b40107fba99ae2fbef">gsb_data_transaction_get_value_date</a> (transaction_number);
<a name="l00629"></a>00629 
<a name="l00630"></a>00630                         <span class="comment">/* if no value date, get the date */</span>
<a name="l00631"></a>00631                         <span class="keywordflow">if</span> (!date)
<a name="l00632"></a>00632                             date = <a class="code" href="gsb__data__transaction_8c.html#ab0b62014885bcf3e2fbfff1ae9b32080">gsb_data_transaction_get_date</a> (transaction_number);
<a name="l00633"></a>00633                     }
<a name="l00634"></a>00634                     <span class="keywordflow">else</span>
<a name="l00635"></a>00635                         date = <a class="code" href="gsb__data__transaction_8c.html#ab0b62014885bcf3e2fbfff1ae9b32080">gsb_data_transaction_get_date</a> (transaction_number);
<a name="l00636"></a>00636 
<a name="l00637"></a>00637                     <span class="keywordflow">if</span> (date
<a name="l00638"></a>00638                         &amp;&amp;
<a name="l00639"></a>00639                         g_date_compare (date,
<a name="l00640"></a>00640                                         draw_initial_date) &gt;= 0
<a name="l00641"></a>00641                         &amp;&amp;
<a name="l00642"></a>00642                         g_date_compare (date,
<a name="l00643"></a>00643                                         draw_final_date) &lt;= 0)
<a name="l00644"></a>00644                         transactions_nb++;
<a name="l00645"></a>00645                 }
<a name="l00646"></a>00646                 <span class="keywordflow">else</span>
<a name="l00647"></a>00647                     transactions_nb++;
<a name="l00648"></a>00648                 <span class="keywordflow">break</span>;
<a name="l00649"></a>00649         }
<a name="l00650"></a>00650     }
<a name="l00651"></a>00651     <span class="comment">/* before returning the value, transactions_nb is in fact the number of lines of visibles transactions,</span>
<a name="l00652"></a>00652 <span class="comment">     * so need to divide by the number of lines for 1 transaction, and remove the white line */</span>
<a name="l00653"></a>00653     transactions_nb = (transactions_nb - custom_list -&gt; nb_rows_by_transaction) / custom_list -&gt; nb_rows_by_transaction;
<a name="l00654"></a>00654 
<a name="l00655"></a>00655     *number_of_archives = archives_nb;
<a name="l00656"></a>00656     *number_of_transactions = transactions_nb;
<a name="l00657"></a>00657     <span class="keywordflow">return</span> FALSE;
<a name="l00658"></a>00658 }
<a name="l00659"></a>00659 
<a name="l00667"></a>00667 <span class="keyword">static</span> <span class="keywordtype">void</span> print_transactions_list_calculate_columns ( gdouble page_width )
<a name="l00668"></a>00668 {
<a name="l00669"></a>00669     gint total_text_width = 0;
<a name="l00670"></a>00670     gint column;
<a name="l00671"></a>00671 
<a name="l00672"></a>00672     <span class="comment">/* set the positions of the columns */</span>
<a name="l00673"></a>00673     columns_position[0] = 0.0;
<a name="l00674"></a>00674     <span class="keywordflow">for</span> ( column=1 ; column&lt;<a class="code" href="custom__list_8h.html#a94bc00a237b4803e1096242436b77bcf">CUSTOM_MODEL_VISIBLE_COLUMNS</a> ; column++)
<a name="l00675"></a>00675         columns_position[column] = (gdouble) (<a class="code" href="gsb__file__load_8c.html#a6e5e85a5f63608656ce9709950bb08e6">transaction_col_width</a>[column - 1]*page_width/100) + columns_position[column - 1];
<a name="l00676"></a>00676 
<a name="l00677"></a>00677     <span class="comment">/* set the page_width of the columns */</span>
<a name="l00678"></a>00678     <span class="keywordflow">for</span> (column = 0 ; column &lt; (CUSTOM_MODEL_VISIBLE_COLUMNS  - 1); column++ )
<a name="l00679"></a>00679     {
<a name="l00680"></a>00680         columns_width[column] = (columns_position[column + 1] - columns_position[column] - 3*<a class="code" href="gsb__data__print__config_8c.html#a9eee382b1ee81d2291ef4eb4aae4bb7a">gsb_data_print_config_get_draw_column</a> ()) * PANGO_SCALE;
<a name="l00681"></a>00681         total_text_width = total_text_width + columns_width[column];
<a name="l00682"></a>00682     }
<a name="l00683"></a>00683     <span class="comment">/* last column is the rest of the line */</span>
<a name="l00684"></a>00684     columns_width[CUSTOM_MODEL_VISIBLE_COLUMNS - 1] = (page_width -3*<a class="code" href="gsb__data__print__config_8c.html#a9eee382b1ee81d2291ef4eb4aae4bb7a">gsb_data_print_config_get_draw_column</a> ()*(CUSTOM_MODEL_VISIBLE_COLUMNS)) * PANGO_SCALE - total_text_width;
<a name="l00685"></a>00685 }
<a name="l00686"></a>00686 
<a name="l00697"></a>00697 <span class="keyword">static</span> gint print_transactions_list_draw_title ( GtkPrintContext *context,
<a name="l00698"></a>00698                                                  gint line_position )
<a name="l00699"></a>00699 {
<a name="l00700"></a>00700     <span class="keywordflow">if</span> (<a class="code" href="gsb__data__print__config_8c.html#afd8a78e043b717e6bc2a6a18b6ced76d">gsb_data_print_config_get_draw_title</a> () &amp;&amp; title_string &amp;&amp; strlen (title_string))
<a name="l00701"></a>00701     {
<a name="l00702"></a>00702         PangoLayout *layout;
<a name="l00703"></a>00703 
<a name="l00704"></a>00704         cairo_move_to (cr, 0, line_position);
<a name="l00705"></a>00705 
<a name="l00706"></a>00706         <span class="comment">/* create the new layout */</span>
<a name="l00707"></a>00707         layout = gtk_print_context_create_pango_layout (context);
<a name="l00708"></a>00708 
<a name="l00709"></a>00709         pango_layout_set_text (layout, title_string, -1);
<a name="l00710"></a>00710         pango_layout_set_font_description (layout, <a class="code" href="gsb__data__print__config_8c.html#a683c317369e1e940e1066cccd3306099">gsb_data_print_config_get_font_title</a> ());
<a name="l00711"></a>00711         pango_layout_set_width (layout,page_width*PANGO_SCALE);
<a name="l00712"></a>00712         pango_layout_set_alignment (layout, PANGO_ALIGN_CENTER);
<a name="l00713"></a>00713         pango_layout_set_ellipsize (layout, PANGO_ELLIPSIZE_END);
<a name="l00714"></a>00714         pango_cairo_show_layout (cr, layout);
<a name="l00715"></a>00715         g_object_unref (layout);
<a name="l00716"></a>00716         line_position = line_position + pango_font_description_get_size (<a class="code" href="gsb__data__print__config_8c.html#a683c317369e1e940e1066cccd3306099">gsb_data_print_config_get_font_title</a> ())/PANGO_SCALE;
<a name="l00717"></a>00717     }
<a name="l00718"></a>00718     <span class="keywordflow">return</span> line_position;
<a name="l00719"></a>00719 }
<a name="l00720"></a>00720 
<a name="l00728"></a>00728 <span class="keyword">static</span> gint print_transactions_list_draw_columns_title ( GtkPrintContext *context,
<a name="l00729"></a>00729                                                          gint line_position)
<a name="l00730"></a>00730 {
<a name="l00731"></a>00731     gint column;
<a name="l00732"></a>00732 
<a name="l00733"></a>00733     <span class="keywordflow">if</span> (!<a class="code" href="gsb__data__print__config_8c.html#a9eee382b1ee81d2291ef4eb4aae4bb7a">gsb_data_print_config_get_draw_column</a> ())
<a name="l00734"></a>00734         <span class="keywordflow">return</span> line_position;
<a name="l00735"></a>00735 
<a name="l00736"></a>00736     <span class="keywordflow">for</span> (column=0 ; column&lt;CUSTOM_MODEL_VISIBLE_COLUMNS ; column++)
<a name="l00737"></a>00737     {
<a name="l00738"></a>00738         PangoLayout *layout;
<a name="l00739"></a>00739         gchar *text;
<a name="l00740"></a>00740         gint column_position;
<a name="l00741"></a>00741 
<a name="l00742"></a>00742         column_position = columns_position[column];
<a name="l00743"></a>00743 
<a name="l00744"></a>00744         <span class="comment">/* get the text */</span>
<a name="l00745"></a>00745         text = _(<a class="code" href="affichage__liste_8c.html#abe5a25ede887e60c7f679c9ff03607f0">titres_colonnes_liste_operations</a>[column]);
<a name="l00746"></a>00746         <span class="keywordflow">if</span> (!text)
<a name="l00747"></a>00747             <span class="keywordflow">continue</span>;
<a name="l00748"></a>00748 
<a name="l00749"></a>00749         cairo_move_to (cr, column_position, line_position);
<a name="l00750"></a>00750 
<a name="l00751"></a>00751         <span class="comment">/* create the new layout */</span>
<a name="l00752"></a>00752         layout = gtk_print_context_create_pango_layout (context);
<a name="l00753"></a>00753 
<a name="l00754"></a>00754         pango_layout_set_text (layout, text, -1);
<a name="l00755"></a>00755         pango_layout_set_font_description (layout, <a class="code" href="gsb__data__print__config_8c.html#af32e6fae377170c98443900214ddd009">gsb_data_print_config_get_font_transactions</a> ());
<a name="l00756"></a>00756         pango_layout_set_width (layout,columns_width[column]);
<a name="l00757"></a>00757         pango_layout_set_alignment (layout, PANGO_ALIGN_CENTER);
<a name="l00758"></a>00758         pango_layout_set_ellipsize (layout, PANGO_ELLIPSIZE_END);
<a name="l00759"></a>00759 
<a name="l00760"></a>00760         pango_cairo_show_layout (cr, layout);
<a name="l00761"></a>00761         g_object_unref (layout);
<a name="l00762"></a>00762     }
<a name="l00763"></a>00763     line_position = line_position + size_row + <a class="code" href="gsb__data__print__config_8c.html#a6214f4edbeb618543155d93c1440fb13">gsb_data_print_config_get_draw_lines</a> ();
<a name="l00764"></a>00764 
<a name="l00765"></a>00765     <span class="keywordflow">return</span> line_position;
<a name="l00766"></a>00766 }
<a name="l00767"></a>00767 
<a name="l00768"></a>00768 
<a name="l00779"></a>00779 <span class="keyword">static</span> <span class="keywordtype">void</span> print_transactions_list_draw_background ( <a class="code" href="struct__CustomRecord.html">CustomRecord</a> *record,
<a name="l00780"></a>00780                                                       gboolean color_bg,
<a name="l00781"></a>00781                                                       gint line_position )
<a name="l00782"></a>00782 {
<a name="l00783"></a>00783     <span class="keywordflow">if</span> (!<a class="code" href="gsb__data__print__config_8c.html#aba43ee990b36315212df9e30ce5a640e">gsb_data_print_config_get_draw_background</a> ())
<a name="l00784"></a>00784         <span class="keywordflow">return</span>;
<a name="l00785"></a>00785 
<a name="l00786"></a>00786     <span class="keywordflow">if</span> (record -&gt; what_is_line == <a class="code" href="custom__list_8h.html#a0caea412748bef9b8222da212aaa0069">IS_ARCHIVE</a>)
<a name="l00787"></a>00787     {
<a name="l00788"></a>00788         cairo_rectangle (cr, 0, line_position, page_width, size_row + 2*<a class="code" href="gsb__data__print__config_8c.html#a6214f4edbeb618543155d93c1440fb13">gsb_data_print_config_get_draw_lines</a> ());
<a name="l00789"></a>00789         cairo_set_source_rgb (cr, (gdouble) <a class="code" href="affichage_8c.html#a881db8e6c000ad504ff0183a674cb196">archive_background_color</a>.red/65535, (gdouble) <a class="code" href="affichage_8c.html#a881db8e6c000ad504ff0183a674cb196">archive_background_color</a>.green/65535, (gdouble) <a class="code" href="affichage_8c.html#a881db8e6c000ad504ff0183a674cb196">archive_background_color</a>.blue/65535);
<a name="l00790"></a>00790     }
<a name="l00791"></a>00791     <span class="keywordflow">else</span>
<a name="l00792"></a>00792     {
<a name="l00793"></a>00793         <span class="keywordflow">if</span> (color_bg)
<a name="l00794"></a>00794         {
<a name="l00795"></a>00795             <a class="code" href="struct__CustomList.html">CustomList</a> *custom_list = <a class="code" href="transaction__model_8c.html#a416a1ee9231b6f7d74d3b0811902163a">transaction_model_get_model</a> ();
<a name="l00796"></a>00796             cairo_rectangle (cr, 0, line_position, page_width, custom_list -&gt; nb_rows_by_transaction * size_row + 2*<a class="code" href="gsb__data__print__config_8c.html#a6214f4edbeb618543155d93c1440fb13">gsb_data_print_config_get_draw_lines</a> ());
<a name="l00797"></a>00797             cairo_set_source_rgb (cr, (gdouble) <a class="code" href="affichage_8c.html#a58089bf9225ae2e274165369f8bc7a00">couleur_fond</a>[0].red/65535, (gdouble) <a class="code" href="affichage_8c.html#a58089bf9225ae2e274165369f8bc7a00">couleur_fond</a>[0].green/65535, (gdouble) <a class="code" href="affichage_8c.html#a58089bf9225ae2e274165369f8bc7a00">couleur_fond</a>[0].blue/65535);
<a name="l00798"></a>00798         }
<a name="l00799"></a>00799         <span class="keywordflow">else</span>
<a name="l00800"></a>00800         {
<a name="l00801"></a>00801             <a class="code" href="struct__CustomList.html">CustomList</a> *custom_list = <a class="code" href="transaction__model_8c.html#a416a1ee9231b6f7d74d3b0811902163a">transaction_model_get_model</a> ();
<a name="l00802"></a>00802             cairo_rectangle (cr, 0, line_position, page_width, custom_list -&gt; nb_rows_by_transaction * size_row + 2*<a class="code" href="gsb__data__print__config_8c.html#a6214f4edbeb618543155d93c1440fb13">gsb_data_print_config_get_draw_lines</a> ());
<a name="l00803"></a>00803             cairo_set_source_rgb (cr, (gdouble) <a class="code" href="affichage_8c.html#a58089bf9225ae2e274165369f8bc7a00">couleur_fond</a>[1].red/65535, (gdouble) <a class="code" href="affichage_8c.html#a58089bf9225ae2e274165369f8bc7a00">couleur_fond</a>[1].green/65535, (gdouble) <a class="code" href="affichage_8c.html#a58089bf9225ae2e274165369f8bc7a00">couleur_fond</a>[1].blue/65535);
<a name="l00804"></a>00804         }
<a name="l00805"></a>00805     }
<a name="l00806"></a>00806     cairo_fill (cr);
<a name="l00807"></a>00807     cairo_set_source_rgb (cr, 0.0, 0.0, 0.0);
<a name="l00808"></a>00808 }
<a name="l00809"></a>00809 
<a name="l00819"></a>00819 <span class="keyword">static</span> gint print_transactions_list_draw_line ( gint line_position )
<a name="l00820"></a>00820 {
<a name="l00821"></a>00821     <span class="keywordflow">if</span> (!<a class="code" href="gsb__data__print__config_8c.html#a6214f4edbeb618543155d93c1440fb13">gsb_data_print_config_get_draw_lines</a> ())
<a name="l00822"></a>00822         <span class="keywordflow">return</span> line_position;
<a name="l00823"></a>00823 
<a name="l00824"></a>00824     <span class="comment">/* add a space with the last transaction */</span>
<a name="l00825"></a>00825     line_position++;
<a name="l00826"></a>00826     cairo_move_to (cr, 0, line_position);
<a name="l00827"></a>00827     cairo_set_line_width (cr, 0.5);
<a name="l00828"></a>00828     cairo_line_to (cr, page_width, line_position);
<a name="l00829"></a>00829     cairo_stroke (cr);
<a name="l00830"></a>00830 
<a name="l00831"></a>00831     <span class="keywordflow">return</span> line_position;
<a name="l00832"></a>00832 }
<a name="l00833"></a>00833 
<a name="l00842"></a>00842 <span class="keyword">static</span> gint print_transactions_list_draw_column ( gint column_position,
<a name="l00843"></a>00843                                                  gint line_position )
<a name="l00844"></a>00844 {
<a name="l00845"></a>00845     <span class="keywordflow">if</span> (!<a class="code" href="gsb__data__print__config_8c.html#a9eee382b1ee81d2291ef4eb4aae4bb7a">gsb_data_print_config_get_draw_column</a> ())
<a name="l00846"></a>00846         <span class="keywordflow">return</span> column_position;
<a name="l00847"></a>00847 
<a name="l00848"></a>00848     cairo_move_to (cr, column_position, line_position);
<a name="l00849"></a>00849     cairo_set_line_width (cr, 0.5);
<a name="l00850"></a>00850     cairo_line_to (cr, column_position, line_position + size_row + 2*<a class="code" href="gsb__data__print__config_8c.html#a6214f4edbeb618543155d93c1440fb13">gsb_data_print_config_get_draw_lines</a> ());
<a name="l00851"></a>00851     cairo_stroke (cr);
<a name="l00852"></a>00852     <span class="comment">/* add a space with the next column */</span>
<a name="l00853"></a>00853     column_position++;
<a name="l00854"></a>00854 
<a name="l00855"></a>00855     <span class="keywordflow">return</span> column_position;
<a name="l00856"></a>00856 }
<a name="l00857"></a>00857 
<a name="l00865"></a>00865 <span class="keyword">static</span> gint print_transactions_list_draw_row ( GtkPrintContext *context,
<a name="l00866"></a>00866                                               <a class="code" href="struct__CustomRecord.html">CustomRecord</a> *record,
<a name="l00867"></a>00867                                               gint line_position )
<a name="l00868"></a>00868 {
<a name="l00869"></a>00869     gint column;
<a name="l00870"></a>00870     gfloat alignment[] = {
<a name="l00871"></a>00871         PANGO_ALIGN_CENTER, PANGO_ALIGN_CENTER, PANGO_ALIGN_LEFT, 
<a name="l00872"></a>00872         PANGO_ALIGN_CENTER, PANGO_ALIGN_RIGHT, PANGO_ALIGN_RIGHT, PANGO_ALIGN_RIGHT
<a name="l00873"></a>00873     };
<a name="l00874"></a>00874 
<a name="l00875"></a>00875     <span class="keywordflow">for</span> (column=0 ; column&lt;CUSTOM_MODEL_VISIBLE_COLUMNS ; column++)
<a name="l00876"></a>00876     {
<a name="l00877"></a>00877         PangoLayout *layout;
<a name="l00878"></a>00878         gchar *text;
<a name="l00879"></a>00879         gint column_position;
<a name="l00880"></a>00880 
<a name="l00881"></a>00881         column_position = columns_position[column];
<a name="l00882"></a>00882 
<a name="l00883"></a>00883         <span class="comment">/* draw first the column */</span>
<a name="l00884"></a>00884         column_position = print_transactions_list_draw_column (column_position, line_position);
<a name="l00885"></a>00885 
<a name="l00886"></a>00886         <span class="comment">/* get the text */</span>
<a name="l00887"></a>00887         text = record -&gt; visible_col[column];
<a name="l00888"></a>00888         <span class="keywordflow">if</span> (!text)
<a name="l00889"></a>00889             <span class="keywordflow">continue</span>;
<a name="l00890"></a>00890 
<a name="l00891"></a>00891         cairo_move_to (cr, column_position, line_position);
<a name="l00892"></a>00892 
<a name="l00893"></a>00893         <span class="comment">/* create the new layout */</span>
<a name="l00894"></a>00894         layout = gtk_print_context_create_pango_layout (context);
<a name="l00895"></a>00895 
<a name="l00896"></a>00896         pango_layout_set_text (layout, text, -1);
<a name="l00897"></a>00897         pango_layout_set_font_description (layout, <a class="code" href="gsb__data__print__config_8c.html#af32e6fae377170c98443900214ddd009">gsb_data_print_config_get_font_transactions</a> ());
<a name="l00898"></a>00898         pango_layout_set_width (layout,columns_width[column]);
<a name="l00899"></a>00899         pango_layout_set_alignment (layout, alignment[column]);
<a name="l00900"></a>00900         pango_layout_set_ellipsize (layout, PANGO_ELLIPSIZE_END);
<a name="l00901"></a>00901 
<a name="l00902"></a>00902         pango_cairo_show_layout (cr, layout);
<a name="l00903"></a>00903         g_object_unref (layout);
<a name="l00904"></a>00904     }
<a name="l00905"></a>00905     <span class="comment">/* go to the next row */</span>
<a name="l00906"></a>00906     line_position = line_position + size_row;
<a name="l00907"></a>00907 
<a name="l00908"></a>00908     <span class="keywordflow">return</span> line_position;
<a name="l00909"></a>00909 }
<a name="l00910"></a>00910 
<a name="l00911"></a>00911 <span class="preprocessor">#endif </span><span class="comment">/* GTK_CHECK_VERSION(2,12,0) */</span>
<a name="l00912"></a>00912 
<a name="l00913"></a>00913 
<a name="l00914"></a>00914 
<a name="l00915"></a>00915 <span class="comment">/* Local Variables: */</span>
<a name="l00916"></a>00916 <span class="comment">/* c-basic-offset: 4 */</span>
<a name="l00917"></a>00917 <span class="comment">/* End: */</span>
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Généré le Sat Aug 7 22:12:03 2010 pour Grisbi par&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
